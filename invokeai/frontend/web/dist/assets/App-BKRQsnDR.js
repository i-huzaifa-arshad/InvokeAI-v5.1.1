var xD=Object.defineProperty;var ky=e=>{throw TypeError(e)};var bD=(e,t,n)=>t in e?xD(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var b=(e,t,n)=>bD(e,typeof t!="symbol"?t+"":t,n),bm=(e,t,n)=>t.has(e)||ky("Cannot "+n);var L=(e,t,n)=>(bm(e,t,"read from private field"),n?n.call(e):t.get(e)),xt=(e,t,n)=>t.has(e)?ky("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(e):t.set(e,n),He=(e,t,n,s)=>(bm(e,t,"write to private field"),s?s.call(e,n):t.set(e,n),n),Le=(e,t,n)=>(bm(e,t,"access private method"),n);var Uu=(e,t,n,s)=>({set _(r){He(e,t,r,n)},get _(){return L(e,t,s)}});import{g as hw,w as yD,a as vD,r as l,i as gd,b as ym,c as Zc,d as pw,I as CD,e as fw,t as Lg,f as mw,h as Iy,j as gw,S as wD,k as jD,l as SD,m as kD,n as _y,o as xw,p as bw,q as yw,s as Yo,u as ID,v as vw,x as _D,y as MD,z as Pp,A as AD,B as ED,R as te,C as lx,D as xd,E as cx,F as LD,G as TD,H as PD,J as RD,P as DD,K as OD,L as ND,M as BD,N as $D,O as Fe,Q as Do,T as Mo,U as se,V as Ge,W as My,X as gt,Y as FD,Z as ur,_ as hr,$ as dx,a0 as Dn,a1 as Cw,a2 as ww,a3 as jw,a4 as Te,a5 as zD,a6 as VD,a7 as ux,a8 as fa,a9 as ma,aa as hx,ab as wl,ac as jl,ad as px,ae as Er,af as Lr,ag as HD,ah as WD,ai as Hl,aj as Rp,ak as fx,al as GD,am as UD,an as ZD,ao as qD,ap as KD,aq as Sw,ar as QD,as as YD,at as Xl,au as JD,av as XD,aw as kw,ax as Iw,ay as e8,az as t8,aA as n8,aB as s8,aC as mx,aD as gx,aE as _w,aF as Mw,aG as xx,aH as Aw,aI as Ew,aJ as Lw,aK as Tw,aL as Pw,aM as Rw,aN as Dw,aO as Ow,aP as o8,aQ as r8,aR as a8,aS as Nw,aT as Bw,aU as $w,aV as Fw,aW as zw,aX as Vw,aY as Hw,aZ as Tg,a_ as Pg,a$ as Ww,b0 as Gw,b1 as i8,b2 as l8,b3 as ec,b4 as ve,b5 as cn,b6 as he,b7 as Rg,b8 as Uw,b9 as E,ba as S,bb as c8,bc as Dp,bd as w,be as d8,bf as u8,bg as Kn,bh as Bd,bi as Pn,bj as bn,bk as bx,bl as bd,bm as Zw,bn as $d,bo as pe,bp as Gs,bq as Fd,br as Gr,bs as o,bt as yd,bu as zd,bv as yx,bw as wi,bx as tc,by as qw,bz as Ho,bA as Go,bB as h8,bC as Vd,bD as ji,bE as ss,bF as Kw,bG as Nr,bH as Qw,bI as Op,bJ as jh,bK as Tt,bL as p8,bM as f8,bN as Wl,bO as Ao,bP as Oo,bQ as Yw,bR as Jw,bS as Xw,bT as Ay,bU as m8,bV as g8,bW as x8,bX as b8,bY as nc,bZ as xe,b_ as j,b$ as Hd,c0 as Ct,c1 as Np,c2 as y8,c3 as ao,c4 as vx,c5 as No,c6 as O,c7 as On,c8 as ej,c9 as Cx,ca as wx,cb as jx,cc as yn,cd as pt,ce as Wd,cf as bt,cg as tj,ch as nj,ci as Je,cj as sc,ck as Gd,cl as Xe,cm as Br,cn as v8,co as sj,cp as oj,cq as Zu,cr as Sx,cs as Ey,ct as rj,cu as aj,cv as C8,cw as Ly,cx as kx,cy as V,cz as Ne,cA as Ud,cB as Ix,cC as U,cD as kn,cE as w8,cF as j8,cG as Gn,cH as Si,cI as Qt,cJ as ij,cK as S8,cL as lj,cM as cj,cN as Ty,cO as k8,cP as I8,cQ as zt,cR as ot,cS as dj,cT as hi,cU as Qn,cV as ds,cW as Zd,cX as uj,cY as Yn,cZ as hj,c_ as Jn,c$ as nn,d0 as me,d1 as dt,d2 as _8,d3 as M8,d4 as A8,d5 as E8,d6 as qe,d7 as Ve,d8 as _x,d9 as pr,da as it,db as L8,dc as pj,dd as Bp,de as T8,df as P8,dg as R8,dh as D8,di as O8,dj as fr,dk as co,dl as mr,dm as Bo,dn as Ea,dp as uo,dq as N8,dr as B8,ds as $8,dt as fj,du as mj,dv as La,dw as Mx,dx as Ax,dy as Ex,dz as Lx,dA as gj,dB as _e,dC as qn,dD as Ae,dE as qd,dF as F8,dG as Kd,dH as z8,dI as ks,dJ as xj,dK as V8,dL as Qd,dM as Ta,dN as Pa,dO as bj,dP as Un,dQ as $p,dR as Yd,dS as Ss,dT as yj,dU as H8,dV as vj,dW as Rn,dX as Q,dY as Ur,dZ as Vt,d_ as ar,d$ as W8,e0 as G8,e1 as ko,e2 as Fp,e3 as U8,e4 as Cj,e5 as Z8,e6 as q8,e7 as K8,e8 as Q8,e9 as Y8,ea as ki,eb as Ii,ec as rn,ed as oc,ee as mn,ef as J8,eg as X8,eh as e5,ei as wj,ej as t5,ek as n5,el as s5,em as o5,en as r5,eo as a5,ep as i5,eq as Tx,er as l5,es as ai,et as ls,eu as c5,ev as d5,ew as jj,ex as Sj,ey as Px,ez as Rx,eA as Dx,eB as rc,eC as io,eD as un,eE as u5,eF as Jd,eG as Ox,eH as Nx,eI as h5,eJ as kj,eK as Ij,eL as p5,eM as ya,eN as f5,eO as m5,eP as g5,eQ as _j,eR as Mj,eS as Aj,eT as os,eU as Gh,eV as Bx,eW as Uh,eX as Sl,eY as Dg,eZ as Ej,e_ as Lj,e$ as Gl,f0 as x5,f1 as va,f2 as ln,f3 as ze,f4 as Ms,f5 as Tj,f6 as Pj,f7 as Rj,f8 as b5,f9 as Tn,fa as cl,fb as Dj,fc as y5,fd as Zt,fe as Oe,ff as Oj,fg as Xs,fh as qu,fi as Py,fj as Zh,fk as Ca,fl as vm,fm as Og,fn as Ng,fo as Bg,fp as Ry,fq as Nj,fr as Bj,fs as v5,ft as C5,fu as w5,fv as j5,fw as Vi,fx as ir,fy as zp,fz as Dy,fA as Oy,fB as Ny,fC as By,fD as dl,fE as $g,fF as S5,fG as k5,fH as Fg,fI as Uo,fJ as $j,fK as Ra,fL as Hi,fM as I5,fN as $y,fO as Fy,fP as _5,fQ as M5,fR as zy,fS as Vy,fT as A5,fU as Hy,fV as qh,fW as Wy,fX as E5,fY as L5,fZ as Fj,f_ as T5,f$ as P5,g0 as R5,g1 as D5,g2 as O5,g3 as zj,g4 as Vj,g5 as zg,g6 as ul,g7 as Xd,g8 as N5,g9 as B5,ga as $5,gb as F5,gc as $x,gd as z5,ge as V5,gf as H5,gg as W5,gh as Hj,gi as Wj,gj as G5,gk as U5,gl as Fx,gm as eu,gn as zx,go as Gj,gp as Z5,gq as q5,gr as K5,gs as Q5,gt as Y5,gu as J5,gv as X5,gw as eO,gx as tO,gy as nO,gz as sO,gA as oO,gB as rO,gC as Uj,gD as Zj,gE as aO,gF as iO,gG as lO,gH as cO,gI as dO,gJ as uO,gK as hO,gL as Zr,gM as Da,gN as tu,gO as Vp,gP as Hp,gQ as qj,gR as Kj,gS as Qj,gT as Yj,gU as Jj,gV as Wp,gW as pO,gX as kl,gY as Vg,gZ as Vx,g_ as Xj,g$ as eS,h0 as Hx,h1 as Cm,h2 as fO,h3 as mO,h4 as gO,h5 as qc,h6 as xO,h7 as bO,h8 as Gp,h9 as yO,ha as wa,hb as ac,hc as _i,hd as vO,he as Wx,hf as CO,hg as wO,hh as jO,hi as tS,hj as SO,hk as kO,hl as nS,hm as sS,hn as IO,ho as _O,hp as Gx,hq as Ux,hr as MO,hs as oS,ht as rS,hu as AO,hv as aS,hw as iS,hx as lS,hy as Is,hz as EO,hA as LO,hB as Up,hC as Zx,hD as qx,hE as Kx,hF as Qx,hG as Yx,hH as cS,hI as Ia,hJ as TO,hK as PO,hL as Mi,hM as RO,hN as DO,hO as OO,hP as NO,hQ as dS,hR as BO,hS as $O,hT as FO,hU as uS,hV as hS,hW as pS,hX as fS,hY as zO,hZ as VO,h_ as Gy,h$ as HO,i0 as WO,i1 as Uy,i2 as GO,i3 as UO,i4 as ZO,i5 as qO,i6 as nu,i7 as KO,i8 as QO,i9 as YO,ia as JO,ib as XO,ic as su,id as e3,ie as t3,ig as n3,ih as s3,ii as o3,ij as r3,ik as a3,il as i3,im as l3,io as c3,ip as d3,iq as u3,ir as h3,is as p3,it as Zp,iu as f3,iv as ou,iw as m3,ix as Jx,iy as Zy,iz as qy,iA as g3,iB as x3,iC as b3,iD as y3,iE as v3,iF as Ky,iG as C3,iH as Xx,iI as w3,iJ as j3,iK as vd,iL as Kh,iM as ic,iN as mS,iO as ru,iP as gS,iQ as S3,iR as qp,iS as k3,iT as I3,iU as _3,iV as M3,iW as A3,iX as E3,iY as L3,iZ as T3,i_ as Qy,i$ as P3,j0 as R3,j1 as xS,j2 as D3,j3 as O3,j4 as N3,j5 as eb,j6 as bS,j7 as tb,j8 as B3,j9 as Hg,ja as $3,jb as yS,jc as Kp,jd as au,je as F3,jf as Wg,jg as vS,jh as CS,ji as wS,jj as nb,jk as sb,jl as ob,jm as z3,jn as rb,jo as V3,jp as Ul,jq as H3,jr as jS,js as nl,jt as ca,ju as W3,jv as G3,jw as U3,jx as Z3,jy as q3,jz as K3,jA as Q3,jB as Y3,jC as J3,jD as X3,jE as eN,jF as ab,jG as tN,jH as nN,jI as sN,jJ as oN,jK as rN,jL as Qh,jM as aN,jN as iN,jO as _a,jP as lN,jQ as cN,jR as dN,jS as ib,jT as uN,jU as hN,jV as pN,jW as fN,jX as mN,jY as gN,jZ as xN,j_ as bN,j$ as yN,k0 as vN,k1 as CN,k2 as wN,k3 as jN,k4 as SN,k5 as kN,k6 as IN,k7 as _N,k8 as MN,k9 as AN,ka as EN,kb as LN,kc as TN,kd as PN,ke as RN,kf as DN,kg as ON,kh as NN,ki as BN,kj as $N,kk as FN,kl as zN,km as VN,kn as HN,ko as WN,kp as GN,kq as UN,kr as ZN,ks as qN,kt as KN,ku as QN,kv as YN,kw as JN,kx as XN,ky as eB,kz as tB,kA as nB,kB as sB,kC as oB,kD as rB,kE as qr,kF as hl,kG as aB,kH as iu,kI as Qp,kJ as SS,kK as iB,kL as lB,kM as cB,kN as dB,kO as uB,kP as hB,kQ as is,kR as pB,kS as Ku,kT as fB,kU as kS,kV as mB,kW as gB,kX as lb,kY as xB,kZ as bB,k_ as IS,k$ as _S,l0 as yB,l1 as MS,l2 as vB,l3 as CB,l4 as wB,l5 as AS,l6 as ES,l7 as LS,l8 as Yy,l9 as jB,la as SB,lb as kB,lc as TS,ld as lu,le as cu,lf as PS,lg as RS,lh as DS,li as cb,lj as IB,lk as Gg,ll as OS,lm as Yp,ln as _B,lo as Tr,lp as NS,lq as MB,lr as AB,ls as Jp,lt as Sh,lu as EB,lv as db,lw as du,lx as LB,ly as TB,lz as PB,lA as RB,lB as DB,lC as OB,lD as BS,lE as NB,lF as BB,lG as $B,lH as FB,lI as zB,lJ as Qu,lK as VB,lL as HB,lM as WB,lN as GB,lO as UB,lP as ZB,lQ as ub,lR as $S,lS as qB,lT as KB,lU as QB,lV as YB,lW as JB,lX as FS,lY as XB,lZ as zS,l_ as e$,l$ as t$,m0 as lc,m1 as n$,m2 as s$,m3 as o$,m4 as r$,m5 as a$,m6 as i$,m7 as l$,m8 as c$,m9 as d$,ma as u$,mb as h$,mc as uu,md as VS,me as p$,mf as f$,mg as m$,mh as g$,mi as x$,mj as b$,mk as y$,ml as v$,mm as C$,mn as w$,mo as j$,mp as S$,mq as k$,mr as I$,ms as _$,mt as hb,mu as M$,mv as A$,mw as pb,mx as E$,my as HS,mz as L$,mA as T$,mB as fb,mC as WS,mD as P$,mE as R$,mF as D$,mG as mb,mH as O$,mI as N$,mJ as hu,mK as B$,mL as $$,mM as F$,mN as z$,mO as V$,mP as H$,mQ as W$,mR as Jy,mS as GS,mT as US,mU as G$,mV as ZS,mW as U$,mX as Z$,mY as q$,mZ as K$,m_ as Q$,m$ as qS,n0 as Y$,n1 as J$,n2 as X$,n3 as eF,n4 as tF,n5 as nF,n6 as sF,n7 as oF,n8 as rF,n9 as aF,na as iF,nb as lF,nc as gb,nd as Xy,ne as cF,nf as dF,ng as uF,nh as hF,ni as Ug,nj as KS,nk as QS,nl as ev,nm as tv,nn as pu,no as pF,np as fF,nq as Yu,nr as Xp,ns as Zg,nt as ef,nu as mF,nv as gF,nw as xF,nx as fu,ny as bF,nz as yF,nA as vF,nB as CF,nC as wF,nD as jF,nE as SF,nF as YS,nG as kF,nH as IF,nI as _F,nJ as MF,nK as AF,nL as EF,nM as LF,nN as JS,nO as XS,nP as qg,nQ as TF,nR as nv,nS as pl,nT as xb,nU as no,nV as ek,nW as bb,nX as Il,nY as Ko,nZ as ii,n_ as PF,n$ as RF,o0 as DF,o1 as tk,o2 as nk,o3 as sk,o4 as ok,o5 as rk,o6 as ak,o7 as OF,o8 as NF,o9 as BF,oa as $F,ob as FF,oc as zF,od as VF,oe as HF,of as yb,og as tf,oh as Kc,oi as ik,oj as lk,ok as ck,ol as WF,om as vb,on as dk,oo as uk,op as vs,oq as hk,or as cc,os as Yh,ot as pk,ou as GF,ov as Qc,ow as fl,ox as UF,oy as ZF,oz as qF,oA as KF,oB as sv,oC as ov,oD as QF,oE as YF,oF as JF,oG as XF,oH as e7,oI as wm,oJ as rv,oK as av,oL as jm,oM as t7,oN as n7,oO as s7,oP as o7,oQ as r7,oR as fk,oS as a7,oT as i7,oU as Cb,oV as l7,oW as c7,oX as mk,oY as d7,oZ as u7,o_ as h7,o$ as p7,p0 as f7,p1 as m7,p2 as g7,p3 as x7,p4 as b7,p5 as y7,p6 as v7,p7 as C7,p8 as w7,p9 as j7,pa as S7,pb as k7,pc as I7,pd as _7,pe as M7,pf as A7,pg as E7,ph as L7,pi as T7,pj as gk,pk as P7,pl as R7,pm as D7,pn as O7,po as N7,pp as xk,pq as B7,pr as $7,ps as F7,pt as iv,pu as z7,pv as lv,pw as V7,px as cv,py as H7,pz as sl,pA as kh,pB as W7,pC as G7,pD as U7,pE as Z7,pF as q7,pG as sa,pH as K7,pI as Q7,pJ as bk,pK as Y7,pL as dv,pM as uv,pN as J7,pO as X7,pP as e9,pQ as t9}from"./index-BbMnFGg9.js";var n9={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0};const s9=hw(n9);var o9=/\s([^'"/\s><]+?)[\s/>]|([^\s=]+)=\s?(".*?"|'.*?')/g;function hv(e){var t={type:"tag",name:"",voidElement:!1,attrs:{},children:[]},n=e.match(/<\/?([^\s]+?)[/\s>]/);if(n&&(t.name=n[1],(s9[n[1]]||e.charAt(e.length-2)==="/")&&(t.voidElement=!0),t.name.startsWith("!--"))){var s=e.indexOf("-->");return{type:"comment",comment:s!==-1?e.slice(4,s):""}}for(var r=new RegExp(o9),a=null;(a=r.exec(e))!==null;)if(a[0].trim())if(a[1]){var i=a[1].trim(),c=[i,""];i.indexOf("=")>-1&&(c=i.split("=")),t.attrs[c[0]]=c[1],r.lastIndex--}else a[2]&&(t.attrs[a[2]]=a[3].trim().substring(1,a[3].length-1));return t}var r9=/<[a-zA-Z0-9\-\!\/](?:"[^"]*"|'[^']*'|[^'">])*>/g,a9=/^\s*$/,i9=Object.create(null);function yk(e,t){switch(t.type){case"text":return e+t.content;case"tag":return e+="<"+t.name+(t.attrs?function(n){var s=[];for(var r in n)s.push(r+'="'+n[r]+'"');return s.length?" "+s.join(" "):""}(t.attrs):"")+(t.voidElement?"/>":">"),t.voidElement?e:e+t.children.reduce(yk,"")+"</"+t.name+">";case"comment":return e+"<!--"+t.comment+"-->"}}var l9={parse:function(e,t){t||(t={}),t.components||(t.components=i9);var n,s=[],r=[],a=-1,i=!1;if(e.indexOf("<")!==0){var c=e.indexOf("<");s.push({type:"text",content:c===-1?e:e.substring(0,c)})}return e.replace(r9,function(d,u){if(i){if(d!=="</"+n.name+">")return;i=!1}var h,p=d.charAt(1)!=="/",f=d.startsWith("<!--"),m=u+d.length,g=e.charAt(m);if(f){var x=hv(d);return a<0?(s.push(x),s):((h=r[a]).children.push(x),s)}if(p&&(a++,(n=hv(d)).type==="tag"&&t.components[n.name]&&(n.type="component",i=!0),n.voidElement||i||!g||g==="<"||n.children.push({type:"text",content:e.slice(m,e.indexOf("<",m))}),a===0&&s.push(n),(h=r[a-1])&&h.children.push(n),r[a]=n),(!p||n.voidElement)&&(a>-1&&(n.voidElement||n.name===d.slice(2,-1))&&(a--,n=a===-1?s:r[a]),!i&&g!=="<"&&g)){h=a===-1?s:r[a].children;var C=e.indexOf("<",m),y=e.slice(m,C===-1?void 0:C);a9.test(y)&&(y=" "),(C>-1&&a+h.length>=0||y!==" ")&&h.push({type:"text",content:y})}}),s},stringify:function(e){return e.reduce(function(t,n){return t+yk("",n)},"")}};const Sm=(e,t)=>{var s;if(!e)return!1;const n=((s=e.props)==null?void 0:s.children)??e.children;return t?n.length>0:!!n},km=e=>{var n,s;if(!e)return[];const t=((n=e.props)==null?void 0:n.children)??e.children;return(s=e.props)!=null&&s.i18nIsDynamicList?ml(t):t},c9=e=>Array.isArray(e)&&e.every(l.isValidElement),ml=e=>Array.isArray(e)?e:[e],d9=(e,t)=>{const n={...t};return n.props=Object.assign(e.props,t.props),n},vk=(e,t)=>{if(!e)return"";let n="";const s=ml(e),r=t!=null&&t.transSupportBasicHtmlNodes?t.transKeepBasicHtmlNodesFor??[]:[];return s.forEach((a,i)=>{if(gd(a))n+=`${a}`;else if(l.isValidElement(a)){const{props:c,type:d}=a,u=Object.keys(c).length,h=r.indexOf(d)>-1,p=c.children;if(!p&&h&&!u)n+=`<${d}/>`;else if(!p&&(!h||u)||c.i18nIsDynamicList)n+=`<${i}></${i}>`;else if(h&&u===1&&gd(p))n+=`<${d}>${p}</${d}>`;else{const f=vk(p,t);n+=`<${i}>${f}</${i}>`}}else if(a===null)ym("Trans: the passed in value is invalid - seems you passed in a null child.");else if(Zc(a)){const{format:c,...d}=a,u=Object.keys(d);if(u.length===1){const h=c?`${u[0]}, ${c}`:u[0];n+=`{{${h}}}`}else ym("react-i18next: the passed in object contained more than one variable - the object should look like {{ value, format }} where format is optional.",a)}else ym("Trans: the passed in value is invalid - seems you passed in a variable like {number} - please pass in variables for interpolation as full objects like {{number}}.",a)}),n},u9=(e,t,n,s,r,a)=>{if(t==="")return[];const i=s.transKeepBasicHtmlNodesFor||[],c=t&&new RegExp(i.map(C=>`<${C}`).join("|")).test(t);if(!e&&!c&&!a)return[t];const d={},u=C=>{ml(C).forEach(v=>{gd(v)||(Sm(v)?u(km(v)):Zc(v)&&!l.isValidElement(v)&&Object.assign(d,v))})};u(e);const h=l9.parse(`<0>${t}</0>`),p={...d,...r},f=(C,y,v)=>{var M;const I=km(C),k=g(I,y.children,v);return c9(I)&&k.length===0||(M=C.props)!=null&&M.i18nIsDynamicList?I:k},m=(C,y,v,I,k)=>{C.dummy?(C.children=y,v.push(l.cloneElement(C,{key:I},k?void 0:y))):v.push(...l.Children.map([C],M=>{const _={...M.props};return delete _.i18nIsDynamicList,l.createElement(M.type,{..._,key:I,ref:M.ref},k?null:y)}))},g=(C,y,v)=>{const I=ml(C);return ml(y).reduce((M,_,A)=>{var N,P;const D=((P=(N=_.children)==null?void 0:N[0])==null?void 0:P.content)&&n.services.interpolator.interpolate(_.children[0].content,p,n.language);if(_.type==="tag"){let z=I[parseInt(_.name,10)];v.length===1&&!z&&(z=v[0][_.name]),z||(z={});const W=Object.keys(_.attrs).length!==0?d9({props:_.attrs},z):z,X=l.isValidElement(W),ee=X&&Sm(_,!0)&&!_.voidElement,G=c&&Zc(W)&&W.dummy&&!X,re=Zc(e)&&Object.hasOwnProperty.call(e,_.name);if(gd(W)){const le=n.services.interpolator.interpolate(W,p,n.language);M.push(le)}else if(Sm(W)||ee){const le=f(W,_,v);m(W,le,M,A)}else if(G){const le=g(I,_.children,v);m(W,le,M,A)}else if(Number.isNaN(parseFloat(_.name)))if(re){const le=f(W,_,v);m(W,le,M,A,_.voidElement)}else if(s.transSupportBasicHtmlNodes&&i.indexOf(_.name)>-1)if(_.voidElement)M.push(l.createElement(_.name,{key:`${_.name}-${A}`}));else{const le=g(I,_.children,v);M.push(l.createElement(_.name,{key:`${_.name}-${A}`},le))}else if(_.voidElement)M.push(`<${_.name} />`);else{const le=g(I,_.children,v);M.push(`<${_.name}>${le}</${_.name}>`)}else if(Zc(W)&&!X){const le=_.children[0]?D:null;le&&M.push(le)}else m(W,D,M,A,_.children.length!==1||!D)}else if(_.type==="text"){const z=s.transWrapTextNodes,W=a?s.unescape(n.services.interpolator.interpolate(_.content,p,n.language)):n.services.interpolator.interpolate(_.content,p,n.language);z?M.push(l.createElement(z,{key:`${_.name}-${A}`},W)):M.push(W)}return M},[])},x=g([{dummy:!0,children:e||[]}],h,ml(e||[]));return km(x[0])};function h9({children:e,count:t,parent:n,i18nKey:s,context:r,tOptions:a={},values:i,defaults:c,components:d,ns:u,i18n:h,t:p,shouldUnescape:f,...m}){var z,W,X,ee,G,re;const g=h||pw();if(!g)return yD("You will need to pass in an i18next instance by using i18nextReactModule"),e;const x=p||g.t.bind(g)||(le=>le),C={...vD(),...(z=g.options)==null?void 0:z.react};let y=u||x.ns||((W=g.options)==null?void 0:W.defaultNS);y=gd(y)?[y]:y||["translation"];const v=vk(e,C),I=c||v||C.transEmptyNodeValue||s,{hashTransKey:k}=C,M=s||(k?k(v||I):v||I);(ee=(X=g.options)==null?void 0:X.interpolation)!=null&&ee.defaultVariables&&(i=i&&Object.keys(i).length>0?{...i,...g.options.interpolation.defaultVariables}:{...g.options.interpolation.defaultVariables});const _=i||t!==void 0&&!((re=(G=g.options)==null?void 0:G.interpolation)!=null&&re.alwaysFormat)||!e?a.interpolation:{interpolation:{...a.interpolation,prefix:"#$?",suffix:"?$#"}},A={...a,context:r||a.context,count:t,...i,..._,defaultValue:I,ns:y},D=M?x(M,A):I;d&&Object.keys(d).forEach(le=>{const Ce=d[le];if(typeof Ce.type=="function"||!Ce.props||!Ce.props.children||D.indexOf(`${le}/>`)<0&&D.indexOf(`${le} />`)<0)return;function be(){return l.createElement(l.Fragment,null,Ce)}d[le]=l.createElement(be)});const N=u9(d||e,D,g,C,A,f),P=n??C.defaultTransParent;return P?l.createElement(P,m,N):N}function Cs({children:e,count:t,parent:n,i18nKey:s,context:r,tOptions:a={},values:i,defaults:c,components:d,ns:u,i18n:h,t:p,shouldUnescape:f,...m}){var v;const{i18n:g,defaultNS:x}=l.useContext(CD)||{},C=h||g||pw(),y=p||(C==null?void 0:C.t.bind(C));return h9({children:e,count:t,parent:n,i18nKey:s,context:r,tOptions:a,values:i,defaults:c,components:d,ns:u||(y==null?void 0:y.ns)||x||((v=C==null?void 0:C.options)==null?void 0:v.defaultNS),i18n:C,t:p,shouldUnescape:f,...m})}var p9=fw.isFinite,f9=Math.min;function m9(e){var t=Math[e];return function(n,s){if(n=Lg(n),s=s==null?0:f9(mw(s),292),s&&p9(n)){var r=(Iy(n)+"e").split("e"),a=t(r[0]+"e"+(+r[1]+s));return r=(Iy(a)+"e").split("e"),+(r[0]+"e"+(+r[1]-s))}return t(n)}}var Im=function(){return fw.Date.now()},g9="Expected a function",x9=Math.max,b9=Math.min;function Ai(e,t,n){var s,r,a,i,c,d,u=0,h=!1,p=!1,f=!0;if(typeof e!="function")throw new TypeError(g9);t=Lg(t)||0,gw(n)&&(h=!!n.leading,p="maxWait"in n,a=p?x9(Lg(n.maxWait)||0,t):a,f="trailing"in n?!!n.trailing:f);function m(_){var A=s,D=r;return s=r=void 0,u=_,i=e.apply(D,A),i}function g(_){return u=_,c=setTimeout(y,t),h?m(_):i}function x(_){var A=_-d,D=_-u,N=t-A;return p?b9(N,a-D):N}function C(_){var A=_-d,D=_-u;return d===void 0||A>=t||A<0||p&&D>=a}function y(){var _=Im();if(C(_))return v(_);c=setTimeout(y,x(_))}function v(_){return c=void 0,f&&s?m(_):(s=r=void 0,i)}function I(){c!==void 0&&clearTimeout(c),u=0,s=d=r=c=void 0}function k(){return c===void 0?i:v(Im())}function M(){var _=Im(),A=C(_);if(s=arguments,r=this,d=_,A){if(c===void 0)return g(d);if(p)return clearTimeout(c),c=setTimeout(y,t),m(d)}return c===void 0&&(c=setTimeout(y,t)),i}return M.cancel=I,M.flush=k,M}var y9=200;function v9(e,t,n,s){var r=-1,a=jD,i=!0,c=e.length,d=[],u=t.length;if(!c)return d;t.length>=y9&&(a=SD,i=!1,t=new wD(t));e:for(;++r<c;){var h=e[r],p=h;if(h=h!==0?h:0,i&&p===p){for(var f=u;f--;)if(t[f]===p)continue e;d.push(h)}else a(t,p,s)||d.push(h)}return d}var Ck=kD(function(e,t){return _y(e)?v9(e,xw(t,1,_y,!0)):[]});function C9(e,t){var n=[];return bw(e,function(s,r,a){t(s,r,a)&&n.push(s)}),n}function pv(e,t){var n=Yo(e)?ID:C9;return n(e,yw(t))}function w9(e,t){var n=-1,s=vw(e)?Array(e.length):[];return bw(e,function(r,a,i){s[++n]=t(r,a,i)}),s}function To(e,t){var n=Yo(e)?_D:w9;return n(e,yw(t))}function j9(e,t){return xw(To(e,t))}var S9=Math.max;function k9(e,t,n,s){e=vw(e)?e:MD(e),n=n&&!s?mw(n):0;var r=e.length;return n<0&&(n=S9(r+n,0)),Pp(e)?n<=r&&e.indexOf(t,n)>-1:!!r&&AD(e,t,n)>-1}function Ut(e){return e==null}var I9="Expected a function";function wk(e){if(typeof e!="function")throw new TypeError(I9);return function(){var t=arguments;switch(t.length){case 0:return!e.call(this);case 1:return!e.call(this,t[0]);case 2:return!e.call(this,t[0],t[1]);case 3:return!e.call(this,t[0],t[1],t[2])}return!e.apply(this,t)}}var wb=m9("round"),_9="Expected a function";function Kg(e,t,n){var s=!0,r=!0;if(typeof e!="function")throw new TypeError(_9);return gw(n)&&(s="leading"in n?!!n.leading:s,r="trailing"in n?!!n.trailing:r),Ai(e,t,{leading:s,maxWait:t,trailing:r})}function jk(e,t){return t=typeof t=="function"?t:void 0,e&&e.length?ED(e,void 0,t):[]}function jb(e){return Object.keys(e)}const Sk=({id:e,x:t,y:n,width:s,height:r,style:a,color:i,strokeColor:c,strokeWidth:d,className:u,borderRadius:h,shapeRendering:p,onClick:f,selected:m})=>{const{background:g,backgroundColor:x}=a||{},C=i||g||x;return te.createElement("rect",{className:lx(["react-flow__minimap-node",{selected:m},u]),x:t,y:n,rx:h,ry:h,width:s,height:r,fill:C,stroke:c,strokeWidth:d,shapeRendering:p,onClick:f?y=>f(y,e):void 0})};Sk.displayName="MiniMapNode";var M9=l.memo(Sk);const A9=e=>e.nodeOrigin,E9=e=>e.getNodes().filter(t=>!t.hidden&&t.width&&t.height),_m=e=>e instanceof Function?e:()=>e;function L9({nodeStrokeColor:e="transparent",nodeColor:t="#e2e2e2",nodeClassName:n="",nodeBorderRadius:s=5,nodeStrokeWidth:r=2,nodeComponent:a=M9,onClick:i}){const c=xd(E9,cx),d=xd(A9),u=_m(t),h=_m(e),p=_m(n),f=typeof window>"u"||window.chrome?"crispEdges":"geometricPrecision";return te.createElement(te.Fragment,null,c.map(m=>{const{x:g,y:x}=LD(m,d).positionAbsolute;return te.createElement(a,{key:m.id,x:g,y:x,width:m.width,height:m.height,style:m.style,selected:m.selected,className:p(m),color:u(m),borderRadius:s,strokeColor:h(m),strokeWidth:r,shapeRendering:f,onClick:i,id:m.id})}))}var T9=l.memo(L9);const P9=200,R9=150,D9=e=>{const t=e.getNodes(),n={x:-e.transform[0]/e.transform[2],y:-e.transform[1]/e.transform[2],width:e.width/e.transform[2],height:e.height/e.transform[2]};return{viewBB:n,boundingRect:t.length>0?OD(ND(t,e.nodeOrigin),n):n,rfId:e.rfId}},O9="react-flow__minimap-desc";function kk({style:e,className:t,nodeStrokeColor:n="transparent",nodeColor:s="#e2e2e2",nodeClassName:r="",nodeBorderRadius:a=5,nodeStrokeWidth:i=2,nodeComponent:c,maskColor:d="rgb(240, 240, 240, 0.6)",maskStrokeColor:u="none",maskStrokeWidth:h=1,position:p="bottom-right",onClick:f,onNodeClick:m,pannable:g=!1,zoomable:x=!1,ariaLabel:C="React Flow mini map",inversePan:y=!1,zoomStep:v=10,offsetScale:I=5}){const k=TD(),M=l.useRef(null),{boundingRect:_,viewBB:A,rfId:D}=xd(D9,cx),N=(e==null?void 0:e.width)??P9,P=(e==null?void 0:e.height)??R9,z=_.width/N,W=_.height/P,X=Math.max(z,W),ee=X*N,G=X*P,re=I*X,le=_.x-(ee-_.width)/2-re,Ce=_.y-(G-_.height)/2-re,be=ee+re*2,ye=G+re*2,ne=`${O9}-${D}`,R=l.useRef(0);R.current=X,l.useEffect(()=>{if(M.current){const B=PD(M.current),K=ae=>{const{transform:ue,d3Selection:Re,d3Zoom:we}=k.getState();if(ae.sourceEvent.type!=="wheel"||!Re||!we)return;const De=-ae.sourceEvent.deltaY*(ae.sourceEvent.deltaMode===1?.05:ae.sourceEvent.deltaMode?1:.002)*v,Me=ue[2]*Math.pow(2,De);we.scaleTo(Re,Me)},$=ae=>{const{transform:ue,d3Selection:Re,d3Zoom:we,translateExtent:De,width:Me,height:ht}=k.getState();if(ae.sourceEvent.type!=="mousemove"||!Re||!we)return;const st=R.current*Math.max(1,ue[2])*(y?-1:1),We={x:ue[0]-ae.sourceEvent.movementX*st,y:ue[1]-ae.sourceEvent.movementY*st},T=[[0,0],[Me,ht]],H=BD.translate(We.x,We.y).scale(ue[2]),q=we.constrain()(H,T,De);we.transform(Re,q)},Y=RD().on("zoom",g?$:null).on("zoom.wheel",x?K:null);return B.call(Y),()=>{B.on("zoom",null)}}},[g,x,y,v]);const F=f?B=>{const K=$D(B);f(B,{x:K[0],y:K[1]})}:void 0,Z=m?(B,K)=>{const $=k.getState().nodeInternals.get(K);m(B,$)}:void 0;return te.createElement(DD,{position:p,style:e,className:lx(["react-flow__minimap",t]),"data-testid":"rf__minimap"},te.createElement("svg",{width:N,height:P,viewBox:`${le} ${Ce} ${be} ${ye}`,role:"img","aria-labelledby":ne,ref:M,onClick:F},C&&te.createElement("title",{id:ne},C),te.createElement(T9,{onClick:Z,nodeColor:s,nodeStrokeColor:n,nodeBorderRadius:a,nodeClassName:r,nodeStrokeWidth:i,nodeComponent:c}),te.createElement("path",{className:"react-flow__minimap-mask",d:`M${le-re},${Ce-re}h${be+re*2}v${ye+re*2}h${-be-re*2}z
        M${A.x},${A.y}h${A.width}v${A.height}h${-A.width}z`,fill:d,fillRule:"evenodd",stroke:u,strokeWidth:h,pointerEvents:"none"})))}kk.displayName="MiniMap";var N9=l.memo(kk),Eo;(function(e){e.Lines="lines",e.Dots="dots",e.Cross="cross"})(Eo||(Eo={}));function B9({color:e,dimensions:t,lineWidth:n}){return te.createElement("path",{stroke:e,strokeWidth:n,d:`M${t[0]/2} 0 V${t[1]} M0 ${t[1]/2} H${t[0]}`})}function $9({color:e,radius:t}){return te.createElement("circle",{cx:t,cy:t,r:t,fill:e})}const F9={[Eo.Dots]:"#91919a",[Eo.Lines]:"#eee",[Eo.Cross]:"#e2e2e2"},z9={[Eo.Dots]:1,[Eo.Lines]:1,[Eo.Cross]:6},V9=e=>({transform:e.transform,patternId:`pattern-${e.rfId}`});function Ik({id:e,variant:t=Eo.Dots,gap:n=20,size:s,lineWidth:r=1,offset:a=2,color:i,style:c,className:d}){const u=l.useRef(null),{transform:h,patternId:p}=xd(V9,cx),f=i||F9[t],m=s||z9[t],g=t===Eo.Dots,x=t===Eo.Cross,C=Array.isArray(n)?n:[n,n],y=[C[0]*h[2]||1,C[1]*h[2]||1],v=m*h[2],I=x?[v,v]:y,k=g?[v/a,v/a]:[I[0]/a,I[1]/a];return te.createElement("svg",{className:lx(["react-flow__background",d]),style:{...c,position:"absolute",width:"100%",height:"100%",top:0,left:0},ref:u,"data-testid":"rf__background"},te.createElement("pattern",{id:p+e,x:h[0]%y[0],y:h[1]%y[1],width:y[0],height:y[1],patternUnits:"userSpaceOnUse",patternTransform:`translate(-${k[0]},-${k[1]})`},g?te.createElement($9,{color:f,radius:v/a}):te.createElement(B9,{dimensions:I,color:f,lineWidth:r})),te.createElement("rect",{x:"0",y:"0",width:"100%",height:"100%",fill:`url(#${p+e})`}))}Ik.displayName="Background";var H9=l.memo(Ik);const Mm=new Set;function wt(e){l.useEffect(()=>(Fe(!Mm.has(e),`There should be only one instance of ${e}`),Mm.add(e),()=>{Mm.delete(e)}),[e])}const _k=Do("system"),_l={gallery:new Set,layers:new Set,canvas:new Set,workflows:new Set,viewer:new Set},Sb=Ge(null),W9=jb(_l).reduce((e,t)=>(e[`$${t}`]=Mo(Sb,n=>n===t),e),{}),Qg=e=>{Sb.set(e),_k.trace(`Focus changed: ${e}`)},Oa=(e,t,n)=>{l.useEffect(()=>{if(!t.current)return;const{focusOnMount:s=!1}={focusOnMount:!1,...n},r=t.current;return _l[e].add(r),s&&Qg(e),()=>{_l[e].delete(r),_l[e].size===0&&Sb.get()===e&&Qg(null)}},[n,t,e])},js=e=>se(W9[`$${e}`]),fv=e=>{var r;const t=document.activeElement;if(!(t instanceof HTMLElement))return;const n=[];for(const a of jb(_l))for(const i of _l[a])i.contains(t)&&n.push({region:a,element:i});if(n.length===0)return;n.sort((a,i)=>i.element.contains(a.element)?-1:a.element.contains(i.element)?1:0);const s=(r=n[0])==null?void 0:r.region;if(!s){_k.warn("No focused region found");return}Qg(s)},G9=()=>{wt("useFocusRegionWatcher"),l.useEffect(()=>(window.addEventListener("focus",fv,{capture:!0}),()=>{window.removeEventListener("focus",fv,{capture:!0})}),[])},U9=e=>Object.keys(e),$o=(e,t)=>{var s;if(!e)throw new My(t||"Missing base");const n=(s=gt().getState().params.model)==null?void 0:s.base;if(n&&e!==n)throw new My(t||`Incompatible base models: ${e} and ${n}`)},Z9=e=>($o("sdxl","Refiner incompatible with currently-selected model"),new Promise(t=>{t(e)})),q9=e=>($o(e.base,"VAE incompatible with currently-selected model"),new Promise(t=>{t(e)})),K9=e=>($o("flux","T5 Encoder incompatible with currently-selected model"),new Promise(t=>{t(e)})),Q9=e=>($o(e.model.base,"LoRA incompatible with currently-selected model"),new Promise(t=>{t(e)})),Y9=e=>{const t=[];return e.forEach(n=>{try{$o(n.model.base,"LoRA incompatible with currently-selected model"),t.push(n)}catch{}}),new Promise(n=>{n(t)})},J9=e=>{var t;return $o((t=e.model)==null?void 0:t.base,"ControlNet incompatible with currently-selected model"),new Promise(n=>{n(e)})},X9=e=>{const t=[];return e.forEach(n=>{var s;try{$o((s=n.model)==null?void 0:s.base,"ControlNet incompatible with currently-selected model"),t.push(n)}catch{}}),new Promise(n=>{n(t)})},ez=e=>{var t;return $o((t=e.model)==null?void 0:t.base,"T2I Adapter incompatible with currently-selected model"),new Promise(n=>{n(e)})},tz=e=>{const t=[];return e.forEach(n=>{var s;try{$o((s=n.model)==null?void 0:s.base,"T2I Adapter incompatible with currently-selected model"),t.push(n)}catch{}}),new Promise(n=>{n(t)})},nz=e=>{var t;return $o((t=e.model)==null?void 0:t.base,"IP Adapter incompatible with currently-selected model"),new Promise(n=>{n(e)})},sz=e=>{const t=[];return e.forEach(n=>{var s;try{$o((s=n.model)==null?void 0:s.base,"IP Adapter incompatible with currently-selected model"),t.push(n)}catch{}}),new Promise(n=>{n(t)})},Ju={refinerModel:Z9,vaeModel:q9,t5EncoderModel:K9,lora:Q9,loras:Y9,controlNet:J9,controlNets:X9,t2iAdapter:ez,t2iAdapters:tz,ipAdapter:nz,ipAdapters:sz},Wi=Symbol("pending"),Za=Symbol("failed");class oz extends Error{constructor(t){super(t),this.name=this.constructor.name}}const Ee=(e,t,n=s=>!0)=>new Promise((s,r)=>{const a=fx(e,t);n(a)&&s(a),r(new oz(`Property ${t} is not of expected type`))}),rz=e=>Ee(e,"created_by",Pp),az=e=>Ee(e,"generation_mode",Pp),iz=e=>Ee(e,"positive_prompt",GD),lz=e=>Ee(e,"negative_prompt",UD),cz=e=>Ee(e,"positive_style_prompt",ZD),dz=e=>Ee(e,"negative_style_prompt",qD),uz=e=>Ee(e,"seed",KD),hz=e=>Ee(e,"cfg_scale",Sw),pz=e=>Ee(e,"cfg_rescale_multiplier",QD),fz=e=>Ee(e,"guidance",YD),mz=e=>Ee(e,"scheduler",Xl),gz=e=>Ee(e,"width",JD),xz=e=>Ee(e,"height",XD),bz=e=>Ee(e,"steps",kw),yz=e=>Ee(e,"strength",Iw),vz=async e=>{try{return await Ee(e,"hrf_enabled",FD)}catch{return!1}},Cz=e=>Ee(e,"hrf_strength",Iw),wz=e=>Ee(e,"hrf_method",e8),jz=e=>Ee(e,"refiner_steps",kw),Sz=e=>Ee(e,"refiner_cfg_scale",Sw),kz=e=>Ee(e,"refiner_scheduler",Xl),Iz=e=>Ee(e,"refiner_positive_aesthetic_score",t8),_z=e=>Ee(e,"refiner_negative_aesthetic_score",n8),Mz=e=>Ee(e,"refiner_start",s8),Az=async e=>{const t=await Ee(e,"model",void 0),n=await ur(t,"main"),s=await hr(n,dx);return Dn.parse(s)},Ez=async e=>{const t=await Ee(e,"refiner_model",void 0),n=await ur(t,"main"),s=await hr(n,Cw);return Dn.parse(s)},Lz=async e=>{const t=await Ee(e,"vae",void 0),n=await ur(t,"vae"),s=await hr(n,ww);return Dn.parse(s)},Mk=async e=>{const t=await Ee(e,"lora",void 0),n=await Ee(e,"model",void 0),s=await Ee(e,"weight",void 0),r=await ur(n??t,"lora"),a=await hr(r,jw);return{id:Te("lora"),model:Dn.parse(a),weight:zD(s)?s:VD.weight,isEnabled:!0}},Tz=async e=>{try{const t=await Ee(e,"loras",Yo);return(await Promise.allSettled(t.map(r=>Mk(r)))).filter(r=>r.status==="fulfilled").map(r=>r.value)}catch{return[]}},Ak=async e=>{const t=await Ee(e,"control_model"),n=await ur(t,"controlnet"),s=await hr(n,ux),r=fa.shape.control_weight.nullish().catch(null).parse(await Ee(e,"control_weight")),a=fa.shape.begin_step_percent.nullish().catch(null).parse(await Ee(e,"begin_step_percent")),i=fa.shape.end_step_percent.nullish().catch(null).parse(await Ee(e,"end_step_percent")),c=fa.shape.control_mode.nullish().catch(null).parse(await Ee(e,"control_mode"));return{type:"controlnet",model:Dn.parse(s),weight:typeof r=="number"?r:ma.weight,beginEndStepPct:[a??ma.beginEndStepPct[0],i??ma.beginEndStepPct[1]],controlMode:c??ma.controlMode}},Pz=async e=>{try{const t=await Ee(e,"controlnets",Yo);return(await Promise.allSettled(t.map(r=>Ak(r)))).filter(r=>r.status==="fulfilled").map(r=>r.value)}catch{return[]}},Ek=async e=>{const t=await Ee(e,"t2i_adapter_model"),n=await ur(t,"t2i_adapter"),s=await hr(n,hx),r=wl.shape.weight.nullish().catch(null).parse(await Ee(e,"weight")),a=wl.shape.begin_step_percent.nullish().catch(null).parse(await Ee(e,"begin_step_percent")),i=wl.shape.end_step_percent.nullish().catch(null).parse(await Ee(e,"end_step_percent"));return{type:"t2i_adapter",model:Dn.parse(s),weight:typeof r=="number"?r:jl.weight,beginEndStepPct:[a??jl.beginEndStepPct[0],i??jl.beginEndStepPct[1]]}},Rz=async e=>{try{const t=await Ee(e,"t2iAdapters",Yo);return(await Promise.allSettled(t.map(r=>Ek(r)))).filter(r=>r.status==="fulfilled").map(r=>r.value)}catch{return[]}},Lk=async e=>{const t=await Ee(e,"ip_adapter_model"),n=await ur(t,"ip_adapter"),s=await hr(n,px),r=Er.shape.weight.nullish().catch(null).parse(await Ee(e,"weight")),a=Er.shape.method.nullish().catch(null).parse(await Ee(e,"method")),i=Er.shape.begin_step_percent.nullish().catch(null).parse(await Ee(e,"begin_step_percent")),c=Er.shape.end_step_percent.nullish().catch(null).parse(await Ee(e,"end_step_percent"));return{type:"ip_adapter",model:Dn.parse(s),clipVisionModel:"ViT-H",image:null,weight:r??Lr.weight,method:a??Lr.method,beginEndStepPct:[i??Lr.beginEndStepPct[0],c??Lr.beginEndStepPct[1]]}},Dz=async e=>{try{const t=await Ee(e,"ipAdapters",Yo);return(await Promise.allSettled(t.map(r=>Lk(r)))).filter(r=>r.status==="fulfilled").map(r=>r.value)}catch{return[]}},Tk=e=>HD.parseAsync(e),Oz=async e=>{const t=await Ee(e,"canvas_v2_metadata",void 0);return WD.parseAsync(t)},Nz=async e=>{try{const t=[];try{const n=await Ee(e,"control_layers"),s=await Ee(n,"layers",Yo),a=(await Promise.allSettled(s.map(Tk))).filter(i=>i.status==="fulfilled").map(i=>i.value);t.push(...a)}catch{}try{const n=await Ee(e,"controlnets",Yo),r=(await Promise.allSettled(n.map(async a=>await Pk(a)))).filter(a=>a.status==="fulfilled").map(a=>a.value);t.push(...r)}catch{}try{const n=await Ee(e,"t2iAdapters",Yo),r=(await Promise.allSettled(n.map(async a=>await Rk(a)))).filter(a=>a.status==="fulfilled").map(a=>a.value);t.push(...r)}catch{}try{const n=await Ee(e,"ipAdapters",Yo),r=(await Promise.allSettled(n.map(async a=>await Dk(a)))).filter(a=>a.status==="fulfilled").map(a=>a.value);t.push(...r)}catch{}return t}catch{return[]}},Pk=async e=>{const t=await Ee(e,"control_model"),n=await ur(t,"controlnet"),s=await hr(n,ux),r=fa.shape.control_weight.nullish().catch(null).parse(await Ee(e,"control_weight")),a=fa.shape.begin_step_percent.nullish().catch(null).parse(await Ee(e,"begin_step_percent")),i=fa.shape.end_step_percent.nullish().catch(null).parse(await Ee(e,"end_step_percent")),c=fa.shape.control_mode.nullish().catch(null).parse(await Ee(e,"control_mode")),d=[a??ma.beginEndStepPct[0],i??ma.beginEndStepPct[1]];return{id:Te("control_layer"),type:"control_layer",isEnabled:!0,isLocked:!1,opacity:1,name:null,objects:[],position:{x:0,y:0},withTransparencyEffect:!1,controlAdapter:{type:"controlnet",model:Dn.parse(s),weight:typeof r=="number"?r:ma.weight,beginEndStepPct:d,controlMode:c??ma.controlMode}}},Rk=async e=>{const t=await Ee(e,"t2i_adapter_model"),n=await ur(t,"t2i_adapter"),s=await hr(n,hx),r=wl.shape.weight.nullish().catch(null).parse(await Ee(e,"weight")),a=wl.shape.begin_step_percent.nullish().catch(null).parse(await Ee(e,"begin_step_percent")),i=wl.shape.end_step_percent.nullish().catch(null).parse(await Ee(e,"end_step_percent")),c=[a??jl.beginEndStepPct[0],i??jl.beginEndStepPct[1]];return{id:Te("control_layer"),type:"control_layer",isEnabled:!0,isLocked:!1,opacity:1,position:{x:0,y:0},controlAdapter:{type:"t2i_adapter",model:Dn.parse(s),weight:typeof r=="number"?r:jl.weight,beginEndStepPct:c},name:null,objects:[],withTransparencyEffect:!1}},Dk=async e=>{const t=await Ee(e,"ip_adapter_model"),n=await ur(t,"ip_adapter"),s=await hr(n,px),r=Er.shape.image.nullish().catch(null).parse(await Ee(e,"image")),a=Er.shape.weight.nullish().catch(null).parse(await Ee(e,"weight")),i=Er.shape.method.nullish().catch(null).parse(await Ee(e,"method")),c=Er.shape.begin_step_percent.nullish().catch(null).parse(await Ee(e,"begin_step_percent")),d=Er.shape.end_step_percent.nullish().catch(null).parse(await Ee(e,"end_step_percent")),u=[c??Lr.beginEndStepPct[0],d??Lr.beginEndStepPct[1]],h=r?await Hl(r.image_name):null;return{id:Te("ip_adapter"),type:"reference_image",isEnabled:!0,isLocked:!1,name:null,ipAdapter:{type:"ip_adapter",model:Dn.parse(s),weight:typeof a=="number"?a:Lr.weight,beginEndStepPct:u,clipVisionModel:Lr.clipVisionModel,method:i??Lr.method,image:h?Rp(h):null}}},St={createdBy:rz,generationMode:az,positivePrompt:iz,negativePrompt:lz,sdxlPositiveStylePrompt:cz,sdxlNegativeStylePrompt:dz,seed:uz,cfgScale:hz,cfgRescaleMultiplier:pz,guidance:fz,scheduler:mz,width:gz,height:xz,steps:bz,strength:yz,hrfEnabled:vz,hrfStrength:Cz,hrfMethod:wz,refinerSteps:jz,refinerCFGScale:Sz,refinerScheduler:kz,refinerPositiveAestheticScore:Iz,refinerNegativeAestheticScore:_z,refinerStart:Mz,mainModel:Az,refinerModel:Ez,vaeModel:Lz,lora:Mk,loras:Tz,controlNet:Ak,controlNets:Pz,t2iAdapter:Ek,t2iAdapters:Rz,ipAdapter:Lk,ipAdapters:Dz,controlNetToControlLayer:Pk,t2iAdapterToControlAdapterLayer:Rk,ipAdapterToIPAdapterLayer:Dk,layer:Tk,layers:Nz,canvasV2Metadata:Oz},Bz=e=>{gt().dispatch(mx(e))},$z=e=>{gt().dispatch(gx(e))},Fz=e=>{gt().dispatch(_w(e))},zz=e=>{gt().dispatch(Mw(e))},Vz=e=>{gt().dispatch(xx(e))},Hz=e=>{gt().dispatch(Aw(e))},Wz=e=>{gt().dispatch(Ew(e))},Gz=e=>{gt().dispatch(Lw(e))},Uz=e=>{gt().dispatch(Tw(e))},Ok={updateAspectRatio:!0,clamp:!0},Zz=e=>{gt().dispatch(Pw({width:e,...Ok}))},qz=e=>{gt().dispatch(Rw({height:e,...Ok}))},Kz=e=>{gt().dispatch(Dw(e))},Qz=e=>{gt().dispatch(Ow(e))},Yz=e=>{gt().dispatch(o8(e))},Jz=e=>{gt().dispatch(r8(e))},Xz=e=>{gt().dispatch(a8(e))},eV=e=>{gt().dispatch(Nw(e))},tV=e=>{gt().dispatch(Bw(e))},nV=e=>{gt().dispatch($w(e))},sV=e=>{gt().dispatch(Fw(e))},oV=e=>{gt().dispatch(zw(e))},rV=e=>{gt().dispatch(Vw(e))},aV=e=>{gt().dispatch(Hw(e))},iV=e=>{gt().dispatch(Tg(e))},lV=e=>{if(!e){gt().dispatch(Pg(null));return}gt().dispatch(Pg(e))},cV=e=>{gt().dispatch(Ww(e))},dV=e=>{gt().dispatch(Gw({lora:e}))},uV=e=>{const{dispatch:t}=gt();t(i8()),e.length&&e.forEach(n=>{t(Gw({lora:n}))})},hV=e=>{if(e.controlLayers.length===0&&e.rasterLayers.length===0&&e.inpaintMasks.length===0&&e.referenceImages.length===0&&e.regionalGuidance.length===0)return;const{dispatch:t}=gt();t(l8(e))},Lt={positivePrompt:Bz,negativePrompt:$z,sdxlPositiveStylePrompt:Fz,sdxlNegativeStylePrompt:zz,seed:Vz,cfgScale:Hz,guidance:Wz,cfgRescaleMultiplier:Gz,scheduler:Uz,width:Zz,height:qz,steps:Kz,strength:Qz,hrfEnabled:Yz,hrfStrength:Jz,hrfMethod:Xz,refinerSteps:eV,refinerCFGScale:tV,refinerScheduler:nV,refinerPositiveAestheticScore:sV,refinerNegativeAestheticScore:oV,refinerStart:rV,model:aV,refinerModel:iV,vae:lV,lora:dV,loras:uV,t5EncoderModel:cV,canvasV2Metadata:hV},Am=async e=>{try{const t=await Uw(e.key);return`${t.name} (${t.base.toUpperCase()})`}catch{return`${e.key} (${e.base.toUpperCase()})`}},pV=async e=>{try{const t=await Uw(e.model.key);return`${t.name} (${t.base.toUpperCase()}) - ${e.weight}`}catch{return`${e.model.key} (${e.model.base.toUpperCase()}) - ${e.weight}`}},dc=e=>{he({id:"PARAMETER_SET",title:ve("toast.parameterSet"),description:ve("toast.parameterSetDesc",{parameter:e}),status:"info"})},nf=(e,t)=>{he({id:"PARAMETER_NOT_SET",title:ve("toast.parameterNotSet"),description:t?ve("toast.parameterNotSetDescWithMessage",{parameter:e,message:t}):ve("toast.parameterNotSetDesc",{parameter:e}),status:"warning"})},fV=e=>async(t,n=!1)=>{try{const s=await e.parser(t);return n&&dc(e.getLabel()),s}catch(s){throw n&&nf(e.getLabel(),s.message),s}},mV=e=>async(t,n=!1)=>{try{const s=await e.itemParser(t);return n&&dc(e.getLabel()),s}catch(s){throw n&&nf(e.getLabel(),s.message),s}},gV=e=>async(t,n=!1)=>{try{e.validator&&await e.validator(t),await e.recaller(t),n&&dc(e.getLabel())}catch(s){throw n&&nf(e.getLabel(),s.message),s}},xV=e=>async(t,n=!1)=>{try{e.itemValidator&&await e.itemValidator(t),await e.itemRecaller(t),n&&dc(e.getLabel())}catch(s){throw n&&nf(e.getLabel(),s.message),s}},mv=e=>new Promise(t=>{t(String(e))}),It=({getLabel:e,parser:t,itemParser:n,recaller:s,itemRecaller:r,validator:a,itemValidator:i,renderValue:c,renderItemValue:d,getIsVisible:u})=>({parse:fV({parser:t,getLabel:e}),parseItem:n?mV({itemParser:n,getLabel:e}):void 0,recall:s?gV({recaller:s,validator:a,getLabel:e}):void 0,recallItem:r?xV({itemRecaller:r,itemValidator:i,getLabel:e}):void 0,getLabel:e,renderValue:c??mv,renderItemValue:d??mv,getIsVisible:u}),rt={createdBy:It({getLabel:()=>ve("metadata.createdBy"),parser:St.createdBy}),generationMode:It({getLabel:()=>ve("metadata.generationMode"),parser:St.generationMode}),cfgRescaleMultiplier:It({getLabel:()=>ve("metadata.cfgRescaleMultiplier"),parser:St.cfgRescaleMultiplier,recaller:Lt.cfgRescaleMultiplier}),cfgScale:It({getLabel:()=>ve("metadata.cfgScale"),parser:St.cfgScale,recaller:Lt.cfgScale}),guidance:It({getLabel:()=>ve("metadata.guidance"),parser:St.guidance,recaller:Lt.guidance}),height:It({getLabel:()=>ve("metadata.height"),parser:St.height,recaller:Lt.height}),negativePrompt:It({getLabel:()=>ve("metadata.negativePrompt"),parser:St.negativePrompt,recaller:Lt.negativePrompt}),positivePrompt:It({getLabel:()=>ve("metadata.positivePrompt"),parser:St.positivePrompt,recaller:Lt.positivePrompt}),scheduler:It({getLabel:()=>ve("metadata.scheduler"),parser:St.scheduler,recaller:Lt.scheduler}),sdxlNegativeStylePrompt:It({getLabel:()=>ve("sdxl.negStylePrompt"),parser:St.sdxlNegativeStylePrompt,recaller:Lt.sdxlNegativeStylePrompt}),sdxlPositiveStylePrompt:It({getLabel:()=>ve("sdxl.posStylePrompt"),parser:St.sdxlPositiveStylePrompt,recaller:Lt.sdxlPositiveStylePrompt}),seed:It({getLabel:()=>ve("metadata.seed"),parser:St.seed,recaller:Lt.seed}),steps:It({getLabel:()=>ve("metadata.steps"),parser:St.steps,recaller:Lt.steps}),strength:It({getLabel:()=>ve("metadata.strength"),parser:St.strength,recaller:Lt.strength}),width:It({getLabel:()=>ve("metadata.width"),parser:St.width,recaller:Lt.width}),hrfEnabled:It({getLabel:()=>ve("hrf.metadata.enabled"),parser:St.hrfEnabled,recaller:Lt.hrfEnabled}),hrfMethod:It({getLabel:()=>ve("hrf.metadata.method"),parser:St.hrfMethod,recaller:Lt.hrfMethod}),hrfStrength:It({getLabel:()=>ve("hrf.metadata.strength"),parser:St.hrfStrength,recaller:Lt.hrfStrength}),refinerCFGScale:It({getLabel:()=>ve("sdxl.cfgScale"),parser:St.refinerCFGScale,recaller:Lt.refinerCFGScale}),refinerModel:It({getLabel:()=>ve("sdxl.refinermodel"),parser:St.refinerModel,recaller:Lt.refinerModel,validator:Ju.refinerModel,renderValue:Am}),refinerNegativeAestheticScore:It({getLabel:()=>ve("sdxl.posAestheticScore"),parser:St.refinerNegativeAestheticScore,recaller:Lt.refinerNegativeAestheticScore}),refinerPositiveAestheticScore:It({getLabel:()=>ve("sdxl.negAestheticScore"),parser:St.refinerPositiveAestheticScore,recaller:Lt.refinerPositiveAestheticScore}),refinerScheduler:It({getLabel:()=>ve("sdxl.scheduler"),parser:St.refinerScheduler,recaller:Lt.refinerScheduler}),refinerStart:It({getLabel:()=>ve("sdxl.refinerStart"),parser:St.refinerStart,recaller:Lt.refinerStart}),refinerSteps:It({getLabel:()=>ve("sdxl.refinerSteps"),parser:St.refinerSteps,recaller:Lt.refinerSteps}),model:It({getLabel:()=>ve("metadata.model"),parser:St.mainModel,recaller:Lt.model,renderValue:Am}),vae:It({getLabel:()=>ve("metadata.vae"),parser:St.vaeModel,recaller:Lt.vae,renderValue:Am,validator:Ju.vaeModel}),loras:It({getLabel:()=>ve("models.lora"),parser:St.loras,itemParser:St.lora,recaller:Lt.loras,itemRecaller:Lt.lora,validator:Ju.loras,itemValidator:Ju.lora,renderItemValue:pV}),canvasV2Metadata:It({getLabel:()=>ve("metadata.canvasV2Metadata"),parser:St.canvasV2Metadata,recaller:Lt.canvasV2Metadata})},bV=async e=>{const n=await kb(["positivePrompt","negativePrompt","sdxlPositiveStylePrompt","sdxlNegativeStylePrompt"],e);ec(n)>0&&dc(ve("metadata.allPrompts"))},yV=e=>{const t=kb(["width","height"],e);ec(t)>0&&dc(ve("metadata.imageDimensions"))},vV=["strength"],CV=[],Yg=async(e,t,n=[])=>{const s=cn(n);t?s.push(...vV):s.push(...CV);const r=U9(rt).filter(i=>!s.includes(i)),a=await kb(r,e);ec(a)>0?he({id:"PARAMETER_SET",title:ve("toast.parametersSet"),status:"info"}):he({id:"PARAMETER_SET",title:ve("toast.parametersNotSet"),status:"warning"})},kb=async(e,t)=>{const{dispatch:n}=gt(),s={},r=e.sort(a=>a==="model"?-1:0);for(const a of r){const{parse:i,recall:c}=rt[a];if(c)try{const d=await i(t);await c(d),s[a]=d}catch{}}return s.sdxlPositiveStylePrompt&&s.sdxlPositiveStylePrompt!==s.positivePrompt||s.sdxlNegativeStylePrompt&&s.sdxlNegativeStylePrompt!==s.negativePrompt?n(Rg(!1)):n(Rg(!0)),s},wV={isModalOpen:!1,updatingStylePresetId:null,prefilledFormData:null},Ma=Ge(wV),Nk=e=>{const t=E(),{t:n}=S(),[s,r]=c8();return[l.useCallback(async i=>{try{const{data:c}=await s(i);c?(t(Dp({data:c,asCopy:!0})),e!=null&&e.onSuccess&&(e==null||e.onSuccess())):he({id:"PROBLEM_RETRIEVING_WORKFLOW",title:n("toast.problemRetrievingWorkflow"),status:"error"})}catch{he({id:"PROBLEM_RETRIEVING_WORKFLOW",title:n("toast.problemRetrievingWorkflow"),status:"error"})}},[s,t,e,n]),r]};function jV(e,t,n){var s=this,r=l.useRef(null),a=l.useRef(0),i=l.useRef(null),c=l.useRef([]),d=l.useRef(),u=l.useRef(),h=l.useRef(e),p=l.useRef(!0);h.current=e;var f=typeof window<"u",m=!t&&t!==0&&f;if(typeof e!="function")throw new TypeError("Expected a function");t=+t||0;var g=!!(n=n||{}).leading,x=!("trailing"in n)||!!n.trailing,C="maxWait"in n,y="debounceOnServer"in n&&!!n.debounceOnServer,v=C?Math.max(+n.maxWait||0,t):null;l.useEffect(function(){return p.current=!0,function(){p.current=!1}},[]);var I=l.useMemo(function(){var k=function(P){var z=c.current,W=d.current;return c.current=d.current=null,a.current=P,u.current=h.current.apply(W,z)},M=function(P,z){m&&cancelAnimationFrame(i.current),i.current=m?requestAnimationFrame(P):setTimeout(P,z)},_=function(P){if(!p.current)return!1;var z=P-r.current;return!r.current||z>=t||z<0||C&&P-a.current>=v},A=function(P){return i.current=null,x&&c.current?k(P):(c.current=d.current=null,u.current)},D=function P(){var z=Date.now();if(_(z))return A(z);if(p.current){var W=t-(z-r.current),X=C?Math.min(W,v-(z-a.current)):W;M(P,X)}},N=function(){if(f||y){var P=Date.now(),z=_(P);if(c.current=[].slice.call(arguments),d.current=s,r.current=P,z){if(!i.current&&p.current)return a.current=r.current,M(D,t),g?k(r.current):u.current;if(C)return M(D,t),k(r.current)}return i.current||M(D,t),u.current}};return N.cancel=function(){i.current&&(m?cancelAnimationFrame(i.current):clearTimeout(i.current)),a.current=0,c.current=r.current=d.current=i.current=null},N.isPending=function(){return!!i.current},N.flush=function(){return i.current?A(Date.now()):u.current},N},[g,C,t,v,x,m,f,y]);return I}function SV(e,t){return e===t}function kV(e,t){return t}function Bk(e,t,n){var s=SV,r=l.useReducer(kV,e),a=r[0],i=r[1],c=jV(l.useCallback(function(u){return i(u)},[i]),t,n),d=l.useRef(e);return s(d.current,e)||(c(e),d.current=e),s(a,e)&&c.cancel(),[a,c]}const $k=e=>{const t=w(d8),[n]=Bk(e,t),{data:s,isLoading:r}=u8(n??Kn);return{metadata:s,isLoading:r}},Ib=e=>{const t=E(),{t:n}=S(),s=w(Bd),r=w(Pn),a=w(bn),{metadata:i}=$k(e.image_name),[c,d]=l.useState(!1),[u,h]=l.useState(!1),[p,f]=l.useState(!1),m=se(bx);l.useEffect(()=>{(async()=>{if(i){d(!0);try{await rt.seed.parse(i),h(!0)}catch{h(!1)}(await Promise.allSettled([rt.positivePrompt.parse(i).catch(()=>{}),rt.negativePrompt.parse(i).catch(()=>{}),rt.sdxlPositiveStylePrompt.parse(i).catch(()=>{}),rt.sdxlNegativeStylePrompt.parse(i).catch(()=>{})])).some(z=>z.status==="fulfilled")?f(!0):f(!1)}else d(!1),h(!1),f(!1)})()},[i]);const g=l.useCallback(()=>{s&&(t(bd(null)),he({status:"info",title:n("stylePresets.promptTemplateCleared")}))},[t,s,n]),x=l.useCallback(()=>{i&&(Yg(i,a==="canvas",r?["width","height"]:[]),g())},[i,a,r,g]),C=l.useCallback(()=>{i&&(Yg(i,a==="canvas",["seed"]),g())},[a,i,g]),y=l.useCallback(()=>{i&&rt.seed.parse(i).then(N=>{var P,z;(z=(P=rt.seed).recall)==null||z.call(P,N,!0)}).catch(()=>{})},[i]),v=l.useCallback(()=>{i&&(bV(i),g())},[i,g]),I=l.useCallback(async()=>{if(!i)return;let N,P;try{N=await rt.positivePrompt.parse(i)}catch{N=""}try{P=await rt.negativePrompt.parse(i)}catch{P=""}Ma.set({prefilledFormData:{name:"",positivePrompt:N,negativePrompt:P,imageUrl:e.image_url,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[i,e]),[k]=Nk(),M=l.useCallback(()=>{!e.has_workflow||!m||k(e.image_name)},[k,m,e.has_workflow,e.image_name]),_=l.useCallback(()=>{r||yV(e)},[e,r]),A=l.useCallback(()=>{t(Zw({imageDTO:e}))},[t,e]),D=l.useCallback(()=>{t($d([e]))},[t,e]);return{hasMetadata:c,hasSeed:u,hasPrompts:p,recallAll:x,remix:C,recallSeed:y,recallPrompts:v,createAsPreset:I,loadWorkflow:M,hasWorkflow:e.has_workflow,recallSize:_,upscale:A,delete:D}},dn=e=>{const t=l.useMemo(()=>pe(Gs,s=>!(s.disabledFeatures.includes(e)||s.disabledSDFeatures.includes(e)||s.disabledTabs.includes(e))),[e]);return w(t)};function Jg(){return Jg=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},Jg.apply(this,arguments)}var Fk=["shift","alt","meta","mod","ctrl"],IV={esc:"escape",return:"enter",".":"period",",":"comma","-":"slash"," ":"space","`":"backquote","#":"backslash","+":"bracketright",ShiftLeft:"shift",ShiftRight:"shift",AltLeft:"alt",AltRight:"alt",MetaLeft:"meta",MetaRight:"meta",OSLeft:"meta",OSRight:"meta",ControlLeft:"ctrl",ControlRight:"ctrl"};function ga(e){return(IV[e]||e).trim().toLowerCase().replace(/key|digit|numpad|arrow/,"")}function _V(e){return Fk.includes(e)}function Em(e,t){return t===void 0&&(t=","),e.split(t)}function Lm(e,t,n){t===void 0&&(t="+");var s=e.toLocaleLowerCase().split(t).map(function(i){return ga(i)}),r={alt:s.includes("alt"),ctrl:s.includes("ctrl")||s.includes("control"),shift:s.includes("shift"),meta:s.includes("meta"),mod:s.includes("mod")},a=s.filter(function(i){return!Fk.includes(i)});return Jg({},r,{keys:a,description:n})}(function(){typeof document<"u"&&(document.addEventListener("keydown",function(e){e.key!==void 0&&zk([ga(e.key),ga(e.code)])}),document.addEventListener("keyup",function(e){e.key!==void 0&&Vk([ga(e.key),ga(e.code)])})),typeof window<"u"&&window.addEventListener("blur",function(){xa.clear()})})();var xa=new Set;function _b(e){return Array.isArray(e)}function MV(e,t){t===void 0&&(t=",");var n=_b(e)?e:e.split(t);return n.every(function(s){return xa.has(s.trim().toLowerCase())})}function zk(e){var t=Array.isArray(e)?e:[e];xa.has("meta")&&xa.forEach(function(n){return!_V(n)&&xa.delete(n.toLowerCase())}),t.forEach(function(n){return xa.add(n.toLowerCase())})}function Vk(e){var t=Array.isArray(e)?e:[e];e==="meta"?xa.clear():t.forEach(function(n){return xa.delete(n.toLowerCase())})}function AV(e,t,n){(typeof n=="function"&&n(e,t)||n===!0)&&e.preventDefault()}function EV(e,t,n){return typeof n=="function"?n(e,t):n===!0||n===void 0}function LV(e){return Hk(e,["input","textarea","select"])}function Hk(e,t){var n=e.target;t===void 0&&(t=!1);var s=n&&n.tagName;return _b(t)?!!(s&&t&&t.some(function(r){return r.toLowerCase()===s.toLowerCase()})):!!(s&&t&&t===!0)}function TV(e,t){return e.length===0&&t?(console.warn('A hotkey has the "scopes" option set, however no active scopes were found. If you want to use the global scopes feature, you need to wrap your app in a <HotkeysProvider>'),!0):t?e.some(function(n){return t.includes(n)})||e.includes("*"):!0}var PV=function(t,n,s){s===void 0&&(s=!1);var r=n.alt,a=n.meta,i=n.mod,c=n.shift,d=n.ctrl,u=n.keys,h=t.key,p=t.code,f=t.ctrlKey,m=t.metaKey,g=t.shiftKey,x=t.altKey,C=ga(p),y=h.toLowerCase();if(!(u!=null&&u.includes(C))&&!(u!=null&&u.includes(y))&&!["ctrl","control","unknown","meta","alt","shift","os"].includes(C))return!1;if(!s){if(r===!x&&y!=="alt"||c===!g&&y!=="shift")return!1;if(i){if(!m&&!f)return!1}else if(a===!m&&y!=="meta"&&y!=="os"||d===!f&&y!=="ctrl"&&y!=="control")return!1}return u&&u.length===1&&(u.includes(y)||u.includes(C))?!0:u?MV(u):!u},RV=l.createContext(void 0),DV=function(){return l.useContext(RV)};function Wk(e,t){return e&&t&&typeof e=="object"&&typeof t=="object"?Object.keys(e).length===Object.keys(t).length&&Object.keys(e).reduce(function(n,s){return n&&Wk(e[s],t[s])},!0):e===t}var OV=l.createContext({hotkeys:[],enabledScopes:[],toggleScope:function(){},enableScope:function(){},disableScope:function(){}}),NV=function(){return l.useContext(OV)};function BV(e){var t=l.useRef(void 0);return Wk(t.current,e)||(t.current=e),t.current}var gv=function(t){t.stopPropagation(),t.preventDefault(),t.stopImmediatePropagation()},$V=typeof window<"u"?l.useLayoutEffect:l.useEffect;function lo(e,t,n,s){var r=l.useRef(null),a=l.useRef(!1),i=n instanceof Array?s instanceof Array?void 0:s:n,c=_b(e)?e.join(i==null?void 0:i.splitKey):e,d=n instanceof Array?n:s instanceof Array?s:void 0,u=l.useCallback(t,d??[]),h=l.useRef(u);d?h.current=u:h.current=t;var p=BV(i),f=NV(),m=f.enabledScopes,g=DV();return $V(function(){if(!((p==null?void 0:p.enabled)===!1||!TV(m,p==null?void 0:p.scopes))){var x=function(k,M){var _;if(M===void 0&&(M=!1),!(LV(k)&&!Hk(k,p==null?void 0:p.enableOnFormTags))){if(r.current!==null){var A=r.current.getRootNode();if((A instanceof Document||A instanceof ShadowRoot)&&A.activeElement!==r.current&&!r.current.contains(A.activeElement)){gv(k);return}}(_=k.target)!=null&&_.isContentEditable&&!(p!=null&&p.enableOnContentEditable)||Em(c,p==null?void 0:p.splitKey).forEach(function(D){var N,P=Lm(D,p==null?void 0:p.combinationKey);if(PV(k,P,p==null?void 0:p.ignoreModifiers)||(N=P.keys)!=null&&N.includes("*")){if(p!=null&&p.ignoreEventWhen!=null&&p.ignoreEventWhen(k)||M&&a.current)return;if(AV(k,P,p==null?void 0:p.preventDefault),!EV(k,P,p==null?void 0:p.enabled)){gv(k);return}h.current(k,P),M||(a.current=!0)}})}},C=function(k){k.key!==void 0&&(zk(ga(k.code)),((p==null?void 0:p.keydown)===void 0&&(p==null?void 0:p.keyup)!==!0||p!=null&&p.keydown)&&x(k))},y=function(k){k.key!==void 0&&(Vk(ga(k.code)),a.current=!1,p!=null&&p.keyup&&x(k,!0))},v=r.current||(i==null?void 0:i.document)||document;return v.addEventListener("keyup",y),v.addEventListener("keydown",C),g&&Em(c,p==null?void 0:p.splitKey).forEach(function(I){return g.addHotkey(Lm(I,p==null?void 0:p.combinationKey,p==null?void 0:p.description))}),function(){v.removeEventListener("keyup",y),v.removeEventListener("keydown",C),g&&Em(c,p==null?void 0:p.splitKey).forEach(function(I){return g.removeHotkey(Lm(I,p==null?void 0:p.combinationKey,p==null?void 0:p.description))})}}},[c,p,m]),r}const FV=(e,t)=>e.map(n=>t?n.split("+").map(s=>s.replaceAll("mod","cmd").replaceAll("alt","option")):n.split("+").map(s=>s.replaceAll("mod","ctrl"))),Gk=()=>{const{t:e}=S(),t=dn("modelManager"),n=l.useMemo(()=>navigator.userAgent.toLowerCase().includes("mac"),[]);return l.useMemo(()=>{const r={app:{title:e("hotkeys.app.title"),hotkeys:{}},canvas:{title:e("hotkeys.canvas.title"),hotkeys:{}},viewer:{title:e("hotkeys.viewer.title"),hotkeys:{}},gallery:{title:e("hotkeys.gallery.title"),hotkeys:{}},workflows:{title:e("hotkeys.workflows.title"),hotkeys:{}}},a=(i,c,d)=>{r[i].hotkeys[c]={id:c,category:i,title:e(`hotkeys.${i}.${c}.title`),desc:e(`hotkeys.${i}.${c}.desc`),hotkeys:d,platformKeys:FV(d,n)}};return a("app","invoke",["mod+enter"]),a("app","invokeFront",["mod+shift+enter"]),a("app","cancelQueueItem",["shift+x"]),a("app","clearQueue",["mod+shift+x"]),a("app","selectCanvasTab",["1"]),a("app","selectUpscalingTab",["2"]),a("app","selectWorkflowsTab",["3"]),t&&a("app","selectModelsTab",["4"]),a("app","selectQueueTab",t?["5"]:["4"]),a("app","focusPrompt",["alt+a"]),a("app","toggleLeftPanel",["t","o"]),a("app","toggleRightPanel",["g"]),a("app","resetPanelLayout",["shift+r"]),a("app","togglePanels",["f"]),a("canvas","selectBrushTool",["b"]),a("canvas","selectBboxTool",["c"]),a("canvas","decrementToolWidth",["["]),a("canvas","incrementToolWidth",["]"]),a("canvas","selectEraserTool",["e"]),a("canvas","selectMoveTool",["v"]),a("canvas","selectRectTool",["u"]),a("canvas","selectViewTool",["h"]),a("canvas","selectColorPickerTool",["i"]),a("canvas","setFillToWhite",["d"]),a("canvas","fitLayersToCanvas",["mod+0"]),a("canvas","fitBboxToCanvas",["mod+shift+0"]),a("canvas","setZoomTo100Percent",["mod+1"]),a("canvas","setZoomTo200Percent",["mod+2"]),a("canvas","setZoomTo400Percent",["mod+3"]),a("canvas","setZoomTo800Percent",["mod+4"]),a("canvas","quickSwitch",["q"]),a("canvas","deleteSelected",["delete","backspace"]),a("canvas","resetSelected",["shift+c"]),a("canvas","transformSelected",["shift+t"]),a("canvas","filterSelected",["shift+f"]),a("canvas","undo",["mod+z"]),a("canvas","redo",["mod+shift+z","mod+y"]),a("canvas","nextEntity",["alt+]"]),a("canvas","prevEntity",["alt+["]),a("canvas","applyFilter",["enter"]),a("canvas","cancelFilter",["esc"]),a("canvas","applyTransform",["enter"]),a("canvas","cancelTransform",["esc"]),a("workflows","addNode",["shift+a","space"]),a("workflows","copySelection",["mod+c"]),a("workflows","pasteSelection",["mod+v"]),a("workflows","pasteSelectionWithEdges",["mod+shift+v"]),a("workflows","selectAll",["mod+a"]),a("workflows","deleteSelection",["delete","backspace"]),a("workflows","undo",["mod+z"]),a("workflows","redo",["mod+shift+z","mod+y"]),a("viewer","toggleViewer",["z"]),a("viewer","swapImages",["c"]),a("viewer","nextComparisonMode",["m"]),a("viewer","loadWorkflow",["w"]),a("viewer","recallAll",["a"]),a("viewer","recallSeed",["s"]),a("viewer","recallPrompts",["p"]),a("viewer","remix",["r"]),a("viewer","useSize",["d"]),a("viewer","runPostprocessing",["shift+u"]),a("viewer","toggleMetadata",["i"]),a("gallery","selectAllOnPage",["mod+a"]),a("gallery","clearSelection",["esc"]),a("gallery","galleryNavUp",["up"]),a("gallery","galleryNavRight",["right"]),a("gallery","galleryNavDown",["down"]),a("gallery","galleryNavLeft",["left"]),a("gallery","galleryNavUpAlt",["alt+up"]),a("gallery","galleryNavRightAlt",["alt+right"]),a("gallery","galleryNavDownAlt",["alt+down"]),a("gallery","galleryNavLeftAlt",["alt+left"]),a("gallery","deleteSelection",["delete","backspace"]),r},[n,t,e])},Ie=({id:e,category:t,callback:n,options:s,dependencies:r})=>{const a=Gk(),i=l.useMemo(()=>{var d;const c=(d=a[t].hotkeys[e])==null?void 0:d.hotkeys;return Fe(c!==void 0,`Hotkey ${t}.${e} not found`),c},[t,a,e]);return lo(i,n,s,r)},Uk=l.memo(()=>{wt("GlobalImageHotkeys");const e=w(Fd),{currentData:t}=Gr((e==null?void 0:e.image_name)??Kn);return t?o.jsx(Zk,{imageDTO:t}):null});Uk.displayName="GlobalImageHotkeys";const Zk=l.memo(({imageDTO:e})=>{const t=js("gallery"),n=js("viewer"),s=Ib(e),r=w(Pn),a=dn("upscaling");return Ie({id:"loadWorkflow",category:"viewer",callback:s.loadWorkflow,options:{enabled:t||n},dependencies:[s.loadWorkflow,t,n]}),Ie({id:"recallAll",category:"viewer",callback:s.recallAll,options:{enabled:!r&&(t||n)},dependencies:[s.recallAll,r,t,n]}),Ie({id:"recallSeed",category:"viewer",callback:s.recallSeed,options:{enabled:t||n},dependencies:[s.recallSeed,t,n]}),Ie({id:"recallPrompts",category:"viewer",callback:s.recallPrompts,options:{enabled:t||n},dependencies:[s.recallPrompts,t,n]}),Ie({id:"remix",category:"viewer",callback:s.remix,options:{enabled:t||n},dependencies:[s.remix,t,n]}),Ie({id:"useSize",category:"viewer",callback:s.recallSize,options:{enabled:!r&&(t||n)},dependencies:[s.recallSize,r,t,n]}),Ie({id:"runPostprocessing",category:"viewer",callback:s.upscale,options:{enabled:a&&n},dependencies:[a,e,n]}),null});Zk.displayName="GlobalImageHotkeysInternal";const qk=l.createContext(null),Jo=l.memo(({children:e})=>{const t=se(yd);return t?o.jsx(qk.Provider,{value:t,children:e}):null});Jo.displayName="CanvasManagerProviderGate";const At=()=>{const e=l.useContext(qk);return Fe(e,"useCanvasManagerContext must be used within a CanvasManagerProviderGate"),e},Kk=()=>se(yd);let xv=!1;const Qk=wi(!0),zV=Qk[0],Ih=Qk[1],jt=()=>{const e=E(),t=Kk(),n=zV(),s=l.useCallback(()=>{!xv&&t&&(xv=!0,t.stage.fitLayersToStage()),n.setFalse()},[t,n]),r=l.useCallback(a=>{e(zd(null)),e(yx(a)),n.setTrue()},[e,n]);return{isOpen:n.isTrue,open:n.setTrue,close:s,toggle:n.toggle,$state:Ih,openImageInViewer:r}},Yk=tc("gallery/sentImageToCanvas"),VV=tc("gallery/imageDownloaded"),[mu,HV]=qw(!1),Vc=(e="")=>h8(`workflows/${e}`),pi=Ho.injectEndpoints({endpoints:e=>({getWorkflow:e.query({query:t=>Vc(`i/${t}`),providesTags:(t,n,s)=>[{type:"Workflow",id:s},"FetchOnReconnect"],onQueryStarted:async(t,n)=>{const{dispatch:s,queryFulfilled:r}=n;try{await r,s(pi.util.invalidateTags([{type:"WorkflowsRecent",id:Go}]))}catch{}}}),deleteWorkflow:e.mutation({query:t=>({url:Vc(`i/${t}`),method:"DELETE"}),invalidatesTags:(t,n,s)=>[{type:"Workflow",id:Go},{type:"Workflow",id:s},{type:"WorkflowsRecent",id:Go}]}),createWorkflow:e.mutation({query:t=>({url:Vc(),method:"POST",body:{workflow:t}}),invalidatesTags:[{type:"Workflow",id:Go},{type:"WorkflowsRecent",id:Go}]}),updateWorkflow:e.mutation({query:t=>({url:Vc(`i/${t.id}`),method:"PATCH",body:{workflow:t}}),invalidatesTags:(t,n,s)=>[{type:"WorkflowsRecent",id:Go},{type:"Workflow",id:Go},{type:"Workflow",id:s.id}]}),listWorkflows:e.query({query:t=>({url:Vc(),params:t}),providesTags:["FetchOnReconnect",{type:"Workflow",id:Go}]})})}),{useLazyGetWorkflowQuery:WV,useCreateWorkflowMutation:Jk,useDeleteWorkflowMutation:GV,useUpdateWorkflowMutation:UV,useListWorkflowsQuery:ZV}=pi,Xk=e=>{const t=E(),n=Vd(),{t:s}=S(),[r,a]=WV();return{getAndLoadWorkflow:l.useCallback(async c=>{try{const{workflow:d}=await r(c).unwrap();t(Dp({data:{workflow:JSON.stringify(d),graph:null},asCopy:!1})),e!=null&&e.onSuccess&&e.onSuccess()}catch{n({id:`AUTH_ERROR_TOAST_${pi.endpoints.getWorkflow.name}`,title:s("toast.problemRetrievingWorkflow"),status:"error"}),e!=null&&e.onError&&e.onError()}},[r,t,e,s,n]),getAndLoadWorkflowResult:a}},qV=e=>{wt("useStudioInitAction");const{t}=S(),n=l.useRef(!1),s=ji(),{getAndLoadWorkflow:r}=Xk(),a=l.useCallback(async h=>{const p=await ss(()=>Kw(h));if(p.isErr()){he({title:t("toast.unableToLoadImage"),status:"error"});return}const f=p.value,g={objects:[Nr(f)]};s.dispatch(Qw()),s.dispatch(Op({overrides:g,isSelected:!0})),s.dispatch(jh(!0)),s.dispatch(Tt("canvas")),s.dispatch(Yk()),Ih.set(!1),he({title:t("toast.sentToCanvas"),status:"info"})},[s,t]),i=l.useCallback(async h=>{const p=await ss(()=>p8(h));if(p.isErr()){he({title:t("toast.unableToLoadImageMetadata"),status:"error"});return}const f=p.value;Yg(f,!0),s.dispatch(Tt("canvas"))},[s,t]),c=l.useCallback(h=>{r(h),s.dispatch(Tt("workflows"))},[r,s]),d=l.useCallback(async h=>{if((await ss(()=>f8(h))).isErr()){he({title:t("toast.unableToLoadStylePreset"),status:"error"});return}s.dispatch(bd(h)),s.dispatch(Tt("canvas")),he({title:t("toast.stylePresetLoaded"),status:"info"})},[s,t]),u=l.useCallback(h=>{switch(h){case"generation":s.dispatch(Tt("canvas")),s.dispatch(Ao("gallery")),s.dispatch(jh(!1)),Ih.set(!0);break;case"canvas":s.dispatch(Tt("canvas")),s.dispatch(jh(!0)),Ih.set(!1);break;case"workflows":s.dispatch(Tt("workflows"));break;case"upscaling":s.dispatch(Tt("upscaling"));break;case"viewAllWorkflows":s.dispatch(Tt("workflows")),HV.set(!0);break;case"viewAllStylePresets":s.dispatch(Tt("canvas")),Wl.set(!0);break}},[s]);l.useEffect(()=>{if(!(n.current||!e))switch(n.current=!0,e.type){case"loadWorkflow":c(e.data.workflowId);break;case"selectStylePreset":d(e.data.stylePresetId);break;case"sendToCanvas":a(e.data.imageName);break;case"useAllParameters":i(e.data.imageName);break;case"goToDestination":u(e.data.destination);break}},[a,i,e,c,d,u])},bv=document.title,KV="assets/images/invoke-favicon.svg",QV="assets/images/invoke-alert-favicon.svg",YV=()=>{const{queueSize:e}=Oo(void 0,{selectFromResult:t=>({queueSize:t.data?t.data.queue.pending+t.data.queue.in_progress:0})});l.useEffect(()=>{document.title=e>0?`(${e}) ${bv}`:bv;const t=document.getElementById("invoke-favicon");t instanceof HTMLLinkElement&&(t.href=e>0?QV:KV)},[e])},eI=e=>{const t=w(Yw),n=w(Jw),s=w(Xw);return l.useEffect(()=>{if(s){localStorage.setItem("ROARR_LOG","true");let a=`context.logLevel:>=${b8[t]}`;n.length>0?a+=` AND (${n.map(i=>`context.namespace:${i}`).join(" OR ")})`:a+=" AND context.namespace:undefined",localStorage.setItem("ROARR_FILTER",a)}else localStorage.setItem("ROARR_LOG","false");Ay.ROARR.write=m8.createLogWriter()},[t,s,n]),l.useEffect(()=>{const a={...g8};x8.set(Ay.Roarr.child(a))},[]),l.useMemo(()=>Do(e),[e])},gu=e=>{const{boardName:t}=nc({include_archived:!0},{selectFromResult:({data:n})=>{const s=n==null?void 0:n.find(a=>a.board_id===e);return{boardName:(s==null?void 0:s.board_name)||ve("boards.uncategorized")}}});return t},JV=e=>{const{dropzone:t,setIsHandlingUpload:n}=e;return lo("esc",()=>{n(!1)},[n]),o.jsxs(xe,{position:"absolute",top:0,right:0,bottom:0,left:0,zIndex:999,backdropFilter:"blur(20px)",children:[o.jsx(j,{position:"absolute",top:0,right:0,bottom:0,left:0,bg:"base.900",opacity:.7}),o.jsxs(j,{position:"absolute",flexDir:"column",gap:4,top:2,right:2,bottom:2,left:2,opacity:1,borderWidth:2,borderColor:t.isDragAccept?"invokeYellow.300":"error.500",borderRadius:"base",borderStyle:"dashed",transitionProperty:"common",transitionDuration:"0.1s",alignItems:"center",justifyContent:"center",color:t.isDragReject?"error.300":void 0,children:[t.isDragAccept&&o.jsx(eH,{}),!t.isDragAccept&&o.jsx(tH,{})]})]})},XV=l.memo(JV),eH=()=>{const{t:e}=S(),t=w(Hd),n=gu(t);return o.jsxs(o.Fragment,{children:[o.jsx(Ct,{size:"lg",children:e("gallery.dropToUpload")}),o.jsx(Ct,{size:"md",children:e("toast.imagesWillBeAddedTo",{boardName:n})})]})},tH=()=>{const{t:e}=S(),t=w(Np);return t===void 0?o.jsxs(o.Fragment,{children:[o.jsx(Ct,{size:"lg",children:e("toast.invalidUpload")}),o.jsx(Ct,{size:"md",children:e("toast.uploadFailedInvalidUploadDesc")})]}):o.jsxs(o.Fragment,{children:[o.jsx(Ct,{size:"lg",children:e("toast.invalidUpload")}),o.jsx(Ct,{size:"md",children:e("toast.uploadFailedInvalidUploadDesc_withCount",{count:t})})]})},tI=()=>l.useCallback(()=>{y8(),localStorage.clear()},[]);var nI={exports:{}},nH="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED",sH=nH,oH=sH;function sI(){}function oI(){}oI.resetWarningCache=sI;var rH=function(){function e(s,r,a,i,c,d){if(d!==oH){var u=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw u.name="Invariant Violation",u}}e.isRequired=e;function t(){return e}var n={array:e,bigint:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:oI,resetWarningCache:sI};return n.PropTypes=n,n};nI.exports=rH();var aH=nI.exports;const Rt=hw(aH);var Qo=function(){return Qo=Object.assign||function(t){for(var n,s=1,r=arguments.length;s<r;s++){n=arguments[s];for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a])}return t},Qo.apply(this,arguments)};function rI(e,t){var n={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(n[s]=e[s]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var r=0,s=Object.getOwnPropertySymbols(e);r<s.length;r++)t.indexOf(s[r])<0&&Object.prototype.propertyIsEnumerable.call(e,s[r])&&(n[s[r]]=e[s[r]]);return n}function uc(e,t,n,s){function r(a){return a instanceof n?a:new n(function(i){i(a)})}return new(n||(n=Promise))(function(a,i){function c(h){try{u(s.next(h))}catch(p){i(p)}}function d(h){try{u(s.throw(h))}catch(p){i(p)}}function u(h){h.done?a(h.value):r(h.value).then(c,d)}u((s=s.apply(e,t||[])).next())})}function hc(e,t){var n={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},s,r,a,i=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return i.next=c(0),i.throw=c(1),i.return=c(2),typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function c(u){return function(h){return d([u,h])}}function d(u){if(s)throw new TypeError("Generator is already executing.");for(;i&&(i=0,u[0]&&(n=0)),n;)try{if(s=1,r&&(a=u[0]&2?r.return:u[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,u[1])).done)return a;switch(r=0,a&&(u=[u[0]&2,a.value]),u[0]){case 0:case 1:a=u;break;case 4:return n.label++,{value:u[1],done:!1};case 5:n.label++,r=u[1],u=[0];continue;case 7:u=n.ops.pop(),n.trys.pop();continue;default:if(a=n.trys,!(a=a.length>0&&a[a.length-1])&&(u[0]===6||u[0]===2)){n=0;continue}if(u[0]===3&&(!a||u[1]>a[0]&&u[1]<a[3])){n.label=u[1];break}if(u[0]===6&&n.label<a[1]){n.label=a[1],a=u;break}if(a&&n.label<a[2]){n.label=a[2],n.ops.push(u);break}a[2]&&n.ops.pop(),n.trys.pop();continue}u=t.call(e,n)}catch(h){u=[6,h],r=0}finally{s=a=0}if(u[0]&5)throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}}function yv(e,t){var n=typeof Symbol=="function"&&e[Symbol.iterator];if(!n)return e;var s=n.call(e),r,a=[],i;try{for(;(t===void 0||t-- >0)&&!(r=s.next()).done;)a.push(r.value)}catch(c){i={error:c}}finally{try{r&&!r.done&&(n=s.return)&&n.call(s)}finally{if(i)throw i.error}}return a}function Xg(e,t,n){if(n||arguments.length===2)for(var s=0,r=t.length,a;s<r;s++)(a||!(s in t))&&(a||(a=Array.prototype.slice.call(t,0,s)),a[s]=t[s]);return e.concat(a||Array.prototype.slice.call(t))}var iH=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function xu(e,t){var n=lH(e);if(typeof n.path!="string"){var s=e.webkitRelativePath;Object.defineProperty(n,"path",{value:typeof t=="string"?t:typeof s=="string"&&s.length>0?s:e.name,writable:!1,configurable:!1,enumerable:!0})}return n}function lH(e){var t=e.name,n=t&&t.lastIndexOf(".")!==-1;if(n&&!e.type){var s=t.split(".").pop().toLowerCase(),r=iH.get(s);r&&Object.defineProperty(e,"type",{value:r,writable:!1,configurable:!1,enumerable:!0})}return e}var cH=[".DS_Store","Thumbs.db"];function dH(e){return uc(this,void 0,void 0,function(){return hc(this,function(t){return Jh(e)&&uH(e.dataTransfer)?[2,mH(e.dataTransfer,e.type)]:hH(e)?[2,pH(e)]:Array.isArray(e)&&e.every(function(n){return"getFile"in n&&typeof n.getFile=="function"})?[2,fH(e)]:[2,[]]})})}function uH(e){return Jh(e)}function hH(e){return Jh(e)&&Jh(e.target)}function Jh(e){return typeof e=="object"&&e!==null}function pH(e){return e0(e.target.files).map(function(t){return xu(t)})}function fH(e){return uc(this,void 0,void 0,function(){var t;return hc(this,function(n){switch(n.label){case 0:return[4,Promise.all(e.map(function(s){return s.getFile()}))];case 1:return t=n.sent(),[2,t.map(function(s){return xu(s)})]}})})}function mH(e,t){return uc(this,void 0,void 0,function(){var n,s;return hc(this,function(r){switch(r.label){case 0:return e.items?(n=e0(e.items).filter(function(a){return a.kind==="file"}),t!=="drop"?[2,n]:[4,Promise.all(n.map(gH))]):[3,2];case 1:return s=r.sent(),[2,vv(aI(s))];case 2:return[2,vv(e0(e.files).map(function(a){return xu(a)}))]}})})}function vv(e){return e.filter(function(t){return cH.indexOf(t.name)===-1})}function e0(e){if(e===null)return[];for(var t=[],n=0;n<e.length;n++){var s=e[n];t.push(s)}return t}function gH(e){if(typeof e.webkitGetAsEntry!="function")return Cv(e);var t=e.webkitGetAsEntry();return t&&t.isDirectory?iI(t):Cv(e)}function aI(e){return e.reduce(function(t,n){return Xg(Xg([],yv(t),!1),yv(Array.isArray(n)?aI(n):[n]),!1)},[])}function Cv(e){var t=e.getAsFile();if(!t)return Promise.reject("".concat(e," is not a File"));var n=xu(t);return Promise.resolve(n)}function xH(e){return uc(this,void 0,void 0,function(){return hc(this,function(t){return[2,e.isDirectory?iI(e):bH(e)]})})}function iI(e){var t=e.createReader();return new Promise(function(n,s){var r=[];function a(){var i=this;t.readEntries(function(c){return uc(i,void 0,void 0,function(){var d,u,h;return hc(this,function(p){switch(p.label){case 0:if(c.length)return[3,5];p.label=1;case 1:return p.trys.push([1,3,,4]),[4,Promise.all(r)];case 2:return d=p.sent(),n(d),[3,4];case 3:return u=p.sent(),s(u),[3,4];case 4:return[3,6];case 5:h=Promise.all(c.map(xH)),r.push(h),a(),p.label=6;case 6:return[2]}})})},function(c){s(c)})}a()})}function bH(e){return uc(this,void 0,void 0,function(){return hc(this,function(t){return[2,new Promise(function(n,s){e.file(function(r){var a=xu(r,e.fullPath);n(a)},function(r){s(r)})})]})})}var Tm=function(e,t){if(e&&t){var n=Array.isArray(t)?t:t.split(","),s=e.name||"",r=(e.type||"").toLowerCase(),a=r.replace(/\/.*$/,"");return n.some(function(i){var c=i.trim().toLowerCase();return c.charAt(0)==="."?s.toLowerCase().endsWith(c):c.endsWith("/*")?a===c.replace(/\/.*$/,""):r===c})}return!0};function wv(e){return CH(e)||vH(e)||cI(e)||yH()}function yH(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vH(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function CH(e){if(Array.isArray(e))return t0(e)}function jv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Sv(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?jv(Object(n),!0).forEach(function(s){lI(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):jv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function lI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Cd(e,t){return SH(e)||jH(e,t)||cI(e,t)||wH()}function wH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function cI(e,t){if(e){if(typeof e=="string")return t0(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return t0(e,t)}}function t0(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function jH(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],r=!0,a=!1,i,c;try{for(n=n.call(e);!(r=(i=n.next()).done)&&(s.push(i.value),!(t&&s.length===t));r=!0);}catch(d){a=!0,c=d}finally{try{!r&&n.return!=null&&n.return()}finally{if(a)throw c}}return s}}function SH(e){if(Array.isArray(e))return e}var kH=typeof Tm=="function"?Tm:Tm.default,IH="file-invalid-type",_H="file-too-large",MH="file-too-small",AH="too-many-files",EH=function(t){t=Array.isArray(t)&&t.length===1?t[0]:t;var n=Array.isArray(t)?"one of ".concat(t.join(", ")):t;return{code:IH,message:"File type must be ".concat(n)}},kv=function(t){return{code:_H,message:"File is larger than ".concat(t," ").concat(t===1?"byte":"bytes")}},Iv=function(t){return{code:MH,message:"File is smaller than ".concat(t," ").concat(t===1?"byte":"bytes")}},LH={code:AH,message:"Too many files"};function dI(e,t){var n=e.type==="application/x-moz-file"||kH(e,t);return[n,n?null:EH(t)]}function uI(e,t,n){if(Ka(e.size))if(Ka(t)&&Ka(n)){if(e.size>n)return[!1,kv(n)];if(e.size<t)return[!1,Iv(t)]}else{if(Ka(t)&&e.size<t)return[!1,Iv(t)];if(Ka(n)&&e.size>n)return[!1,kv(n)]}return[!0,null]}function Ka(e){return e!=null}function TH(e){var t=e.files,n=e.accept,s=e.minSize,r=e.maxSize,a=e.multiple,i=e.maxFiles,c=e.validator;return!a&&t.length>1||a&&i>=1&&t.length>i?!1:t.every(function(d){var u=dI(d,n),h=Cd(u,1),p=h[0],f=uI(d,s,r),m=Cd(f,1),g=m[0],x=c?c(d):null;return p&&g&&!x})}function Xh(e){return typeof e.isPropagationStopped=="function"?e.isPropagationStopped():typeof e.cancelBubble<"u"?e.cancelBubble:!1}function Xu(e){return e.dataTransfer?Array.prototype.some.call(e.dataTransfer.types,function(t){return t==="Files"||t==="application/x-moz-file"}):!!e.target&&!!e.target.files}function _v(e){e.preventDefault()}function PH(e){return e.indexOf("MSIE")!==-1||e.indexOf("Trident/")!==-1}function RH(e){return e.indexOf("Edge/")!==-1}function DH(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:window.navigator.userAgent;return PH(e)||RH(e)}function Vo(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(s){for(var r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];return t.some(function(c){return!Xh(s)&&c&&c.apply(void 0,[s].concat(a)),Xh(s)})}}function OH(){return"showOpenFilePicker"in window}function NH(e){if(Ka(e)){var t=Object.entries(e).filter(function(n){var s=Cd(n,2),r=s[0],a=s[1],i=!0;return hI(r)||(console.warn('Skipped "'.concat(r,'" because it is not a valid MIME type. Check https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types for a list of valid MIME types.')),i=!1),(!Array.isArray(a)||!a.every(pI))&&(console.warn('Skipped "'.concat(r,'" because an invalid file extension was provided.')),i=!1),i}).reduce(function(n,s){var r=Cd(s,2),a=r[0],i=r[1];return Sv(Sv({},n),{},lI({},a,i))},{});return[{description:"Files",accept:t}]}return e}function BH(e){if(Ka(e))return Object.entries(e).reduce(function(t,n){var s=Cd(n,2),r=s[0],a=s[1];return[].concat(wv(t),[r],wv(a))},[]).filter(function(t){return hI(t)||pI(t)}).join(",")}function $H(e){return e instanceof DOMException&&(e.name==="AbortError"||e.code===e.ABORT_ERR)}function FH(e){return e instanceof DOMException&&(e.name==="SecurityError"||e.code===e.SECURITY_ERR)}function hI(e){return e==="audio/*"||e==="video/*"||e==="image/*"||e==="text/*"||/\w+\/[-+.\w]+/g.test(e)}function pI(e){return/^.*\.[\w]+$/.test(e)}var zH=["children"],VH=["open"],HH=["refKey","role","onKeyDown","onFocus","onBlur","onClick","onDragEnter","onDragOver","onDragLeave","onDrop"],WH=["refKey","onChange","onClick"];function GH(e){return qH(e)||ZH(e)||fI(e)||UH()}function UH(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ZH(e){if(typeof Symbol<"u"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function qH(e){if(Array.isArray(e))return n0(e)}function Pm(e,t){return YH(e)||QH(e,t)||fI(e,t)||KH()}function KH(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function fI(e,t){if(e){if(typeof e=="string")return n0(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if(n==="Object"&&e.constructor&&(n=e.constructor.name),n==="Map"||n==="Set")return Array.from(e);if(n==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return n0(e,t)}}function n0(e,t){(t==null||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function QH(e,t){var n=e==null?null:typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(n!=null){var s=[],r=!0,a=!1,i,c;try{for(n=n.call(e);!(r=(i=n.next()).done)&&(s.push(i.value),!(t&&s.length===t));r=!0);}catch(d){a=!0,c=d}finally{try{!r&&n.return!=null&&n.return()}finally{if(a)throw c}}return s}}function YH(e){if(Array.isArray(e))return e}function Mv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function Xt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Mv(Object(n),!0).forEach(function(s){s0(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function s0(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ep(e,t){if(e==null)return{};var n=JH(e,t),s,r;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)s=a[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function JH(e,t){if(e==null)return{};var n={},s=Object.keys(e),r,a;for(a=0;a<s.length;a++)r=s[a],!(t.indexOf(r)>=0)&&(n[r]=e[r]);return n}var Mb=l.forwardRef(function(e,t){var n=e.children,s=ep(e,zH),r=Na(s),a=r.open,i=ep(r,VH);return l.useImperativeHandle(t,function(){return{open:a}},[a]),te.createElement(l.Fragment,null,n(Xt(Xt({},i),{},{open:a})))});Mb.displayName="Dropzone";var mI={disabled:!1,getFilesFromEvent:dH,maxSize:1/0,minSize:0,multiple:!0,maxFiles:0,preventDropOnDocument:!0,noClick:!1,noKeyboard:!1,noDrag:!1,noDragEventsBubbling:!1,validator:null,useFsAccessApi:!1,autoFocus:!1};Mb.defaultProps=mI;Mb.propTypes={children:Rt.func,accept:Rt.objectOf(Rt.arrayOf(Rt.string)),multiple:Rt.bool,preventDropOnDocument:Rt.bool,noClick:Rt.bool,noKeyboard:Rt.bool,noDrag:Rt.bool,noDragEventsBubbling:Rt.bool,minSize:Rt.number,maxSize:Rt.number,maxFiles:Rt.number,disabled:Rt.bool,getFilesFromEvent:Rt.func,onFileDialogCancel:Rt.func,onFileDialogOpen:Rt.func,useFsAccessApi:Rt.bool,autoFocus:Rt.bool,onDragEnter:Rt.func,onDragLeave:Rt.func,onDragOver:Rt.func,onDrop:Rt.func,onDropAccepted:Rt.func,onDropRejected:Rt.func,onError:Rt.func,validator:Rt.func};var o0={isFocused:!1,isFileDialogActive:!1,isDragActive:!1,isDragAccept:!1,isDragReject:!1,acceptedFiles:[],fileRejections:[]};function Na(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=Xt(Xt({},mI),e),n=t.accept,s=t.disabled,r=t.getFilesFromEvent,a=t.maxSize,i=t.minSize,c=t.multiple,d=t.maxFiles,u=t.onDragEnter,h=t.onDragLeave,p=t.onDragOver,f=t.onDrop,m=t.onDropAccepted,g=t.onDropRejected,x=t.onFileDialogCancel,C=t.onFileDialogOpen,y=t.useFsAccessApi,v=t.autoFocus,I=t.preventDropOnDocument,k=t.noClick,M=t.noKeyboard,_=t.noDrag,A=t.noDragEventsBubbling,D=t.onError,N=t.validator,P=l.useMemo(function(){return BH(n)},[n]),z=l.useMemo(function(){return NH(n)},[n]),W=l.useMemo(function(){return typeof C=="function"?C:Av},[C]),X=l.useMemo(function(){return typeof x=="function"?x:Av},[x]),ee=l.useRef(null),G=l.useRef(null),re=l.useReducer(XH,o0),le=Pm(re,2),Ce=le[0],be=le[1],ye=Ce.isFocused,ne=Ce.isFileDialogActive,R=l.useRef(typeof window<"u"&&window.isSecureContext&&y&&OH()),F=function(){!R.current&&ne&&setTimeout(function(){if(G.current){var ge=G.current.files;ge.length||(be({type:"closeDialog"}),X())}},300)};l.useEffect(function(){return window.addEventListener("focus",F,!1),function(){window.removeEventListener("focus",F,!1)}},[G,ne,X,R]);var Z=l.useRef([]),B=function(ge){ee.current&&ee.current.contains(ge.target)||(ge.preventDefault(),Z.current=[])};l.useEffect(function(){return I&&(document.addEventListener("dragover",_v,!1),document.addEventListener("drop",B,!1)),function(){I&&(document.removeEventListener("dragover",_v),document.removeEventListener("drop",B))}},[ee,I]),l.useEffect(function(){return!s&&v&&ee.current&&ee.current.focus(),function(){}},[ee,v,s]);var K=l.useCallback(function(J){D?D(J):console.error(J)},[D]),$=l.useCallback(function(J){J.preventDefault(),J.persist(),q(J),Z.current=[].concat(GH(Z.current),[J.target]),Xu(J)&&Promise.resolve(r(J)).then(function(ge){if(!(Xh(J)&&!A)){var Ue=ge.length,Ke=Ue>0&&TH({files:ge,accept:P,minSize:i,maxSize:a,multiple:c,maxFiles:d,validator:N}),vt=Ue>0&&!Ke;be({isDragAccept:Ke,isDragReject:vt,isDragActive:!0,type:"setDraggedFiles"}),u&&u(J)}}).catch(function(ge){return K(ge)})},[r,u,K,A,P,i,a,c,d,N]),Y=l.useCallback(function(J){J.preventDefault(),J.persist(),q(J);var ge=Xu(J);if(ge&&J.dataTransfer)try{J.dataTransfer.dropEffect="copy"}catch{}return ge&&p&&p(J),!1},[p,A]),ae=l.useCallback(function(J){J.preventDefault(),J.persist(),q(J);var ge=Z.current.filter(function(Ke){return ee.current&&ee.current.contains(Ke)}),Ue=ge.indexOf(J.target);Ue!==-1&&ge.splice(Ue,1),Z.current=ge,!(ge.length>0)&&(be({type:"setDraggedFiles",isDragActive:!1,isDragAccept:!1,isDragReject:!1}),Xu(J)&&h&&h(J))},[ee,h,A]),ue=l.useCallback(function(J,ge){var Ue=[],Ke=[];J.forEach(function(vt){var In=dI(vt,P),an=Pm(In,2),Fn=an[0],_s=an[1],qs=uI(vt,i,a),Ks=Pm(qs,2),Cn=Ks[0],vr=Ks[1],po=N?N(vt):null;if(Fn&&Cn&&!po)Ue.push(vt);else{var fo=[_s,vr];po&&(fo=fo.concat(po)),Ke.push({file:vt,errors:fo.filter(function(Qs){return Qs})})}}),(!c&&Ue.length>1||c&&d>=1&&Ue.length>d)&&(Ue.forEach(function(vt){Ke.push({file:vt,errors:[LH]})}),Ue.splice(0)),be({acceptedFiles:Ue,fileRejections:Ke,type:"setFiles"}),f&&f(Ue,Ke,ge),Ke.length>0&&g&&g(Ke,ge),Ue.length>0&&m&&m(Ue,ge)},[be,c,P,i,a,d,f,m,g,N]),Re=l.useCallback(function(J){J.preventDefault(),J.persist(),q(J),Z.current=[],Xu(J)&&Promise.resolve(r(J)).then(function(ge){Xh(J)&&!A||ue(ge,J)}).catch(function(ge){return K(ge)}),be({type:"reset"})},[r,ue,K,A]),we=l.useCallback(function(){if(R.current){be({type:"openDialog"}),W();var J={multiple:c,types:z};window.showOpenFilePicker(J).then(function(ge){return r(ge)}).then(function(ge){ue(ge,null),be({type:"closeDialog"})}).catch(function(ge){$H(ge)?(X(ge),be({type:"closeDialog"})):FH(ge)?(R.current=!1,G.current?(G.current.value=null,G.current.click()):K(new Error("Cannot open the file picker because the https://developer.mozilla.org/en-US/docs/Web/API/File_System_Access_API is not supported and no <input> was provided."))):K(ge)});return}G.current&&(be({type:"openDialog"}),W(),G.current.value=null,G.current.click())},[be,W,X,y,ue,K,z,c]),De=l.useCallback(function(J){!ee.current||!ee.current.isEqualNode(J.target)||(J.key===" "||J.key==="Enter"||J.keyCode===32||J.keyCode===13)&&(J.preventDefault(),we())},[ee,we]),Me=l.useCallback(function(){be({type:"focus"})},[]),ht=l.useCallback(function(){be({type:"blur"})},[]),st=l.useCallback(function(){k||(DH()?setTimeout(we,0):we())},[k,we]),We=function(ge){return s?null:ge},T=function(ge){return M?null:We(ge)},H=function(ge){return _?null:We(ge)},q=function(ge){A&&ge.stopPropagation()},de=l.useMemo(function(){return function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ge=J.refKey,Ue=ge===void 0?"ref":ge,Ke=J.role,vt=J.onKeyDown,In=J.onFocus,an=J.onBlur,Fn=J.onClick,_s=J.onDragEnter,qs=J.onDragOver,Ks=J.onDragLeave,Cn=J.onDrop,vr=ep(J,HH);return Xt(Xt(s0({onKeyDown:T(Vo(vt,De)),onFocus:T(Vo(In,Me)),onBlur:T(Vo(an,ht)),onClick:We(Vo(Fn,st)),onDragEnter:H(Vo(_s,$)),onDragOver:H(Vo(qs,Y)),onDragLeave:H(Vo(Ks,ae)),onDrop:H(Vo(Cn,Re)),role:typeof Ke=="string"&&Ke!==""?Ke:"presentation"},Ue,ee),!s&&!M?{tabIndex:0}:{}),vr)}},[ee,De,Me,ht,st,$,Y,ae,Re,M,_,s]),ce=l.useCallback(function(J){J.stopPropagation()},[]),ie=l.useMemo(function(){return function(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},ge=J.refKey,Ue=ge===void 0?"ref":ge,Ke=J.onChange,vt=J.onClick,In=ep(J,WH),an=s0({accept:P,multiple:c,type:"file",style:{display:"none"},onChange:We(Vo(Ke,Re)),onClick:We(Vo(vt,ce)),tabIndex:-1},Ue,G);return Xt(Xt({},an),In)}},[G,n,c,Re,s]);return Xt(Xt({},Ce),{},{isFocused:ye&&!s,getRootProps:de,getInputProps:ie,rootRef:ee,inputRef:G,open:We(we)})}function XH(e,t){switch(t.type){case"focus":return Xt(Xt({},e),{},{isFocused:!0});case"blur":return Xt(Xt({},e),{},{isFocused:!1});case"openDialog":return Xt(Xt({},o0),{},{isFileDialogActive:!0});case"closeDialog":return Xt(Xt({},e),{},{isFileDialogActive:!1});case"setDraggedFiles":return Xt(Xt({},e),{},{isDragActive:t.isDragActive,isDragAccept:t.isDragAccept,isDragReject:t.isDragReject});case"setFiles":return Xt(Xt({},e),{},{acceptedFiles:t.acceptedFiles,fileRejections:t.fileRejections});case"reset":return Xt({},o0);default:return e}}function Av(){}const eW=Do("gallery"),tW={"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},nW=()=>{wt("useFullscreenDropzone");const{t:e}=S(),t=w(ao),[n,s]=l.useState(!1),[r]=vx(),a=w(bn),i=w(Np),c=l.useCallback(()=>a==="upscaling"?{type:"SET_UPSCALE_INITIAL_IMAGE"}:{type:"TOAST"},[a]),d=l.useCallback((f,m)=>{if(m.length>0){const g=m.map(C=>({errors:C.errors.map(({message:y})=>y),file:C.file.path}));eW.error({errors:g},"Invalid upload");const x=i===void 0?e("toast.uploadFailedInvalidUploadDesc"):e("toast.uploadFailedInvalidUploadDesc_withCount",{count:i});he({id:"UPLOAD_FAILED",title:e("toast.uploadFailed"),description:x,status:"error"}),s(!1);return}for(const[g,x]of f.entries())r({file:x,image_category:"user",is_intermediate:!1,postUploadAction:c(),board_id:t==="none"?void 0:t,isFirstUploadOfBatch:g===0});s(!1)},[e,i,r,c,t]),u=l.useCallback(()=>{s(!0)},[]),h=l.useCallback(()=>{s(!1)},[]),p=Na({accept:tW,noClick:!0,onDrop:d,onDragOver:u,onDragLeave:h,noKeyboard:!0,multiple:i===void 0||i>1,maxFiles:i});return l.useEffect(()=>{const f=m=>{var g,x;p.inputRef.current&&(g=m.clipboardData)!=null&&g.files&&(p.inputRef.current.files=m.clipboardData.files,(x=p.inputRef.current)==null||x.dispatchEvent(new Event("change",{bubbles:!0})))};return document.addEventListener("paste",f),()=>{document.removeEventListener("paste",f)}},[p.inputRef]),{dropzone:p,isHandlingUpload:n,setIsHandlingUpload:s}},[sW]=wi(!1),pc=()=>{const{t:e}=S(),t=E(),n=sW(),{data:s}=Oo(),r=se(On),[a,{isLoading:i}]=ej({fixedCacheKey:"clearQueue"}),c=l.useCallback(async()=>{if(s!=null&&s.queue.total)try{await a().unwrap(),he({id:"QUEUE_CLEAR_SUCCEEDED",title:e("queue.clearSucceeded"),status:"success"}),t(Cx(void 0)),t(wx(void 0))}catch{he({id:"QUEUE_CLEAR_FAILED",title:e("queue.clearFailed"),status:"error"})}},[s==null?void 0:s.queue.total,a,t,e]),d=l.useMemo(()=>!r||!(s!=null&&s.queue.total),[r,s==null?void 0:s.queue.total]);return{clearQueue:c,isOpen:n.isTrue,openDialog:n.setTrue,closeDialog:n.setFalse,isLoading:i,queueStatus:s,isDisabled:d}},gI=l.memo(()=>{wt("ClearQueueConfirmationsAlertDialog");const{t:e}=S(),t=pc();return o.jsxs(No,{isOpen:t.isOpen,onClose:t.closeDialog,title:e("queue.clearTooltip"),acceptCallback:t.clearQueue,acceptButtonText:e("queue.clear"),useInert:!1,children:[o.jsx(O,{children:e("queue.clearQueueAlertDialog")}),o.jsx("br",{}),o.jsx(O,{children:e("queue.clearQueueAlertDialog2")})]})});gI.displayName="ClearQueueConfirmationsAlertDialog";const Ab=()=>{const e=se(On),{data:t}=Oo(),[n,{isLoading:s}]=jx(),{t:r}=S(),a=l.useMemo(()=>t==null?void 0:t.queue.item_id,[t==null?void 0:t.queue.item_id]),i=l.useCallback(async()=>{if(a)try{await n(a).unwrap(),he({id:"QUEUE_CANCEL_SUCCEEDED",title:r("queue.cancelSucceeded"),status:"success"})}catch{he({id:"QUEUE_CANCEL_FAILED",title:r("queue.cancelFailed"),status:"error"})}},[a,r,n]),c=l.useMemo(()=>!e||Ut(a),[e,a]);return{cancelQueueItem:i,isLoading:s,currentQueueItemId:a,isDisabled:c}},wd=Ge(!1),Yc=Ge(!0),eh={reference_image:"controlLayers.referenceImage",inpaint_mask:"controlLayers.inpaintMask",regional_guidance:"controlLayers.regionalGuidance",raster_layer:"controlLayers.rasterLayer",control_layer:"controlLayers.controlLayer"},oW=(e,t,n,s,r,a)=>pt([Wd,bt,tj,nj,Je,sc,Gd,Gs,bn],(i,c,d,u,h,p,f,m,g)=>{const{bbox:x}=h,{model:C,positivePrompt:y}=p,v=[];if(t||v.push({content:Xe.t("parameters.invoke.systemDisconnected")}),g==="workflows")d.shouldValidateGraph&&(c.nodes.length||v.push({content:Xe.t("parameters.invoke.noNodesInGraph")}),c.nodes.forEach(I=>{if(!Br(I))return;const k=e[I.data.type];if(!k){v.push({content:Xe.t("parameters.invoke.missingNodeTemplate")});return}const M=v8([I],c.edges);sj(I.data.inputs,_=>{const A=k.inputs[_.name],D=M.some(N=>N.target===I.id&&N.targetHandle===_.name);if(!A){v.push({content:Xe.t("parameters.invoke.missingFieldTemplate")});return}if(A.required&&_.value===void 0&&!D){v.push({content:Xe.t("parameters.invoke.missingInputForField",{nodeLabel:I.data.label||k.title,fieldLabel:_.label||A.title})});return}})}));else if(g==="upscaling"){if(!f.upscaleInitialImage)v.push({content:Xe.t("upscaling.missingUpscaleInitialImage")});else if(m.maxUpscaleDimension){const{width:I,height:k}=f.upscaleInitialImage,{scale:M}=f,_=m.maxUpscaleDimension**2;I*M*k*M>_&&v.push({content:Xe.t("upscaling.exceedsMaxSize")})}f.upscaleModel||v.push({content:Xe.t("upscaling.missingUpscaleModel")}),f.tileControlnetModel||v.push({content:Xe.t("upscaling.missingTileControlNetModel")})}else n&&v.push({content:Xe.t("parameters.invoke.canvasIsFiltering")}),s&&v.push({content:Xe.t("parameters.invoke.canvasIsTransforming")}),r&&v.push({content:Xe.t("parameters.invoke.canvasIsRasterizing")}),a&&v.push({content:Xe.t("parameters.invoke.canvasIsCompositing")}),u.prompts.length===0&&oj(y)&&v.push({content:Xe.t("parameters.invoke.noPrompts")}),C||v.push({content:Xe.t("parameters.invoke.noModelSelected")}),(C==null?void 0:C.base)==="flux"&&(p.t5EncoderModel||v.push({content:Xe.t("parameters.invoke.noT5EncoderModelSelected")}),p.clipEmbedModel||v.push({content:Xe.t("parameters.invoke.noCLIPEmbedModelSelected")}),p.fluxVAE||v.push({content:Xe.t("parameters.invoke.noFLUXVAEModelSelected")}),x.scaleMethod==="none"?(x.rect.width%16!==0&&v.push({content:Xe.t("parameters.invoke.fluxModelIncompatibleBboxWidth",{width:x.rect.width})}),x.rect.height%16!==0&&v.push({content:Xe.t("parameters.invoke.fluxModelIncompatibleBboxHeight",{height:x.rect.height})})):(x.scaledSize.width%16!==0&&v.push({content:Xe.t("parameters.invoke.fluxModelIncompatibleScaledBboxWidth",{width:x.scaledSize.width})}),x.scaledSize.height%16!==0&&v.push({content:Xe.t("parameters.invoke.fluxModelIncompatibleScaledBboxHeight",{height:x.scaledSize.height})}))),h.controlLayers.entities.filter(I=>I.isEnabled).forEach((I,k)=>{var P;const M=Xe.t("controlLayers.layer_one"),_=k+1,A=Xe.t(eh.control_layer),D=`${M} #${_} (${A})`,N=[];if(I.controlAdapter.model||N.push(Xe.t("parameters.invoke.layer.controlAdapterNoModelSelected")),((P=I.controlAdapter.model)==null?void 0:P.base)!==(C==null?void 0:C.base)&&N.push(Xe.t("parameters.invoke.layer.controlAdapterIncompatibleBaseModel")),I.controlAdapter.type==="t2i_adapter"){const z=(C==null?void 0:C.base)==="sdxl"?32:64;x.scaleMethod==="none"?(x.rect.width%16!==0&&v.push({content:Xe.t("parameters.invoke.layer.t2iAdapterIncompatibleBboxWidth",{multiple:z,width:x.rect.width})}),x.rect.height%16!==0&&v.push({content:Xe.t("parameters.invoke.layer.t2iAdapterIncompatibleBboxHeight",{multiple:z,height:x.rect.height})})):(x.scaledSize.width%16!==0&&v.push({content:Xe.t("parameters.invoke.layer.t2iAdapterIncompatibleScaledBboxWidth",{multiple:z,width:x.scaledSize.width})}),x.scaledSize.height%16!==0&&v.push({content:Xe.t("parameters.invoke.layer.t2iAdapterIncompatibleScaledBboxHeight",{multiple:z,height:x.scaledSize.height})}))}if(N.length){const z=Zu(N.join(", "));v.push({prefix:D,content:z})}}),h.referenceImages.entities.filter(I=>I.isEnabled).forEach((I,k)=>{var P;const M=Xe.t("controlLayers.layer_one"),_=k+1,A=Xe.t(eh[I.type]),D=`${M} #${_} (${A})`,N=[];if(I.ipAdapter.model||N.push(Xe.t("parameters.invoke.layer.ipAdapterNoModelSelected")),((P=I.ipAdapter.model)==null?void 0:P.base)!==(C==null?void 0:C.base)&&N.push(Xe.t("parameters.invoke.layer.ipAdapterIncompatibleBaseModel")),I.ipAdapter.image||N.push(Xe.t("parameters.invoke.layer.ipAdapterNoImageSelected")),N.length){const z=Zu(N.join(", "));v.push({prefix:D,content:z})}}),h.regionalGuidance.entities.filter(I=>I.isEnabled).forEach((I,k)=>{const M=Xe.t("controlLayers.layer_one"),_=k+1,A=Xe.t(eh[I.type]),D=`${M} #${_} (${A})`,N=[];if(I.objects.length===0&&N.push(Xe.t("parameters.invoke.layer.rgNoRegion")),I.positivePrompt===null&&I.negativePrompt===null&&I.referenceImages.length===0&&N.push(Xe.t("parameters.invoke.layer.rgNoPromptsOrIPAdapters")),I.referenceImages.forEach(({ipAdapter:P})=>{var z;P.model||N.push(Xe.t("parameters.invoke.layer.ipAdapterNoModelSelected")),((z=P.model)==null?void 0:z.base)!==(C==null?void 0:C.base)&&N.push(Xe.t("parameters.invoke.layer.ipAdapterIncompatibleBaseModel")),P.image||N.push(Xe.t("parameters.invoke.layer.ipAdapterNoImageSelected"))}),N.length){const P=Zu(N.join(", "));v.push({prefix:D,content:P})}}),h.rasterLayers.entities.filter(I=>I.isEnabled).forEach((I,k)=>{const M=Xe.t("controlLayers.layer_one"),_=k+1,A=Xe.t(eh[I.type]),D=`${M} #${_} (${A})`,N=[];if(N.length){const P=Zu(N.join(", "));v.push({prefix:D,content:P})}});return{isReady:!v.length,reasons:v}}),xI=()=>{const e=se(yn),t=se(On),n=Kk(),s=se((n==null?void 0:n.stateApi.$isFiltering)??Yc),r=se((n==null?void 0:n.stateApi.$isTransforming)??Yc),a=se((n==null?void 0:n.stateApi.$isRasterizing)??Yc),i=se((n==null?void 0:n.compositor.$isBusy)??Yc),c=l.useMemo(()=>oW(e,t,s,r,a,i),[e,t,s,r,a,i]);return w(c)},Eb=()=>{const e=E(),t=w(bn),{isReady:n}=xI(),[s,{isLoading:r}]=Sx({fixedCacheKey:"enqueueBatch"}),a=l.useCallback(()=>{n&&e(Ey({tabName:t,prepend:!1}))},[e,n,t]),i=l.useCallback(()=>{n&&e(Ey({tabName:t,prepend:!0}))},[e,n,t]);return{queueBack:a,queueFront:i,isLoading:r,isDisabled:!n}},rW=()=>{const e=E(),t=dn("modelManager"),n=Eb();Ie({id:"invoke",category:"app",callback:n.queueBack,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]}),Ie({id:"invokeFront",category:"app",callback:n.queueFront,options:{enabled:!n.isDisabled&&!n.isLoading,preventDefault:!0,enableOnFormTags:["input","textarea","select"]},dependencies:[n]});const{cancelQueueItem:s,isDisabled:r,isLoading:a}=Ab();Ie({id:"cancelQueueItem",category:"app",callback:s,options:{enabled:!r&&!a,preventDefault:!0},dependencies:[s,r,a]});const{clearQueue:i,isDisabled:c,isLoading:d}=pc();Ie({id:"clearQueue",category:"app",callback:i,options:{enabled:!c&&!d,preventDefault:!0},dependencies:[i,c,d]}),Ie({id:"selectCanvasTab",category:"app",callback:()=>{e(Tt("canvas"))},dependencies:[e]}),Ie({id:"selectUpscalingTab",category:"app",callback:()=>{e(Tt("upscaling"))},dependencies:[e]}),Ie({id:"selectWorkflowsTab",category:"app",callback:()=>{e(Tt("workflows"))},dependencies:[e]}),Ie({id:"selectModelsTab",category:"app",callback:()=>{e(Tt("models"))},options:{enabled:t},dependencies:[e,t]}),Ie({id:"selectQueueTab",category:"app",callback:()=>{e(Tt("queue"))},dependencies:[e,t]})},aW=pt(rj,e=>e.imagesToChange),iW=pe(rj,e=>e.isModalOpen),lW=()=>{wt("ChangeBoardModal");const e=E(),[t,n]=l.useState(),{data:s,isFetching:r}=nc({include_archived:!0}),a=w(iW),i=w(aW),[c]=aj(),[d]=C8(),{t:u}=S(),h=l.useMemo(()=>[{label:u("boards.uncategorized"),value:"none"}].concat((s??[]).map(x=>({label:x.board_name,value:x.board_id}))),[s,u]),p=l.useMemo(()=>h.find(x=>x.value===t),[h,t]),f=l.useCallback(()=>{e(Ly()),e(kx(!1))},[e]),m=l.useCallback(()=>{!i.length||!t||(t==="none"?d({imageDTOs:i}):c({imageDTOs:i,board_id:t}),n(null),e(Ly()))},[c,e,i,d,t]),g=l.useCallback(x=>{x&&n(x.value)},[]);return o.jsx(No,{isOpen:a,onClose:f,title:u("boards.changeBoard"),acceptCallback:m,acceptButtonText:u("boards.move"),cancelButtonText:u("boards.cancel"),useInert:!1,children:o.jsxs(j,{flexDir:"column",gap:4,children:[o.jsxs(O,{children:[u("boards.movingImagesToBoard",{count:i.length}),":"]}),o.jsx(V,{isDisabled:r,children:o.jsx(Ne,{placeholder:u(r?"boards.loading":"boards.selectBoard"),onChange:g,value:p,options:h})})]})})},cW=l.memo(lW),[bI]=wi(!1),[yI]=wi(!1),vI=()=>{const e=E(),t=jt(),n=w(Ud),s=bI(),r=l.useCallback(()=>{e(w8()),t.open(),e(Ao("gallery"))},[e,t]),a=l.useCallback(()=>{if(n){s.setTrue();return}r()},[r,s,n]);return{newGallerySessionImmediate:r,newGallerySessionWithDialog:a}},CI=()=>{const e=E(),t=jt(),n=w(Ud),s=yI(),r=l.useCallback(()=>{e(j8()),t.close(),e(Ao("layers"))},[e,t]),a=l.useCallback(()=>{if(n){s.setTrue();return}r()},[r,s,n]);return{newCanvasSessionImmediate:r,newCanvasSessionWithDialog:a}},wI=l.memo(()=>{wt("NewGallerySessionDialog");const{t:e}=S(),t=E(),n=bI(),{newGallerySessionImmediate:s}=vI(),r=w(Ud),a=l.useCallback(()=>{t(Ix())},[t]);return o.jsx(No,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newGallerySession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:o.jsxs(j,{direction:"column",gap:3,children:[o.jsx(O,{children:e("controlLayers.newGallerySessionDesc")}),o.jsx(O,{children:e("common.areYouSure")}),o.jsxs(V,{children:[o.jsx(U,{children:e("common.dontAskMeAgain")}),o.jsx(kn,{isChecked:!r,onChange:a})]})]})})});wI.displayName="NewGallerySessionDialog";const jI=l.memo(()=>{wt("NewCanvasSessionDialog");const{t:e}=S(),t=E(),n=yI(),{newCanvasSessionImmediate:s}=CI(),r=w(Ud),a=l.useCallback(()=>{t(Ix())},[t]);return o.jsx(No,{isOpen:n.isTrue,onClose:n.setFalse,title:e("controlLayers.newCanvasSession"),acceptCallback:s,acceptButtonText:e("common.ok"),useInert:!1,children:o.jsxs(j,{direction:"column",gap:3,children:[o.jsx(O,{children:e("controlLayers.newCanvasSessionDesc")}),o.jsx(O,{children:e("common.areYouSure")}),o.jsxs(V,{children:[o.jsx(U,{children:e("common.dontAskMeAgain")}),o.jsx(kn,{isChecked:!r,onChange:a})]})]})})});jI.displayName="NewCanvasSessionDialog";const dW=e=>{const{t}=S(),{imageUsage:n,topMessage:s=t("gallery.currentlyInUse"),bottomMessage:r=t("gallery.featuresWillReset")}=e;return!n||!Gn(n)?null:o.jsxs(o.Fragment,{children:[o.jsx(O,{children:s}),o.jsxs(Si,{paddingInlineStart:6,fontSize:"sm",children:[n.isControlLayerImage&&o.jsx(Qt,{children:t("controlLayers.controlLayer")}),n.isReferenceImage&&o.jsx(Qt,{children:t("controlLayers.referenceImage")}),n.isInpaintMaskImage&&o.jsx(Qt,{children:t("controlLayers.inpaintMask")}),n.isRasterLayerImage&&o.jsx(Qt,{children:t("controlLayers.rasterLayer")}),n.isRegionalGuidanceImage&&o.jsx(Qt,{children:t("controlLayers.regionalGuidance")}),n.isUpscaleImage&&o.jsx(Qt,{children:t("ui.tabs.upscalingTab")}),n.isNodesImage&&o.jsx(Qt,{children:t("ui.tabs.workflowsTab")})]}),o.jsx(O,{children:r})]})},SI=l.memo(dW),uW=pt([ij,bt,Je,S8,Gd],(e,t,n,s,r)=>{const{imagesToDelete:a}=e,i=(a??[]).map(({image_name:d})=>lj(t,n,r,d)),c={isUpscaleImage:Gn(i,d=>d.isUpscaleImage),isRasterLayerImage:Gn(i,d=>d.isRasterLayerImage),isInpaintMaskImage:Gn(i,d=>d.isInpaintMaskImage),isRegionalGuidanceImage:Gn(i,d=>d.isRegionalGuidanceImage),isNodesImage:Gn(i,d=>d.isNodesImage),isControlLayerImage:Gn(i,d=>d.isControlLayerImage),isReferenceImage:Gn(i,d=>d.isReferenceImage)};return{imagesToDelete:a,imagesUsage:s,imageUsageSummary:c}}),hW=pe(Wd,e=>e.shouldConfirmOnDelete),pW=pe(ij,e=>e.isModalOpen),fW=()=>{wt("DeleteImageModal");const e=E(),{t}=S(),n=w(hW),s=w(pW),{imagesToDelete:r,imagesUsage:a,imageUsageSummary:i}=w(uW),c=l.useCallback(h=>e(cj(!h.target.checked)),[e]),d=l.useCallback(()=>{e(Ty()),e(k8(!1))},[e]),u=l.useCallback(()=>{!r.length||!a.length||(e(Ty()),e(I8({imageDTOs:r,imagesUsage:a})))},[e,r,a]);return o.jsx(No,{title:t("gallery.deleteImage",{count:r.length}),isOpen:s,onClose:d,cancelButtonText:t("common.cancel"),acceptButtonText:t("common.delete"),acceptCallback:u,useInert:!1,children:o.jsxs(j,{direction:"column",gap:3,children:[o.jsx(SI,{imageUsage:i}),o.jsx(zt,{}),o.jsx(O,{children:t("gallery.deleteImagePermanent")}),o.jsx(O,{children:t("common.areYouSure")}),o.jsxs(V,{children:[o.jsx(U,{children:t("common.dontAskMeAgain")}),o.jsx(ot,{isChecked:!n,onChange:c})]})]})})},mW=l.memo(fW),Rm=Ge(!1),kI=()=>{const e=se(Rm),t=l.useCallback(()=>{Rm.set(!0)},[]),n=l.useCallback(()=>{Rm.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}};var II={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},Ev=te.createContext&&te.createContext(II),gW=["attr","size","title"];function xW(e,t){if(e==null)return{};var n=bW(e,t),s,r;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)s=a[r],!(t.indexOf(s)>=0)&&Object.prototype.propertyIsEnumerable.call(e,s)&&(n[s]=e[s])}return n}function bW(e,t){if(e==null)return{};var n={};for(var s in e)if(Object.prototype.hasOwnProperty.call(e,s)){if(t.indexOf(s)>=0)continue;n[s]=e[s]}return n}function tp(){return tp=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},tp.apply(this,arguments)}function Lv(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);t&&(s=s.filter(function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable})),n.push.apply(n,s)}return n}function np(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Lv(Object(n),!0).forEach(function(s){yW(e,s,n[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Lv(Object(n)).forEach(function(s){Object.defineProperty(e,s,Object.getOwnPropertyDescriptor(n,s))})}return e}function yW(e,t,n){return t=vW(t),t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vW(e){var t=CW(e,"string");return typeof t=="symbol"?t:t+""}function CW(e,t){if(typeof e!="object"||!e)return e;var n=e[Symbol.toPrimitive];if(n!==void 0){var s=n.call(e,t||"default");if(typeof s!="object")return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return(t==="string"?String:Number)(e)}function _I(e){return e&&e.map((t,n)=>te.createElement(t.tag,np({key:n},t.attr),_I(t.child)))}function oe(e){return t=>te.createElement(wW,tp({attr:np({},e.attr)},t),_I(e.child))}function wW(e){var t=n=>{var{attr:s,size:r,title:a}=e,i=xW(e,gW),c=r||n.size||"1em",d;return n.className&&(d=n.className),e.className&&(d=(d?d+" ":"")+e.className),te.createElement("svg",tp({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},n.attr,s,i,{className:d,style:np(np({color:e.color||n.color},n.style),e.style),height:c,width:c,xmlns:"http://www.w3.org/2000/svg"}),a&&te.createElement("title",null,a),e.children)};return Ev!==void 0?te.createElement(Ev.Consumer,null,n=>t(n)):t(II)}function MI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V88a20,20,0,0,0,16,19.6V192a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V107.6A20,20,0,0,0,244,88V64A20,20,0,0,0,224,44ZM36,68H220V84H36ZM52,188V108H204v80Zm112-52a12,12,0,0,1-12,12H104a12,12,0,0,1,0-24h48A12,12,0,0,1,164,136Z"},child:[]}]})(e)}function jW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,200a12,12,0,0,1-24,0,84.09,84.09,0,0,0-84-84H61l27.52,27.51a12,12,0,0,1-17,17l-48-48a12,12,0,0,1,0-17l48-48a12,12,0,0,1,17,17L61,92h67A108.12,108.12,0,0,1,236,200Z"},child:[]}]})(e)}function SW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,56v48a12,12,0,0,1-12,12H184a12,12,0,1,1,0-24H201.1l-19-17.38c-.13-.12-.26-.24-.38-.37A76,76,0,1,0,127,204h1a75.53,75.53,0,0,0,52.15-20.72,12,12,0,0,1,16.49,17.45A99.45,99.45,0,0,1,128,228h-1.37A100,100,0,1,1,198.51,57.06L220,76.72V56a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function Kr(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a100,100,0,0,1-98.66,100H128a99.39,99.39,0,0,1-68.62-27.29,12,12,0,0,1,16.48-17.45,76,76,0,1,0-1.57-109c-.13.13-.25.25-.39.37L54.89,92H72a12,12,0,0,1,0,24H24a12,12,0,0,1-12-12V56a12,12,0,0,1,24,0V76.72L57.48,57.06A100,100,0,0,1,228,128Z"},child:[]}]})(e)}function kW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,152.49l-72,72a12,12,0,0,1-17,0l-72-72a12,12,0,0,1,17-17L116,187V40a12,12,0,0,1,24,0V187l51.51-51.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function IW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H69l51.52,51.51a12,12,0,0,1-17,17l-72-72a12,12,0,0,1,0-17l72-72a12,12,0,0,1,17,17L69,116H216A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function _W(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M47.51,112.49a12,12,0,0,1,17-17L116,147V32a12,12,0,0,1,24,0V147l51.51-51.52a12,12,0,0,1,17,17l-72,72a12,12,0,0,1-17,0ZM216,204H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function MW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,143.51a12,12,0,0,1-17,17L140,109V224a12,12,0,0,1-24,0V109L64.49,160.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0ZM216,28H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function AW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.49,136.49l-72,72a12,12,0,0,1-17-17L187,140H40a12,12,0,0,1,0-24H187L135.51,64.48a12,12,0,0,1,17-17l72,72A12,12,0,0,1,224.49,136.49Z"},child:[]}]})(e)}function Lb(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,104a12,12,0,0,1-24,0V69l-59.51,59.51a12,12,0,0,1-17-17L187,52H152a12,12,0,0,1,0-24h64a12,12,0,0,1,12,12Zm-44,24a12,12,0,0,0-12,12v64H52V84h64a12,12,0,0,0,0-24H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V140A12,12,0,0,0,184,128Z"},child:[]}]})(e)}function AI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,120.49a12,12,0,0,1-17,0L140,69V216a12,12,0,0,1-24,0V69L64.49,120.49a12,12,0,0,1-17-17l72-72a12,12,0,0,1,17,0l72,72A12,12,0,0,1,208.49,120.49Z"},child:[]}]})(e)}function EW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V96a12,12,0,0,1-12,12H168a12,12,0,0,1,0-24h19l-7.8-7.8a75.55,75.55,0,0,0-53.32-22.26h-.43A75.49,75.49,0,0,0,72.39,75.57,12,12,0,1,1,55.61,58.41a99.38,99.38,0,0,1,69.87-28.47H126A99.42,99.42,0,0,1,196.2,59.23L204,67V48a12,12,0,0,1,24,0ZM183.61,180.43a75.49,75.49,0,0,1-53.09,21.63h-.43A75.55,75.55,0,0,1,76.77,179.8L69,172H88a12,12,0,0,0,0-24H40a12,12,0,0,0-12,12v48a12,12,0,0,0,24,0V189l7.8,7.8A99.42,99.42,0,0,0,130,226.06h.56a99.38,99.38,0,0,0,69.87-28.47,12,12,0,0,0-16.78-17.16Z"},child:[]}]})(e)}function sf(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M88,108H40A12,12,0,0,1,28,96V48a12,12,0,0,1,24,0V67l7.8-7.8A99.42,99.42,0,0,1,130,29.94h.56a99.38,99.38,0,0,1,69.87,28.47,12,12,0,0,1-16.78,17.16,76,76,0,0,0-106.84.63L69,84H88a12,12,0,0,1,0,24Zm128,40H168a12,12,0,0,0,0,24h19l-7.8,7.8a75.55,75.55,0,0,1-53.32,22.26h-.43a75.49,75.49,0,0,1-53.09-21.63,12,12,0,0,0-16.78,17.16,99.38,99.38,0,0,0,69.87,28.47H126a99.42,99.42,0,0,0,70.16-29.29L204,189v19a12,12,0,0,0,24,0V160A12,12,0,0,0,216,148Z"},child:[]}]})(e)}function LW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M120.49,167.51a12,12,0,0,1,0,17l-32,32a12,12,0,0,1-17,0l-32-32a12,12,0,1,1,17-17L68,179V48a12,12,0,0,1,24,0V179l11.51-11.52A12,12,0,0,1,120.49,167.51Zm96-96-32-32a12,12,0,0,0-17,0l-32,32a12,12,0,0,0,17,17L164,77V208a12,12,0,0,0,24,0V77l11.51,11.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function bu(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M220,48V96a12,12,0,0,1-24,0V77l-35.51,35.52a12,12,0,0,1-17-17L179,60H160a12,12,0,0,1,0-24h48A12,12,0,0,1,220,48ZM95.51,143.51,60,179V160a12,12,0,0,0-24,0v48a12,12,0,0,0,12,12H96a12,12,0,0,0,0-24H77l35.52-35.51a12,12,0,0,0-17-17ZM208,148a12,12,0,0,0-12,12v19l-35.51-35.52a12,12,0,0,0-17,17L179,196H160a12,12,0,0,0,0,24h48a12,12,0,0,0,12-12V160A12,12,0,0,0,208,148ZM77,60H96a12,12,0,0,0,0-24H48A12,12,0,0,0,36,48V96a12,12,0,0,0,24,0V77l35.51,35.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function EI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.29,182.17a12,12,0,0,1-16.47,4.12L140,149.19V216a12,12,0,0,1-24,0V149.19l-61.82,37.1a12,12,0,1,1-12.35-20.58L104.68,128,41.83,90.29A12,12,0,1,1,54.18,69.71L116,106.81V40a12,12,0,0,1,24,0v66.81l61.82-37.1a12,12,0,1,1,12.35,20.58L151.32,128l62.85,37.71A12,12,0,0,1,218.29,182.17Z"},child:[]}]})(e)}function TW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,28H72A20,20,0,0,0,52,48V224a12,12,0,0,0,18.36,10.18l57.63-36,57.65,36A12,12,0,0,0,204,224V48A20,20,0,0,0,184,28Zm-4,174.35-45.65-28.53a12,12,0,0,0-12.72,0L76,202.35V52H180Z"},child:[]}]})(e)}function fc(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,100a20,20,0,0,0,20-20V48a20,20,0,0,0-20-20H176a20,20,0,0,0-20,20v4H100V48A20,20,0,0,0,80,28H48A20,20,0,0,0,28,48V80a20,20,0,0,0,20,20h4v56H48a20,20,0,0,0-20,20v32a20,20,0,0,0,20,20H80a20,20,0,0,0,20-20v-4h56v4a20,20,0,0,0,20,20h32a20,20,0,0,0,20-20V176a20,20,0,0,0-20-20h-4V100ZM180,52h24V76H180ZM52,52H76V76H52ZM76,204H52V180H76Zm128,0H180V180h24Zm-24-48h-4a20,20,0,0,0-20,20v4H100v-4a20,20,0,0,0-20-20H76V100h4a20,20,0,0,0,20-20V76h56v4a20,20,0,0,0,20,20h4Z"},child:[]}]})(e)}function PW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M54.8,119.49A35.06,35.06,0,0,1,49.05,128a35.06,35.06,0,0,1,5.75,8.51C60,147.24,60,159.83,60,172c0,25.94,1.84,32,20,32a12,12,0,0,1,0,24c-19.14,0-32.2-6.9-38.8-20.51C36,196.76,36,184.17,36,172c0-25.94-1.84-32-20-32a12,12,0,0,1,0-24c18.16,0,20-6.06,20-32,0-12.17,0-24.76,5.2-35.49C47.8,34.9,60.86,28,80,28a12,12,0,0,1,0,24c-18.16,0-20,6.06-20,32C60,96.17,60,108.76,54.8,119.49ZM240,116c-18.16,0-20-6.06-20-32,0-12.17,0-24.76-5.2-35.49C208.2,34.9,195.14,28,176,28a12,12,0,0,0,0,24c18.16,0,20,6.06,20,32,0,12.17,0,24.76,5.2,35.49A35.06,35.06,0,0,0,207,128a35.06,35.06,0,0,0-5.75,8.51C196,147.24,196,159.83,196,172c0,25.94-1.84,32-20,32a12,12,0,0,0,0,24c19.14,0,32.2-6.9,38.8-20.51C220,196.76,220,184.17,220,172c0-25.94,1.84-32,20-32a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function RW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.24,213.21C216.12,203,204,180.64,204,152V134.73a19.94,19.94,0,0,0-12.62-18.59l-24.86-9.81a4,4,0,0,1-2.26-5.14l21.33-53A32,32,0,0,0,167.17,6,32.13,32.13,0,0,0,126.25,24.2l-.07.18-21,53.09a3.94,3.94,0,0,1-2.14,2.2,3.89,3.89,0,0,1-3,.06L74.6,69.43A19.89,19.89,0,0,0,52.87,74C31.06,96.43,20,122.68,20,152a115.46,115.46,0,0,0,32.29,80.3A12,12,0,0,0,61,236H232a12,12,0,0,0,5.24-22.79ZM68.19,92.73,91.06,102A28,28,0,0,0,127.5,86.31l20.95-53a8.32,8.32,0,0,1,10.33-4.81,8,8,0,0,1,4.61,10.57,1.17,1.17,0,0,0,0,.11L142,92.29a28.05,28.05,0,0,0,15.68,36.33L180,137.45V152c0,1,0,2.07.05,3.1l-122.44-49A101.91,101.91,0,0,1,68.19,92.73ZM116.74,212a83.73,83.73,0,0,1-22.09-39,12,12,0,0,0-23.25,6,110.27,110.27,0,0,0,14.49,33H66.25A91.53,91.53,0,0,1,44,152a84,84,0,0,1,3.41-24.11l136.67,54.66A86.58,86.58,0,0,0,198.66,212Z"},child:[]}]})(e)}function DW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,160a12,12,0,0,0,0-24H212V120h12a12,12,0,0,0,0-24H210.45a83.7,83.7,0,0,0-18.78-38.7l16.82-16.81a12,12,0,1,0-17-17l-18,18a83.7,83.7,0,0,0-91.1,0l-18-18a12,12,0,0,0-17,17L64.33,57.3A83.7,83.7,0,0,0,45.55,96H32a12,12,0,0,0,0,24H44v16H32a12,12,0,0,0,0,24H44a83.55,83.55,0,0,0,1.55,16H32a12,12,0,0,0,0,24H54.15a84,84,0,0,0,147.7,0H224a12,12,0,0,0,0-24H210.45A83.55,83.55,0,0,0,212,160ZM128,52a60.1,60.1,0,0,1,57.82,44H70.18A60.1,60.1,0,0,1,128,52Zm12,166.79V148a12,12,0,0,0-24,0v70.79A60.09,60.09,0,0,1,68,160V120H188v40A60.09,60.09,0,0,1,140,218.79Z"},child:[]}]})(e)}function Fo(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,104.49l-80,80a12,12,0,0,1-17,0l-80-80a12,12,0,0,1,17-17L128,159l71.51-71.52a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function Tb(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M168.49,199.51a12,12,0,0,1-17,17l-80-80a12,12,0,0,1,0-17l80-80a12,12,0,0,1,17,17L97,128Z"},child:[]}]})(e)}function Pb(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184.49,136.49l-80,80a12,12,0,0,1-17-17L159,128,87.51,56.49a12,12,0,1,1,17-17l80,80A12,12,0,0,1,184.49,136.49Z"},child:[]}]})(e)}function LI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,168.49a12,12,0,0,1-17,0L128,97,56.49,168.49a12,12,0,0,1-17-17l80-80a12,12,0,0,1,17,0l80,80A12,12,0,0,1,216.49,168.49Z"},child:[]}]})(e)}function Ei(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,80.49l-128,128a12,12,0,0,1-17,0l-56-56a12,12,0,1,1,17-17L96,183,215.51,63.51a12,12,0,0,1,17,17Z"},child:[]}]})(e)}function OW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Z"},child:[]}]})(e)}function NW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,128a108,108,0,0,1-216,0c0-42.52,24.73-81.34,63-98.9A12,12,0,1,1,93,50.91C63.24,64.57,44,94.83,44,128a84,84,0,0,0,168,0c0-33.17-19.24-63.43-49-77.09A12,12,0,1,1,173,29.1C211.27,46.66,236,85.48,236,128Z"},child:[]}]})(e)}function TI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM52,52H76v95.22a24,24,0,1,0,24,0V125l40,40v39H52ZM204,204H164V160a12,12,0,0,0-3.51-8.49L100,91V52h24V72a12,12,0,0,0,3.51,8.49l17.31,17.3a24,24,0,1,0,17-17L148,67V52h56Z"},child:[]}]})(e)}function BW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.68,97.22,34.74,128l36.94,30.78a12,12,0,1,1-15.36,18.44l-48-40a12,12,0,0,1,0-18.44l48-40A12,12,0,0,1,71.68,97.22Zm176,21.56-48-40a12,12,0,1,0-15.36,18.44L221.26,128l-36.94,30.78a12,12,0,1,0,15.36,18.44l48-40a12,12,0,0,0,0-18.44ZM164.1,28.72a12,12,0,0,0-15.38,7.18l-64,176a12,12,0,0,0,7.18,15.37A11.79,11.79,0,0,0,96,228a12,12,0,0,0,11.28-7.9l64-176A12,12,0,0,0,164.1,28.72Z"},child:[]}]})(e)}function gr(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,28H88A12,12,0,0,0,76,40V76H40A12,12,0,0,0,28,88V216a12,12,0,0,0,12,12H168a12,12,0,0,0,12-12V180h36a12,12,0,0,0,12-12V40A12,12,0,0,0,216,28ZM156,204H52V100H156Zm48-48H180V88a12,12,0,0,0-12-12H100V52H204Z"},child:[]}]})(e)}function PI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M244,192a12,12,0,0,1-12,12H204v28a12,12,0,0,1-24,0V204H64a12,12,0,0,1-12-12V76H24a12,12,0,0,1,0-24H52V24a12,12,0,0,1,24,0V180H232A12,12,0,0,1,244,192ZM104,76h76v76a12,12,0,0,0,24,0V64a12,12,0,0,0-12-12H104a12,12,0,0,0,0,24Z"},child:[]}]})(e)}function $W(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.6,62.64l-88-48.17a19.91,19.91,0,0,0-19.2,0l-88,48.17A20,20,0,0,0,20,80.19v95.62a20,20,0,0,0,10.4,17.55l88,48.17a19.89,19.89,0,0,0,19.2,0l88-48.17A20,20,0,0,0,236,175.81V80.19A20,20,0,0,0,225.6,62.64ZM128,36.57,200,76,128,115.4,56,76ZM44,96.79l72,39.4v76.67L44,173.44Zm96,116.07V136.19l72-39.4v76.65Z"},child:[]}]})(e)}function FW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224.15,179.17l-46.83-46.82,37.93-13.51.76-.3a20,20,0,0,0-1.76-37.27L54.16,29A20,20,0,0,0,29,54.16L81.27,214.24A20,20,0,0,0,118.54,216c.11-.25.21-.5.3-.76l13.51-37.92,46.83,46.82a20,20,0,0,0,28.28,0l16.69-16.68A20,20,0,0,0,224.15,179.17Zm-30.83,25.17-48.48-48.48A20,20,0,0,0,130.7,150a20.66,20.66,0,0,0-3.74.35A20,20,0,0,0,112.35,162c-.11.25-.21.5-.3.76L100.4,195.5,54.29,54.29l141.21,46.1-32.71,11.66c-.26.09-.51.19-.76.3a20,20,0,0,0-6.17,32.48h0l48.49,48.48Z"},child:[]}]})(e)}function zW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M108,60A16,16,0,1,1,92,44,16,16,0,0,1,108,60Zm56,16a16,16,0,1,0-16-16A16,16,0,0,0,164,76ZM92,112a16,16,0,1,0,16,16A16,16,0,0,0,92,112Zm72,0a16,16,0,1,0,16,16A16,16,0,0,0,164,112ZM92,180a16,16,0,1,0,16,16A16,16,0,0,0,92,180Zm72,0a16,16,0,1,0,16,16A16,16,0,0,0,164,180Z"},child:[]}]})(e)}function RI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M71.51,88.49a12,12,0,0,1,17-17L116,99V24a12,12,0,0,1,24,0V99l27.51-27.52a12,12,0,0,1,17,17l-48,48a12,12,0,0,1-17,0ZM224,116H188a12,12,0,0,0,0,24h32v56H36V140H68a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116Zm-20,52a16,16,0,1,0-16,16A16,16,0,0,0,204,168Z"},child:[]}]})(e)}function mc(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0Zm-108.49,8.49a12,12,0,0,0,17,0l40-40a12,12,0,0,0-17-17L140,115V32a12,12,0,0,0-24,0v83L96.49,95.51a12,12,0,0,0-17,17Z"},child:[]}]})(e)}function VW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M134.88,6.17a12,12,0,0,0-13.76,0,259,259,0,0,0-42.18,39C50.85,77.43,36,111.63,36,144a92,92,0,0,0,184,0C220,66.64,138.36,8.6,134.88,6.17ZM194.08,160H140V144h56A68,68,0,0,1,194.08,160ZM140,120V104h47a115,115,0,0,1,5.68,16Zm19.3-58.71A197.29,197.29,0,0,1,173.68,80H140V41.46A243.5,243.5,0,0,1,159.3,61.29ZM60,144c0-33.31,20-63.37,36.7-82.71A243.5,243.5,0,0,1,116,41.46V210.92A68.1,68.1,0,0,1,60,144Zm80,66.92V184h42.94A68,68,0,0,1,140,210.92Z"},child:[]}]})(e)}function HW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,204H141l86.84-86.84a28,28,0,0,0,0-39.6L186.43,36.19a28,28,0,0,0-39.6,0L28.19,154.82a28,28,0,0,0,0,39.6l30.06,30.07A12,12,0,0,0,66.74,228H216a12,12,0,0,0,0-24ZM163.8,53.16a4,4,0,0,1,5.66,0l41.38,41.38a4,4,0,0,1,0,5.65L160,151l-47-47ZM71.71,204,45.16,177.45a4,4,0,0,1,0-5.65L96,121l47,47-36,36Z"},child:[]}]})(e)}function WW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M148,200a20,20,0,1,1-20-20A20,20,0,0,1,148,200Zm-20-40a12,12,0,0,0,12-12V48a12,12,0,0,0-24,0V148A12,12,0,0,0,128,160Z"},child:[]}]})(e)}function yu(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M251,123.13c-.37-.81-9.13-20.26-28.48-39.61C196.63,57.67,164,44,128,44S59.37,57.67,33.51,83.52C14.16,102.87,5.4,122.32,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212s68.63-13.66,94.48-39.51c19.36-19.35,28.12-38.79,28.49-39.61A12.08,12.08,0,0,0,251,123.13Zm-46.06,33C183.47,177.27,157.59,188,128,188s-55.47-10.73-76.91-31.88A130.36,130.36,0,0,1,29.52,128,130.45,130.45,0,0,1,51.09,99.89C72.54,78.73,98.41,68,128,68s55.46,10.73,76.91,31.89A130.36,130.36,0,0,1,226.48,128,130.45,130.45,0,0,1,204.91,156.12ZM128,84a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,84Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,148Z"},child:[]}]})(e)}function GW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.42,162A12,12,0,1,1,213.58,174l-16.86-29.5a127.19,127.19,0,0,1-30.17,13.86L171.84,190a12,12,0,0,1-9.87,13.8,11.22,11.22,0,0,1-2,.17,12,12,0,0,1-11.82-10L143,163.17a136.5,136.5,0,0,1-30.06,0L107.84,194A12,12,0,0,1,96,204a11.22,11.22,0,0,1-2-.17A12,12,0,0,1,84.16,190l5.29-31.72a127.19,127.19,0,0,1-30.17-13.86L42.42,174A12,12,0,1,1,21.58,162L40,129.85a159.73,159.73,0,0,1-17.31-18.31A12,12,0,0,1,41.34,96.46C57.38,116.32,85.44,140,128,140s70.62-23.68,86.66-43.54a12,12,0,0,1,18.67,15.08A159.73,159.73,0,0,1,216,129.85Z"},child:[]}]})(e)}function UW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M56.88,31.93A12,12,0,1,0,39.12,48.07l16,17.65C20.67,88.66,5.72,121.58,5,123.13a12.08,12.08,0,0,0,0,9.75c.37.82,9.13,20.26,28.49,39.61C59.37,198.34,92,212,128,212a131.34,131.34,0,0,0,51-10l20.09,22.1a12,12,0,0,0,17.76-16.14ZM128,188c-29.59,0-55.47-10.73-76.91-31.88A130.69,130.69,0,0,1,29.52,128c5.27-9.31,18.79-29.9,42-44.29l90.09,99.11A109.33,109.33,0,0,1,128,188Zm123-55.12c-.36.81-9,20-28,39.16a12,12,0,1,1-17-16.9A130.48,130.48,0,0,0,226.48,128a130.36,130.36,0,0,0-21.57-28.12C183.46,78.73,157.59,68,128,68c-3.35,0-6.7.14-10,.42a12,12,0,1,1-2-23.91c3.93-.34,8-.51,12-.51,36,0,68.63,13.67,94.49,39.52,19.35,19.35,28.11,38.8,28.48,39.61A12.08,12.08,0,0,1,251,132.88Z"},child:[]}]})(e)}function ZW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,67.24a39.77,39.77,0,0,0-12.51-28.52C199.91,24,174.71,24.5,159.29,39.93L142.48,56.84a28,28,0,0,0-35.64,3.29l-9,9a20,20,0,0,0-.73,27.49L48.9,144.84A43.76,43.76,0,0,0,37,185.28l-7.5,17.19a17.66,17.66,0,0,0,3.71,19.65,19.9,19.9,0,0,0,22.15,4.19l16.31-7.13a43.88,43.88,0,0,0,39.45-12.09l48.24-48.26a20,20,0,0,0,27.47-.73l9-9a28.06,28.06,0,0,0,3.26-35.72l17.23-17.33A39.69,39.69,0,0,0,228,67.24ZM94.15,190.11a20,20,0,0,1-20,5,11.93,11.93,0,0,0-8.32.47L57,199.38,60.69,191a12,12,0,0,0,.37-8.64,19.92,19.92,0,0,1,4.81-20.55l48.2-48.22,28.28,28.3Zm105.14-111-25.37,25.52a12,12,0,0,0,0,16.95l4.88,4.89a4,4,0,0,1,0,5.66l-6.14,6.15-55-55.05,6.14-6.14a4,4,0,0,1,5.65,0L134.35,82a12,12,0,0,0,8.49,3.51h0A12,12,0,0,0,151.34,82l24.94-25.08c6.3-6.3,16.48-6.63,22.71-.74a16,16,0,0,1,.3,23Z"},child:[]}]})(e)}function qW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.52l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.52ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Z"},child:[]}]})(e)}function DI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216.49,79.51l-56-56A12,12,0,0,0,152,20H56A20,20,0,0,0,36,40V216a20,20,0,0,0,20,20H200a20,20,0,0,0,20-20V88A12,12,0,0,0,216.49,79.51ZM160,57l23,23H160ZM60,212V44h76V92a12,12,0,0,0,12,12h48V212Zm104-60a12,12,0,0,1-12,12H140v12a12,12,0,0,1-24,0V164H104a12,12,0,0,1,0-24h12V128a12,12,0,0,1,24,0v12h12A12,12,0,0,1,164,152Z"},child:[]}]})(e)}function Rb(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M225.15,197.71,164,95.81V44h4a12,12,0,0,0,0-24H88a12,12,0,0,0,0,24h4V95.81L30.85,197.71A20,20,0,0,0,48,228H208a20,20,0,0,0,17.15-30.29ZM140,44V99.14a12,12,0,0,0,1.71,6.17l35.13,58.54c-10.79.86-25.15-1.31-43.42-10.56-14-7.08-27.46-11.33-40.27-12.76l21.14-35.22A12,12,0,0,0,116,99.14V44ZM55.06,204,79,164.19c13-1.11,27.62,2.42,43.62,10.52,19.61,9.92,36.25,13.31,49.85,13.31A75.44,75.44,0,0,0,190.11,186l10.83,18Z"},child:[]}]})(e)}function $r(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M222.14,69.17,186.83,33.86A19.86,19.86,0,0,0,172.69,28H48A20,20,0,0,0,28,48V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V83.31A19.86,19.86,0,0,0,222.14,69.17ZM164,204H92V160h72Zm40,0H188V156a20,20,0,0,0-20-20H88a20,20,0,0,0-20,20v48H52V52H171l33,33ZM164,84a12,12,0,0,1-12,12H96a12,12,0,0,1,0-24h56A12,12,0,0,1,164,84Z"},child:[]}]})(e)}function of(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M248.49,71.51l-32-32a12,12,0,0,0-17,17L211,68h-3c-52,0-64.8,30.71-75.08,55.38-8.82,21.17-15.45,37.05-42.75,40.09a44,44,0,1,0,.28,24.08c43.34-3.87,55.07-32,64.63-54.93C164.9,109,172,92,208,92h3l-11.52,11.51a12,12,0,0,0,17,17l32-32A12,12,0,0,0,248.49,71.51ZM48,196a20,20,0,1,1,20-20A20,20,0,0,1,48,196Z"},child:[]}]})(e)}function OI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,56H160L133.33,36a20.12,20.12,0,0,0-12-4H76A20,20,0,0,0,56,52V72H36A20,20,0,0,0,16,92V204a20,20,0,0,0,20,20H188.89A19.13,19.13,0,0,0,208,204.89V184h20.89A19.13,19.13,0,0,0,248,164.89V76A20,20,0,0,0,228,56ZM184,200H40V96H80l28.8,21.6A12,12,0,0,0,116,120h68Zm40-40H208V116a20,20,0,0,0-20-20H120L93.33,76a20.12,20.12,0,0,0-12-4H80V56h40l28.8,21.6A12,12,0,0,0,156,80h68Z"},child:[]}]})(e)}function vu(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,88a12,12,0,0,1,12-12h32a12,12,0,0,1,12,12v32a12,12,0,0,1-24,0V100H152A12,12,0,0,1,140,88ZM72,180h32a12,12,0,0,0,0-24H84V136a12,12,0,0,0-24,0v32A12,12,0,0,0,72,180ZM236,56V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56Zm-24,4H44V196H212Z"},child:[]}]})(e)}function KW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,47.91A20,20,0,0,0,216,36H40A20,20,0,0,0,25.2,69.45l.12.14L92,140.75V216a20,20,0,0,0,31.1,16.64l32-21.33A20,20,0,0,0,164,194.66V140.75l66.67-71.16.12-.14A20,20,0,0,0,234.29,47.91Zm-91,79.89A12,12,0,0,0,140,136v56.52l-24,16V136a12,12,0,0,0-3.25-8.2L49.23,60H206.77Z"},child:[]}]})(e)}function NI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M250.18,105.17,186.71,41.25a100.11,100.11,0,0,0-141.43,0l-.13.14L31.37,55.61a12,12,0,1,0,17.24,16.7L62.32,58.16A75.68,75.68,0,0,1,77.49,46.43L119,88,25.85,181.16a20,20,0,0,0,0,28.29l20.69,20.69a20,20,0,0,0,28.28,0L168,137l1.51,1.51h0l23.65,23.66a20,20,0,0,0,28.29,0l28.69-28.7A20,20,0,0,0,250.18,105.17ZM60.68,210.34l-15-15L108,133l15,15ZM140,131l-15-15,19.51-19.51a12,12,0,0,0,0-17L102.24,37.24a75.94,75.94,0,0,1,67.47,20.95l31.44,31.67L178,113l-1.51-1.51a12,12,0,0,0-17,0Zm67.32,11.31L195,130l23.09-23.09,12.3,12.39Z"},child:[]}]})(e)}function QW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,44a32,32,0,0,0-8,1V44a32,32,0,0,0-60.79-14A32,32,0,0,0,76,60v50.83a32,32,0,0,0-52,36.7C55.82,214.6,75.35,244,128,244a92.1,92.1,0,0,0,92-92V76A32,32,0,0,0,188,44Zm8,108a68.08,68.08,0,0,1-68,68c-35.83,0-49.71-14-82.48-83.14-.14-.29-.29-.58-.45-.86a8,8,0,0,1,13.85-8l.21.35,18.68,30A12,12,0,0,0,100,152V60a8,8,0,0,1,16,0v60a12,12,0,0,0,24,0V44a8,8,0,0,1,16,0v76a12,12,0,0,0,24,0V76a8,8,0,0,1,16,0Z"},child:[]}]})(e)}function YW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,20H72A20,20,0,0,0,52,40V76a20.1,20.1,0,0,0,8,16l48,36L60,164a20.1,20.1,0,0,0-8,16v36a20,20,0,0,0,20,20H184a20,20,0,0,0,20-20V180.36a20.13,20.13,0,0,0-7.94-16L147.9,128l48.16-36.4a20.13,20.13,0,0,0,7.94-16V40A20,20,0,0,0,184,20Zm-4,24V60H76V44Zm-52,69L89.33,84h77Zm52,99H76V182l52-39,52,39.33Z"},child:[]}]})(e)}function fi(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M144,96a16,16,0,1,1,16,16A16,16,0,0,1,144,96Zm92-40V200a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V56A20,20,0,0,1,40,36H216A20,20,0,0,1,236,56ZM44,60v79.72l33.86-33.86a20,20,0,0,1,28.28,0L147.31,147l17.18-17.17a20,20,0,0,1,28.28,0L212,149.09V60Zm0,136H162.34L92,125.66l-48,48Zm168,0V183l-33.37-33.37L164.28,164l32,32Z"},child:[]}]})(e)}function BI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M160,88a16,16,0,1,1,16,16A16,16,0,0,1,160,88Zm76-32V160a20,20,0,0,1-20,20H204v20a20,20,0,0,1-20,20H40a20,20,0,0,1-20-20V88A20,20,0,0,1,40,68H60V56A20,20,0,0,1,80,36H216A20,20,0,0,1,236,56ZM180,180H80a20,20,0,0,1-20-20V92H44V196H180Zm-21.66-24L124,121.66,89.66,156ZM212,60H84v67.72l25.86-25.86a20,20,0,0,1,28.28,0L192.28,156H212Z"},child:[]}]})(e)}function JW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,28H88A20,20,0,0,0,68,48V60H48A20,20,0,0,0,28,80V208a20,20,0,0,0,20,20H176a20,20,0,0,0,20-20V188h12a20,20,0,0,0,20-20V48A20,20,0,0,0,208,28ZM92,52H204v59.72l-9.86-9.86a20,20,0,0,0-28.28,0L103.72,164H92Zm80,152H52V84H68v84a20,20,0,0,0,20,20h84Zm-34.34-40L180,121.66l24,24V164ZM108,88a20,20,0,1,1,20,20A20,20,0,0,1,108,88Z"},child:[]}]})(e)}function Li(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M108,84a16,16,0,1,1,16,16A16,16,0,0,1,108,84Zm128,44A108,108,0,1,1,128,20,108.12,108.12,0,0,1,236,128Zm-24,0a84,84,0,1,0-84,84A84.09,84.09,0,0,0,212,128Zm-72,36.68V132a20,20,0,0,0-20-20,12,12,0,0,0-4,23.32V168a20,20,0,0,0,20,20,12,12,0,0,0,4-23.32Z"},child:[]}]})(e)}function XW(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,44H32A20,20,0,0,0,12,64V192a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V64A20,20,0,0,0,224,44Zm-4,144H36V68H220ZM52,128a12,12,0,0,1,12-12H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,128Zm0-36A12,12,0,0,1,64,80H192a12,12,0,0,1,0,24H64A12,12,0,0,1,52,92Zm0,72a12,12,0,0,1,12-12h8a12,12,0,0,1,0,24H64A12,12,0,0,1,52,164Zm108,0a12,12,0,0,1-12,12H108a12,12,0,0,1,0-24h40A12,12,0,0,1,160,164Zm44,0a12,12,0,0,1-12,12h-8a12,12,0,0,1,0-24h8A12,12,0,0,1,204,164Z"},child:[]}]})(e)}function eG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M180,232a12,12,0,0,1-12,12H88a12,12,0,0,1,0-24h80A12,12,0,0,1,180,232Zm40-128a92.47,92.47,0,0,1-37,73.73,7.81,7.81,0,0,0-3,6.27,20,20,0,0,1-20,20H96a20,20,0,0,1-20-20v-.23a7.76,7.76,0,0,0-3.25-6.2,91.36,91.36,0,0,1-36.75-73C35.73,54.69,76,13.2,125.79,12A92,92,0,0,1,220,104Zm-24,0a68,68,0,0,0-69.65-68C89.56,36.89,59.8,67.56,60,104.39a67.52,67.52,0,0,0,27.18,54h0A32.14,32.14,0,0,1,99.77,180H116V149L87.51,120.49a12,12,0,0,1,17-17L128,127l23.51-23.51a12,12,0,0,1,17,17L140,149v31h16.25a31.89,31.89,0,0,1,12.41-21.49A67.45,67.45,0,0,0,196,104Z"},child:[]}]})(e)}function $I(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M219.71,117.38a12,12,0,0,0-7.25-8.52L161.28,88.39l10.59-70.61a12,12,0,0,0-20.64-10l-112,120a12,12,0,0,0,4.31,19.33l51.18,20.47L84.13,238.22a12,12,0,0,0,20.64,10l112-120A12,12,0,0,0,219.71,117.38ZM113.6,203.55l6.27-41.77a12,12,0,0,0-7.41-12.92L68.74,131.37,142.4,52.45l-6.27,41.77a12,12,0,0,0,7.41,12.92l43.72,17.49Z"},child:[]}]})(e)}function tG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M87.5,151.52l64-64a12,12,0,0,1,17,17l-64,64a12,12,0,0,1-17-17Zm131-114a60.08,60.08,0,0,0-84.87,0L103.51,67.61a12,12,0,0,0,17,17l30.07-30.06a36,36,0,0,1,50.93,50.92L171.4,135.52a12,12,0,1,0,17,17l30.08-30.06A60.09,60.09,0,0,0,218.45,37.55ZM135.52,171.4l-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function nG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M218.45,122.43l-30.08,30.06a12,12,0,0,1-17-17l30.08-30.07a36,36,0,0,0-50.93-50.92L120.48,84.59a12,12,0,0,1-17-17l30.07-30.06a60,60,0,0,1,84.87,84.88Zm-82.93,49-30.07,30.08a36,36,0,0,1-50.92-50.93l30.06-30.07a12,12,0,0,0-17-17L37.55,133.58a60,60,0,0,0,84.88,84.87l30.06-30.07a12,12,0,0,0-17-17Z"},child:[]}]})(e)}function sG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128ZM40,76H216a12,12,0,0,0,0-24H40a12,12,0,0,0,0,24ZM216,180H40a12,12,0,0,0,0,24H216a12,12,0,0,0,0-24Z"},child:[]}]})(e)}function FI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,76H100V56a28,28,0,0,1,28-28c13.51,0,25.65,9.62,28.24,22.39a12,12,0,1,0,23.52-4.78C174.87,21.5,153.1,4,128,4A52.06,52.06,0,0,0,76,56V76H48A20,20,0,0,0,28,96V208a20,20,0,0,0,20,20H208a20,20,0,0,0,20-20V96A20,20,0,0,0,208,76Zm-4,128H52V100H204Z"},child:[]}]})(e)}function zI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232.49,215.51,185,168a92.12,92.12,0,1,0-17,17l47.53,47.54a12,12,0,0,0,17-17ZM44,112a68,68,0,1,1,68,68A68.07,68.07,0,0,1,44,112Z"},child:[]}]})(e)}function VI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H80a12,12,0,0,1,0-24h64A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function HI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,112a12,12,0,0,1-12,12H124v20a12,12,0,0,1-24,0V124H80a12,12,0,0,1,0-24h20V80a12,12,0,0,1,24,0v20h20A12,12,0,0,1,156,112Zm76.49,120.49a12,12,0,0,1-17,0L168,185a92.12,92.12,0,1,1,17-17l47.54,47.53A12,12,0,0,1,232.49,232.49ZM112,180a68,68,0,1,0-68-68A68.08,68.08,0,0,0,112,180Z"},child:[]}]})(e)}function oG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,60a44,44,0,1,0,44,44A44.05,44.05,0,0,0,128,60Zm0,64a20,20,0,1,1,20-20A20,20,0,0,1,128,124Zm0-112a92.1,92.1,0,0,0-92,92c0,77.36,81.64,135.4,85.12,137.83a12,12,0,0,0,13.76,0,259,259,0,0,0,42.18-39C205.15,170.57,220,136.37,220,104A92.1,92.1,0,0,0,128,12Zm31.3,174.71A249.35,249.35,0,0,1,128,216.89a249.35,249.35,0,0,1-31.3-30.18C80,167.37,60,137.31,60,104a68,68,0,0,1,136,0C196,137.31,176,167.37,159.3,186.71Z"},child:[]}]})(e)}function rG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H40a12,12,0,0,1,0-24H216A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function rf(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M236,32a12,12,0,0,0-12-12c-44.78,0-90,48.54-115.9,82a64,64,0,0,0-80,62c0,12-3.1,22.71-9.23,31.76A43,43,0,0,1,9.4,206.05a11.88,11.88,0,0,0-4.91,13.38A12.07,12.07,0,0,0,16.11,228h76A64,64,0,0,0,154,148C187.49,122.05,236,76.8,236,32ZM209.62,46.39c-4,12.92-13.15,27.49-26.92,42.91-3,3.39-6.16,6.7-9.35,9.89a104.31,104.31,0,0,0-16.5-16.51c3.19-3.19,6.49-6.32,9.88-9.35C182.15,59.55,196.71,50.43,209.62,46.39ZM92.07,204H42a80.17,80.17,0,0,0,10.14-40,40,40,0,1,1,40,40Zm38.18-91.32c3.12-3.93,6.55-8.09,10.23-12.35a80.52,80.52,0,0,1,15.23,15.24c-4.26,3.68-8.42,7.11-12.35,10.23A64.43,64.43,0,0,0,130.25,112.68Z"},child:[]}]})(e)}function Cu(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M230.14,70.54,185.46,25.85a20,20,0,0,0-28.29,0L33.86,149.17A19.85,19.85,0,0,0,28,163.31V208a20,20,0,0,0,20,20H92.69a19.86,19.86,0,0,0,14.14-5.86L230.14,98.82a20,20,0,0,0,0-28.28ZM93,180l71-71,11,11-71,71ZM76,163,65,152l71-71,11,11ZM52,173l15.51,15.51h0L83,204H52ZM192,103,153,64l18.34-18.34,39,39Z"},child:[]}]})(e)}function WI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M255.62,51.65a12,12,0,0,0-11.27-11.27c-53.27-3.13-96.2,13.36-114.84,44.14-12.14,20-12.56,44.17-1.46,67.3a75.14,75.14,0,0,0-12.28,23l-12.66-12.66c7.19-16.77,6.43-34.11-2.4-48.69C86.73,90.36,54.89,78,15.55,80.27A12,12,0,0,0,4.28,91.55C2,130.89,14.36,162.73,37.45,176.71a49.76,49.76,0,0,0,26,7.27,57.54,57.54,0,0,0,22.7-4.87L112,205v23a12,12,0,0,0,24,0V198.51a51.63,51.63,0,0,1,9.49-29.95,76.82,76.82,0,0,0,32.1,7.39,64.91,64.91,0,0,0,33.89-9.46C242.25,147.85,258.76,104.92,255.62,51.65ZM49.88,156.18c-13.19-8-21.18-27.46-21.83-52.13,24.67.65,44.14,8.64,52.13,21.83a26,26,0,0,1,3.63,17L72.48,131.51a12,12,0,0,0-17,17l11.34,11.34A26.27,26.27,0,0,1,49.88,156.18ZM199.05,146c-10.66,6.45-23,7.67-35.81,3.76l37.25-37.24a12,12,0,0,0-17-17l-37.25,37.24C142.37,120,143.59,107.61,150,97c12.7-21,42.65-33,81.32-33H232C232.14,103,220.14,133.18,199.05,146Z"},child:[]}]})(e)}function Bt(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,128a12,12,0,0,1-12,12H140v76a12,12,0,0,1-24,0V140H40a12,12,0,0,1,0-24h76V40a12,12,0,0,1,24,0v76h76A12,12,0,0,1,228,128Z"},child:[]}]})(e)}function GI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M28,64A12,12,0,0,1,40,52H216a12,12,0,0,1,0,24H40A12,12,0,0,1,28,64Zm104,52H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm0,64H40a12,12,0,0,0,0,24h92a12,12,0,0,0,0-24Zm120-20a12,12,0,0,1-5.64,10.18l-64,40A12,12,0,0,1,164,200V120a12,12,0,0,1,18.36-10.18l64,40A12,12,0,0,1,252,160Zm-34.64,0L188,141.65v36.7Z"},child:[]}]})(e)}function UI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M100,52H40A20,20,0,0,0,20,72v64a20,20,0,0,0,20,20H96v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,100,52Zm-4,80H44V76H96ZM216,52H156a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20h56v4a28,28,0,0,1-28,28,12,12,0,0,0,0,24,52.06,52.06,0,0,0,52-52V72A20,20,0,0,0,216,52Zm-4,80H160V76h52Z"},child:[]}]})(e)}function aG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,36H40A20,20,0,0,0,20,56V200a20,20,0,0,0,20,20H216a20,20,0,0,0,20-20V56A20,20,0,0,0,216,36Zm-4,160H44V60H212Z"},child:[]}]})(e)}function iG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,108H48a12,12,0,0,0-12,12v88a12,12,0,0,0,12,12h88a12,12,0,0,0,12-12V120A12,12,0,0,0,136,108Zm-12,88H60V132h64Zm96-8v12a20,20,0,0,1-20,20H180a12,12,0,0,1,0-24h16v-8a12,12,0,0,1,24,0Zm0-72v24a12,12,0,0,1-24,0V116a12,12,0,0,1,24,0Zm0-60V72a12,12,0,0,1-24,0V60H184a12,12,0,0,1,0-24h16A20,20,0,0,1,220,56Zm-68-8a12,12,0,0,1-12,12H116a12,12,0,0,1,0-24h24A12,12,0,0,1,152,48ZM36,76V56A20,20,0,0,1,56,36H68a12,12,0,0,1,0,24H60V76a12,12,0,0,1-24,0Z"},child:[]}]})(e)}function lG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M238.15,70.54,185.46,17.86a20,20,0,0,0-28.29,0L17.85,157.17a20,20,0,0,0,0,28.29l52.69,52.68a20,20,0,0,0,28.29,0L238.15,98.83A20,20,0,0,0,238.15,70.54ZM84.68,218.34l-47-47L64,145l23.52,23.52a12,12,0,0,0,17-17L81,128l15-15,23.51,23.52a12,12,0,0,0,17-17L113,96l15-15,23.52,23.52a12,12,0,0,0,17-17L145,64l26.35-26.34,47,47Z"},child:[]}]})(e)}function cG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,216a12,12,0,0,1-12,12H112a12,12,0,0,1,0-24h32A12,12,0,0,1,156,216ZM40,156a12,12,0,0,0,12-12V112a12,12,0,0,0-24,0v32A12,12,0,0,0,40,156Zm32,48H52V184a12,12,0,0,0-24,0v24a20,20,0,0,0,20,20H72a12,12,0,0,0,0-24ZM228,48V208a20,20,0,0,1-20,20H184a12,12,0,0,1,0-24h3L52,69v3a12,12,0,0,1-24,0V48A20,20,0,0,1,48,28H208A20,20,0,0,1,228,48Zm-24,4H69L204,187Z"},child:[]}]})(e)}function ZI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,103.52l-80-80A12,12,0,0,0,140,32V68.74c-25.76,3.12-53.66,15.89-76.75,35.47-29.16,24.74-47.32,56.69-51.14,90A16,16,0,0,0,39.67,207h0c10.46-11.14,47-45.74,100.33-50.42V192a12,12,0,0,0,20.48,8.48l80-80A12,12,0,0,0,240.49,103.52ZM164,163V144a12,12,0,0,0-12-12c-49,0-86.57,21.56-109.79,40.11,7.13-18.16,19.63-35.22,36.57-49.59C101.3,103.41,128.67,92,152,92a12,12,0,0,0,12-12V61l51,51Z"},child:[]}]})(e)}function af(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243.16,68.85a17.4,17.4,0,0,0-15.26-12l-34.52-2.72L180.12,22.66a17.52,17.52,0,0,0-32.24,0L134.62,54.09l-34.51,2.72a17.39,17.39,0,0,0-9.93,30.62l26.17,22.1-8,33a17.46,17.46,0,0,0,26,19L164,143.66l29.59,17.81a17.46,17.46,0,0,0,26-19l-8-33,26.17-22.1A17.3,17.3,0,0,0,243.16,68.85ZM190.5,96a12,12,0,0,0-3.92,12l6,24.91-22.41-13.5a12.06,12.06,0,0,0-12.38,0l-22.41,13.5,6-24.91a12,12,0,0,0-3.93-12L118,79.48l25.83-2a12,12,0,0,0,10.11-7.3L164,46.2l10.11,23.94a12,12,0,0,0,10.11,7.3l25.82,2Zm-158,88.52a12,12,0,0,1-17-17l51.76-51.75a12,12,0,0,1,17,17Zm63.59-8.57a12,12,0,0,1,0,17l-47.59,47.6a12,12,0,0,1-17-17l47.6-47.59A12,12,0,0,1,96.08,175.92Zm62.44,9.56a12,12,0,0,1,0,17l-38,38a12,12,0,0,1-17-17l38-38A12,12,0,0,1,158.52,185.48Z"},child:[]}]})(e)}function dG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.49,175.51a12,12,0,0,1,0,17l-24,24a12,12,0,0,1-17-17L203,196h-2.09a76.17,76.17,0,0,1-61.85-31.83L97.38,105.78A52.1,52.1,0,0,0,55.06,84H32a12,12,0,0,1,0-24H55.06a76.17,76.17,0,0,1,61.85,31.83l41.71,58.39A52.1,52.1,0,0,0,200.94,172H203l-3.52-3.51a12,12,0,0,1,17-17Zm-95.62-72.62a12,12,0,0,0,16.93-1.13A52,52,0,0,1,200.94,84H203l-3.52,3.51a12,12,0,0,0,17,17l24-24a12,12,0,0,0,0-17l-24-24a12,12,0,0,0-17,17L203,60h-2.09a76,76,0,0,0-57.2,26A12,12,0,0,0,144.87,102.89Zm-33.74,50.22a12,12,0,0,0-16.93,1.13A52,52,0,0,1,55.06,172H32a12,12,0,0,0,0,24H55.06a76,76,0,0,0,57.2-26A12,12,0,0,0,111.13,153.11Z"},child:[]}]})(e)}function uG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M40,92H70.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24H137.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24Zm64-24A12,12,0,1,1,92,80,12,12,0,0,1,104,68Zm112,96H201.94a36,36,0,0,0-67.88,0H40a12,12,0,0,0,0,24h94.06a36,36,0,0,0,67.88,0H216a12,12,0,0,0,0-24Zm-48,24a12,12,0,1,1,12-12A12,12,0,0,1,168,188Z"},child:[]}]})(e)}function hG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,128a12,12,0,0,1-12,12H48a12,12,0,0,1,0-24h68A12,12,0,0,1,128,128ZM48,76H180a12,12,0,0,0,0-24H48a12,12,0,0,0,0,24Zm52,104H48a12,12,0,0,0,0,24h52a12,12,0,0,0,0-24Zm132.49-20.49a12,12,0,0,0-17,0L196,179V112a12,12,0,0,0-24,0v67l-19.51-19.52a12,12,0,0,0-17,17l40,40a12,12,0,0,0,17,0l40-40A12,12,0,0,0,232.49,159.51Z"},child:[]}]})(e)}function pG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M36,128a12,12,0,0,1,12-12h68a12,12,0,0,1,0,24H48A12,12,0,0,1,36,128ZM48,76h52a12,12,0,0,0,0-24H48a12,12,0,0,0,0,24ZM180,180H48a12,12,0,0,0,0,24H180a12,12,0,0,0,0-24ZM232.49,79.51l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,0,0,17,17L172,77v67a12,12,0,0,0,24,0V77l19.51,19.52a12,12,0,0,0,17-17Z"},child:[]}]})(e)}function fG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.36,170A12,12,0,0,1,230,186.37l-96,56a12,12,0,0,1-12.1,0l-96-56a12,12,0,0,1,12.09-20.74l90,52.48L218,165.63A12,12,0,0,1,234.36,170ZM218,117.63,128,170.11,38.05,117.63A12,12,0,0,0,26,138.37l96,56a12,12,0,0,0,12.1,0l96-56A12,12,0,0,0,218,117.63ZM20,80a12,12,0,0,1,6-10.37l96-56a12.06,12.06,0,0,1,12.1,0l96,56a12,12,0,0,1,0,20.74l-96,56a12,12,0,0,1-12.1,0l-96-56A12,12,0,0,1,20,80Zm35.82,0L128,122.11,200.18,80,128,37.89Z"},child:[]}]})(e)}function mG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M10.05,110.42l112,64a12,12,0,0,0,11.9,0l112-64a12,12,0,0,0,0-20.84l-112-64a12,12,0,0,0-11.9,0l-112,64a12,12,0,0,0,0,20.84Zm118-60.6L215.81,100,128,150.18,40.19,100Zm122.42,92.23A12,12,0,0,1,246,158.42l-112,64a12,12,0,0,1-11.9,0l-112-64A12,12,0,1,1,22,137.58l106,60.6,106-60.6A12,12,0,0,1,250.42,142.05Z"},child:[]}]})(e)}function Db(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M243,96a20.33,20.33,0,0,0-17.74-14l-56.59-4.57L146.83,24.62a20.36,20.36,0,0,0-37.66,0L87.35,77.44,30.76,82A20.45,20.45,0,0,0,19.1,117.88l43.18,37.24-13.2,55.7A20.37,20.37,0,0,0,79.57,233L128,203.19,176.43,233a20.39,20.39,0,0,0,30.49-22.15l-13.2-55.7,43.18-37.24A20.43,20.43,0,0,0,243,96ZM172.53,141.7a12,12,0,0,0-3.84,11.86L181.58,208l-47.29-29.08a12,12,0,0,0-12.58,0L74.42,208l12.89-54.4a12,12,0,0,0-3.84-11.86L41.2,105.24l55.4-4.47a12,12,0,0,0,10.13-7.38L128,41.89l21.27,51.5a12,12,0,0,0,10.13,7.38l55.4,4.47Z"},child:[]}]})(e)}function gG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,48V152a20,20,0,0,1-20,20H112.92a12,12,0,0,1-17.41,16.49l-20-20a12,12,0,0,1,0-17l20-20A12,12,0,0,1,112.92,148H204V52H100a12,12,0,0,1-24,0V48A20,20,0,0,1,96,28H208A20,20,0,0,1,228,48ZM168,192a12,12,0,0,0-12,12H52V108h91.08a12,12,0,0,0,17.41,16.49l20-20a12,12,0,0,0,0-17l-20-20A12,12,0,0,0,143.08,84H48a20,20,0,0,0-20,20V208a20,20,0,0,0,20,20H160a20,20,0,0,0,20-20v-4A12,12,0,0,0,168,192Z"},child:[]}]})(e)}function Ob(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H180V36A28,28,0,0,0,152,8H104A28,28,0,0,0,76,36V48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM100,36a4,4,0,0,1,4-4h48a4,4,0,0,1,4,4V48H100Zm88,168H68V72H188ZM116,104v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Zm48,0v64a12,12,0,0,1-24,0V104a12,12,0,0,1,24,0Z"},child:[]}]})(e)}function Hs(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48H40a12,12,0,0,0,0,24h4V208a20,20,0,0,0,20,20H192a20,20,0,0,0,20-20V72h4a12,12,0,0,0,0-24ZM188,204H68V72H188ZM76,20A12,12,0,0,1,88,8h80a12,12,0,0,1,0,24H88A12,12,0,0,1,76,20Z"},child:[]}]})(e)}function qI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M188,184a16,16,0,1,1,16-16A16,16,0,0,1,188,184Zm36-68H180a12,12,0,0,0,0,24h40v56H36V140H76a12,12,0,0,0,0-24H32a20,20,0,0,0-20,20v64a20,20,0,0,0,20,20H224a20,20,0,0,0,20-20V136A20,20,0,0,0,224,116ZM88.49,80.49,116,53v75a12,12,0,0,0,24,0V53l27.51,27.52a12,12,0,1,0,17-17l-48-48a12,12,0,0,0-17,0l-48,48a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function gc(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M228,144v64a12,12,0,0,1-12,12H40a12,12,0,0,1-12-12V144a12,12,0,0,1,24,0v52H204V144a12,12,0,0,1,24,0ZM96.49,80.49,116,61v83a12,12,0,0,0,24,0V61l19.51,19.52a12,12,0,1,0,17-17l-40-40a12,12,0,0,0-17,0l-40,40a12,12,0,1,0,17,17Z"},child:[]}]})(e)}function xG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M125.18,156.94a64,64,0,1,0-82.36,0,100.23,100.23,0,0,0-39.49,32,12,12,0,0,0,19.35,14.2,76,76,0,0,1,122.64,0,12,12,0,0,0,19.36-14.2A100.33,100.33,0,0,0,125.18,156.94ZM44,108a40,40,0,1,1,40,40A40,40,0,0,1,44,108Zm206.1,97.67a12,12,0,0,1-16.78-2.57A76.31,76.31,0,0,0,172,172a12,12,0,0,1,0-24,40,40,0,1,0-10.3-78.67,12,12,0,1,1-6.16-23.19,64,64,0,0,1,57.64,110.8,100.23,100.23,0,0,1,39.49,32A12,12,0,0,1,250.1,205.67Z"},child:[]}]})(e)}function lf(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240.26,186.1,152.81,34.23h0a28.74,28.74,0,0,0-49.62,0L15.74,186.1a27.45,27.45,0,0,0,0,27.71A28.31,28.31,0,0,0,40.55,228h174.9a28.31,28.31,0,0,0,24.79-14.19A27.45,27.45,0,0,0,240.26,186.1Zm-20.8,15.7a4.46,4.46,0,0,1-4,2.2H40.55a4.46,4.46,0,0,1-4-2.2,3.56,3.56,0,0,1,0-3.73L124,46.2a4.77,4.77,0,0,1,8,0l87.44,151.87A3.56,3.56,0,0,1,219.46,201.8ZM116,136V104a12,12,0,0,1,24,0v32a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,176Z"},child:[]}]})(e)}function KI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M128,20A108,108,0,1,0,236,128,108.12,108.12,0,0,0,128,20Zm0,192a84,84,0,1,1,84-84A84.09,84.09,0,0,1,128,212Zm-12-80V80a12,12,0,0,1,24,0v52a12,12,0,0,1-24,0Zm28,40a16,16,0,1,1-16-16A16,16,0,0,1,144,172Z"},child:[]}]})(e)}function sn(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208.49,191.51a12,12,0,0,1-17,17L128,145,64.49,208.49a12,12,0,0,1-17-17L111,128,47.51,64.49a12,12,0,0,1,17-17L128,111l63.51-63.52a12,12,0,0,1,17,17L145,128Z"},child:[]}]})(e)}function bG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,48H32A16,16,0,0,0,16,64V88a16,16,0,0,0,16,16v88a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V104a16,16,0,0,0,16-16V64A16,16,0,0,0,224,48Zm-72,96H104a8,8,0,0,1,0-16h48a8,8,0,0,1,0,16Zm72-56H32V64H224V88Z"},child:[]}]})(e)}function yG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M184,32H72A16,16,0,0,0,56,48V224a8,8,0,0,0,12.24,6.78L128,193.43l59.77,37.35A8,8,0,0,0,200,224V48A16,16,0,0,0,184,32Z"},child:[]}]})(e)}function vG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M232,128A104,104,0,1,1,128,24,104.13,104.13,0,0,1,232,128Z"},child:[]}]})(e)}function QI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,32H88a8,8,0,0,0-8,8V80H40a8,8,0,0,0-8,8V216a8,8,0,0,0,8,8H168a8,8,0,0,0,8-8V176h40a8,8,0,0,0,8-8V40A8,8,0,0,0,216,32Zm-8,128H176V88a8,8,0,0,0-8-8H96V48H208Z"},child:[]}]})(e)}function CG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128Z"},child:[]}]})(e)}function Nb(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM48,100a28,28,0,1,0,28,28A28,28,0,0,0,48,100Zm160,0a28,28,0,1,0,28,28A28,28,0,0,0,208,100Z"},child:[]}]})(e)}function wG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M156,128a28,28,0,1,1-28-28A28,28,0,0,1,156,128ZM128,76a28,28,0,1,0-28-28A28,28,0,0,0,128,76Zm0,104a28,28,0,1,0,28,28A28,28,0,0,0,128,180Z"},child:[]}]})(e)}function xc(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M237.94,107.21a8,8,0,0,0-3.89-5.4l-29.83-17-.12-33.62a8,8,0,0,0-2.83-6.08,111.91,111.91,0,0,0-36.72-20.67,8,8,0,0,0-6.46.59L128,41.85,97.88,25a8,8,0,0,0-6.47-.6A111.92,111.92,0,0,0,54.73,45.15a8,8,0,0,0-2.83,6.07l-.15,33.65-29.83,17a8,8,0,0,0-3.89,5.4,106.47,106.47,0,0,0,0,41.56,8,8,0,0,0,3.89,5.4l29.83,17,.12,33.63a8,8,0,0,0,2.83,6.08,111.91,111.91,0,0,0,36.72,20.67,8,8,0,0,0,6.46-.59L128,214.15,158.12,231a7.91,7.91,0,0,0,3.9,1,8.09,8.09,0,0,0,2.57-.42,112.1,112.1,0,0,0,36.68-20.73,8,8,0,0,0,2.83-6.07l.15-33.65,29.83-17a8,8,0,0,0,3.89-5.4A106.47,106.47,0,0,0,237.94,107.21ZM128,168a40,40,0,1,1,40-40A40,40,0,0,1,128,168Z"},child:[]}]})(e)}function YI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M213.85,125.46l-112,120a8,8,0,0,1-13.69-7l14.66-73.33L45.19,143.49a8,8,0,0,1-3-13l112-120a8,8,0,0,1,13.69,7L153.18,90.9l57.63,21.61a8,8,0,0,1,3,12.95Z"},child:[]}]})(e)}function JI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,80H176V56a48,48,0,0,0-96,0V80H48A16,16,0,0,0,32,96V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V96A16,16,0,0,0,208,80ZM96,56a32,32,0,0,1,64,0V80H96Z"},child:[]}]})(e)}function XI(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,48V208a16,16,0,0,1-16,16H160a16,16,0,0,1-16-16V48a16,16,0,0,1,16-16h40A16,16,0,0,1,216,48ZM96,32H56A16,16,0,0,0,40,48V208a16,16,0,0,0,16,16H96a16,16,0,0,0,16-16V48A16,16,0,0,0,96,32Z"},child:[]}]})(e)}function e_(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M240,128a15.74,15.74,0,0,1-7.6,13.51L88.32,229.65a16,16,0,0,1-16.2.3A15.86,15.86,0,0,1,64,216.13V39.87a15.86,15.86,0,0,1,8.12-13.82,16,16,0,0,1,16.2.3L232.4,114.49A15.74,15.74,0,0,1,240,128Z"},child:[]}]})(e)}function jG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40ZM80,192H64a16,16,0,0,1-16-16V144a8,8,0,0,1,16,0v32H80a8,8,0,0,1,0,16ZM80,80H64v32a8,8,0,0,1-16,0V80A16,16,0,0,1,64,64H80a8,8,0,0,1,0,16Zm64,112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm0-112H112a8,8,0,0,1,0-16h32a8,8,0,0,1,0,16Zm64,96a16,16,0,0,1-16,16H176a8,8,0,0,1,0-16h16V144a8,8,0,0,1,16,0Zm0-64a8,8,0,0,1-16,0V80H176a8,8,0,0,1,0-16h16a16,16,0,0,1,16,16Z"},child:[]}]})(e)}function SG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M212,200a36,36,0,1,1-69.85-12.25l-53-34.05a36,36,0,1,1,0-51.4l53-34a36.09,36.09,0,1,1,8.67,13.45l-53,34.05a36,36,0,0,1,0,24.5l53,34.05A36,36,0,0,1,212,200Z"},child:[]}]})(e)}function cf(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,144a15.78,15.78,0,0,1-10.42,14.94L146,178l-19,51.62a15.92,15.92,0,0,1-29.88,0L78,178l-51.62-19a15.92,15.92,0,0,1,0-29.88L78,110l19-51.62a15.92,15.92,0,0,1,29.88,0L146,110l51.62,19A15.78,15.78,0,0,1,208,144ZM152,48h16V64a8,8,0,0,0,16,0V48h16a8,8,0,0,0,0-16H184V16a8,8,0,0,0-16,0V32H152a8,8,0,0,0,0,16Zm88,32h-8V72a8,8,0,0,0-16,0v8h-8a8,8,0,0,0,0,16h8v8a8,8,0,0,0,16,0V96h8a8,8,0,0,0,0-16Z"},child:[]}]})(e)}function Bb(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M234.29,114.85l-45,38.83L203,211.75a16.4,16.4,0,0,1-24.5,17.82L128,198.49,77.47,229.57A16.4,16.4,0,0,1,53,211.75l13.76-58.07-45-38.83A16.46,16.46,0,0,1,31.08,86l59-4.76,22.76-55.08a16.36,16.36,0,0,1,30.27,0l22.75,55.08,59,4.76a16.46,16.46,0,0,1,9.37,28.86Z"},child:[]}]})(e)}function kG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M176,56H80a72,72,0,0,0,0,144h96a72,72,0,0,0,0-144Zm0,112a40,40,0,1,1,40-40A40,40,0,0,1,176,168Z"},child:[]}]})(e)}function bc(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M224,56a8,8,0,0,1-8,8h-8V208a16,16,0,0,1-16,16H64a16,16,0,0,1-16-16V64H40a8,8,0,0,1,0-16H216A8,8,0,0,1,224,56ZM88,32h80a8,8,0,0,0,0-16H88a8,8,0,0,0,0,16Z"},child:[]}]})(e)}function IG(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M208,32H48A16,16,0,0,0,32,48V208a16,16,0,0,0,16,16H208a16,16,0,0,0,16-16V48A16,16,0,0,0,208,32ZM48,48H208v77.38l-24.69-24.7a16,16,0,0,0-22.62,0L53.37,208H48ZM208,208H76l96-96,36,36v60ZM96,120A24,24,0,1,0,72,96,24,24,0,0,0,96,120Zm0-32a8,8,0,1,1-8,8A8,8,0,0,1,96,88Z"},child:[]}]})(e)}function t_(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M216,40H40A16,16,0,0,0,24,56V200a16,16,0,0,0,16,16H216a16,16,0,0,0,16-16V56A16,16,0,0,0,216,40Zm0,16V158.75l-26.07-26.06a16,16,0,0,0-22.63,0l-20,20-44-44a16,16,0,0,0-22.62,0L40,149.37V56ZM40,172l52-52,80,80H40Zm176,28H194.63l-36-36,20-20L216,181.38V200ZM144,100a12,12,0,1,1,12,12A12,12,0,0,1,144,100Z"},child:[]}]})(e)}function _G(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M140,180a12,12,0,1,1-12-12A12,12,0,0,1,140,180ZM128,72c-22.06,0-40,16.15-40,36v4a8,8,0,0,0,16,0v-4c0-11,10.77-20,24-20s24,9,24,20-10.77,20-24,20a8,8,0,0,0-8,8v8a8,8,0,0,0,16,0v-.72c18.24-3.35,32-17.9,32-35.28C168,88.15,150.06,72,128,72Zm104,56A104,104,0,1,1,128,24,104.11,104.11,0,0,1,232,128Zm-16,0a88,88,0,1,0-88,88A88.1,88.1,0,0,0,216,128Z"},child:[]}]})(e)}function n_(e){return oe({tag:"svg",attr:{viewBox:"0 0 256 256",fill:"currentColor"},child:[{tag:"path",attr:{d:"M136,32V64a8,8,0,0,1-16,0V32a8,8,0,0,1,16,0Zm37.25,58.75a8,8,0,0,0,5.66-2.35l22.63-22.62a8,8,0,0,0-11.32-11.32L167.6,77.09a8,8,0,0,0,5.65,13.66ZM224,120H192a8,8,0,0,0,0,16h32a8,8,0,0,0,0-16Zm-45.09,47.6a8,8,0,0,0-11.31,11.31l22.62,22.63a8,8,0,0,0,11.32-11.32ZM128,184a8,8,0,0,0-8,8v32a8,8,0,0,0,16,0V192A8,8,0,0,0,128,184ZM77.09,167.6,54.46,190.22a8,8,0,0,0,11.32,11.32L88.4,178.91A8,8,0,0,0,77.09,167.6ZM72,128a8,8,0,0,0-8-8H32a8,8,0,0,0,0,16H64A8,8,0,0,0,72,128ZM65.78,54.46A8,8,0,0,0,54.46,65.78L77.09,88.4A8,8,0,0,0,88.4,77.09Z"},child:[]}]})(e)}const MG=""+new URL("commercial-license-bg-C_dHp7on.png",import.meta.url).href,AG={paramNegativeConditioning:{placement:"right"},clipSkip:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},controlNet:{href:"https://support.invoke.ai/support/solutions/articles/151000105880"},controlNetBeginEnd:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000178148"},lora:{href:"https://support.invoke.ai/support/solutions/articles/151000159072"},loraWeight:{href:"https://support.invoke.ai/support/solutions/articles/151000159072-concepts-low-rank-adaptations-loras-"},compositingMaskBlur:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingBlurMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},compositingCoherenceMode:{href:"https://support.invoke.ai/support/solutions/articles/151000158838-compositing-settings"},infillMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000158841-infill-and-scaling"},scaleBeforeProcessing:{href:"https://support.invoke.ai/support/solutions/articles/151000158841"},paramCFGScale:{href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramCFGRescaleMultiplier:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramDenoisingStrength:{href:"https://support.invoke.ai/support/solutions/articles/151000094998-image-to-image"},paramHrf:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},paramIterations:{href:"https://support.invoke.ai/support/solutions/articles/151000159073"},paramPositiveConditioning:{href:"https://support.invoke.ai/support/solutions/articles/151000096606-tips-on-crafting-prompts",placement:"right"},paramScheduler:{placement:"right",href:"https://www.youtube.com/watch?v=1OeHEJrsTpI"},paramSeed:{href:"https://support.invoke.ai/support/solutions/articles/151000096684-what-is-a-seed-how-do-i-use-it-to-recreate-the-same-image-"},paramModel:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000096601-what-is-a-model-which-should-i-use-"},paramRatio:{gutter:16},controlNetControlMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},controlNetProcessor:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000105880-using-controlnet"},controlNetResizeMode:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178148"},paramVAE:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramVAEPrecision:{placement:"right",href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},paramUpscaleMethod:{href:"https://support.invoke.ai/support/solutions/articles/151000096700-how-can-i-get-larger-images-what-does-upscaling-do-"},refinerModel:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerNegativeAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerPositiveAestheticScore:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerScheduler:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerStart:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerSteps:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},refinerCfgScale:{href:"https://support.invoke.ai/support/solutions/articles/151000178333-using-the-refiner"},seamlessTilingXAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},seamlessTilingYAxis:{href:"https://support.invoke.ai/support/solutions/articles/151000178161-advanced-settings"},fluxDevLicense:{href:"https://www.invoke.com/get-a-commercial-license-for-flux",image:MG}},EG=1e3,LG=[{name:"preventOverflow",options:{padding:10}}],TG=pe(Wd,e=>e.shouldEnableInformationalPopovers),Be=l.memo(({feature:e,children:t,inPortal:n=!0,hideDisable:s=!1,...r})=>{const a=w(TG),i=l.useMemo(()=>AG[e],[e]),c=l.useMemo(()=>dj(hi(i,["image","href","buttonLabel"]),r),[i,r]);return!s&&!a?t:o.jsxs(Qn,{isLazy:!0,closeOnBlur:!1,trigger:"hover",variant:"informational",openDelay:EG,modifiers:LG,placement:"top",...c,children:[o.jsx(ds,{children:t}),n?o.jsx(Zd,{children:o.jsx(Tv,{data:i,feature:e,hideDisable:s})}):o.jsx(Tv,{data:i,feature:e,hideDisable:s})]})});Be.displayName="InformationalPopover";const Tv=({data:e,feature:t,hideDisable:n})=>{const{t:s}=S(),r=E(),a=l.useMemo(()=>s(`popovers.${t}.heading`),[t,s]),i=l.useMemo(()=>s(`popovers.${t}.paragraphs`,{returnObjects:!0})??[],[t,s]),c=l.useCallback(()=>{e!=null&&e.href&&window.open(e.href)},[e==null?void 0:e.href]),d=l.useCallback(()=>{r(uj(!1)),he({title:s("settings.informationalPopoversDisabled"),description:s("settings.informationalPopoversDisabledDesc"),status:"info"})},[r,s]);return o.jsxs(Yn,{maxW:300,children:[o.jsx(hj,{top:2}),o.jsx(Jn,{children:o.jsxs(j,{gap:2,flexDirection:"column",alignItems:"flex-start",children:[a&&o.jsxs(o.Fragment,{children:[o.jsx(Ct,{size:"sm",children:a}),o.jsx(zt,{})]}),(e==null?void 0:e.image)&&o.jsxs(o.Fragment,{children:[o.jsx(nn,{objectFit:"contain",backgroundColor:"white",src:e.image,alt:"Optional Image"}),o.jsx(zt,{})]}),i.map(u=>o.jsx(O,{children:u},u)),o.jsx(zt,{}),o.jsxs(j,{alignItems:"center",justifyContent:"space-between",w:"full",children:[!n&&o.jsx(me,{onClick:d,variant:"link",size:"sm",children:s("common.dontShowMeThese")}),o.jsx(dt,{}),(e==null?void 0:e.href)&&o.jsx(me,{onClick:c,leftIcon:o.jsx(Lb,{}),variant:"link",size:"sm",children:s("common.learnMore")??a})]})]})})]})},PG=()=>{const e=w(_8),t=w(M8),n=w(A8),s=E(),{t:r}=S(),a=l.useCallback(i=>{s(E8(i))},[s]);return o.jsxs(V,{isDisabled:!n,children:[o.jsx(Be,{feature:"dynamicPromptsMaxPrompts",inPortal:!1,children:o.jsx(U,{children:r("dynamicPrompts.maxPrompts")})}),o.jsx(qe,{min:t.sliderMin,max:t.sliderMax,value:e,defaultValue:t.initial,onChange:a,marks:!0}),o.jsx(Ve,{min:t.numberInputMin,max:t.numberInputMax,value:e,defaultValue:t.initial,onChange:a})]})},RG=l.memo(PG),s_=l.memo(e=>e.image?o.jsx(_x,{w:`${e.image.width}px`,h:"auto",objectFit:"contain",aspectRatio:`${e.image.width}/${e.image.height}`}):o.jsx(j,{opacity:.7,w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",bg:"base.900",children:o.jsx(pr,{size:"xl"})}));s_.displayName="IAILoadingImageFallback";const Mt=l.memo(e=>{const{icon:t=fi,boxSize:n=16,...s}=e;return o.jsxs(j,{w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",fontSize:"md",...s,children:[t&&o.jsx(it,{as:t,boxSize:n,opacity:.7}),e.label&&o.jsx(O,{textAlign:"center",children:e.label})]})});Mt.displayName="IAINoContentFallback";const $b=l.memo(e=>{const{sx:t,...n}=e,s=l.useMemo(()=>({w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:2,userSelect:"none",opacity:.7,color:"base.500",...t}),[t]);return o.jsxs(j,{sx:s,...n,children:[o.jsx(pr,{size:"xl"}),e.label&&o.jsx(O,{textAlign:"center",children:e.label})]})});$b.displayName="IAINoContentFallbackWithSpinner";/*!
 * OverlayScrollbars
 * Version: 2.10.0
 *
 * Copyright (c) Rene Haas | KingSora.
 * https://github.com/KingSora
 *
 * Released under the MIT license.
 */const Ds=(e,t)=>{const{o:n,i:s,u:r}=e;let a=n,i;const c=(h,p)=>{const f=a,m=h,g=p||(s?!s(f,m):f!==m);return(g||r)&&(a=m,i=f),[a,g,i]};return[t?h=>c(t(a,i),h):c,h=>[a,!!h,i]]},DG=typeof window<"u"&&typeof HTMLElement<"u"&&!!window.document,ws=DG?window:{},sp=Math.max,OG=Math.min,r0=Math.round,op=Math.abs,Pv=Math.sign,Fb=ws.cancelAnimationFrame,df=ws.requestAnimationFrame,rp=ws.setTimeout,a0=ws.clearTimeout,uf=e=>typeof ws[e]<"u"?ws[e]:void 0,NG=uf("MutationObserver"),Rv=uf("IntersectionObserver"),ap=uf("ResizeObserver"),_h=uf("ScrollTimeline"),zb=e=>e===void 0,hf=e=>e===null,sr=e=>typeof e=="number",wu=e=>typeof e=="string",Vb=e=>typeof e=="boolean",Ws=e=>typeof e=="function",lr=e=>Array.isArray(e),ip=e=>typeof e=="object"&&!lr(e)&&!hf(e),Hb=e=>{const t=!!e&&e.length,n=sr(t)&&t>-1&&t%1==0;return lr(e)||!Ws(e)&&n?t>0&&ip(e)?t-1 in e:!0:!1},lp=e=>!!e&&e.constructor===Object,cp=e=>e instanceof HTMLElement,pf=e=>e instanceof Element,Dv=()=>performance.now(),Dm=(e,t,n,s,r)=>{let a=0;const i=Dv(),c=sp(0,n),d=u=>{const h=Dv(),f=h-i>=c,m=u?1:1-(sp(0,i+c-h)/c||0),g=(t-e)*(Ws(r)?r(m,m*c,0,1,c):m)+e,x=f||m===1;s&&s(g,m,x),a=x?0:df(()=>d())};return d(),u=>{Fb(a),u&&d(u)}};function Pt(e,t){if(Hb(e))for(let n=0;n<e.length&&t(e[n],n,e)!==!1;n++);else e&&Pt(Object.keys(e),n=>t(e[n],n,e));return e}const o_=(e,t)=>e.indexOf(t)>=0,jd=(e,t)=>e.concat(t),tn=(e,t,n)=>(!wu(t)&&Hb(t)?Array.prototype.push.apply(e,t):e.push(t),e),Ba=e=>Array.from(e||[]),Wb=e=>lr(e)?e:!wu(e)&&Hb(e)?Ba(e):[e],i0=e=>!!e&&!e.length,l0=e=>Ba(new Set(e)),Fs=(e,t,n)=>{Pt(e,r=>r?r.apply(void 0,t||[]):!0),!n&&(e.length=0)},r_="paddingTop",a_="paddingRight",i_="paddingLeft",l_="paddingBottom",c_="marginLeft",d_="marginRight",u_="marginBottom",h_="overflowX",p_="overflowY",ff="width",mf="height",da="visible",ei="hidden",Zl="scroll",BG=e=>{const t=String(e||"");return t?t[0].toUpperCase()+t.slice(1):""},gf=(e,t,n,s)=>{if(e&&t){let r=!0;return Pt(n,a=>{const i=e[a],c=t[a];i!==c&&(r=!1)}),r}return!1},f_=(e,t)=>gf(e,t,["w","h"]),Mh=(e,t)=>gf(e,t,["x","y"]),$G=(e,t)=>gf(e,t,["t","r","b","l"]),ja=()=>{},Ze=(e,...t)=>e.bind(0,...t),ti=e=>{let t;const n=e?rp:df,s=e?a0:Fb;return[r=>{s(t),t=n(()=>r(),Ws(e)?e():e)},()=>s(t)]},c0=(e,t)=>{const{_:n,v:s,p:r,S:a}=t||{};let i,c,d,u,h=ja;const p=function(C){h(),a0(i),u=i=c=void 0,h=ja,e.apply(this,C)},f=x=>a&&c?a(c,x):x,m=()=>{h!==ja&&p(f(d)||d)},g=function(){const C=Ba(arguments),y=Ws(n)?n():n;if(sr(y)&&y>=0){const I=Ws(s)?s():s,k=sr(I)&&I>=0,M=y>0?rp:df,_=y>0?a0:Fb,D=f(C)||C,N=p.bind(0,D);let P;h(),r&&!u?(N(),u=!0,P=M(()=>u=void 0,y)):(P=M(N,y),k&&!i&&(i=rp(m,I))),h=()=>_(P),c=d=D}else p(C)};return g.m=m,g},m_=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),Po=e=>e?Object.keys(e):[],yt=(e,t,n,s,r,a,i)=>{const c=[t,n,s,r,a,i];return(typeof e!="object"||hf(e))&&!Ws(e)&&(e={}),Pt(c,d=>{Pt(d,(u,h)=>{const p=d[h];if(e===p)return!0;const f=lr(p);if(p&&lp(p)){const m=e[h];let g=m;f&&!lr(m)?g=[]:!f&&!lp(m)&&(g={}),e[h]=yt(g,p)}else e[h]=f?p.slice():p})}),e},g_=(e,t)=>Pt(yt({},e),(n,s,r)=>{n===void 0?delete r[s]:n&&lp(n)&&(r[s]=g_(n))}),Gb=e=>!Po(e).length,x_=(e,t,n)=>sp(e,OG(t,n)),li=e=>l0((lr(e)?e:(e||"").split(" ")).filter(t=>t)),Ub=(e,t)=>e&&e.getAttribute(t),Ov=(e,t)=>e&&e.hasAttribute(t),Sr=(e,t,n)=>{Pt(li(t),s=>{e&&e.setAttribute(s,String(n||""))})},Wo=(e,t)=>{Pt(li(t),n=>e&&e.removeAttribute(n))},xf=(e,t)=>{const n=li(Ub(e,t)),s=Ze(Sr,e,t),r=(a,i)=>{const c=new Set(n);return Pt(li(a),d=>{c[i](d)}),Ba(c).join(" ")};return{O:a=>s(r(a,"delete")),$:a=>s(r(a,"add")),C:a=>{const i=li(a);return i.reduce((c,d)=>c&&n.includes(d),i.length>0)}}},b_=(e,t,n)=>(xf(e,t).O(n),Ze(Zb,e,t,n)),Zb=(e,t,n)=>(xf(e,t).$(n),Ze(b_,e,t,n)),dp=(e,t,n,s)=>(s?Zb:b_)(e,t,n),qb=(e,t,n)=>xf(e,t).C(n),y_=e=>xf(e,"class"),v_=(e,t)=>{y_(e).O(t)},Kb=(e,t)=>(y_(e).$(t),Ze(v_,e,t)),C_=(e,t)=>{const n=t?pf(t)&&t:document;return n?Ba(n.querySelectorAll(e)):[]},FG=(e,t)=>{const n=t?pf(t)&&t:document;return n&&n.querySelector(e)},d0=(e,t)=>pf(e)&&e.matches(t),w_=e=>d0(e,"body"),u0=e=>e?Ba(e.childNodes):[],Sd=e=>e&&e.parentElement,gl=(e,t)=>pf(e)&&e.closest(t),h0=e=>document.activeElement,zG=(e,t,n)=>{const s=gl(e,t),r=e&&FG(n,s),a=gl(r,t)===s;return s&&r?s===e||r===e||a&&gl(gl(e,n),t)!==s:!1},ql=e=>{Pt(Wb(e),t=>{const n=Sd(t);t&&n&&n.removeChild(t)})},Ns=(e,t)=>Ze(ql,e&&t&&Pt(Wb(t),n=>{n&&e.appendChild(n)})),Ml=e=>{const t=document.createElement("div");return Sr(t,"class",e),t},j_=e=>{const t=Ml();return t.innerHTML=e.trim(),Pt(u0(t),n=>ql(n))},Nv=(e,t)=>e.getPropertyValue(t)||e[t]||"",S_=e=>{const t=e||0;return isFinite(t)?t:0},th=e=>S_(parseFloat(e||"")),p0=e=>Math.round(e*1e4)/1e4,k_=e=>`${p0(S_(e))}px`;function kd(e,t){e&&t&&Pt(t,(n,s)=>{try{const r=e.style,a=hf(n)||Vb(n)?"":sr(n)?k_(n):n;s.indexOf("--")===0?r.setProperty(s,a):r[s]=a}catch{}})}function Fr(e,t,n){const s=wu(t);let r=s?"":{};if(e){const a=ws.getComputedStyle(e,n)||e.style;r=s?Nv(a,t):Ba(t).reduce((i,c)=>(i[c]=Nv(a,c),i),r)}return r}const Bv=(e,t,n)=>{const s=t?`${t}-`:"",r=n?`-${n}`:"",a=`${s}top${r}`,i=`${s}right${r}`,c=`${s}bottom${r}`,d=`${s}left${r}`,u=Fr(e,[a,i,c,d]);return{t:th(u[a]),r:th(u[i]),b:th(u[c]),l:th(u[d])}},VG=(e,t)=>`translate${ip(e)?`(${e.x},${e.y})`:`Y(${e})`}`,HG=e=>!!(e.offsetWidth||e.offsetHeight||e.getClientRects().length),WG={w:0,h:0},bf=(e,t)=>t?{w:t[`${e}Width`],h:t[`${e}Height`]}:WG,GG=e=>bf("inner",e||ws),Al=Ze(bf,"offset"),I_=Ze(bf,"client"),up=Ze(bf,"scroll"),Qb=e=>{const t=parseFloat(Fr(e,ff))||0,n=parseFloat(Fr(e,mf))||0;return{w:t-r0(t),h:n-r0(n)}},Om=e=>e.getBoundingClientRect(),UG=e=>!!e&&HG(e),f0=e=>!!(e&&(e[mf]||e[ff])),__=(e,t)=>{const n=f0(e);return!f0(t)&&n},$v=(e,t,n,s)=>{Pt(li(t),r=>{e&&e.removeEventListener(r,n,s)})},Kt=(e,t,n,s)=>{var r;const a=(r=s&&s.H)!=null?r:!0,i=s&&s.I||!1,c=s&&s.A||!1,d={passive:a,capture:i};return Ze(Fs,li(t).map(u=>{const h=c?p=>{$v(e,u,h,i),n&&n(p)}:n;return e&&e.addEventListener(u,h,d),Ze($v,e,u,h,i)}))},M_=e=>e.stopPropagation(),m0=e=>e.preventDefault(),A_=e=>M_(e)||m0(e),Xo=(e,t)=>{const{x:n,y:s}=sr(t)?{x:t,y:t}:t||{};sr(n)&&(e.scrollLeft=n),sr(s)&&(e.scrollTop=s)},Bs=e=>({x:e.scrollLeft,y:e.scrollTop}),E_=()=>({D:{x:0,y:0},M:{x:0,y:0}}),ZG=(e,t)=>{const{D:n,M:s}=e,{w:r,h:a}=t,i=(p,f,m)=>{let g=Pv(p)*m,x=Pv(f)*m;if(g===x){const C=op(p),y=op(f);x=C>y?0:x,g=C<y?0:g}return g=g===x?0:g,[g+0,x+0]},[c,d]=i(n.x,s.x,r),[u,h]=i(n.y,s.y,a);return{D:{x:c,y:u},M:{x:d,y:h}}},Fv=({D:e,M:t})=>{const n=(s,r)=>s===0&&s<=r;return{x:n(e.x,t.x),y:n(e.y,t.y)}},zv=({D:e,M:t},n)=>{const s=(r,a,i)=>x_(0,1,(r-i)/(r-a)||0);return{x:s(e.x,t.x,n.x),y:s(e.y,t.y,n.y)}},g0=e=>{e&&e.focus&&e.focus({preventScroll:!0})},Vv=(e,t)=>{Pt(Wb(t),e)},x0=e=>{const t=new Map,n=(a,i)=>{if(a){const c=t.get(a);Vv(d=>{c&&c[d?"delete":"clear"](d)},i)}else t.forEach(c=>{c.clear()}),t.clear()},s=(a,i)=>{if(wu(a)){const u=t.get(a)||new Set;return t.set(a,u),Vv(h=>{Ws(h)&&u.add(h)},i),Ze(n,a,i)}Vb(i)&&i&&n();const c=Po(a),d=[];return Pt(c,u=>{const h=a[u];h&&tn(d,s(u,h))}),Ze(Fs,d)},r=(a,i)=>{Pt(Ba(t.get(a)),c=>{i&&!i0(i)?c.apply(0,i):c()})};return s(e||{}),[s,n,r]},Hv=e=>JSON.stringify(e,(t,n)=>{if(Ws(n))throw 0;return n}),Wv=(e,t)=>e?`${t}`.split(".").reduce((n,s)=>n&&m_(n,s)?n[s]:void 0,e):void 0,qG={paddingAbsolute:!1,showNativeOverlaidScrollbars:!1,update:{elementEvents:[["img","load"]],debounce:[0,33],attributes:null,ignoreMutation:null},overflow:{x:"scroll",y:"scroll"},scrollbars:{theme:"os-theme-dark",visibility:"auto",autoHide:"never",autoHideDelay:1300,autoHideSuspend:!1,dragScroll:!0,clickScroll:!1,pointers:["mouse","touch","pen"]}},L_=(e,t)=>{const n={},s=jd(Po(t),Po(e));return Pt(s,r=>{const a=e[r],i=t[r];if(ip(a)&&ip(i))yt(n[r]={},L_(a,i)),Gb(n[r])&&delete n[r];else if(m_(t,r)&&i!==a){let c=!0;if(lr(a)||lr(i))try{Hv(a)===Hv(i)&&(c=!1)}catch{}c&&(n[r]=i)}}),n},Gv=(e,t,n)=>s=>[Wv(e,s),n||Wv(t,s)!==void 0],yc="data-overlayscrollbars",Ah="os-environment",nh=`${Ah}-scrollbar-hidden`,Nm=`${yc}-initialize`,Eh="noClipping",Uv=`${yc}-body`,Sa=yc,KG="host",kr=`${yc}-viewport`,QG=h_,YG=p_,JG="arrange",T_="measuring",XG="scrolling",P_="scrollbarHidden",eU="noContent",b0=`${yc}-padding`,Zv=`${yc}-content`,Yb="os-size-observer",tU=`${Yb}-appear`,nU=`${Yb}-listener`,sU="os-trinsic-observer",oU="os-theme-none",Us="os-scrollbar",rU=`${Us}-rtl`,aU=`${Us}-horizontal`,iU=`${Us}-vertical`,R_=`${Us}-track`,Jb=`${Us}-handle`,lU=`${Us}-visible`,cU=`${Us}-cornerless`,qv=`${Us}-interaction`,Kv=`${Us}-unusable`,y0=`${Us}-auto-hide`,Qv=`${y0}-hidden`,Yv=`${Us}-wheel`,dU=`${R_}-interactive`,uU=`${Jb}-interactive`;let D_;const hU=()=>D_,pU=e=>{D_=e};let Bm;const fU=()=>{const e=(k,M,_)=>{Ns(document.body,k),Ns(document.body,k);const A=I_(k),D=Al(k),N=Qb(M);return _&&ql(k),{x:D.h-A.h+N.h,y:D.w-A.w+N.w}},t=k=>{let M=!1;const _=Kb(k,nh);try{M=Fr(k,"scrollbar-width")==="none"||Fr(k,"display","::-webkit-scrollbar")==="none"}catch{}return _(),M},n=`.${Ah}{scroll-behavior:auto!important;position:fixed;opacity:0;visibility:hidden;overflow:scroll;height:200px;width:200px;z-index:-1}.${Ah} div{width:200%;height:200%;margin:10px 0}.${nh}{scrollbar-width:none!important}.${nh}::-webkit-scrollbar,.${nh}::-webkit-scrollbar-corner{appearance:none!important;display:none!important;width:0!important;height:0!important}`,r=j_(`<div class="${Ah}"><div></div><style>${n}</style></div>`)[0],a=r.firstChild,i=r.lastChild,c=hU();c&&(i.nonce=c);const[d,,u]=x0(),[h,p]=Ds({o:e(r,a),i:Mh},Ze(e,r,a,!0)),[f]=p(),m=t(r),g={x:f.x===0,y:f.y===0},x={elements:{host:null,padding:!m,viewport:k=>m&&w_(k)&&k,content:!1},scrollbars:{slot:!0},cancel:{nativeScrollbarsOverlaid:!1,body:null}},C=yt({},qG),y=Ze(yt,{},C),v=Ze(yt,{},x),I={T:f,k:g,R:m,V:!!_h,L:Ze(d,"r"),U:v,P:k=>yt(x,k)&&v(),N:y,q:k=>yt(C,k)&&y(),B:yt({},x),F:yt({},C)};if(Wo(r,"style"),ql(r),Kt(ws,"resize",()=>{u("r",[])}),Ws(ws.matchMedia)&&!m&&(!g.x||!g.y)){const k=M=>{const _=ws.matchMedia(`(resolution: ${ws.devicePixelRatio}dppx)`);Kt(_,"change",()=>{M(),k(M)},{A:!0})};k(()=>{const[M,_]=h();yt(I.T,M),u("r",[_])})}return I},xr=()=>(Bm||(Bm=fU()),Bm),O_=(e,t)=>Ws(t)?t.apply(0,e):t,mU=(e,t,n,s)=>{const r=zb(s)?n:s;return O_(e,r)||t.apply(0,e)},N_=(e,t,n,s)=>{const r=zb(s)?n:s,a=O_(e,r);return!!a&&(cp(a)?a:t.apply(0,e))},gU=(e,t)=>{const{nativeScrollbarsOverlaid:n,body:s}=t||{},{k:r,R:a,U:i}=xr(),{nativeScrollbarsOverlaid:c,body:d}=i().cancel,u=n??c,h=zb(s)?d:s,p=(r.x||r.y)&&u,f=e&&(hf(h)?!a:h);return!!p||!!f},Xb=new WeakMap,xU=(e,t)=>{Xb.set(e,t)},bU=e=>{Xb.delete(e)},B_=e=>Xb.get(e),yU=(e,t,n)=>{let s=!1;const r=n?new WeakMap:!1,a=()=>{s=!0},i=c=>{if(r&&n){const d=n.map(u=>{const[h,p]=u||[];return[p&&h?(c||C_)(h,e):[],p]});Pt(d,u=>Pt(u[0],h=>{const p=u[1],f=r.get(h)||[];if(e.contains(h)&&p){const g=Kt(h,p,x=>{s?(g(),r.delete(h)):t(x)});r.set(h,tn(f,g))}else Fs(f),r.delete(h)}))}};return i(),[a,i]},Jv=(e,t,n,s)=>{let r=!1;const{j:a,X:i,Y:c,W:d,J:u,G:h}=s||{},p=c0(()=>r&&n(!0),{_:33,v:99}),[f,m]=yU(e,p,c),g=a||[],x=i||[],C=jd(g,x),y=(I,k)=>{if(!i0(k)){const M=u||ja,_=h||ja,A=[],D=[];let N=!1,P=!1;if(Pt(k,z=>{const{attributeName:W,target:X,type:ee,oldValue:G,addedNodes:re,removedNodes:le}=z,Ce=ee==="attributes",be=ee==="childList",ye=e===X,ne=Ce&&W,R=ne&&Ub(X,W||""),F=wu(R)?R:null,Z=ne&&G!==F,B=o_(x,W)&&Z;if(t&&(be||!ye)){const K=Ce&&Z,$=K&&d&&d0(X,d),ae=($?!M(X,W,G,F):!Ce||K)&&!_(z,!!$,e,s);Pt(re,ue=>tn(A,ue)),Pt(le,ue=>tn(A,ue)),P=P||ae}!t&&ye&&Z&&!M(X,W,G,F)&&(tn(D,W),N=N||B)}),m(z=>l0(A).reduce((W,X)=>(tn(W,C_(z,X)),d0(X,z)?tn(W,X):W),[])),t)return!I&&P&&n(!1),[!1];if(!i0(D)||N){const z=[l0(D),N];return!I&&n.apply(0,z),z}}},v=new NG(Ze(y,!1));return[()=>(v.observe(e,{attributes:!0,attributeOldValue:!0,attributeFilter:C,subtree:t,childList:t,characterData:t}),r=!0,()=>{r&&(f(),v.disconnect(),r=!1)}),()=>{if(r)return p.m(),y(!0,v.takeRecords())}]},$_={},F_={},vU=e=>{Pt(e,t=>Pt(t,(n,s)=>{$_[s]=t[s]}))},z_=(e,t,n)=>Po(e).map(s=>{const{static:r,instance:a}=e[s],[i,c,d]=n||[],u=n?a:r;if(u){const h=n?u(i,c,t):u(t);return(d||F_)[s]=h}}),ju=e=>F_[e],CU="__osOptionsValidationPlugin",wU="__osSizeObserverPlugin",jU=(e,t)=>{const{k:n}=t,[s,r]=e("showNativeOverlaidScrollbars");return[s&&n.x&&n.y,r]},Kl=e=>e.indexOf(da)===0,SU=(e,t)=>{const n=(r,a,i,c)=>{const d=r===da?ei:r.replace(`${da}-`,""),u=Kl(r),h=Kl(i);return!a&&!c?ei:u&&h?da:u?a&&c?d:a?da:ei:a?d:h&&c?da:ei},s={x:n(t.x,e.x,t.y,e.y),y:n(t.y,e.y,t.x,e.x)};return{K:s,Z:{x:s.x===Zl,y:s.y===Zl}}},V_="__osScrollbarsHidingPlugin",H_="__osClickScrollPlugin",kU={[H_]:{static:()=>(e,t,n,s)=>{let r=!1,a=ja;const i=133,c=222,[d,u]=ti(i),h=Math.sign(t),p=n*h,f=p/2,m=y=>1-(1-y)*(1-y),g=(y,v)=>Dm(y,v,c,e,m),x=(y,v)=>Dm(y,t-p,i*v,(I,k,M)=>{e(I),M&&(a=g(I,t))}),C=Dm(0,p,c,(y,v,I)=>{if(e(y),I&&(s(r),!r)){const k=t-y;Math.sign(k-f)===h&&d(()=>{const _=k-p;a=Math.sign(_)===h?x(y,Math.abs(_)/n):g(y,t)})}},m);return y=>{r=!0,y&&C(),u(),a()}}}},W_=(e,t,n)=>{const{dt:s}=n||{},r=ju(wU),[a]=Ds({o:!1,u:!0});return()=>{const i=[],d=j_(`<div class="${Yb}"><div class="${nU}"></div></div>`)[0],u=d.firstChild,h=p=>{const f=p instanceof ResizeObserverEntry;let m=!1,g=!1;if(f){const[x,,C]=a(p.contentRect),y=f0(x);g=__(x,C),m=!g&&!y}else g=p===!0;m||t({ft:!0,dt:g})};if(ap){const p=new ap(f=>h(f.pop()));p.observe(u),tn(i,()=>{p.disconnect()})}else if(r){const[p,f]=r(u,h,s);tn(i,jd([Kb(d,tU),Kt(d,"animationstart",p)],f))}else return ja;return Ze(Fs,tn(i,Ns(e,d)))}},IU=(e,t)=>{let n;const s=d=>d.h===0||d.isIntersecting||d.intersectionRatio>0,r=Ml(sU),[a]=Ds({o:!1}),i=(d,u)=>{if(d){const h=a(s(d)),[,p]=h;return p&&!u&&t(h)&&[h]}},c=(d,u)=>i(u.pop(),d);return[()=>{const d=[];if(Rv)n=new Rv(Ze(c,!1),{root:e}),n.observe(r),tn(d,()=>{n.disconnect()});else{const u=()=>{const h=Al(r);i(h)};tn(d,W_(r,u)()),u()}return Ze(Fs,tn(d,Ns(e,r)))},()=>n&&c(!0,n.takeRecords())]},_U=(e,t,n,s)=>{let r,a,i,c,d,u;const h=`[${Sa}]`,p=`[${kr}]`,f=["id","class","style","open","wrap","cols","rows"],{vt:m,ht:g,ot:x,gt:C,bt:y,nt:v,wt:I,yt:k,St:M,Ot:_}=e,A=B=>Fr(B,"direction")==="rtl",D={$t:!1,ct:A(m)},N=xr(),P=ju(V_),[z]=Ds({i:f_,o:{w:0,h:0}},()=>{const B=P&&P.tt(e,t,D,N,n).ut,$=!(I&&v)&&qb(g,Sa,Eh),Y=!v&&k(JG),ae=Y&&Bs(C),ue=ae&&_(),Re=M(T_,$),we=Y&&B&&B()[0],De=up(x),Me=Qb(x);return we&&we(),Xo(C,ae),ue&&ue(),$&&Re(),{w:De.w+Me.w,h:De.h+Me.h}}),W=c0(s,{_:()=>r,v:()=>a,S(B,K){const[$]=B,[Y]=K;return[jd(Po($),Po(Y)).reduce((ae,ue)=>(ae[ue]=$[ue]||Y[ue],ae),{})]}}),X=B=>{const K=A(m);yt(B,{Ct:u!==K}),yt(D,{ct:K}),u=K},ee=(B,K)=>{const[$,Y]=B,ae={xt:Y};return yt(D,{$t:$}),!K&&s(ae),ae},G=({ft:B,dt:K})=>{const Y=!(B&&!K)&&N.R?W:s,ae={ft:B||K,dt:K};X(ae),Y(ae)},re=(B,K)=>{const[,$]=z(),Y={Ht:$};return X(Y),$&&!K&&(B?s:W)(Y),Y},le=(B,K,$)=>{const Y={Et:K};return X(Y),K&&!$&&W(Y),Y},[Ce,be]=y?IU(g,ee):[],ye=!v&&W_(g,G,{dt:!0}),[ne,R]=Jv(g,!1,le,{X:f,j:f}),F=v&&ap&&new ap(B=>{const K=B[B.length-1].contentRect;G({ft:!0,dt:__(K,d)}),d=K}),Z=c0(()=>{const[,B]=z();s({Ht:B})},{_:222,p:!0});return[()=>{F&&F.observe(g);const B=ye&&ye(),K=Ce&&Ce(),$=ne(),Y=N.L(ae=>{ae?W({zt:ae}):Z()});return()=>{F&&F.disconnect(),B&&B(),K&&K(),c&&c(),$(),Y()}},({It:B,At:K,Dt:$})=>{const Y={},[ae]=B("update.ignoreMutation"),[ue,Re]=B("update.attributes"),[we,De]=B("update.elementEvents"),[Me,ht]=B("update.debounce"),st=De||Re,We=K||$,T=H=>Ws(ae)&&ae(H);if(st){i&&i(),c&&c();const[H,q]=Jv(y||x,!0,re,{j:jd(f,ue||[]),Y:we,W:h,G:(de,ce)=>{const{target:ie,attributeName:J}=de;return(!ce&&J&&!v?zG(ie,h,p):!1)||!!gl(ie,`.${Us}`)||!!T(de)}});c=H(),i=q}if(ht)if(W.m(),lr(Me)){const H=Me[0],q=Me[1];r=sr(H)&&H,a=sr(q)&&q}else sr(Me)?(r=Me,a=!1):(r=!1,a=!1);if(We){const H=R(),q=be&&be(),de=i&&i();H&&yt(Y,le(H[0],H[1],We)),q&&yt(Y,ee(q[0],We)),de&&yt(Y,re(de[0],We))}return X(Y),Y},D]},MU=(e,t,n,s)=>{const r="--os-viewport-percent",a="--os-scroll-percent",i="--os-scroll-direction",{U:c}=xr(),{scrollbars:d}=c(),{slot:u}=d,{vt:h,ht:p,ot:f,Mt:m,gt:g,wt:x,nt:C}=t,{scrollbars:y}=m?{}:e,{slot:v}=y||{},I=[],k=[],M=[],_=N_([h,p,f],()=>C&&x?h:p,u,v),A=ne=>{if(_h){const R=new _h({source:g,axis:ne});return{kt:Z=>{const B=Z.Tt.animate({clear:["left"],[a]:[0,1]},{timeline:R});return()=>B.cancel()}}}},D={x:A("x"),y:A("y")},N=()=>{const{Rt:ne,Vt:R}=n,F=(Z,B)=>x_(0,1,Z/(Z+B)||0);return{x:F(R.x,ne.x),y:F(R.y,ne.y)}},P=(ne,R,F)=>{const Z=F?Kb:v_;Pt(ne,B=>{Z(B.Tt,R)})},z=(ne,R)=>{Pt(ne,F=>{const[Z,B]=R(F);kd(Z,B)})},W=(ne,R,F)=>{const Z=Vb(F),B=Z?F:!0,K=Z?!F:!0;B&&P(k,ne,R),K&&P(M,ne,R)},X=()=>{const ne=N(),R=F=>Z=>[Z.Tt,{[r]:p0(F)+""}];z(k,R(ne.x)),z(M,R(ne.y))},ee=()=>{if(!_h){const{Lt:ne}=n,R=zv(ne,Bs(g)),F=Z=>B=>[B.Tt,{[a]:p0(Z)+""}];z(k,F(R.x)),z(M,F(R.y))}},G=()=>{const{Lt:ne}=n,R=Fv(ne),F=Z=>B=>[B.Tt,{[i]:Z?"0":"1"}];z(k,F(R.x)),z(M,F(R.y))},re=()=>{if(C&&!x){const{Rt:ne,Lt:R}=n,F=Fv(R),Z=zv(R,Bs(g)),B=K=>{const{Tt:$}=K,Y=Sd($)===f&&$,ae=(ue,Re,we)=>{const De=Re*ue;return k_(we?De:-De)};return[Y,Y&&{transform:VG({x:ae(Z.x,ne.x,F.x),y:ae(Z.y,ne.y,F.y)})}]};z(k,B),z(M,B)}},le=ne=>{const R=ne?"x":"y",Z=Ml(`${Us} ${ne?aU:iU}`),B=Ml(R_),K=Ml(Jb),$={Tt:Z,Ut:B,Pt:K},Y=D[R];return tn(ne?k:M,$),tn(I,[Ns(Z,B),Ns(B,K),Ze(ql,Z),Y&&Y.kt($),s($,W,ne)]),$},Ce=Ze(le,!0),be=Ze(le,!1),ye=()=>(Ns(_,k[0].Tt),Ns(_,M[0].Tt),Ze(Fs,I));return Ce(),be(),[{Nt:X,qt:ee,Bt:G,Ft:re,jt:W,Xt:{Yt:k,Wt:Ce,Jt:Ze(z,k)},Gt:{Yt:M,Wt:be,Jt:Ze(z,M)}},ye]},AU=(e,t,n,s)=>(r,a,i)=>{const{ht:c,ot:d,nt:u,gt:h,Kt:p,Ot:f}=t,{Tt:m,Ut:g,Pt:x}=r,[C,y]=ti(333),[v,I]=ti(444),k=A=>{Ws(h.scrollBy)&&h.scrollBy({behavior:"smooth",left:A.x,top:A.y})},M=()=>{const A="pointerup pointercancel lostpointercapture",D=`client${i?"X":"Y"}`,N=i?ff:mf,P=i?"left":"top",z=i?"w":"h",W=i?"x":"y",X=(G,re)=>le=>{const{Rt:Ce}=n,be=Al(g)[z]-Al(x)[z],ne=re*le/be*Ce[W];Xo(h,{[W]:G+ne})},ee=[];return Kt(g,"pointerdown",G=>{const re=gl(G.target,`.${Jb}`)===x,le=re?x:g,Ce=e.scrollbars,be=Ce[re?"dragScroll":"clickScroll"],{button:ye,isPrimary:ne,pointerType:R}=G,{pointers:F}=Ce;if(ye===0&&ne&&be&&(F||[]).includes(R)){Fs(ee),I();const B=!re&&(G.shiftKey||be==="instant"),K=Ze(Om,x),$=Ze(Om,g),Y=(ce,ie)=>(ce||K())[P]-(ie||$())[P],ae=r0(Om(h)[N])/Al(h)[z]||1,ue=X(Bs(h)[W],1/ae),Re=G[D],we=K(),De=$(),Me=we[N],ht=Y(we,De)+Me/2,st=Re-De[P],We=re?0:st-ht,T=ce=>{Fs(de),le.releasePointerCapture(ce.pointerId)},H=re||B,q=f(),de=[Kt(p,A,T),Kt(p,"selectstart",ce=>m0(ce),{H:!1}),Kt(g,A,T),H&&Kt(g,"pointermove",ce=>ue(We+(ce[D]-Re))),H&&(()=>{const ce=Bs(h);q();const ie=Bs(h),J={x:ie.x-ce.x,y:ie.y-ce.y};(op(J.x)>3||op(J.y)>3)&&(f(),Xo(h,ce),k(J),v(q))})];if(le.setPointerCapture(G.pointerId),B)ue(We);else if(!re){const ce=ju(H_);if(ce){const ie=ce(ue,We,Me,J=>{J?q():tn(de,q)});tn(de,ie),tn(ee,Ze(ie,!0))}}}})};let _=!0;return Ze(Fs,[Kt(x,"pointermove pointerleave",s),Kt(m,"pointerenter",()=>{a(qv,!0)}),Kt(m,"pointerleave pointercancel",()=>{a(qv,!1)}),!u&&Kt(m,"mousedown",()=>{const A=h0();(Ov(A,kr)||Ov(A,Sa)||A===document.body)&&rp(Ze(g0,d),25)}),Kt(m,"wheel",A=>{const{deltaX:D,deltaY:N,deltaMode:P}=A;_&&P===0&&Sd(m)===c&&k({x:D,y:N}),_=!1,a(Yv,!0),C(()=>{_=!0,a(Yv)}),m0(A)},{H:!1,I:!0}),Kt(m,"pointerdown",Ze(Kt,p,"click",A_,{A:!0,I:!0,H:!1}),{I:!0}),M(),y,I])},EU=(e,t,n,s,r,a)=>{let i,c,d,u,h,p=ja,f=0;const m=ne=>ne.pointerType==="mouse",[g,x]=ti(),[C,y]=ti(100),[v,I]=ti(100),[k,M]=ti(()=>f),[_,A]=MU(e,r,s,AU(t,r,s,ne=>m(ne)&&le())),{ht:D,Qt:N,wt:P}=r,{jt:z,Nt:W,qt:X,Bt:ee,Ft:G}=_,re=(ne,R)=>{if(M(),ne)z(Qv);else{const F=Ze(z,Qv,!0);f>0&&!R?k(F):F()}},le=()=>{(d?!i:!u)&&(re(!0),C(()=>{re(!1)}))},Ce=ne=>{z(y0,ne,!0),z(y0,ne,!1)},be=ne=>{m(ne)&&(i=d,d&&re(!0))},ye=[M,y,I,x,()=>p(),Kt(D,"pointerover",be,{A:!0}),Kt(D,"pointerenter",be),Kt(D,"pointerleave",ne=>{m(ne)&&(i=!1,d&&re(!1))}),Kt(D,"pointermove",ne=>{m(ne)&&c&&le()}),Kt(N,"scroll",ne=>{g(()=>{X(),le()}),a(ne),G()})];return[()=>Ze(Fs,tn(ye,A())),({It:ne,Dt:R,Zt:F,tn:Z})=>{const{nn:B,sn:K,en:$,cn:Y}=Z||{},{Ct:ae,dt:ue}=F||{},{ct:Re}=n,{k:we}=xr(),{K:De,rn:Me}=s,[ht,st]=ne("showNativeOverlaidScrollbars"),[We,T]=ne("scrollbars.theme"),[H,q]=ne("scrollbars.visibility"),[de,ce]=ne("scrollbars.autoHide"),[ie,J]=ne("scrollbars.autoHideSuspend"),[ge]=ne("scrollbars.autoHideDelay"),[Ue,Ke]=ne("scrollbars.dragScroll"),[vt,In]=ne("scrollbars.clickScroll"),[an,Fn]=ne("overflow"),_s=ue&&!R,qs=Me.x||Me.y,Ks=B||K||Y||ae||R,Cn=$||q||Fn,vr=ht&&we.x&&we.y,po=(fo,Qs,zu)=>{const zc=fo.includes(Zl)&&(H===da||H==="auto"&&Qs===Zl);return z(lU,zc,zu),zc};if(f=ge,_s&&(ie&&qs?(Ce(!1),p(),v(()=>{p=Kt(N,"scroll",Ze(Ce,!0),{A:!0})})):Ce(!0)),st&&z(oU,vr),T&&(z(h),z(We,!0),h=We),J&&!ie&&Ce(!0),ce&&(c=de==="move",d=de==="leave",u=de==="never",re(u,!0)),Ke&&z(uU,Ue),In&&z(dU,!!vt),Cn){const fo=po(an.x,De.x,!0),Qs=po(an.y,De.y,!1);z(cU,!(fo&&Qs))}Ks&&(X(),W(),G(),Y&&ee(),z(Kv,!Me.x,!0),z(Kv,!Me.y,!1),z(rU,Re&&!P))},{},_]},LU=e=>{const t=xr(),{U:n,R:s}=t,{elements:r}=n(),{padding:a,viewport:i,content:c}=r,d=cp(e),u=d?{}:e,{elements:h}=u,{padding:p,viewport:f,content:m}=h||{},g=d?e:u.target,x=w_(g),C=g.ownerDocument,y=C.documentElement,v=()=>C.defaultView||ws,I=Ze(mU,[g]),k=Ze(N_,[g]),M=Ze(Ml,""),_=Ze(I,M,i),A=Ze(k,M,c),D=Me=>{const ht=Al(Me),st=up(Me),We=Fr(Me,h_),T=Fr(Me,p_);return st.w-ht.w>0&&!Kl(We)||st.h-ht.h>0&&!Kl(T)},N=_(f),P=N===g,z=P&&x,W=!P&&A(m),X=!P&&N===W,ee=z?y:N,G=z?ee:g,re=!P&&k(M,a,p),le=!X&&W,Ce=[le,ee,re,G].map(Me=>cp(Me)&&!Sd(Me)&&Me),be=Me=>Me&&o_(Ce,Me),ye=!be(ee)&&D(ee)?ee:g,ne=z?y:ee,F={vt:g,ht:G,ot:ee,ln:re,bt:le,gt:ne,Qt:z?C:ee,an:x?y:ye,Kt:C,wt:x,Mt:d,nt:P,un:v,yt:Me=>qb(ee,kr,Me),St:(Me,ht)=>dp(ee,kr,Me,ht),Ot:()=>dp(ne,kr,XG,!0)},{vt:Z,ht:B,ln:K,ot:$,bt:Y}=F,ae=[()=>{Wo(B,[Sa,Nm]),Wo(Z,Nm),x&&Wo(y,[Nm,Sa])}];let ue=u0([Y,$,K,B,Z].find(Me=>Me&&!be(Me)));const Re=z?Z:Y||$,we=Ze(Fs,ae);return[F,()=>{const Me=v(),ht=h0(),st=de=>{Ns(Sd(de),u0(de)),ql(de)},We=de=>Kt(de,"focusin focusout focus blur",A_,{I:!0,H:!1}),T="tabindex",H=Ub($,T),q=We(ht);return Sr(B,Sa,P?"":KG),Sr(K,b0,""),Sr($,kr,""),Sr(Y,Zv,""),P||(Sr($,T,H||"-1"),x&&Sr(y,Uv,"")),Ns(Re,ue),Ns(B,K),Ns(K||B,!P&&$),Ns($,Y),tn(ae,[q,()=>{const de=h0(),ce=be($),ie=ce&&de===$?Z:de,J=We(ie);Wo(K,b0),Wo(Y,Zv),Wo($,kr),x&&Wo(y,Uv),H?Sr($,T,H):Wo($,T),be(Y)&&st(Y),ce&&st($),be(K)&&st(K),g0(ie),J()}]),s&&!P&&(Zb($,kr,P_),tn(ae,Ze(Wo,$,kr))),g0(!P&&x&&ht===Z&&Me.top===Me?$:ht),q(),ue=0,we},we]},TU=({bt:e})=>({Zt:t,_n:n,Dt:s})=>{const{xt:r}=t||{},{$t:a}=n;e&&(r||s)&&kd(e,{[mf]:a&&"100%"})},PU=({ht:e,ln:t,ot:n,nt:s},r)=>{const[a,i]=Ds({i:$G,o:Bv()},Ze(Bv,e,"padding",""));return({It:c,Zt:d,_n:u,Dt:h})=>{let[p,f]=i(h);const{R:m}=xr(),{ft:g,Ht:x,Ct:C}=d||{},{ct:y}=u,[v,I]=c("paddingAbsolute");(g||f||(h||x))&&([p,f]=a(h));const M=!s&&(I||C||f);if(M){const _=!v||!t&&!m,A=p.r+p.l,D=p.t+p.b,N={[d_]:_&&!y?-A:0,[u_]:_?-D:0,[c_]:_&&y?-A:0,top:_?-p.t:0,right:_?y?-p.r:"auto":0,left:_?y?"auto":-p.l:0,[ff]:_&&`calc(100% + ${A}px)`},P={[r_]:_?p.t:0,[a_]:_?p.r:0,[l_]:_?p.b:0,[i_]:_?p.l:0};kd(t||n,N),kd(n,P),yt(r,{ln:p,dn:!_,rt:t?P:yt({},N,P)})}return{fn:M}}},RU=(e,t)=>{const n=xr(),{ht:s,ln:r,ot:a,nt:i,Qt:c,gt:d,wt:u,St:h,un:p}=e,{R:f}=n,m=u&&i,g=Ze(sp,0),x={display:()=>!1,direction:R=>R!=="ltr",flexDirection:R=>R.endsWith("-reverse"),writingMode:R=>R!=="horizontal-tb"},C=Po(x),y={i:f_,o:{w:0,h:0}},v={i:Mh,o:{}},I=R=>{h(T_,!m&&R)},k=R=>{if(!C.some(Re=>{const we=R[Re];return we&&x[Re](we)}))return{D:{x:0,y:0},M:{x:1,y:1}};I(!0);const Z=Bs(d),B=h(eU,!0),K=Kt(c,Zl,Re=>{const we=Bs(d);Re.isTrusted&&we.x===Z.x&&we.y===Z.y&&M_(Re)},{I:!0,A:!0});Xo(d,{x:0,y:0}),B();const $=Bs(d),Y=up(d);Xo(d,{x:Y.w,y:Y.h});const ae=Bs(d);Xo(d,{x:ae.x-$.x<1&&-Y.w,y:ae.y-$.y<1&&-Y.h});const ue=Bs(d);return Xo(d,Z),df(()=>K()),{D:$,M:ue}},M=(R,F)=>{const Z=ws.devicePixelRatio%1!==0?1:0,B={w:g(R.w-F.w),h:g(R.h-F.h)};return{w:B.w>Z?B.w:0,h:B.h>Z?B.h:0}},[_,A]=Ds(y,Ze(Qb,a)),[D,N]=Ds(y,Ze(up,a)),[P,z]=Ds(y),[W]=Ds(v),[X,ee]=Ds(y),[G]=Ds(v),[re]=Ds({i:(R,F)=>gf(R,F,C),o:{}},()=>UG(a)?Fr(a,C):{}),[le,Ce]=Ds({i:(R,F)=>Mh(R.D,F.D)&&Mh(R.M,F.M),o:E_()}),be=ju(V_),ye=(R,F)=>`${F?QG:YG}${BG(R)}`,ne=R=>{const F=B=>[da,ei,Zl].map(K=>ye(K,B)),Z=F(!0).concat(F()).join(" ");h(Z),h(Po(R).map(B=>ye(R[B],B==="x")).join(" "),!0)};return({It:R,Zt:F,_n:Z,Dt:B},{fn:K})=>{const{ft:$,Ht:Y,Ct:ae,dt:ue,zt:Re}=F||{},we=be&&be.tt(e,t,Z,n,R),{it:De,ut:Me,_t:ht}=we||{},[st,We]=jU(R,n),[T,H]=R("overflow"),q=Kl(T.x),de=Kl(T.y),ce=!0;let ie=A(B),J=N(B),ge=z(B),Ue=ee(B);We&&f&&h(P_,!st);{qb(s,Sa,Eh)&&I(!0);const[jy]=Me?Me():[],[Vu]=ie=_(B),[Hu]=J=D(B),Wu=I_(a),Gu=m&&GG(p()),gD={w:g(Hu.w+Vu.w),h:g(Hu.h+Vu.h)},Sy={w:g((Gu?Gu.w:Wu.w+g(Wu.w-Hu.w))+Vu.w),h:g((Gu?Gu.h:Wu.h+g(Wu.h-Hu.h))+Vu.h)};jy&&jy(),Ue=X(Sy),ge=P(M(gD,Sy),B)}const[Ke,vt]=Ue,[In,an]=ge,[Fn,_s]=J,[qs,Ks]=ie,[Cn,vr]=W({x:In.w>0,y:In.h>0}),po=q&&de&&(Cn.x||Cn.y)||q&&Cn.x&&!Cn.y||de&&Cn.y&&!Cn.x,fo=K||ae||Re||Ks||_s||vt||an||H||We||ce,Qs=SU(Cn,T),[zu,zc]=G(Qs.K),[hD,pD]=re(B),wy=ae||ue||pD||vr||B,[fD,mD]=wy?le(k(hD),B):Ce();return fo&&(zc&&ne(Qs.K),ht&&De&&kd(a,ht(Qs,Z,De(Qs,Fn,qs)))),I(!1),dp(s,Sa,Eh,po),dp(r,b0,Eh,po),yt(t,{K:zu,Vt:{x:Ke.w,y:Ke.h},Rt:{x:In.w,y:In.h},rn:Cn,Lt:ZG(fD,In)}),{en:zc,nn:vt,sn:an,cn:mD||an,vn:wy}}},DU=e=>{const[t,n,s]=LU(e),r={ln:{t:0,r:0,b:0,l:0},dn:!1,rt:{[d_]:0,[u_]:0,[c_]:0,[r_]:0,[a_]:0,[l_]:0,[i_]:0},Vt:{x:0,y:0},Rt:{x:0,y:0},K:{x:ei,y:ei},rn:{x:!1,y:!1},Lt:E_()},{vt:a,gt:i,nt:c,Ot:d}=t,{R:u,k:h}=xr(),p=!u&&(h.x||h.y),f=[TU(t),PU(t,r),RU(t,r)];return[n,m=>{const g={},C=p&&Bs(i),y=C&&d();return Pt(f,v=>{yt(g,v(m,g)||{})}),Xo(i,C),y&&y(),!c&&Xo(a,0),g},r,t,s]},OU=(e,t,n,s,r)=>{let a=!1;const i=Gv(t,{}),[c,d,u,h,p]=DU(e),[f,m,g]=_U(h,u,i,k=>{I({},k)}),[x,C,,y]=EU(e,t,g,u,h,r),v=k=>Po(k).some(M=>!!k[M]),I=(k,M)=>{if(n())return!1;const{pn:_,Dt:A,At:D,hn:N}=k,P=_||{},z=!!A||!a,W={It:Gv(t,P,z),pn:P,Dt:z};if(N)return C(W),!1;const X=M||m(yt({},W,{At:D})),ee=d(yt({},W,{_n:g,Zt:X}));C(yt({},W,{Zt:X,tn:ee}));const G=v(X),re=v(ee),le=G||re||!Gb(P)||z;return a=!0,le&&s(k,{Zt:X,tn:ee}),le};return[()=>{const{an:k,gt:M,Ot:_}=h,A=Bs(k),D=[f(),c(),x()],N=_();return Xo(M,A),N(),Ze(Fs,D)},I,()=>({gn:g,bn:u}),{wn:h,yn:y},p]},_o=(e,t,n)=>{const{N:s}=xr(),r=cp(e),a=r?e:e.target,i=B_(a);if(t&&!i){let c=!1;const d=[],u={},h=P=>{const z=g_(P),W=ju(CU);return W?W(z,!0):z},p=yt({},s(),h(t)),[f,m,g]=x0(),[x,C,y]=x0(n),v=(P,z)=>{y(P,z),g(P,z)},[I,k,M,_,A]=OU(e,p,()=>c,({pn:P,Dt:z},{Zt:W,tn:X})=>{const{ft:ee,Ct:G,xt:re,Ht:le,Et:Ce,dt:be}=W,{nn:ye,sn:ne,en:R,cn:F}=X;v("updated",[N,{updateHints:{sizeChanged:!!ee,directionChanged:!!G,heightIntrinsicChanged:!!re,overflowEdgeChanged:!!ye,overflowAmountChanged:!!ne,overflowStyleChanged:!!R,scrollCoordinatesChanged:!!F,contentMutation:!!le,hostMutation:!!Ce,appear:!!be},changedOptions:P||{},force:!!z}])},P=>v("scroll",[N,P])),D=P=>{bU(a),Fs(d),c=!0,v("destroyed",[N,P]),m(),C()},N={options(P,z){if(P){const W=z?s():{},X=L_(p,yt(W,h(P)));Gb(X)||(yt(p,X),k({pn:X}))}return yt({},p)},on:x,off:(P,z)=>{P&&z&&C(P,z)},state(){const{gn:P,bn:z}=M(),{ct:W}=P,{Vt:X,Rt:ee,K:G,rn:re,ln:le,dn:Ce,Lt:be}=z;return yt({},{overflowEdge:X,overflowAmount:ee,overflowStyle:G,hasOverflow:re,scrollCoordinates:{start:be.D,end:be.M},padding:le,paddingAbsolute:Ce,directionRTL:W,destroyed:c})},elements(){const{vt:P,ht:z,ln:W,ot:X,bt:ee,gt:G,Qt:re}=_.wn,{Xt:le,Gt:Ce}=_.yn,be=ne=>{const{Pt:R,Ut:F,Tt:Z}=ne;return{scrollbar:Z,track:F,handle:R}},ye=ne=>{const{Yt:R,Wt:F}=ne,Z=be(R[0]);return yt({},Z,{clone:()=>{const B=be(F());return k({hn:!0}),B}})};return yt({},{target:P,host:z,padding:W||X,viewport:X,content:ee||X,scrollOffsetElement:G,scrollEventElement:re,scrollbarHorizontal:ye(le),scrollbarVertical:ye(Ce)})},update:P=>k({Dt:P,At:!0}),destroy:Ze(D,!1),plugin:P=>u[Po(P)[0]]};return tn(d,[A]),xU(a,N),z_($_,_o,[N,f,u]),gU(_.wn.wt,!r&&e.cancel)?(D(!0),N):(tn(d,I()),v("initialized",[N]),N.update(),N)}return i};_o.plugin=e=>{const t=lr(e),n=t?e:[e],s=n.map(r=>z_(r,_o)[0]);return vU(n),t?s:s[0]};_o.valid=e=>{const t=e&&e.elements,n=Ws(t)&&t();return lp(n)&&!!B_(n.target)};_o.env=()=>{const{T:e,k:t,R:n,V:s,B:r,F:a,U:i,P:c,N:d,q:u}=xr();return yt({},{scrollbarsSize:e,scrollbarsOverlaid:t,scrollbarsHiding:n,scrollTimeline:s,staticDefaultInitialization:r,staticDefaultOptions:a,getDefaultInitialization:i,setDefaultInitialization:c,getDefaultOptions:d,setDefaultOptions:u})};_o.nonce=pU;_o.plugin(kU);const zr={defer:!0,options:{scrollbars:{visibility:"auto",autoHide:"scroll",autoHideDelay:1300,theme:"os-theme-dark",clickScroll:!0},overflow:{x:"hidden"}}},G_=(e="hidden",t="scroll")=>{const n=cn(zr);return dj(n,{options:{overflow:{y:t,x:e}}}),n},NU=()=>{if(typeof window>"u"){const u=()=>{};return[u,u]}let e,t;const n=window,s=typeof n.requestIdleCallback=="function",r=n.requestAnimationFrame,a=n.cancelAnimationFrame,i=s?n.requestIdleCallback:r,c=s?n.cancelIdleCallback:a,d=()=>{c(e),a(t)};return[(u,h)=>{d(),e=i(s?()=>{d(),t=r(u)}:u,typeof h=="object"?h:{timeout:2233})},d]},U_=e=>{const{options:t,events:n,defer:s}=e||{},[r,a]=l.useMemo(NU,[]),i=l.useRef(null),c=l.useRef(s),d=l.useRef(t),u=l.useRef(n);return l.useEffect(()=>{c.current=s},[s]),l.useEffect(()=>{const{current:h}=i;d.current=t,_o.valid(h)&&h.options(t||{},!0)},[t]),l.useEffect(()=>{const{current:h}=i;u.current=n,_o.valid(h)&&h.on(n||{},!0)},[n]),l.useEffect(()=>()=>{var h;a(),(h=i.current)==null||h.destroy()},[]),l.useMemo(()=>[h=>{const p=i.current;if(_o.valid(p))return;const f=c.current,m=d.current||{},g=u.current||{},x=()=>i.current=_o(h,m,g);f?r(x,f):x()},()=>i.current],[])},BU=(e,t)=>{const{element:n="div",options:s,events:r,defer:a,children:i,...c}=e,d=n,u=l.useRef(null),h=l.useRef(null),[p,f]=U_({options:s,events:r,defer:a});return l.useEffect(()=>{const{current:m}=u,{current:g}=h;if(!m)return;const x=m;return p(n==="body"?{target:x,cancel:{body:null}}:{target:x,elements:{viewport:g,content:g}}),()=>{var C;return(C=f())==null?void 0:C.destroy()}},[p,n]),l.useImperativeHandle(t,()=>({osInstance:f,getElement:()=>u.current}),[]),te.createElement(d,{"data-overlayscrollbars-initialize":"",ref:u,...c},n==="body"?i:te.createElement("div",{"data-overlayscrollbars-contents":"",ref:h},i))},Vr=l.forwardRef(BU),$U={height:"100%",width:"100%"},FU=({children:e,maxHeight:t,overflowX:n="hidden",overflowY:s="scroll"})=>{const r=l.useMemo(()=>G_(n,s).options,[n,s]);return o.jsx(j,{w:"full",h:"full",maxHeight:t,position:"relative",children:o.jsx(xe,{position:"absolute",top:0,left:0,right:0,bottom:0,children:o.jsx(Vr,{defer:!0,style:$U,options:r,children:e})})})},Nn=l.memo(FU),zU={"&::marker":{color:"base.500"}},VU=()=>{const{t:e}=S(),t=w(L8),n=w(pj),s=w(Bp),r=w(T8),a=l.useMemo(()=>{let i=`${e("dynamicPrompts.promptsPreview")} (${r.length})`;return t&&(i+=` - ${t}`),i},[t,r.length,e]);return n?o.jsx(j,{w:"full",h:"full",layerStyle:"second",alignItems:"center",justifyContent:"center",p:8,children:o.jsx(Mt,{icon:KI,label:"Problem generating prompts"})}):o.jsxs(V,{orientation:"vertical",w:"full",h:"full",isInvalid:!!(t||n),children:[o.jsx(Be,{feature:"dynamicPrompts",inPortal:!1,children:o.jsx(U,{children:a})}),o.jsxs(j,{w:"full",h:"full",pos:"relative",layerStyle:"first",p:4,borderRadius:"base",children:[o.jsx(Nn,{children:o.jsx(P8,{stylePosition:"inside",ms:0,children:r.map((i,c)=>o.jsx(Qt,{fontSize:"sm",sx:zU,children:o.jsx(O,{as:"span",children:i})},`${i}.${c}`))})}),s&&o.jsx(j,{pos:"absolute",w:"full",h:"full",top:0,insetInlineStart:0,layerStyle:"second",opacity:.7,alignItems:"center",justifyContent:"center",children:o.jsx(pr,{})})]})]})},HU=l.memo(VU),WU=()=>{const e=E(),{t}=S(),n=w(R8),s=l.useMemo(()=>[{value:"PER_ITERATION",label:t("dynamicPrompts.seedBehaviour.perIterationLabel"),description:t("dynamicPrompts.seedBehaviour.perIterationDesc")},{value:"PER_PROMPT",label:t("dynamicPrompts.seedBehaviour.perPromptLabel"),description:t("dynamicPrompts.seedBehaviour.perPromptDesc")}],[t]),r=l.useCallback(i=>{D8(i==null?void 0:i.value)&&e(O8(i.value))},[e]),a=l.useMemo(()=>s.find(i=>i.value===n),[s,n]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"dynamicPromptsSeedBehaviour",inPortal:!1,children:o.jsx(U,{children:t("dynamicPrompts.seedBehaviour.label")})}),o.jsx(Ne,{value:a,options:s,onChange:r})]})},GU=l.memo(WU),Z_=l.memo(()=>{wt("DynamicPromptsModal");const{t:e}=S(),{isOpen:t,onClose:n}=kI();return o.jsxs(fr,{isOpen:t,onClose:n,isCentered:!0,useInert:!1,children:[o.jsx(co,{}),o.jsxs(mr,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[o.jsx(Bo,{children:e("dynamicPrompts.dynamicPrompts")}),o.jsx(Ea,{}),o.jsxs(uo,{as:j,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[o.jsxs(j,{gap:4,children:[o.jsx(GU,{}),o.jsx(RG,{})]}),o.jsx(HU,{})]})]})]})});Z_.displayName="DynamicPromptsModal";const Jc=Ge(null),UU=()=>{wt("DeleteBoardModal");const e=se(Jc),{t}=S(),{currentData:n,isFetching:s}=N8((e==null?void 0:e.board_id)??Kn),r=l.useMemo(()=>pt([bt,Je,Gd],(x,C,y)=>{const v=(n??[]).map(k=>lj(x,C,y,k));return{isUpscaleImage:Gn(v,k=>k.isUpscaleImage),isRasterLayerImage:Gn(v,k=>k.isRasterLayerImage),isInpaintMaskImage:Gn(v,k=>k.isInpaintMaskImage),isRegionalGuidanceImage:Gn(v,k=>k.isRegionalGuidanceImage),isNodesImage:Gn(v,k=>k.isNodesImage),isControlLayerImage:Gn(v,k=>k.isControlLayerImage),isReferenceImage:Gn(v,k=>k.isReferenceImage)}}),[n]),[a,{isLoading:i}]=B8(),[c,{isLoading:d}]=$8(),u=w(r),h=l.useCallback(()=>{e&&(a(e.board_id),Jc.set(null))},[e,a]),p=l.useCallback(()=>{e&&(c(e.board_id),Jc.set(null))},[e,c]),f=l.useCallback(()=>{Jc.set(null)},[]),m=l.useRef(null),g=l.useMemo(()=>d||i||s,[d,i,s]);return e?o.jsx(fj,{isOpen:!!e,onClose:f,leastDestructiveRef:m,isCentered:!0,children:o.jsx(co,{children:o.jsxs(mj,{children:[o.jsxs(Bo,{fontSize:"lg",fontWeight:"bold",children:[t("common.delete")," ",e.board_name]}),o.jsx(uo,{children:o.jsxs(j,{direction:"column",gap:3,children:[s?o.jsx(_x,{children:o.jsx(j,{w:"full",h:32})}):o.jsx(SI,{imageUsage:u,topMessage:t("boards.topMessage"),bottomMessage:t("boards.bottomMessage")}),o.jsx(O,{children:e.is_private?t("boards.deletedPrivateBoardsCannotbeRestored"):t("boards.deletedBoardsCannotbeRestored")}),o.jsx(O,{children:t("gallery.deleteImagePermanent")})]})}),o.jsx(La,{children:o.jsxs(j,{w:"full",gap:2,justifyContent:"end",children:[o.jsx(me,{ref:m,onClick:f,children:t("boards.cancel")}),o.jsx(me,{colorScheme:"warning",isLoading:g,onClick:h,children:t("boards.deleteBoardOnly")}),o.jsx(me,{colorScheme:"error",isLoading:g,onClick:p,children:t("boards.deleteBoardAndImages")})]})})]})})}):null},ZU=l.memo(UU),qU=()=>{const{t:e}=S(),t=E(),n=w(x=>x.gallery.selection),s=se(Mx),r=dn("bulkDownload"),[a]=Ax(),[i]=Ex(),[c]=Lx(),d=l.useCallback(()=>{t(gj(n)),t(kx(!0))},[t,n]),u=l.useCallback(()=>{t($d(n))},[t,n]),h=l.useCallback(()=>{a({imageDTOs:n})},[a,n]),p=l.useCallback(()=>{i({imageDTOs:n})},[i,n]),f=l.useCallback(()=>{c({image_names:n.map(x=>x.image_name)})},[n,c]),m=l.useMemo(()=>n.every(x=>x.starred),[n]),g=l.useMemo(()=>n.every(x=>!x.starred),[n]);return o.jsxs(o.Fragment,{children:[m&&o.jsx(_e,{icon:s?s.on.icon:o.jsx(Db,{}),onClickCapture:p,children:s?s.off.text:"Unstar All"}),(g||!m&&!g)&&o.jsx(_e,{icon:s?s.on.icon:o.jsx(Bb,{}),onClickCapture:h,children:s?s.on.text:"Star All"}),r&&o.jsx(_e,{icon:o.jsx(mc,{}),onClickCapture:f,children:e("gallery.downloadSelection")}),o.jsx(_e,{icon:o.jsx(OI,{}),onClickCapture:d,children:e("boards.changeBoard")}),o.jsx(qn,{}),o.jsx(_e,{color:"error.300",icon:o.jsx(Hs,{}),onClickCapture:u,children:e("gallery.deleteSelection")})]})},KU=l.memo(qU),so=({tooltip:e,icon:t,...n})=>o.jsx(Ae,{label:e,placement:"top",gutter:12,children:o.jsx(_e,{display:"flex",alignItems:"center",justifyContent:"center",w:"min-content",aspectRatio:"1",borderRadius:"base",...n,children:t})}),Su=({children:e})=>o.jsx(j,{gap:2,children:e}),q_=l.createContext(null),QU=q_.Provider,Zs=()=>{const e=l.useContext(q_);return Fe(e!==null,"useImageDTOContext must be used within ImageDTOContextProvider"),e},K_=l.memo(()=>{const{t:e}=S(),t=E(),n=Zs(),s=l.useCallback(()=>{t(gj([n])),t(kx(!0))},[t,n]);return o.jsx(_e,{icon:o.jsx(OI,{}),onClickCapture:s,children:e("boards.changeBoard")})});K_.displayName="ImageMenuItemChangeBoard";const Q_=e=>new Promise((t,n)=>{const s=new Image;s.onload=()=>{const r=document.createElement("canvas");r.width=s.width,r.height=s.height;const a=r.getContext("2d");if(!a){n(new Error("Failed to get canvas context"));return}a.drawImage(s,0,0),r.toBlob(i=>{i?t(i):n(new Error("Failed to convert image to blob"))},"image/png")},s.onerror=()=>{n(new Error("Image failed to load. The URL may be invalid or the object may not exist."))},s.crossOrigin=qd.get()?"use-credentials":"anonymous",s.src=e}),Y_=(e,t="image/png")=>{navigator.clipboard.write([new ClipboardItem({[t]:e})])},YU=()=>{const{t:e}=S(),t=l.useMemo(()=>!!navigator.clipboard&&!!window.ClipboardItem,[]),n=l.useCallback(async s=>{t||he({id:"PROBLEM_COPYING_IMAGE",title:e("toast.problemCopyingImage"),description:"Your browser doesn't support the Clipboard API.",status:"error"});try{const r=await Q_(s);if(!r)throw new Error("Unable to create Blob");Y_(r),he({id:"IMAGE_COPIED",title:e("toast.imageCopied"),status:"success"})}catch(r){he({id:"PROBLEM_COPYING_IMAGE",title:e("toast.problemCopyingImage"),description:String(r),status:"error"})}},[t,e]);return{isClipboardAPIAvailable:t,copyImageToClipboard:n}},J_=l.memo(()=>{const{t:e}=S(),t=Zs(),{isClipboardAPIAvailable:n,copyImageToClipboard:s}=YU(),r=l.useCallback(()=>{s(t.image_url)},[s,t.image_url]);return n?o.jsx(so,{icon:o.jsx(gr,{}),"aria-label":e("parameters.copyImage"),tooltip:e("parameters.copyImage"),onClickCapture:r}):null});J_.displayName="ImageMenuItemCopy";const X_=l.memo(()=>{const{t:e}=S(),t=E(),n=Zs(),s=l.useCallback(()=>{t($d([n]))},[t,n]);return o.jsx(so,{icon:o.jsx(Hs,{}),onClickCapture:s,"aria-label":e("gallery.deleteImage",{count:1}),tooltip:e("gallery.deleteImage",{count:1}),isDestructive:!0})});X_.displayName="ImageMenuItemDelete";const JU=()=>{const{t:e}=S(),t=E(),n=se(qd);return{downloadImage:l.useCallback(async(r,a)=>{try{const i=n?{headers:{Authorization:`Bearer ${n}`}}:{},c=await fetch(r,i).then(h=>h.blob());if(!c)throw new Error("Unable to create Blob");const d=window.URL.createObjectURL(c),u=document.createElement("a");u.style.display="none",u.href=d,u.download=a,document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(d),t(VV())}catch(i){he({id:"PROBLEM_DOWNLOADING_IMAGE",title:e("toast.problemDownloadingImage"),description:String(i),status:"error"})}},[e,t,n])}},eM=l.memo(()=>{const{t:e}=S(),t=Zs(),{downloadImage:n}=JU(),s=l.useCallback(()=>{n(t.image_url,t.image_name)},[n,t.image_name,t.image_url]);return o.jsx(so,{icon:o.jsx(mc,{}),"aria-label":e("parameters.downloadImage"),tooltip:e("parameters.downloadImage"),onClick:s})});eM.displayName="ImageMenuItemDownload";const XU=()=>o.jsx(j,{w:"14px",alignItems:"center",justifyContent:"center",children:o.jsx(pr,{size:"xs"})}),tM=l.memo(()=>{const{t:e}=S(),t=Zs(),[n,{isLoading:s}]=Nk(),r=se(bx),a=l.useCallback(()=>{n(t.image_name)},[n,t.image_name]);return o.jsx(_e,{icon:s?o.jsx(XU,{}):o.jsx(of,{}),onClickCapture:a,isDisabled:!t.has_workflow||!r,children:e("nodes.loadWorkflow")})});tM.displayName="ImageMenuItemLoadWorkflow";const nM=l.memo(()=>{const{t:e}=S(),t=Zs(),{recallAll:n,remix:s,recallSeed:r,recallPrompts:a,hasMetadata:i,hasSeed:c,hasPrompts:d,createAsPreset:u}=Ib(t);return o.jsxs(o.Fragment,{children:[o.jsx(_e,{icon:o.jsx(sf,{}),onClickCapture:s,isDisabled:!i,children:e("parameters.remixImage")}),o.jsx(_e,{icon:o.jsx(UI,{}),onClickCapture:a,isDisabled:!d,children:e("parameters.usePrompt")}),o.jsx(_e,{icon:o.jsx(WI,{}),onClickCapture:r,isDisabled:!c,children:e("parameters.useSeed")}),o.jsx(_e,{icon:o.jsx(EI,{}),onClickCapture:n,isDisabled:!i,children:e("parameters.useAll")}),o.jsx(_e,{icon:o.jsx(rf,{}),onClickCapture:u,isDisabled:!d,children:e("stylePresets.useForTemplate")})]})});nM.displayName="ImageMenuItemMetadataRecallActions";const Ht=()=>{const e=At();return se(e.$isBusy)},sM=l.memo(()=>{const{t:e}=S(),t=E(),n=Zs(),s=jt(),r=F8(),a=Ht(),i=l.useCallback(()=>{r(n),t(Tt("canvas")),s.close(),he({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,s,r,e]);return o.jsx(_e,{icon:o.jsx(qW,{}),onClickCapture:i,isDisabled:a,children:e("controlLayers.newCanvasFromImage")})});sM.displayName="ImageMenuItemNewCanvasFromImage";const eZ=Kd(jG),xl=()=>o.jsx(eZ,{transform:"rotate(90deg)"}),oM=l.memo(()=>{const{t:e}=S(),t=E(),n=Zs(),s=jt(),r=z8(),a=Ht(),i=l.useCallback(()=>{t(Yk()),r(n),t(Tt("canvas")),s.close(),he({id:"SENT_TO_CANVAS",title:e("toast.sentToCanvas"),status:"success"})},[t,n,s,r,e]);return o.jsx(_e,{icon:o.jsx(xl,{}),onClickCapture:i,isDisabled:a,children:e("controlLayers.newLayerFromImage")})});oM.displayName="ImageMenuItemNewLayerFromImage";const rM=l.memo(()=>{const{t:e}=S(),t=Zs(),n=l.useCallback(()=>{window.open(t.image_url,"_blank")},[t.image_url]);return o.jsx(so,{onClickCapture:n,"aria-label":e("common.openInNewTab"),tooltip:e("common.openInNewTab"),icon:o.jsx(Lb,{})})});rM.displayName="ImageMenuItemOpenInNewTab";const aM=l.memo(()=>{const{t:e}=S(),t=Zs(),n=jt(),s=l.useCallback(()=>{n.openImageInViewer(t)},[t,n]);return o.jsx(so,{icon:o.jsx(bu,{}),onClickCapture:s,"aria-label":e("common.openInViewer"),tooltip:e("common.openInViewer")})});aM.displayName="ImageMenuItemOpenInViewer";const iM=l.memo(()=>{const{t:e}=S(),t=E(),n=Zs(),s=l.useMemo(()=>pe(ks,i=>{var c;return((c=i.imageToCompare)==null?void 0:c.image_name)!==n.image_name}),[n.image_name]),r=w(s),a=l.useCallback(()=>{t(zd(n))},[t,n]);return o.jsx(so,{icon:o.jsx(BI,{}),isDisabled:!r,onClick:a,"aria-label":e("gallery.selectForCompare"),tooltip:e("gallery.selectForCompare")})});iM.displayName="ImageMenuItemSelectForCompare";const lM=l.memo(()=>{const{t:e}=S(),t=E(),n=Zs(),s=l.useCallback(()=>{t(xj(n)),t(Tt("upscaling")),he({id:"SENT_TO_CANVAS",title:e("toast.sentToUpscale"),status:"success"})},[t,n,e]);return o.jsx(_e,{icon:o.jsx(ZI,{}),onClickCapture:s,id:"send-to-upscale",children:e("parameters.sendToUpscale")})});lM.displayName="ImageMenuItemSendToUpscale";const cM=l.memo(()=>{const{t:e}=S(),t=Zs(),n=se(Mx),[s]=Ax(),[r]=Ex(),a=l.useCallback(()=>{t&&s({imageDTOs:[t]})},[s,t]),i=l.useCallback(()=>{t&&r({imageDTOs:[t]})},[r,t]);return t.starred?o.jsx(_e,{icon:n?n.off.icon:o.jsx(Bb,{}),onClickCapture:i,children:n?n.off.text:e("gallery.unstarImage")}):o.jsx(_e,{icon:n?n.on.icon:o.jsx(Db,{}),onClickCapture:a,children:n?n.on.text:e("gallery.starImage")})});cM.displayName="ImageMenuItemStarUnstar";const tZ=({imageDTO:e})=>o.jsxs(QU,{value:e,children:[o.jsxs(Su,{children:[o.jsx(rM,{}),o.jsx(J_,{}),o.jsx(eM,{}),o.jsx(aM,{}),o.jsx(iM,{}),o.jsx(X_,{})]}),o.jsx(qn,{}),o.jsx(tM,{}),o.jsx(nM,{}),o.jsx(qn,{}),o.jsx(lM,{}),o.jsxs(Jo,{children:[o.jsx(oM,{}),o.jsx(sM,{})]}),o.jsx(qn,{}),o.jsx(K_,{}),o.jsx(cM,{})]}),dM=l.memo(tZ),nZ=500,sZ=10,El=V8({isOpen:!1,imageDTO:null,position:{x:-1,y:-1}}),ad=()=>{El.setKey("isOpen",!1)},v0=new Map,oZ=e=>{const t=Array.from(v0.entries()).find(n=>n[0].contains(e));return t==null?void 0:t[1]},rZ=(e,t)=>{l.useEffect(()=>{if(!t.current||!e)return;const n=t.current;return v0.set(n,e),()=>{v0.delete(n)}},[e,t])},uM=l.memo(()=>{wt("ImageContextMenu");const e=se(El);return Qd(ad),o.jsxs(Zd,{children:[o.jsxs(Ta,{isOpen:e.isOpen,gutter:0,placement:"auto-end",onClose:ad,children:[o.jsx(Pa,{"aria-hidden":!0,w:1,h:1,position:"absolute",left:e.position.x,top:e.position.y,cursor:"default",bg:"transparent",_hover:aZ,pointerEvents:"none"}),o.jsx(pM,{})]}),o.jsx(hM,{})]})});uM.displayName="ImageContextMenu";const aZ={bg:"transparent"},hM=l.memo(()=>{const e=l.useRef({x:-1,y:-1}),t=l.useRef(0),n=l.useRef(0),s=l.useCallback(d=>{if(d.shiftKey){ad();return}const u=oZ(d.target);if(!u){ad();return}window.clearTimeout(n.current),d.preventDefault(),e.current.x!==d.pageX||e.current.y!==d.pageY?(El.get().isOpen&&ad(),n.current=window.setTimeout(()=>{El.set({isOpen:!0,position:{x:d.pageX,y:d.pageY},imageDTO:u})},100)):El.set({isOpen:!0,position:{x:d.pageX,y:d.pageY},imageDTO:u}),e.current={x:d.pageX,y:d.pageY}},[]),r=l.useCallback(d=>{d.pointerType!=="mouse"&&(t.current=window.setTimeout(()=>{s(d)},nZ),e.current={x:d.pageX,y:d.pageY})},[s]),a=l.useCallback(d=>{if(d.pointerType==="mouse"||t.current===null)return;const u=e.current;Math.hypot(d.pageX-u.x,d.pageY-u.y)>sZ&&clearTimeout(t.current)},[]),i=l.useCallback(d=>{d.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]),c=l.useCallback(d=>{d.pointerType!=="mouse"&&t.current&&clearTimeout(t.current)},[]);return l.useEffect(()=>{const d=new AbortController;return window.addEventListener("contextmenu",s,{signal:d.signal}),window.addEventListener("pointerdown",r,{signal:d.signal}),window.addEventListener("pointerup",i,{signal:d.signal}),window.addEventListener("pointercancel",c,{signal:d.signal}),window.addEventListener("pointermove",a,{signal:d.signal}),()=>{d.abort()}},[s,c,r,a,i]),l.useEffect(()=>()=>{window.clearTimeout(n.current),window.clearTimeout(t.current)},[]),null});hM.displayName="ImageContextMenuEventLogical";const pM=l.memo(()=>{const e=w(bj),t=se(El);return t.imageDTO?e>1?o.jsx(Un,{visibility:"visible",children:o.jsx(KU,{})}):o.jsx(Un,{visibility:"visible",children:o.jsx(dM,{imageDTO:t.imageDTO})}):null});pM.displayName="MenuContent";const fs=l.memo(({loadingMessage:e})=>o.jsx(j,{flexDirection:"column",gap:4,borderRadius:"base",p:4,bg:"base.800",children:o.jsxs(j,{justifyContent:"center",alignItems:"center",flexDirection:"column",p:4,gap:8,children:[o.jsx(pr,{}),o.jsx(O,{variant:"subtext",children:e||"Fetching..."})]})}));fs.displayName="FetchingModelsLoader";const C0=e=>[e,...e.dependencies||[]],fM=()=>{const{modelList:e}=$p(void 0,{selectFromResult:({data:s})=>({modelList:s?Yd.selectAll(s):Ss})}),t=l.useCallback(({source:s,name:r,base:a,type:i,is_installed:c})=>e.some(d=>c||s===d.source||a===d.base&&r===d.name&&i===d.type),[e]),n=l.useCallback(s=>{const{name:r,base:a,type:i,source:c,description:d,format:u}=s;return{config:{name:r,base:a,type:i,description:d,format:u},source:c}},[]);return{getIsInstalled:t,buildModelInstallArg:n}},iZ=({bundleName:e,bundle:t})=>{const[n]=yj(),{getIsInstalled:s,buildModelInstallArg:r}=fM(),{t:a}=S(),i=l.useMemo(()=>{const d=j9(t,C0),u=jk(d,(f,m)=>f.source===m.source||f.name===m.name&&f.base===m.base&&f.type===m.type),h=u.filter(wk(s)).map(r),p=u.filter(s).map(r);return{install:h,skip:p}},[r,t,s]),c=l.useCallback(()=>{i.install.forEach(n);let d=a("modelManager.installingXModels",{count:i.install.length});i.skip.length>1&&(d+=a("modelManager.skippingXDuplicates",{count:i.skip.length-1})),he({status:"info",title:a("modelManager.installingBundle"),description:d})},[i.install,i.skip.length,n,a]);return o.jsx(Ae,{label:o.jsx(j,{flexDir:"column",children:o.jsx(O,{children:a("modelManager.includesNModels",{n:t.length})})}),children:o.jsx(me,{size:"sm",onClick:c,py:6,isDisabled:i.install.length===0,children:o.jsxs(j,{flexDir:"column",children:[o.jsx(O,{children:H8(e)?vj[e]:e}),i.install.length>0&&o.jsxs(O,{fontSize:"xs",children:["(",t.length," ",a("settings.models"),")"]}),i.install.length===0&&o.jsx(O,{fontSize:"xs",children:a("common.installed")})]})})})},vc=()=>{const{t:e}=S(),[t,n]=yj();return[l.useCallback(({source:r,inplace:a,config:i,onSuccess:c,onError:d})=>{i||(i={}),t({source:r,inplace:a,config:i}).unwrap().then(u=>{c&&c(),he({id:"MODEL_INSTALL_QUEUED",title:e("toast.modelAddedSimple"),status:"success"})}).catch(u=>{d&&d(u),u&&he({id:"MODEL_INSTALL_QUEUE_FAILED",title:`${u.data.detail} `,status:"error"})})},[t,e]),n]},lZ={any:"base","sd-1":"green","sd-2":"teal",sdxl:"invokeBlue","sdxl-refiner":"invokeBlue",flux:"gold"},cZ=({base:e})=>o.jsx(Rn,{flexGrow:0,colorScheme:lZ[e],variant:"subtle",h:"min-content",children:vj[e]}),mM=l.memo(cZ),gM=l.memo(({starterModel:e})=>{const{t}=S(),{getIsInstalled:n,buildModelInstallArg:s}=fM(),r=l.useMemo(()=>C0(e).every(n),[n,e]),a=l.useMemo(()=>C0(e).filter(wk(n)).map(s),[n,e,s]),[i]=vc(),c=l.useCallback(()=>{a.forEach(i),he({status:"info",title:t("modelManager.installingModel"),description:t("modelManager.installingXModels",{count:a.length})})},[a,i,t]);return o.jsxs(j,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[o.jsxs(j,{fontSize:"sm",flexDir:"column",children:[o.jsxs(j,{gap:3,children:[o.jsx(Rn,{h:"min-content",children:e.type.replaceAll("_"," ")}),o.jsx(mM,{base:e.base}),o.jsx(O,{fontWeight:"semibold",children:e.name})]}),o.jsx(O,{variant:"subtext",children:e.description})]}),o.jsx(xe,{children:r?o.jsx(Rn,{children:t("common.installed")}):o.jsx(Q,{"aria-label":t("modelManager.install"),icon:o.jsx(Bt,{}),onClick:c,size:"sm"})})]})});gM.displayName="StarterModelsResultItem";const xM=l.memo(({results:e})=>{const{t}=S(),[n,s]=l.useState(""),r=l.useMemo(()=>e.starter_models.filter(c=>{const d=n.trim().toLowerCase(),u=[c.name.toLowerCase(),c.type.toLowerCase().replaceAll("_"," "),c.description.toLowerCase()];return c.type==="spandrel_image_to_image"&&(u.push("upscale"),u.push("post-processing"),u.push("postprocessing"),u.push("post processing")),u.some(h=>h.includes(d))}),[e,n]),a=l.useCallback(c=>{s(c.target.value)},[]),i=l.useCallback(()=>{s("")},[]);return o.jsxs(j,{flexDir:"column",gap:3,height:"100%",children:[o.jsxs(j,{justifyContent:"space-between",alignItems:"center",children:[ec(e.starter_bundles)>0&&o.jsxs(j,{gap:4,alignItems:"center",children:[o.jsxs(j,{gap:1,alignItems:"center",children:[o.jsx(O,{color:"base.200",fontWeight:"semibold",children:t("modelManager.starterBundles")}),o.jsx(Ae,{label:t("modelManager.starterBundleHelpText"),children:o.jsx(xe,{children:o.jsx(it,{as:Li,color:"base.200"})})})]}),o.jsx(j,{gap:2,children:To(e.starter_bundles,(c,d)=>o.jsx(iZ,{bundleName:d,bundle:c},d))})]}),o.jsxs(Ur,{w:64,size:"xs",children:[o.jsx(Vt,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:a,size:"xs"}),n&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(Q,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:o.jsx(sn,{}),onClick:i,flexShrink:0})})]})]}),o.jsx(j,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:o.jsx(Nn,{children:o.jsx(j,{flexDir:"column",gap:3,children:r.map(c=>o.jsx(gM,{starterModel:c},c.source))})})})]})});xM.displayName="StarterModelsResults";const bM=l.memo(()=>{const{isLoading:e,data:t}=W8(),{t:n}=S();return o.jsxs(j,{flexDir:"column",height:"100%",gap:3,children:[e&&o.jsx(fs,{loadingMessage:n("common.loading")}),t&&o.jsx(xM,{results:t})]})});bM.displayName="StarterModelsForm";const yM=l.memo(({result:e})=>{const{t}=S(),[n]=vc(),s=l.useCallback(()=>{n({source:e})},[n,e]);return o.jsxs(j,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[o.jsxs(j,{fontSize:"sm",flexDir:"column",children:[o.jsx(O,{fontWeight:"semibold",children:e.split("/").slice(-1)[0]}),o.jsx(O,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:e})]}),o.jsx(Q,{"aria-label":t("modelManager.install"),icon:o.jsx(Bt,{}),onClick:s,size:"sm"})]})});yM.displayName="HuggingFaceResultItem";const vM=l.memo(({results:e})=>{const{t}=S(),[n,s]=l.useState(""),[r]=vc(),a=l.useMemo(()=>e.filter(u=>{const h=u.split("/").slice(-1)[0];return h==null?void 0:h.toLowerCase().includes(n.toLowerCase())}),[e,n]),i=l.useCallback(u=>{s(u.target.value.trim())},[]),c=l.useCallback(()=>{s("")},[]),d=l.useCallback(()=>{for(const u of a)r({source:u})},[a,r]);return o.jsxs(o.Fragment,{children:[o.jsx(zt,{}),o.jsxs(j,{flexDir:"column",gap:3,height:"100%",children:[o.jsxs(j,{justifyContent:"space-between",alignItems:"center",children:[o.jsx(Ct,{size:"sm",children:t("modelManager.availableModels")}),o.jsxs(j,{alignItems:"center",gap:3,children:[o.jsx(me,{size:"sm",onClick:d,isDisabled:e.length===0,flexShrink:0,children:t("modelManager.installAll")}),o.jsxs(Ur,{w:64,size:"xs",children:[o.jsx(Vt,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:i,size:"xs"}),n&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(Q,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:o.jsx(sn,{}),onClick:c})})]})]})]}),o.jsx(j,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:o.jsx(Nn,{children:o.jsx(j,{flexDir:"column",gap:3,children:a.map(u=>o.jsx(yM,{result:u},u))})})})]})]})});vM.displayName="HuggingFaceResults";const CM=l.memo(()=>{const[e,t]=l.useState(""),[n,s]=l.useState(!1),[r,a]=l.useState(""),{t:i}=S(),[c,{isLoading:d,data:u}]=G8(),[h]=vc(),p=l.useCallback(()=>{c(e).unwrap().then(m=>{var g;m.is_diffusers?(h({source:e}),s(!1)):((g=m.urls)==null?void 0:g.length)===1&&m.urls[0]?(h({source:m.urls[0]}),s(!1)):s(!0)}).catch(m=>{a(m.data.detail||"")})},[c,h,e]),f=l.useCallback(m=>{t(m.target.value),a("")},[]);return o.jsxs(j,{flexDir:"column",height:"100%",gap:3,children:[o.jsxs(V,{isInvalid:!!r.length,w:"full",orientation:"vertical",flexShrink:0,children:[o.jsx(U,{children:i("modelManager.huggingFaceRepoID")}),o.jsxs(j,{gap:3,alignItems:"center",w:"full",children:[o.jsx(Vt,{placeholder:i("modelManager.huggingFacePlaceholder"),value:e,onChange:f}),o.jsx(me,{onClick:p,isLoading:d,isDisabled:e.length===0,size:"sm",flexShrink:0,children:i("modelManager.installRepo")})]}),o.jsx(ko,{children:i("modelManager.huggingFaceHelper")}),!!r.length&&o.jsx(Fp,{children:r})]}),u&&u.urls&&n&&o.jsx(vM,{results:u.urls})]})});CM.displayName="HuggingFaceForm";var ku=e=>e.type==="checkbox",bl=e=>e instanceof Date,ts=e=>e==null;const wM=e=>typeof e=="object";var xn=e=>!ts(e)&&!Array.isArray(e)&&wM(e)&&!bl(e),jM=e=>xn(e)&&e.target?ku(e.target)?e.target.checked:e.target.value:e,dZ=e=>e.substring(0,e.search(/\.\d+(\.|$)/))||e,SM=(e,t)=>e.has(dZ(t)),uZ=e=>{const t=e.constructor&&e.constructor.prototype;return xn(t)&&t.hasOwnProperty("isPrototypeOf")},e1=typeof window<"u"&&typeof window.HTMLElement<"u"&&typeof document<"u";function gs(e){let t;const n=Array.isArray(e);if(e instanceof Date)t=new Date(e);else if(e instanceof Set)t=new Set(e);else if(!(e1&&(e instanceof Blob||e instanceof FileList))&&(n||xn(e)))if(t=n?[]:{},!n&&!uZ(e))t=e;else for(const s in e)e.hasOwnProperty(s)&&(t[s]=gs(e[s]));else return e;return t}var yf=e=>Array.isArray(e)?e.filter(Boolean):[],on=e=>e===void 0,je=(e,t,n)=>{if(!t||!xn(e))return n;const s=yf(t.split(/[,[\].]+?/)).reduce((r,a)=>ts(r)?r:r[a],e);return on(s)||s===e?on(e[t])?n:e[t]:s},eo=e=>typeof e=="boolean",t1=e=>/^\w*$/.test(e),kM=e=>yf(e.replace(/["|']|\]/g,"").split(/\.|\[/)),Nt=(e,t,n)=>{let s=-1;const r=t1(t)?[t]:kM(t),a=r.length,i=a-1;for(;++s<a;){const c=r[s];let d=n;if(s!==i){const u=e[c];d=xn(u)||Array.isArray(u)?u:isNaN(+r[s+1])?{}:[]}if(c==="__proto__")return;e[c]=d,e=e[c]}return e};const hp={BLUR:"blur",FOCUS_OUT:"focusout",CHANGE:"change"},Io={onBlur:"onBlur",onChange:"onChange",onSubmit:"onSubmit",onTouched:"onTouched",all:"all"},Cr={max:"max",min:"min",maxLength:"maxLength",minLength:"minLength",pattern:"pattern",required:"required",validate:"validate"},hZ=te.createContext(null),n1=()=>te.useContext(hZ);var IM=(e,t,n,s=!0)=>{const r={defaultValues:t._defaultValues};for(const a in e)Object.defineProperty(r,a,{get:()=>{const i=a;return t._proxyFormState[i]!==Io.all&&(t._proxyFormState[i]=!s||Io.all),n&&(n[i]=!0),e[i]}});return r},xs=e=>xn(e)&&!Object.keys(e).length,_M=(e,t,n,s)=>{n(e);const{name:r,...a}=e;return xs(a)||Object.keys(a).length>=Object.keys(t).length||Object.keys(a).find(i=>t[i]===(!s||Io.all))},id=e=>Array.isArray(e)?e:[e],MM=(e,t,n)=>!e||!t||e===t||id(e).some(s=>s&&(n?s===t:s.startsWith(t)||t.startsWith(s)));function s1(e){const t=te.useRef(e);t.current=e,te.useEffect(()=>{const n=!e.disabled&&t.current.subject&&t.current.subject.subscribe({next:t.current.next});return()=>{n&&n.unsubscribe()}},[e.disabled])}function pZ(e){const t=n1(),{control:n=t.control,disabled:s,name:r,exact:a}=e||{},[i,c]=te.useState(n._formState),d=te.useRef(!0),u=te.useRef({isDirty:!1,isLoading:!1,dirtyFields:!1,touchedFields:!1,validatingFields:!1,isValidating:!1,isValid:!1,errors:!1}),h=te.useRef(r);return h.current=r,s1({disabled:s,next:p=>d.current&&MM(h.current,p.name,a)&&_M(p,u.current,n._updateFormState)&&c({...n._formState,...p}),subject:n._subjects.state}),te.useEffect(()=>(d.current=!0,u.current.isValid&&n._updateValid(!0),()=>{d.current=!1}),[n]),IM(i,n,u.current,!1)}var er=e=>typeof e=="string",AM=(e,t,n,s,r)=>er(e)?(s&&t.watch.add(e),je(n,e,r)):Array.isArray(e)?e.map(a=>(s&&t.watch.add(a),je(n,a))):(s&&(t.watchAll=!0),n);function fZ(e){const t=n1(),{control:n=t.control,name:s,defaultValue:r,disabled:a,exact:i}=e||{},c=te.useRef(s);c.current=s,s1({disabled:a,subject:n._subjects.values,next:h=>{MM(c.current,h.name,i)&&u(gs(AM(c.current,n._names,h.values||n._formValues,!1,r)))}});const[d,u]=te.useState(n._getWatch(s,r));return te.useEffect(()=>n._removeUnmounted()),d}function Bn(e){const t=n1(),{name:n,disabled:s,control:r=t.control,shouldUnregister:a}=e,i=SM(r._names.array,n),c=fZ({control:r,name:n,defaultValue:je(r._formValues,n,je(r._defaultValues,n,e.defaultValue)),exact:!0}),d=pZ({control:r,name:n,exact:!0}),u=te.useRef(r.register(n,{...e.rules,value:c,...eo(e.disabled)?{disabled:e.disabled}:{}}));return te.useEffect(()=>{const h=r._options.shouldUnregister||a,p=(f,m)=>{const g=je(r._fields,f);g&&g._f&&(g._f.mount=m)};if(p(n,!0),h){const f=gs(je(r._options.defaultValues,n));Nt(r._defaultValues,n,f),on(je(r._formValues,n))&&Nt(r._formValues,n,f)}return()=>{(i?h&&!r._state.action:h)?r.unregister(n):p(n,!1)}},[n,r,i,a]),te.useEffect(()=>{je(r._fields,n)&&r._updateDisabledField({disabled:s,fields:r._fields,name:n,value:je(r._fields,n)._f.value})},[s,n,r]),{field:{name:n,value:c,...eo(s)||d.disabled?{disabled:d.disabled||s}:{},onChange:te.useCallback(h=>u.current.onChange({target:{value:jM(h),name:n},type:hp.CHANGE}),[n]),onBlur:te.useCallback(()=>u.current.onBlur({target:{value:je(r._formValues,n),name:n},type:hp.BLUR}),[n,r]),ref:te.useCallback(h=>{const p=je(r._fields,n);p&&h&&(p._f.ref={focus:()=>h.focus(),select:()=>h.select(),setCustomValidity:f=>h.setCustomValidity(f),reportValidity:()=>h.reportValidity()})},[r._fields,n])},formState:d,fieldState:Object.defineProperties({},{invalid:{enumerable:!0,get:()=>!!je(d.errors,n)},isDirty:{enumerable:!0,get:()=>!!je(d.dirtyFields,n)},isTouched:{enumerable:!0,get:()=>!!je(d.touchedFields,n)},isValidating:{enumerable:!0,get:()=>!!je(d.validatingFields,n)},error:{enumerable:!0,get:()=>je(d.errors,n)}})}}var mZ=(e,t,n,s,r)=>t?{...n[e],types:{...n[e]&&n[e].types?n[e].types:{},[s]:r||!0}}:{},Xv=e=>({isOnSubmit:!e||e===Io.onSubmit,isOnBlur:e===Io.onBlur,isOnChange:e===Io.onChange,isOnAll:e===Io.all,isOnTouch:e===Io.onTouched}),eC=(e,t,n)=>!n&&(t.watchAll||t.watch.has(e)||[...t.watch].some(s=>e.startsWith(s)&&/^\.\w+/.test(e.slice(s.length))));const ld=(e,t,n,s)=>{for(const r of n||Object.keys(e)){const a=je(e,r);if(a){const{_f:i,...c}=a;if(i){if(i.refs&&i.refs[0]&&t(i.refs[0],r)&&!s)return!0;if(i.ref&&t(i.ref,i.name)&&!s)return!0;if(ld(c,t))break}else if(xn(c)&&ld(c,t))break}}};var gZ=(e,t,n)=>{const s=id(je(e,n));return Nt(s,"root",t[n]),Nt(e,n,s),e},o1=e=>e.type==="file",Dr=e=>typeof e=="function",pp=e=>{if(!e1)return!1;const t=e?e.ownerDocument:0;return e instanceof(t&&t.defaultView?t.defaultView.HTMLElement:HTMLElement)},Lh=e=>er(e),r1=e=>e.type==="radio",fp=e=>e instanceof RegExp;const tC={value:!1,isValid:!1},nC={value:!0,isValid:!0};var EM=e=>{if(Array.isArray(e)){if(e.length>1){const t=e.filter(n=>n&&n.checked&&!n.disabled).map(n=>n.value);return{value:t,isValid:!!t.length}}return e[0].checked&&!e[0].disabled?e[0].attributes&&!on(e[0].attributes.value)?on(e[0].value)||e[0].value===""?nC:{value:e[0].value,isValid:!0}:nC:tC}return tC};const sC={isValid:!1,value:null};var LM=e=>Array.isArray(e)?e.reduce((t,n)=>n&&n.checked&&!n.disabled?{isValid:!0,value:n.value}:t,sC):sC;function oC(e,t,n="validate"){if(Lh(e)||Array.isArray(e)&&e.every(Lh)||eo(e)&&!e)return{type:n,message:Lh(e)?e:"",ref:t}}var Gi=e=>xn(e)&&!fp(e)?e:{value:e,message:""},rC=async(e,t,n,s,r)=>{const{ref:a,refs:i,required:c,maxLength:d,minLength:u,min:h,max:p,pattern:f,validate:m,name:g,valueAsNumber:x,mount:C,disabled:y}=e._f,v=je(t,g);if(!C||y)return{};const I=i?i[0]:a,k=W=>{s&&I.reportValidity&&(I.setCustomValidity(eo(W)?"":W||""),I.reportValidity())},M={},_=r1(a),A=ku(a),D=_||A,N=(x||o1(a))&&on(a.value)&&on(v)||pp(a)&&a.value===""||v===""||Array.isArray(v)&&!v.length,P=mZ.bind(null,g,n,M),z=(W,X,ee,G=Cr.maxLength,re=Cr.minLength)=>{const le=W?X:ee;M[g]={type:W?G:re,message:le,ref:a,...P(W?G:re,le)}};if(r?!Array.isArray(v)||!v.length:c&&(!D&&(N||ts(v))||eo(v)&&!v||A&&!EM(i).isValid||_&&!LM(i).isValid)){const{value:W,message:X}=Lh(c)?{value:!!c,message:c}:Gi(c);if(W&&(M[g]={type:Cr.required,message:X,ref:I,...P(Cr.required,X)},!n))return k(X),M}if(!N&&(!ts(h)||!ts(p))){let W,X;const ee=Gi(p),G=Gi(h);if(!ts(v)&&!isNaN(v)){const re=a.valueAsNumber||v&&+v;ts(ee.value)||(W=re>ee.value),ts(G.value)||(X=re<G.value)}else{const re=a.valueAsDate||new Date(v),le=ye=>new Date(new Date().toDateString()+" "+ye),Ce=a.type=="time",be=a.type=="week";er(ee.value)&&v&&(W=Ce?le(v)>le(ee.value):be?v>ee.value:re>new Date(ee.value)),er(G.value)&&v&&(X=Ce?le(v)<le(G.value):be?v<G.value:re<new Date(G.value))}if((W||X)&&(z(!!W,ee.message,G.message,Cr.max,Cr.min),!n))return k(M[g].message),M}if((d||u)&&!N&&(er(v)||r&&Array.isArray(v))){const W=Gi(d),X=Gi(u),ee=!ts(W.value)&&v.length>+W.value,G=!ts(X.value)&&v.length<+X.value;if((ee||G)&&(z(ee,W.message,X.message),!n))return k(M[g].message),M}if(f&&!N&&er(v)){const{value:W,message:X}=Gi(f);if(fp(W)&&!v.match(W)&&(M[g]={type:Cr.pattern,message:X,ref:a,...P(Cr.pattern,X)},!n))return k(X),M}if(m){if(Dr(m)){const W=await m(v,t),X=oC(W,I);if(X&&(M[g]={...X,...P(Cr.validate,X.message)},!n))return k(X.message),M}else if(xn(m)){let W={};for(const X in m){if(!xs(W)&&!n)break;const ee=oC(await m[X](v,t),I,X);ee&&(W={...ee,...P(X,ee.message)},k(ee.message),n&&(M[g]=W))}if(!xs(W)&&(M[g]={ref:I,...W},!n))return M}}return k(!0),M};function xZ(e,t){const n=t.slice(0,-1).length;let s=0;for(;s<n;)e=on(e)?s++:e[t[s++]];return e}function bZ(e){for(const t in e)if(e.hasOwnProperty(t)&&!on(e[t]))return!1;return!0}function wn(e,t){const n=Array.isArray(t)?t:t1(t)?[t]:kM(t),s=n.length===1?e:xZ(e,n),r=n.length-1,a=n[r];return s&&delete s[a],r!==0&&(xn(s)&&xs(s)||Array.isArray(s)&&bZ(s))&&wn(e,n.slice(0,-1)),e}var $m=()=>{let e=[];return{get observers(){return e},next:r=>{for(const a of e)a.next&&a.next(r)},subscribe:r=>(e.push(r),{unsubscribe:()=>{e=e.filter(a=>a!==r)}}),unsubscribe:()=>{e=[]}}},mp=e=>ts(e)||!wM(e);function ua(e,t){if(mp(e)||mp(t))return e===t;if(bl(e)&&bl(t))return e.getTime()===t.getTime();const n=Object.keys(e),s=Object.keys(t);if(n.length!==s.length)return!1;for(const r of n){const a=e[r];if(!s.includes(r))return!1;if(r!=="ref"){const i=t[r];if(bl(a)&&bl(i)||xn(a)&&xn(i)||Array.isArray(a)&&Array.isArray(i)?!ua(a,i):a!==i)return!1}}return!0}var TM=e=>e.type==="select-multiple",yZ=e=>r1(e)||ku(e),Fm=e=>pp(e)&&e.isConnected,PM=e=>{for(const t in e)if(Dr(e[t]))return!0;return!1};function gp(e,t={}){const n=Array.isArray(e);if(xn(e)||n)for(const s in e)Array.isArray(e[s])||xn(e[s])&&!PM(e[s])?(t[s]=Array.isArray(e[s])?[]:{},gp(e[s],t[s])):ts(e[s])||(t[s]=!0);return t}function RM(e,t,n){const s=Array.isArray(e);if(xn(e)||s)for(const r in e)Array.isArray(e[r])||xn(e[r])&&!PM(e[r])?on(t)||mp(n[r])?n[r]=Array.isArray(e[r])?gp(e[r],[]):{...gp(e[r])}:RM(e[r],ts(t)?{}:t[r],n[r]):n[r]=!ua(e[r],t[r]);return n}var sh=(e,t)=>RM(e,t,gp(t)),DM=(e,{valueAsNumber:t,valueAsDate:n,setValueAs:s})=>on(e)?e:t?e===""?NaN:e&&+e:n&&er(e)?new Date(e):s?s(e):e;function zm(e){const t=e.ref;if(!(e.refs?e.refs.every(n=>n.disabled):t.disabled))return o1(t)?t.files:r1(t)?LM(e.refs).value:TM(t)?[...t.selectedOptions].map(({value:n})=>n):ku(t)?EM(e.refs).value:DM(on(t.value)?e.ref.value:t.value,e)}var vZ=(e,t,n,s)=>{const r={};for(const a of e){const i=je(t,a);i&&Nt(r,a,i._f)}return{criteriaMode:n,names:[...e],fields:r,shouldUseNativeValidation:s}},Hc=e=>on(e)?e:fp(e)?e.source:xn(e)?fp(e.value)?e.value.source:e.value:e;const aC="AsyncFunction";var CZ=e=>(!e||!e.validate)&&!!(Dr(e.validate)&&e.validate.constructor.name===aC||xn(e.validate)&&Object.values(e.validate).find(t=>t.constructor.name===aC)),wZ=e=>e.mount&&(e.required||e.min||e.max||e.maxLength||e.minLength||e.pattern||e.validate);function iC(e,t,n){const s=je(e,n);if(s||t1(n))return{error:s,name:n};const r=n.split(".");for(;r.length;){const a=r.join("."),i=je(t,a),c=je(e,a);if(i&&!Array.isArray(i)&&n!==a)return{name:n};if(c&&c.type)return{name:a,error:c};r.pop()}return{name:n}}var jZ=(e,t,n,s,r)=>r.isOnAll?!1:!n&&r.isOnTouch?!(t||e):(n?s.isOnBlur:r.isOnBlur)?!e:(n?s.isOnChange:r.isOnChange)?e:!0,SZ=(e,t)=>!yf(je(e,t)).length&&wn(e,t);const kZ={mode:Io.onSubmit,reValidateMode:Io.onChange,shouldFocusError:!0};function IZ(e={}){let t={...kZ,...e},n={submitCount:0,isDirty:!1,isLoading:Dr(t.defaultValues),isValidating:!1,isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,touchedFields:{},dirtyFields:{},validatingFields:{},errors:t.errors||{},disabled:t.disabled||!1},s={},r=xn(t.defaultValues)||xn(t.values)?gs(t.defaultValues||t.values)||{}:{},a=t.shouldUnregister?{}:gs(r),i={action:!1,mount:!1,watch:!1},c={mount:new Set,unMount:new Set,array:new Set,watch:new Set},d,u=0;const h={isDirty:!1,dirtyFields:!1,validatingFields:!1,touchedFields:!1,isValidating:!1,isValid:!1,errors:!1},p={values:$m(),array:$m(),state:$m()},f=Xv(t.mode),m=Xv(t.reValidateMode),g=t.criteriaMode===Io.all,x=T=>H=>{clearTimeout(u),u=setTimeout(T,H)},C=async T=>{if(h.isValid||T){const H=t.resolver?xs((await D()).errors):await P(s,!0);H!==n.isValid&&p.state.next({isValid:H})}},y=(T,H)=>{(h.isValidating||h.validatingFields)&&((T||Array.from(c.mount)).forEach(q=>{q&&(H?Nt(n.validatingFields,q,H):wn(n.validatingFields,q))}),p.state.next({validatingFields:n.validatingFields,isValidating:!xs(n.validatingFields)}))},v=(T,H=[],q,de,ce=!0,ie=!0)=>{if(de&&q){if(i.action=!0,ie&&Array.isArray(je(s,T))){const J=q(je(s,T),de.argA,de.argB);ce&&Nt(s,T,J)}if(ie&&Array.isArray(je(n.errors,T))){const J=q(je(n.errors,T),de.argA,de.argB);ce&&Nt(n.errors,T,J),SZ(n.errors,T)}if(h.touchedFields&&ie&&Array.isArray(je(n.touchedFields,T))){const J=q(je(n.touchedFields,T),de.argA,de.argB);ce&&Nt(n.touchedFields,T,J)}h.dirtyFields&&(n.dirtyFields=sh(r,a)),p.state.next({name:T,isDirty:W(T,H),dirtyFields:n.dirtyFields,errors:n.errors,isValid:n.isValid})}else Nt(a,T,H)},I=(T,H)=>{Nt(n.errors,T,H),p.state.next({errors:n.errors})},k=T=>{n.errors=T,p.state.next({errors:n.errors,isValid:!1})},M=(T,H,q,de)=>{const ce=je(s,T);if(ce){const ie=je(a,T,on(q)?je(r,T):q);on(ie)||de&&de.defaultChecked||H?Nt(a,T,H?ie:zm(ce._f)):G(T,ie),i.mount&&C()}},_=(T,H,q,de,ce)=>{let ie=!1,J=!1;const ge={name:T},Ue=!!(je(s,T)&&je(s,T)._f&&je(s,T)._f.disabled);if(!q||de){h.isDirty&&(J=n.isDirty,n.isDirty=ge.isDirty=W(),ie=J!==ge.isDirty);const Ke=Ue||ua(je(r,T),H);J=!!(!Ue&&je(n.dirtyFields,T)),Ke||Ue?wn(n.dirtyFields,T):Nt(n.dirtyFields,T,!0),ge.dirtyFields=n.dirtyFields,ie=ie||h.dirtyFields&&J!==!Ke}if(q){const Ke=je(n.touchedFields,T);Ke||(Nt(n.touchedFields,T,q),ge.touchedFields=n.touchedFields,ie=ie||h.touchedFields&&Ke!==q)}return ie&&ce&&p.state.next(ge),ie?ge:{}},A=(T,H,q,de)=>{const ce=je(n.errors,T),ie=h.isValid&&eo(H)&&n.isValid!==H;if(e.delayError&&q?(d=x(()=>I(T,q)),d(e.delayError)):(clearTimeout(u),d=null,q?Nt(n.errors,T,q):wn(n.errors,T)),(q?!ua(ce,q):ce)||!xs(de)||ie){const J={...de,...ie&&eo(H)?{isValid:H}:{},errors:n.errors,name:T};n={...n,...J},p.state.next(J)}},D=async T=>{y(T,!0);const H=await t.resolver(a,t.context,vZ(T||c.mount,s,t.criteriaMode,t.shouldUseNativeValidation));return y(T),H},N=async T=>{const{errors:H}=await D(T);if(T)for(const q of T){const de=je(H,q);de?Nt(n.errors,q,de):wn(n.errors,q)}else n.errors=H;return H},P=async(T,H,q={valid:!0})=>{for(const de in T){const ce=T[de];if(ce){const{_f:ie,...J}=ce;if(ie){const ge=c.array.has(ie.name),Ue=ce._f&&CZ(ce._f);Ue&&h.validatingFields&&y([de],!0);const Ke=await rC(ce,a,g,t.shouldUseNativeValidation&&!H,ge);if(Ue&&h.validatingFields&&y([de]),Ke[ie.name]&&(q.valid=!1,H))break;!H&&(je(Ke,ie.name)?ge?gZ(n.errors,Ke,ie.name):Nt(n.errors,ie.name,Ke[ie.name]):wn(n.errors,ie.name))}!xs(J)&&await P(J,H,q)}}return q.valid},z=()=>{for(const T of c.unMount){const H=je(s,T);H&&(H._f.refs?H._f.refs.every(q=>!Fm(q)):!Fm(H._f.ref))&&K(T)}c.unMount=new Set},W=(T,H)=>(T&&H&&Nt(a,T,H),!ua(ne(),r)),X=(T,H,q)=>AM(T,c,{...i.mount?a:on(H)?r:er(T)?{[T]:H}:H},q,H),ee=T=>yf(je(i.mount?a:r,T,e.shouldUnregister?je(r,T,[]):[])),G=(T,H,q={})=>{const de=je(s,T);let ce=H;if(de){const ie=de._f;ie&&(!ie.disabled&&Nt(a,T,DM(H,ie)),ce=pp(ie.ref)&&ts(H)?"":H,TM(ie.ref)?[...ie.ref.options].forEach(J=>J.selected=ce.includes(J.value)):ie.refs?ku(ie.ref)?ie.refs.length>1?ie.refs.forEach(J=>(!J.defaultChecked||!J.disabled)&&(J.checked=Array.isArray(ce)?!!ce.find(ge=>ge===J.value):ce===J.value)):ie.refs[0]&&(ie.refs[0].checked=!!ce):ie.refs.forEach(J=>J.checked=J.value===ce):o1(ie.ref)?ie.ref.value="":(ie.ref.value=ce,ie.ref.type||p.values.next({name:T,values:{...a}})))}(q.shouldDirty||q.shouldTouch)&&_(T,ce,q.shouldTouch,q.shouldDirty,!0),q.shouldValidate&&ye(T)},re=(T,H,q)=>{for(const de in H){const ce=H[de],ie=`${T}.${de}`,J=je(s,ie);(c.array.has(T)||!mp(ce)||J&&!J._f)&&!bl(ce)?re(ie,ce,q):G(ie,ce,q)}},le=(T,H,q={})=>{const de=je(s,T),ce=c.array.has(T),ie=gs(H);Nt(a,T,ie),ce?(p.array.next({name:T,values:{...a}}),(h.isDirty||h.dirtyFields)&&q.shouldDirty&&p.state.next({name:T,dirtyFields:sh(r,a),isDirty:W(T,ie)})):de&&!de._f&&!ts(ie)?re(T,ie,q):G(T,ie,q),eC(T,c)&&p.state.next({...n}),p.values.next({name:i.mount?T:void 0,values:{...a}})},Ce=async T=>{i.mount=!0;const H=T.target;let q=H.name,de=!0;const ce=je(s,q),ie=()=>H.type?zm(ce._f):jM(T),J=ge=>{de=Number.isNaN(ge)||ua(ge,je(a,q,ge))};if(ce){let ge,Ue;const Ke=ie(),vt=T.type===hp.BLUR||T.type===hp.FOCUS_OUT,In=!wZ(ce._f)&&!t.resolver&&!je(n.errors,q)&&!ce._f.deps||jZ(vt,je(n.touchedFields,q),n.isSubmitted,m,f),an=eC(q,c,vt);Nt(a,q,Ke),vt?(ce._f.onBlur&&ce._f.onBlur(T),d&&d(0)):ce._f.onChange&&ce._f.onChange(T);const Fn=_(q,Ke,vt,!1),_s=!xs(Fn)||an;if(!vt&&p.values.next({name:q,type:T.type,values:{...a}}),In)return h.isValid&&(e.mode==="onBlur"?vt&&C():C()),_s&&p.state.next({name:q,...an?{}:Fn});if(!vt&&an&&p.state.next({...n}),t.resolver){const{errors:qs}=await D([q]);if(J(Ke),de){const Ks=iC(n.errors,s,q),Cn=iC(qs,s,Ks.name||q);ge=Cn.error,q=Cn.name,Ue=xs(qs)}}else y([q],!0),ge=(await rC(ce,a,g,t.shouldUseNativeValidation))[q],y([q]),J(Ke),de&&(ge?Ue=!1:h.isValid&&(Ue=await P(s,!0)));de&&(ce._f.deps&&ye(ce._f.deps),A(q,Ue,ge,Fn))}},be=(T,H)=>{if(je(n.errors,H)&&T.focus)return T.focus(),1},ye=async(T,H={})=>{let q,de;const ce=id(T);if(t.resolver){const ie=await N(on(T)?T:ce);q=xs(ie),de=T?!ce.some(J=>je(ie,J)):q}else T?(de=(await Promise.all(ce.map(async ie=>{const J=je(s,ie);return await P(J&&J._f?{[ie]:J}:J)}))).every(Boolean),!(!de&&!n.isValid)&&C()):de=q=await P(s);return p.state.next({...!er(T)||h.isValid&&q!==n.isValid?{}:{name:T},...t.resolver||!T?{isValid:q}:{},errors:n.errors}),H.shouldFocus&&!de&&ld(s,be,T?ce:c.mount),de},ne=T=>{const H={...i.mount?a:r};return on(T)?H:er(T)?je(H,T):T.map(q=>je(H,q))},R=(T,H)=>({invalid:!!je((H||n).errors,T),isDirty:!!je((H||n).dirtyFields,T),error:je((H||n).errors,T),isValidating:!!je(n.validatingFields,T),isTouched:!!je((H||n).touchedFields,T)}),F=T=>{T&&id(T).forEach(H=>wn(n.errors,H)),p.state.next({errors:T?n.errors:{}})},Z=(T,H,q)=>{const de=(je(s,T,{_f:{}})._f||{}).ref,ce=je(n.errors,T)||{},{ref:ie,message:J,type:ge,...Ue}=ce;Nt(n.errors,T,{...Ue,...H,ref:de}),p.state.next({name:T,errors:n.errors,isValid:!1}),q&&q.shouldFocus&&de&&de.focus&&de.focus()},B=(T,H)=>Dr(T)?p.values.subscribe({next:q=>T(X(void 0,H),q)}):X(T,H,!0),K=(T,H={})=>{for(const q of T?id(T):c.mount)c.mount.delete(q),c.array.delete(q),H.keepValue||(wn(s,q),wn(a,q)),!H.keepError&&wn(n.errors,q),!H.keepDirty&&wn(n.dirtyFields,q),!H.keepTouched&&wn(n.touchedFields,q),!H.keepIsValidating&&wn(n.validatingFields,q),!t.shouldUnregister&&!H.keepDefaultValue&&wn(r,q);p.values.next({values:{...a}}),p.state.next({...n,...H.keepDirty?{isDirty:W()}:{}}),!H.keepIsValid&&C()},$=({disabled:T,name:H,field:q,fields:de,value:ce})=>{if(eo(T)&&i.mount||T){const ie=T?void 0:on(ce)?zm(q?q._f:je(de,H)._f):ce;Nt(a,H,ie),_(H,ie,!1,!1,!0)}},Y=(T,H={})=>{let q=je(s,T);const de=eo(H.disabled)||eo(e.disabled);return Nt(s,T,{...q||{},_f:{...q&&q._f?q._f:{ref:{name:T}},name:T,mount:!0,...H}}),c.mount.add(T),q?$({field:q,disabled:eo(H.disabled)?H.disabled:e.disabled,name:T,value:H.value}):M(T,!0,H.value),{...de?{disabled:H.disabled||e.disabled}:{},...t.progressive?{required:!!H.required,min:Hc(H.min),max:Hc(H.max),minLength:Hc(H.minLength),maxLength:Hc(H.maxLength),pattern:Hc(H.pattern)}:{},name:T,onChange:Ce,onBlur:Ce,ref:ce=>{if(ce){Y(T,H),q=je(s,T);const ie=on(ce.value)&&ce.querySelectorAll&&ce.querySelectorAll("input,select,textarea")[0]||ce,J=yZ(ie),ge=q._f.refs||[];if(J?ge.find(Ue=>Ue===ie):ie===q._f.ref)return;Nt(s,T,{_f:{...q._f,...J?{refs:[...ge.filter(Fm),ie,...Array.isArray(je(r,T))?[{}]:[]],ref:{type:ie.type,name:T}}:{ref:ie}}}),M(T,!1,void 0,ie)}else q=je(s,T,{}),q._f&&(q._f.mount=!1),(t.shouldUnregister||H.shouldUnregister)&&!(SM(c.array,T)&&i.action)&&c.unMount.add(T)}}},ae=()=>t.shouldFocusError&&ld(s,be,c.mount),ue=T=>{eo(T)&&(p.state.next({disabled:T}),ld(s,(H,q)=>{const de=je(s,q);de&&(H.disabled=de._f.disabled||T,Array.isArray(de._f.refs)&&de._f.refs.forEach(ce=>{ce.disabled=de._f.disabled||T}))},0,!1))},Re=(T,H)=>async q=>{let de;q&&(q.preventDefault&&q.preventDefault(),q.persist&&q.persist());let ce=gs(a);if(p.state.next({isSubmitting:!0}),t.resolver){const{errors:ie,values:J}=await D();n.errors=ie,ce=J}else await P(s);if(wn(n.errors,"root"),xs(n.errors)){p.state.next({errors:{}});try{await T(ce,q)}catch(ie){de=ie}}else H&&await H({...n.errors},q),ae(),setTimeout(ae);if(p.state.next({isSubmitted:!0,isSubmitting:!1,isSubmitSuccessful:xs(n.errors)&&!de,submitCount:n.submitCount+1,errors:n.errors}),de)throw de},we=(T,H={})=>{je(s,T)&&(on(H.defaultValue)?le(T,gs(je(r,T))):(le(T,H.defaultValue),Nt(r,T,gs(H.defaultValue))),H.keepTouched||wn(n.touchedFields,T),H.keepDirty||(wn(n.dirtyFields,T),n.isDirty=H.defaultValue?W(T,gs(je(r,T))):W()),H.keepError||(wn(n.errors,T),h.isValid&&C()),p.state.next({...n}))},De=(T,H={})=>{const q=T?gs(T):r,de=gs(q),ce=xs(T),ie=ce?r:de;if(H.keepDefaultValues||(r=q),!H.keepValues){if(H.keepDirtyValues)for(const J of c.mount)je(n.dirtyFields,J)?Nt(ie,J,je(a,J)):le(J,je(ie,J));else{if(e1&&on(T))for(const J of c.mount){const ge=je(s,J);if(ge&&ge._f){const Ue=Array.isArray(ge._f.refs)?ge._f.refs[0]:ge._f.ref;if(pp(Ue)){const Ke=Ue.closest("form");if(Ke){Ke.reset();break}}}}s={}}a=e.shouldUnregister?H.keepDefaultValues?gs(r):{}:gs(ie),p.array.next({values:{...ie}}),p.values.next({values:{...ie}})}c={mount:H.keepDirtyValues?c.mount:new Set,unMount:new Set,array:new Set,watch:new Set,watchAll:!1,focus:""},i.mount=!h.isValid||!!H.keepIsValid||!!H.keepDirtyValues,i.watch=!!e.shouldUnregister,p.state.next({submitCount:H.keepSubmitCount?n.submitCount:0,isDirty:ce?!1:H.keepDirty?n.isDirty:!!(H.keepDefaultValues&&!ua(T,r)),isSubmitted:H.keepIsSubmitted?n.isSubmitted:!1,dirtyFields:ce?{}:H.keepDirtyValues?H.keepDefaultValues&&a?sh(r,a):n.dirtyFields:H.keepDefaultValues&&T?sh(r,T):H.keepDirty?n.dirtyFields:{},touchedFields:H.keepTouched?n.touchedFields:{},errors:H.keepErrors?n.errors:{},isSubmitSuccessful:H.keepIsSubmitSuccessful?n.isSubmitSuccessful:!1,isSubmitting:!1})},Me=(T,H)=>De(Dr(T)?T(a):T,H);return{control:{register:Y,unregister:K,getFieldState:R,handleSubmit:Re,setError:Z,_executeSchema:D,_getWatch:X,_getDirty:W,_updateValid:C,_removeUnmounted:z,_updateFieldArray:v,_updateDisabledField:$,_getFieldArray:ee,_reset:De,_resetDefaultValues:()=>Dr(t.defaultValues)&&t.defaultValues().then(T=>{Me(T,t.resetOptions),p.state.next({isLoading:!1})}),_updateFormState:T=>{n={...n,...T}},_disableForm:ue,_subjects:p,_proxyFormState:h,_setErrors:k,get _fields(){return s},get _formValues(){return a},get _state(){return i},set _state(T){i=T},get _defaultValues(){return r},get _names(){return c},set _names(T){c=T},get _formState(){return n},set _formState(T){n=T},get _options(){return t},set _options(T){t={...t,...T}}},trigger:ye,register:Y,handleSubmit:Re,watch:B,setValue:le,getValues:ne,reset:Me,resetField:we,clearErrors:F,unregister:K,setError:Z,setFocus:(T,H={})=>{const q=je(s,T),de=q&&q._f;if(de){const ce=de.refs?de.refs[0]:de.ref;ce.focus&&(ce.focus(),H.shouldSelect&&ce.select())}},getFieldState:R}}function Iu(e={}){const t=te.useRef(),n=te.useRef(),[s,r]=te.useState({isDirty:!1,isValidating:!1,isLoading:Dr(e.defaultValues),isSubmitted:!1,isSubmitting:!1,isSubmitSuccessful:!1,isValid:!1,submitCount:0,dirtyFields:{},touchedFields:{},validatingFields:{},errors:e.errors||{},disabled:e.disabled||!1,defaultValues:Dr(e.defaultValues)?void 0:e.defaultValues});t.current||(t.current={...IZ(e),formState:s});const a=t.current.control;return a._options=e,s1({subject:a._subjects.state,next:i=>{_M(i,a._proxyFormState,a._updateFormState,!0)&&r({...a._formState})}}),te.useEffect(()=>a._disableForm(e.disabled),[a,e.disabled]),te.useEffect(()=>{if(a._proxyFormState.isDirty){const i=a._getDirty();i!==s.isDirty&&a._subjects.state.next({isDirty:i})}},[a,s.isDirty]),te.useEffect(()=>{e.values&&!ua(e.values,n.current)?(a._reset(e.values,a._options.resetOptions),n.current=e.values,r(i=>({...i}))):a._resetDefaultValues()},[e.values,a]),te.useEffect(()=>{e.errors&&a._setErrors(e.errors)},[e.errors,a]),te.useEffect(()=>{a._state.mount||(a._updateValid(),a._state.mount=!0),a._state.watch&&(a._state.watch=!1,a._subjects.state.next({...a._formState})),a._removeUnmounted()}),te.useEffect(()=>{e.shouldUnregister&&a._subjects.values.next({values:a._getWatch()})},[e.shouldUnregister,a]),t.current.formState=IM(s,a),t.current}const OM=l.memo(()=>{const[e,{isLoading:t}]=vc(),{register:n,handleSubmit:s,formState:r,reset:a}=Iu({defaultValues:{location:"",inplace:!0},mode:"onChange"}),i=l.useCallback(()=>a(void 0,{keepValues:!0}),[a]),c=l.useCallback(d=>{d!=null&&d.location&&e({source:d.location,inplace:d.inplace,onSuccess:i,onError:i})},[e,i]);return o.jsx("form",{onSubmit:s(c),children:o.jsxs(j,{flexDir:"column",gap:4,children:[o.jsx(j,{gap:2,alignItems:"flex-end",justifyContent:"space-between",children:o.jsxs(V,{orientation:"vertical",children:[o.jsx(U,{children:ve("modelManager.urlOrLocalPath")}),o.jsxs(j,{alignItems:"center",gap:3,w:"full",children:[o.jsx(Vt,{placeholder:ve("modelManager.simpleModelPlaceholder"),...n("location")}),o.jsx(me,{onClick:s(c),isDisabled:!r.dirtyFields.location,isLoading:t,size:"sm",children:ve("modelManager.install")})]}),o.jsx(ko,{children:ve("modelManager.urlOrLocalPathHelper")})]})}),o.jsx(V,{children:o.jsxs(j,{flexDir:"column",gap:2,children:[o.jsxs(j,{gap:4,children:[o.jsx(kn,{...n("inplace")}),o.jsxs(U,{children:[ve("modelManager.inplaceInstall")," (",ve("modelManager.localOnly"),")"]})]}),o.jsx(ko,{children:ve("modelManager.inplaceInstallDesc")})]})})]})})});OM.displayName="InstallModelForm";const Vm={waiting:{colorScheme:"cyan",translationKey:"queue.pending"},downloading:{colorScheme:"yellow",translationKey:"queue.in_progress"},downloads_done:{colorScheme:"yellow",translationKey:"queue.in_progress"},running:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},error:{colorScheme:"red",translationKey:"queue.failed"},cancelled:{colorScheme:"orange",translationKey:"queue.canceled"}},_Z=({status:e})=>{const{t}=S();return!e||!Object.keys(Vm).includes(e)?null:o.jsx(Rn,{textAlign:"center",w:"134px",colorScheme:Vm[e].colorScheme,children:t(Vm[e].translationKey)})},MZ=l.memo(_Z),lC=e=>{const t=["B","KB","MB","GB","TB"];let n=0;for(n;e>=1024&&n<4;n++)e/=1024;return`${e.toFixed(2)} ${t[n]}`},NM=l.memo(e=>{const{installJob:t}=e,[n]=U8(),s=l.useCallback(()=>{n(t.id).unwrap().then(c=>{he({id:"MODEL_INSTALL_CANCELED",title:ve("toast.modelImportCanceled"),status:"success"})}).catch(c=>{c&&he({id:"MODEL_INSTALL_CANCEL_FAILED",title:`${c.data.detail} `,status:"error"})})},[n,t]),r=l.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url;case"local":return t.source.path;default:return ve("common.unknown")}},[t.source]),a=l.useMemo(()=>{switch(t.source.type){case"hf":return t.source.repo_id;case"url":return t.source.url.split("/").slice(-1)[0]??ve("common.unknown");case"local":return t.source.path.split("\\").slice(-1)[0]??ve("common.unknown");default:return ve("common.unknown")}},[t.source]),i=l.useMemo(()=>t.status==="completed"||t.status==="error"||t.status==="cancelled"?100:Ut(t.bytes)||Ut(t.total_bytes)?null:t.total_bytes===0?0:t.bytes/t.total_bytes*100,[t.bytes,t.status,t.total_bytes]);return o.jsxs(j,{gap:3,w:"full",alignItems:"center",children:[o.jsx(Ae,{maxW:600,label:o.jsx(BM,{name:a,source:r,installJob:t}),children:o.jsxs(j,{gap:3,w:"full",alignItems:"center",children:[o.jsx(O,{w:96,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",children:a}),o.jsx(Cj,{w:"full",flexGrow:1,value:i??0,isIndeterminate:i===null,"aria-label":ve("accessibility.invokeProgressBar"),h:2}),o.jsx(MZ,{status:t.status})]})}),o.jsx(Q,{isDisabled:t.status!=="downloading"&&t.status!=="waiting"&&t.status!=="running",size:"xs",tooltip:ve("modelManager.cancel"),"aria-label":ve("modelManager.cancel"),icon:o.jsx(sn,{}),onClick:s,variant:"ghost"})]})});NM.displayName="ModelInstallQueueItem";const BM=l.memo(({name:e,source:t,installJob:n})=>{const s=l.useMemo(()=>n.status!=="downloading"||n.bytes===void 0||n.total_bytes===void 0?"":`${lC(n.bytes)} / ${lC(n.total_bytes)}`,[n.bytes,n.total_bytes,n.status]);return o.jsxs(o.Fragment,{children:[o.jsxs(j,{gap:3,justifyContent:"space-between",children:[o.jsx(O,{fontWeight:"semibold",children:e}),s&&o.jsx(O,{children:s})]}),o.jsx(O,{fontStyle:"italic",wordBreak:"break-all",children:t}),n.error_reason&&o.jsxs(O,{color:"error.500",children:[ve("queue.failed"),": ",n.error]})]})});BM.displayName="TooltipLabel";const $M=l.memo(()=>{const{data:e}=Z8(),[t]=q8(),n=l.useCallback(()=>{t().unwrap().then(r=>{he({id:"MODEL_INSTALL_QUEUE_PRUNED",title:ve("toast.prunedQueue"),status:"success"})}).catch(r=>{r&&he({id:"MODEL_INSTALL_QUEUE_PRUNE_FAILED",title:`${r.data.detail} `,status:"error"})})},[t]),s=l.useMemo(()=>e==null?void 0:e.some(r=>r.status==="cancelled"||r.status==="error"||r.status==="completed"),[e]);return o.jsxs(j,{flexDir:"column",p:3,h:"full",gap:3,children:[o.jsxs(j,{justifyContent:"space-between",alignItems:"center",children:[o.jsx(Ct,{size:"sm",children:ve("modelManager.installQueue")}),o.jsx(me,{size:"sm",isDisabled:!s,onClick:n,tooltip:ve("modelManager.pruneTooltip"),children:ve("modelManager.prune")})]}),o.jsx(xe,{layerStyle:"first",p:3,borderRadius:"base",w:"full",h:"full",children:o.jsx(Nn,{children:o.jsx(j,{flexDir:"column-reverse",gap:"2",w:"full",children:e==null?void 0:e.map(r=>o.jsx(NM,{installJob:r},r.id))})})})]})});$M.displayName="ModelInstallQueue";const FM=l.memo(({result:e,installModel:t})=>{const{t:n}=S(),s=l.useCallback(()=>{t(e.path)},[t,e]);return o.jsxs(j,{alignItems:"center",justifyContent:"space-between",w:"100%",gap:3,children:[o.jsxs(j,{fontSize:"sm",flexDir:"column",children:[o.jsx(O,{fontWeight:"semibold",children:e.path.split("\\").slice(-1)[0]}),o.jsx(O,{variant:"subtext",children:e.path})]}),o.jsx(xe,{children:e.is_installed?o.jsx(Rn,{children:n("common.installed")}):o.jsx(Q,{"aria-label":n("modelManager.install"),icon:o.jsx(Bt,{}),onClick:s,size:"sm"})})]})});FM.displayName="ScanModelResultItem";const zM=l.memo(({results:e})=>{const{t}=S(),[n,s]=l.useState(""),[r,a]=l.useState(!0),[i]=vc(),c=l.useMemo(()=>e.filter(m=>{const g=m.path.split("\\").slice(-1)[0];return g==null?void 0:g.toLowerCase().includes(n.toLowerCase())}),[e,n]),d=l.useCallback(m=>{s(m.target.value.trim())},[]),u=l.useCallback(m=>{a(m.target.checked)},[]),h=l.useCallback(()=>{s("")},[]),p=l.useCallback(()=>{for(const m of c)m.is_installed||i({source:m.path,inplace:r})},[c,i,r]),f=l.useCallback(m=>{i({source:m,inplace:r})},[i,r]);return o.jsxs(o.Fragment,{children:[o.jsx(zt,{}),o.jsxs(j,{flexDir:"column",gap:3,height:"100%",children:[o.jsxs(j,{justifyContent:"space-between",alignItems:"center",children:[o.jsx(Ct,{size:"sm",children:t("modelManager.scanResults")}),o.jsxs(j,{alignItems:"center",gap:3,children:[o.jsxs(V,{w:"min-content",children:[o.jsx(U,{m:0,children:t("modelManager.inplaceInstall")}),o.jsx(kn,{isChecked:r,onChange:u,size:"md"})]}),o.jsx(me,{size:"sm",onClick:p,isDisabled:c.length===0,children:t("modelManager.installAll")}),o.jsxs(Ur,{w:64,size:"xs",children:[o.jsx(Vt,{placeholder:t("modelManager.search"),value:n,"data-testid":"board-search-input",onChange:d,size:"xs"}),n&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(Q,{size:"sm",variant:"link","aria-label":t("boards.clearSearch"),icon:o.jsx(sn,{}),onClick:h,flexShrink:0})})]})]})]}),o.jsx(j,{height:"100%",layerStyle:"third",borderRadius:"base",p:3,children:o.jsx(Nn,{children:o.jsx(j,{flexDir:"column",gap:3,children:c.map(m=>o.jsx(FM,{result:m,installModel:f},m.path))})})})]})]})});zM.displayName="ScanModelsResults";const AZ=K8(e=>e.scanPath),VM=l.memo(()=>{const e=w(AZ),t=E(),[n,s]=l.useState(""),{t:r}=S(),[a,{isLoading:i,data:c}]=Q8(),d=l.useCallback(()=>{a({scan_path:e}).unwrap().catch(h=>{h&&s(h.data.detail)})},[a,e]),u=l.useCallback(h=>{t(Y8(h.target.value)),s("")},[t]);return o.jsxs(j,{flexDir:"column",height:"100%",gap:3,children:[o.jsxs(V,{isInvalid:!!n.length,w:"full",orientation:"vertical",flexShrink:0,children:[o.jsx(U,{children:r("common.folder")}),o.jsxs(j,{gap:3,alignItems:"center",w:"full",children:[o.jsx(Vt,{placeholder:r("modelManager.scanPlaceholder"),value:e,onChange:u}),o.jsx(me,{onClick:d,isLoading:i,isDisabled:e===void 0||e.length===0,size:"sm",flexShrink:0,children:r("modelManager.scanFolder")})]}),o.jsx(ko,{children:r("modelManager.scanFolderHelper")}),!!n.length&&o.jsx(Fp,{children:n})]}),c&&o.jsx(zM,{results:c})]})});VM.displayName="ScanModelsForm";const mi=Ge(0),HM=l.memo(()=>{const{t:e}=S(),t=se(mi),n=l.useCallback(r=>{mi.set(r)},[]),s=l.useCallback(()=>{window.open("https://support.invoke.ai/support/solutions/articles/151000170961-supported-models")},[]);return o.jsxs(j,{layerStyle:"first",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:4,children:[o.jsxs(j,{alignItems:"center",justifyContent:"space-between",children:[o.jsx(Ct,{fontSize:"xl",children:e("modelManager.addModel")}),o.jsx(me,{alignItems:"center",variant:"link",leftIcon:o.jsx(Li,{}),onClick:s,children:o.jsx(O,{variant:"subtext",children:e("modelManager.learnMoreAboutSupportedModels")})})]}),o.jsxs(ki,{variant:"collapse",height:"50%",display:"flex",flexDir:"column",index:t,onChange:n,children:[o.jsxs(Ii,{children:[o.jsx(rn,{children:e("modelManager.urlOrLocalPath")}),o.jsx(rn,{children:e("modelManager.huggingFace")}),o.jsx(rn,{children:e("modelManager.scanFolder")}),o.jsx(rn,{children:e("modelManager.starterModels")})]}),o.jsxs(oc,{p:3,height:"100%",children:[o.jsx(mn,{children:o.jsx(OM,{})}),o.jsx(mn,{height:"100%",children:o.jsx(CM,{})}),o.jsx(mn,{height:"100%",children:o.jsx(VM,{})}),o.jsx(mn,{height:"100%",children:o.jsx(bM,{})})]})]}),o.jsx(xe,{layerStyle:"second",borderRadius:"base",h:"50%",children:o.jsx($M,{})})]})});HM.displayName="InstallModels";const $n=e=>()=>{const t=$p(void 0);return[l.useMemo(()=>t.data?Yd.selectAll(t.data).filter(e):Ss,[t]),t]},vf=$n(dx),EZ=$n(J8),Cf=$n(Cw),LZ=$n(X8),TZ=$n(e5),wf=$n(jw),PZ=$n(wj),a1=$n(ux),WM=$n(hx),i1=$n(t5),l1=$n(n5),_u=$n(s5),c1=$n(px),GM=$n(o5),jf=$n(ww),UM=$n(r5),RZ=$n(a5),DZ=(e,t)=>pe(i5,n=>n.data?Yd.selectAll(n.data).filter(t).find(s=>s.key===e)??null:null),Th="starterModels",OZ=()=>{const{t:e}=S(),t=dn("starterModels"),[n,s]=l.useState(!1),[r,{data:a}]=vf(),i=Vd();l.useEffect(()=>{if(i.isActive(Th)){if(r.length===0)return;i.close(Th)}a&&r.length===0&&!n&&t&&i({id:Th,title:e("modelManager.noModelsInstalled"),description:o.jsx(NZ,{}),status:"info",isClosable:!0,duration:null,onCloseComplete:()=>s(!0)})},[a,n,t,r.length,e,i])},NZ=()=>{const{t:e}=S(),t=E(),n=Vd(),s=l.useCallback(()=>{t(Tt("models")),mi.set(3),n.close(Th)},[t,n]);return o.jsxs(O,{fontSize:"md",children:[e("modelManager.noModelsInstalledDesc1")," ",o.jsxs(me,{onClick:s,variant:"link",color:"base.50",flexGrow:0,children:[e("ui.tabs.modelsTab"),"."]})]})},xp=Ge(null),cC=()=>xp.set(null),BZ=()=>l.useCallback(t=>{xp.set(t)},[]),$Z=()=>{wt("ShareWorkflowModal");const e=se(xp),t=se(Tx),{t:n}=S(),s=l.useMemo(()=>!e||!t?null:`${window.location.origin}/${t}/studio?selectedWorkflowId=${e.workflow_id}`,[t,e]),r=l.useCallback(()=>{s&&(navigator.clipboard.writeText(s),he({status:"success",title:n("toast.linkCopied")}),xp.set(null))},[s,n]);return o.jsxs(fr,{isOpen:e!==null,onClose:cC,isCentered:!0,size:"lg",useInert:!1,children:[o.jsx(co,{}),o.jsxs(mr,{children:[o.jsx(Bo,{children:o.jsxs(j,{flexDir:"column",gap:2,children:[o.jsx(Ct,{fontSize:"xl",children:n("workflows.copyShareLinkForWorkflow")}),o.jsx(O,{fontSize:"md",children:e==null?void 0:e.name})]})}),o.jsx(Ea,{}),o.jsx(uo,{children:o.jsxs(j,{layerStyle:"third",p:4,borderRadius:"base",alignItems:"center",children:[o.jsx(O,{fontWeight:"semibold",children:s}),o.jsx(Q,{variant:"ghost","aria-label":n("common.copy"),tooltip:n("common.copy"),icon:o.jsx(gr,{}),onClick:r})]})}),o.jsx(La,{children:o.jsx(me,{onClick:cC,children:n("common.close")})})]})]})},d1=Ge(null),FZ=()=>d1.set(null),zZ=()=>l.useCallback(t=>{d1.set(t)},[]),ZM=l.memo(()=>{wt("DeleteStylePresetDialog");const{t:e}=S(),t=se(d1),[n]=l5(),s=l.useCallback(async()=>{if(t)try{await n(t.id).unwrap(),he({status:"success",title:e("stylePresets.templateDeleted")})}catch{he({status:"error",title:e("stylePresets.unableToDeleteTemplate")})}},[t,n,e]);return o.jsx(No,{isOpen:t!==null,onClose:FZ,title:e("stylePresets.deleteTemplate"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:o.jsx(O,{children:e("stylePresets.deleteTemplate2")})})});ZM.displayName="DeleteStylePresetDialog";const VZ=e=>{const{field:t}=Bn(e),{t:n}=S(),s=l.useCallback(c=>{const d=c[0];d&&t.onChange(d)},[t]),r=l.useCallback(()=>{t.onChange(null)},[t]),{getInputProps:a,getRootProps:i}=Na({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:s,noDrag:!0,multiple:!1});return t.value?o.jsxs(xe,{position:"relative",flexShrink:0,children:[o.jsx(nn,{src:URL.createObjectURL(t.value),objectFit:"cover",objectPosition:"50% 50%",w:65,h:65,minWidth:65,borderRadius:"base"}),o.jsx(Q,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:r,"aria-label":n("stylePresets.deleteImage"),tooltip:n("stylePresets.deleteImage"),icon:o.jsx(Kr,{}),size:"md",variant:"ghost"})]}):o.jsxs(o.Fragment,{children:[o.jsx(Ae,{label:n("stylePresets.uploadImage"),children:o.jsx(j,{as:me,w:65,h:65,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...i(),children:o.jsx(it,{as:gc,w:8,h:8})})}),o.jsx("input",{...a()})]})},dC=e=>{const{field:t}=Bn(e),n=l.useRef(null),{t:s}=S(),r=l.useCallback(d=>{t.onChange(d.target.value)},[t]),a=l.useMemo(()=>t.value,[t.value]),i=l.useCallback(()=>{var d;if(n.current){const u=n.current.selectionStart,h=a.slice(0,u),p=a.slice(u),f=h+ai+p;t.onChange(f)}else t.onChange(a+ai);(d=n.current)==null||d.focus()},[a,t,n]),c=l.useMemo(()=>a==null?void 0:a.includes(ai),[a]);return o.jsxs(V,{orientation:"vertical",gap:3,children:[o.jsxs(j,{alignItems:"center",gap:2,children:[o.jsx(U,{children:e.label}),o.jsx(me,{onClick:i,size:"xs","aria-label":s("stylePresets.insertPlaceholder"),isDisabled:c,children:s("stylePresets.insertPlaceholder")})]}),o.jsx(ls,{size:"sm",ref:n,value:a,onChange:r})]})},uC=[{label:ve("stylePresets.private"),value:"user"},{label:ve("stylePresets.shared"),value:"project"}],HZ=e=>{var i;const{field:t}=Bn(e),n=se(Ma),{t:s}=S(),r=l.useCallback(c=>{c&&t.onChange(c.value)},[t]),a=l.useMemo(()=>uC.find(c=>c.value===t.value),[t.value]);return o.jsxs(V,{orientation:"vertical",maxW:48,isDisabled:((i=n.prefilledFormData)==null?void 0:i.type)==="project",children:[o.jsx(U,{children:s("stylePresets.type")}),o.jsx(Ne,{value:a,options:uC,onChange:r})]})},WZ=({updatingStylePresetId:e,formData:t})=>{const[n,{isLoading:s}]=c5(),[r,{isLoading:a}]=d5(),{t:i}=S(),c=w(jj),{handleSubmit:d,control:u,register:h,formState:p}=Iu({defaultValues:t||{name:"",positivePrompt:"",negativePrompt:"",image:null,type:"user"},mode:"onChange"}),f=l.useCallback(async m=>{const g={data:{name:m.name,positive_prompt:m.positivePrompt,negative_prompt:m.negativePrompt,type:m.type},image:m.image};try{e?await r({id:e,...g}).unwrap():await n(g).unwrap()}catch{he({status:"error",title:"Failed to save style preset"})}Ma.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[e,r,n]);return o.jsxs(j,{flexDir:"column",gap:4,children:[o.jsxs(j,{alignItems:"center",gap:4,children:[o.jsx(VZ,{control:u,name:"image"}),o.jsxs(V,{orientation:"vertical",children:[o.jsx(U,{children:i("stylePresets.name")}),o.jsx(Vt,{size:"md",...h("name",{required:!0,minLength:1})})]})]}),o.jsx(dC,{label:i("stylePresets.positivePrompt"),control:u,name:"positivePrompt"}),o.jsx(dC,{label:i("stylePresets.negativePrompt"),control:u,name:"negativePrompt"}),o.jsxs(xe,{children:[o.jsx(O,{variant:"subtext",children:i("stylePresets.promptTemplatesDesc1")}),o.jsx(O,{variant:"subtext",children:o.jsx(Cs,{i18nKey:"stylePresets.promptTemplatesDesc2",components:{Pre:o.jsx(GZ,{})},values:{placeholder:ai}})}),o.jsx(O,{variant:"subtext",children:i("stylePresets.promptTemplatesDesc3")})]}),o.jsxs(j,{justifyContent:"space-between",alignItems:"flex-end",gap:10,children:[c?o.jsx(HZ,{control:u,name:"type"}):o.jsx(dt,{}),o.jsx(me,{onClick:d(f),isDisabled:!p.isValid,isLoading:s||a,children:i("common.save")})]})]})},GZ=e=>o.jsx(O,{as:"span",fontFamily:"monospace",fontWeight:"semibold",children:e.children}),UZ=()=>{wt("StylePresetModal");const[e,t]=l.useState(null),{t:n}=S(),s=se(Ma),r=l.useMemo(()=>s.updatingStylePresetId?n("stylePresets.updatePromptTemplate"):n("stylePresets.createPromptTemplate"),[s.updatingStylePresetId,n]),a=l.useCallback(()=>{Ma.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!1})},[]);return l.useEffect(()=>{t(null)},[]),l.useEffect(()=>{(async c=>{if(!c)t(null);else{let d=null;if(c.imageUrl)try{const u=await Q_(c.imageUrl);u&&(d=new File([u],"style_preset.png",{type:"image/png"}))}catch{}t({...c,image:d})}})(s.prefilledFormData)},[s.prefilledFormData]),o.jsxs(fr,{isOpen:s.isModalOpen,onClose:a,isCentered:!0,size:"2xl",useInert:!1,children:[o.jsx(co,{}),o.jsxs(mr,{children:[o.jsx(Bo,{children:r}),o.jsx(Ea,{}),o.jsx(uo,{display:"flex",flexDir:"column",gap:4,children:!s.prefilledFormData||e?o.jsx(WZ,{updatingStylePresetId:s.updatingStylePresetId,formData:e}):o.jsx(pr,{})}),o.jsx(La,{p:2})]})]})},[qM]=wi(!1),ZZ=()=>{wt("RefreshAfterResetModal");const{t:e}=S(),[t,n]=l.useState(3),s=qM();return l.useEffect(()=>{if(!s.isTrue)return;const r=window.setInterval(()=>n(a=>a-1),1e3);return()=>{window.clearInterval(r)}},[s.isTrue]),l.useEffect(()=>{t<=0&&window.location.reload()},[t]),o.jsx(o.Fragment,{children:o.jsxs(fr,{closeOnOverlayClick:!1,isOpen:s.isTrue,onClose:s.setFalse,isCentered:!0,closeOnEsc:!1,useInert:!1,children:[o.jsx(co,{backdropFilter:"blur(40px)"}),o.jsxs(mr,{children:[o.jsx(Bo,{}),o.jsx(uo,{children:o.jsx(j,{justifyContent:"center",children:o.jsx(O,{fontSize:"lg",children:o.jsxs(O,{children:[e("settings.resetComplete")," ",e("settings.reloadingIn")," ",t,"..."]})})})}),o.jsx(La,{})]})]})})},qZ=l.memo(ZZ),KM=pe(Wd,e=>e.language),QM=l.memo(()=>{const{t:e}=S();return w(Sj)?o.jsxs(Px,{status:"warning",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",alignSelf:"flex-end",children:[o.jsx(Rx,{}),o.jsx(Dx,{children:e("controlLayers.settings.preserveMask.alert")})]}):null});QM.displayName="CanvasAlertsPreserveMask";const Ti=l.createContext(null),ut=e=>{const t=l.useContext(Ti);return Fe(t,"useEntityIdentifier must be used within a EntityIdentifierProvider"),e&&Fe(t.type===e,"useEntityIdentifier must be used with the correct type"),t},Sf=l.createContext(null),YM=l.memo(({children:e})=>{const t=At(),n=ut(),s=l.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),r=l.useMemo(()=>s.get(n.id)??null,[s,n.id]);return r?o.jsx(Sf.Provider,{value:r,children:e}):null});YM.displayName="RasterLayerAdapterGate";const JM=l.memo(({children:e})=>{const t=At(),n=ut(),s=l.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),r=l.useMemo(()=>s.get(n.id)??null,[s,n.id]);return r?o.jsx(Sf.Provider,{value:r,children:e}):null});JM.displayName="ControlLayerAdapterGate";const XM=l.memo(({children:e})=>{const t=At(),n=ut(),s=l.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot),r=l.useMemo(()=>s.get(n.id)??null,[s,n.id]);return r?o.jsx(Sf.Provider,{value:r,children:e}):null});XM.displayName="InpaintMaskAdapterGate";const eA=l.memo(({children:e})=>{const t=At(),n=ut(),s=l.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),r=l.useMemo(()=>s.get(n.id)??null,[s,n.id]);return r?o.jsx(Sf.Provider,{value:r,children:e}):null});eA.displayName="RegionalGuidanceAdapterGate";const br=e=>{const t=At(),n=l.useSyncExternalStore(t.adapters.regionMasks.subscribe,t.adapters.regionMasks.getSnapshot),s=l.useSyncExternalStore(t.adapters.rasterLayers.subscribe,t.adapters.rasterLayers.getSnapshot),r=l.useSyncExternalStore(t.adapters.controlLayers.subscribe,t.adapters.controlLayers.getSnapshot),a=l.useSyncExternalStore(t.adapters.inpaintMasks.subscribe,t.adapters.inpaintMasks.getSnapshot);return l.useMemo(()=>e?e.type==="raster_layer"?s.get(e.id)??null:e.type==="control_layer"?r.get(e.id)??null:e.type==="inpaint_mask"?a.get(e.id)??null:e.type==="regional_guidance"?n.get(e.id)??null:null:null,[r,e,a,s,n])},KZ=e=>{const t=br(e);return Fe(t,"useEntityAdapter must be used within a EntityAdapterContext"),t},QZ=e=>pe(Je,t=>{const n=rc(t,e);return n?n.name:null}),kf=e=>{const{t}=S(),n=l.useMemo(()=>QZ(e),[e]),s=w(n);return l.useMemo(()=>{if(s)return s;switch(e.type){case"inpaint_mask":return t("controlLayers.inpaintMask");case"control_layer":return t("controlLayers.controlLayer");case"raster_layer":return t("controlLayers.rasterLayer");case"reference_image":return t("controlLayers.globalReferenceImage");case"regional_guidance":return t("controlLayers.regionalGuidance");default:Fe(!1,"Unexpected entity type")}},[e.type,s,t])},u1=e=>{const t=l.useMemo(()=>pe(Je,s=>{switch(e){case"control_layer":return s.controlLayers.isHidden;case"raster_layer":return s.rasterLayers.isHidden;case"inpaint_mask":return s.inpaintMasks.isHidden;case"regional_guidance":return s.regionalGuidance.isHidden;case"reference_image":default:return!1}}),[e]);return w(t)},YZ=Ge(!1),tA=l.memo(({entityIdentifier:e,adapter:t})=>{var m;const{t:n}=S(),s=kf(e),r=l.useMemo(()=>pe(Je,g=>io(g,e).isEnabled),[e]),a=l.useMemo(()=>pe(Je,g=>io(g,e).isLocked),[e]),i=w(r),c=w(a),d=u1(e.type),u=se(((m=t.filterer)==null?void 0:m.$isFiltering)??YZ),h=se(t.transformer.$isTransforming),p=se(t.$isEmpty),f=l.useMemo(()=>u?{status:"info",title:n("controlLayers.HUD.entityStatus.isFiltering",{title:s})}:h?{status:"info",title:n("controlLayers.HUD.entityStatus.isTransforming",{title:s})}:p?{status:"info",title:n("controlLayers.HUD.entityStatus.isEmpty",{title:s})}:d?{status:"warning",title:n("controlLayers.HUD.entityStatus.isHidden",{title:s})}:c?{status:"warning",title:n("controlLayers.HUD.entityStatus.isLocked",{title:s})}:i?null:{status:"warning",title:n("controlLayers.HUD.entityStatus.isDisabled",{title:s})},[u,h,p,d,c,i,s,n]);return f?o.jsxs(Px,{status:f.status,borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",alignSelf:"flex-end",children:[o.jsx(Rx,{}),o.jsx(Dx,{children:f.title})]}):null});tA.displayName="CanvasAlertsSelectedEntityStatusContent";const nA=l.memo(()=>{const e=w(un),t=br(e);return!e||!t?null:o.jsx(tA,{entityIdentifier:e,adapter:t})});nA.displayName="CanvasAlertsSelectedEntityStatus";const h1=()=>{const{destination:e}=u5(void 0,{selectFromResult:({data:t})=>({destination:t?t.destination:null})});return e},JZ=e=>{const t=jt(),n=E(),s=l.useCallback(()=>{t.open(),n(Ao("gallery"))},[t,n]);return o.jsx(me,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},XZ=()=>{const{t:e}=S(),t=h1(),n=w(bn),s=l.useMemo(()=>n!=="canvas"||!t?!1:t==="gallery",[t,n]);return o.jsx(sA,{title:e("controlLayers.sendingToGallery"),description:o.jsx(Cs,{i18nKey:"controlLayers.viewProgressInViewer",components:{Btn:o.jsx(JZ,{})}}),isVisible:s})},eq=e=>{const t=E(),n=jt(),s=l.useCallback(()=>{t(Tt("canvas")),t(Ao("layers")),n.close()},[t,n]);return o.jsx(me,{onClick:s,size:"sm",variant:"link",color:"base.50",children:e.children})},tq=()=>{const{t:e}=S(),t=h1(),n=w(Pn),s=w(bn),r=l.useMemo(()=>s!=="canvas"&&t!=="canvas"?!1:n?!0:t?t==="canvas":!1,[t,n,s]);return o.jsx(sA,{title:e("controlLayers.sendingToCanvas"),description:o.jsx(Cs,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:o.jsx(eq,{})}}),isVisible:r})},sA=({title:e,description:t,isVisible:n})=>{const s=Jd(!1);return o.jsx(Ox,{children:(n||s.isTrue)&&o.jsx(Nx.div,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.1,ease:"easeOut"}},exit:{opacity:0,transition:{duration:.1,delay:s.isTrue?.1:1,ease:"easeIn"}},onMouseEnter:s.setTrue,onMouseLeave:s.setFalse,children:o.jsxs(Px,{status:"warning",flexDir:"column",pointerEvents:"auto",borderRadius:"base",fontSize:"sm",shadow:"md",w:"fit-content",alignSelf:"flex-end",children:[o.jsxs(j,{w:"full",alignItems:"center",children:[o.jsx(Rx,{}),o.jsx(Dx,{children:e})]}),o.jsx(h5,{children:t})]})})})},oA=l.memo(()=>{const{t:e}=S(),t=Ht(),n=At(),s=l.useCallback(async()=>{const r=n.getAllAdapters();for(const a of r)await a.cropToBbox()},[n]);return o.jsx(_e,{icon:o.jsx(PI,{}),isDisabled:t,onClick:s,children:e("controlLayers.canvasContextMenu.cropCanvasToBbox")})});oA.displayName="CanvasContextMenuItemsCropCanvasToBbox";const nq=Do("canvas"),Qr=({region:e,saveToGallery:t,toastOk:n,toastError:s,onSave:r,withMetadata:a})=>{const{t:i}=S(),c=ji(),d=At();return l.useCallback(async()=>{const h=e==="bbox"?d.stateApi.getBbox().rect:d.stage.getVisibleRect("raster_layer");if(h.width===0||h.height===0){he({title:s,description:i("controlLayers.regionIsEmpty"),status:"warning"});return}let p;a&&(p=p5(c.getState()));const f=await ss(()=>d.compositor.rasterizeAndUploadCompositeRasterLayer(h,{is_intermediate:!t,metadata:p}));f.isOk()?(r&&r(f.value,h),he({title:n})):(nq.error({error:ya(f.error)},"Failed to save canvas to gallery"),he({title:s,status:"error"}))},[d.compositor,d.stage,d.stateApi,r,e,t,c,i,s,n,a])},rA=()=>{const{t:e}=S(),t=l.useMemo(()=>({region:"canvas",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return Qr(t)},aA=()=>{const{t:e}=S(),t=l.useMemo(()=>({region:"bbox",saveToGallery:!0,toastOk:e("controlLayers.savedToGalleryOk"),toastError:e("controlLayers.savedToGalleryError"),withMetadata:!0}),[e]);return Qr(t)},sq=()=>{const{t:e}=S(),t=E(),n=w(kj),s=l.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:i=>{const d={referenceImages:[{id:Te("regional_guidance_reference_image"),ipAdapter:{...cn(n),image:Rp(i)}}]};t(f5({overrides:d,isSelected:!0}))},toastOk:e("controlLayers.newRegionalReferenceImageOk"),toastError:e("controlLayers.newRegionalReferenceImageError")}),[n,t,e]);return Qr(s)},oq=()=>{const{t:e}=S(),t=E(),n=w(kj),s=l.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:i=>{const c={ipAdapter:{...cn(n),image:Rp(i)}};t(m5({overrides:c,isSelected:!0}))},toastOk:e("controlLayers.newGlobalReferenceImageOk"),toastError:e("controlLayers.newGlobalReferenceImageError")}),[n,t,e]);return Qr(s)},rq=()=>{const{t:e}=S(),t=E(),n=l.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(a,i)=>{const c={objects:[Nr(a)],position:{x:i.x,y:i.y}};t(Op({overrides:c,isSelected:!0}))},toastOk:e("controlLayers.newRasterLayerOk"),toastError:e("controlLayers.newRasterLayerError")}),[t,e]);return Qr(n)},aq=()=>{const{t:e}=S(),t=E(),n=w(Ij),s=l.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(i,c)=>{const d={objects:[Nr(i)],controlAdapter:cn(n),position:{x:c.x,y:c.y}};t(g5({overrides:d,isSelected:!0}))},toastOk:e("controlLayers.newControlLayerOk"),toastError:e("controlLayers.newControlLayerError")}),[n,t,e]);return Qr(s)},iq=e=>{const{t}=S(),n=E(),s=l.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(i,c)=>{n(_j({entityIdentifier:e,position:{x:c.x,y:c.y},imageObject:Nr(i),replaceObjects:!0}))},toastOk:t("controlLayers.pullBboxIntoLayerOk"),toastError:t("controlLayers.pullBboxIntoLayerError")}),[n,e,t]);return Qr(s)},lq=e=>{const{t}=S(),n=E(),s=l.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(i,c)=>{n(Mj({entityIdentifier:e,imageDTO:i}))},toastOk:t("controlLayers.pullBboxIntoReferenceImageOk"),toastError:t("controlLayers.pullBboxIntoReferenceImageError")}),[n,e,t]);return Qr(s)},cq=(e,t)=>{const{t:n}=S(),s=E(),r=l.useMemo(()=>({region:"bbox",saveToGallery:!1,onSave:(c,d)=>{s(Aj({entityIdentifier:e,referenceImageId:t,imageDTO:c}))},toastOk:n("controlLayers.pullBboxIntoReferenceImageOk"),toastError:n("controlLayers.pullBboxIntoReferenceImageError")}),[s,e,t,n]);return Qr(r)},iA=l.memo(()=>{const{t:e}=S(),t=Ht(),n=rA(),s=aA(),r=sq(),a=oq(),i=rq(),c=aq();return o.jsxs(o.Fragment,{children:[o.jsx(os,{title:e("controlLayers.canvasContextMenu.canvasGroup"),children:o.jsx(oA,{})}),o.jsxs(os,{title:e("controlLayers.canvasContextMenu.saveToGalleryGroup"),children:[o.jsx(_e,{icon:o.jsx($r,{}),isDisabled:t,onClick:n,children:e("controlLayers.canvasContextMenu.saveCanvasToGallery")}),o.jsx(_e,{icon:o.jsx($r,{}),isDisabled:t,onClick:s,children:e("controlLayers.canvasContextMenu.saveBboxToGallery")})]}),o.jsxs(os,{title:e("controlLayers.canvasContextMenu.bboxGroup"),children:[o.jsx(_e,{icon:o.jsx(xl,{}),isDisabled:t,onClick:a,children:e("controlLayers.canvasContextMenu.newGlobalReferenceImage")}),o.jsx(_e,{icon:o.jsx(xl,{}),isDisabled:t,onClick:r,children:e("controlLayers.canvasContextMenu.newRegionalReferenceImage")}),o.jsx(_e,{icon:o.jsx(xl,{}),isDisabled:t,onClick:c,children:e("controlLayers.canvasContextMenu.newControlLayer")}),o.jsx(_e,{icon:o.jsx(xl,{}),isDisabled:t,onClick:i,children:e("controlLayers.canvasContextMenu.newRasterLayer")})]})]})});iA.displayName="CanvasContextMenuGlobalMenuItems";const dq=()=>{const{t:e}=S();return l.useCallback(async n=>{if(n)try{const s=n.getCanvas(),r=await Gh(s);Y_(r),he({status:"info",title:e("toast.layerCopiedToClipboard")})}catch{he({status:"error",title:e("toast.problemCopyingLayer")})}},[e])},Yr=e=>{const t=Ht(),n=br(e),s=se((n==null?void 0:n.$isInteractable)??Yc);return!t&&s},If=l.memo(()=>{const{t:e}=S(),t=ut(),n=br(t),s=Yr(t),r=dq(),a=l.useCallback(()=>{r(n)},[r,n]);return o.jsx(_e,{onClick:a,icon:o.jsx(gr,{}),isDisabled:!s,children:e("controlLayers.copyToClipboard")})});If.displayName="CanvasEntityMenuItemsCopyToClipboard";const Cc=l.memo(()=>{const{t:e}=S(),t=ut(),n=br(t),s=Yr(t),r=l.useCallback(()=>{n&&n.cropToBbox()},[n]);return o.jsx(_e,{onClick:r,icon:o.jsx(PI,{}),isDisabled:!s,children:e("controlLayers.cropLayerToBbox")})});Cc.displayName="CanvasEntityMenuItemsCropToBbox";const Pi=l.memo(({asIcon:e=!1})=>{const{t}=S(),n=E(),s=ut(),r=Yr(s),a=l.useCallback(()=>{n(Bx({entityIdentifier:s}))},[n,s]);return e?o.jsx(so,{"aria-label":t("common.delete"),tooltip:t("common.delete"),onClick:a,icon:o.jsx(Hs,{}),isDestructive:!0,isDisabled:!r}):o.jsx(_e,{onClick:a,icon:o.jsx(Hs,{}),isDestructive:!0,isDisabled:!r,children:t("common.delete")})});Pi.displayName="CanvasEntityMenuItemsDelete";const _f=e=>{const t=At(),n=br(e),s=Ht(),r=se((n==null?void 0:n.$isInteractable)??wd),a=se((n==null?void 0:n.$isEmpty)??wd),i=l.useMemo(()=>!!(!e||!Uh(e)||!n||s||!r||a),[e,n,s,r,a]),c=l.useCallback(()=>{if(i||!e||!Uh(e))return;const d=t.getAdapter(e);d&&d.filterer.start()},[i,e,t]);return{isDisabled:i,start:c}},Mf=l.memo(()=>{const{t:e}=S(),t=ut(),n=_f(t);return o.jsx(_e,{onClick:n.start,icon:o.jsx(af,{}),isDisabled:n.isDisabled,children:e("controlLayers.filter.filter")})});Mf.displayName="CanvasEntityMenuItemsFilter";const lA=()=>{const{t:e}=S(),[t]=vx(),n=w(ao);return l.useCallback(async r=>{if(r)try{const a=r.getCanvas(),i=await Gh(a),c=new File([i],`layer-${r.id}.png`,{type:"image/png"});await t({file:c,image_category:"user",is_intermediate:!1,postUploadAction:{type:"TOAST"},board_id:n==="none"?void 0:n}),he({status:"info",title:e("toast.layerSavedToAssets")})}catch{he({status:"error",title:e("toast.problemSavingLayer")})}},[e,n,t])},Af=l.memo(()=>{const{t:e}=S(),t=ut(),n=br(t),s=Yr(t),r=lA(),a=l.useCallback(()=>{r(n)},[r,n]);return o.jsx(_e,{onClick:a,icon:o.jsx($r,{}),isDisabled:!s,children:e("controlLayers.saveLayerToAssets")})});Af.displayName="CanvasEntityMenuItemsSave";const p1=e=>{const t=At(),n=br(e),s=Ht(),r=se((n==null?void 0:n.$isInteractable)??wd),a=se((n==null?void 0:n.$isEmpty)??wd),i=l.useMemo(()=>!!(!e||!Sl(e)||!n||s||!r||a),[e,n,s,r,a]),c=l.useCallback(async()=>{if(i||!e||!Sl(e))return;const u=t.getAdapter(e);u&&await u.transformer.startTransform()},[i,e,t]),d=l.useCallback(async()=>{if(i||!e||!Sl(e))return;const u=t.getAdapter(e);u&&(await u.transformer.startTransform({silent:!0}),u.transformer.fitToBboxContain(),await u.transformer.applyTransform())},[t,e,i]);return{isDisabled:i,start:c,fitToBbox:d}},wc=l.memo(()=>{const{t:e}=S(),t=ut(),n=p1(t);return o.jsxs(o.Fragment,{children:[o.jsx(_e,{onClick:n.start,icon:o.jsx(vu,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.transform")}),o.jsx(_e,{onClick:n.fitToBbox,icon:o.jsx(fc,{}),isDisabled:n.isDisabled,children:e("controlLayers.transform.fitToBbox")})]})});wc.displayName="CanvasEntityMenuItemsTransform";const cA=l.memo(()=>{const e=ut(),t=kf(e);return o.jsxs(os,{title:t,children:[Uh(e)&&o.jsx(Mf,{}),Sl(e)&&o.jsx(wc,{}),Dg(e)&&o.jsx(If,{}),Dg(e)&&o.jsx(Af,{}),Sl(e)&&o.jsx(Cc,{}),o.jsx(Pi,{})]})});cA.displayName="CanvasContextMenuSelectedEntityMenuItemsContent";const dA=l.memo(()=>{const e=w(un);return e?o.jsx(Ti.Provider,{value:e,children:o.jsx(cA,{})}):null});dA.displayName="CanvasContextMenuSelectedEntityMenuItems";function uq(e){return Ej(e)}function hq(e){return Lj(e)}const pq=e=>{const{isOver:t,label:n,withBackdrop:s=!0}=e;return o.jsxs(j,{position:"absolute",top:0,right:0,bottom:0,left:0,children:[o.jsx(j,{position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",bg:s?"base.900":"transparent",opacity:.7,borderRadius:"base",alignItems:"center",justifyContent:"center",transitionProperty:"common",transitionDuration:"0.1s"}),o.jsx(j,{position:"absolute",top:.5,right:.5,bottom:.5,left:.5,opacity:1,borderWidth:1.5,borderColor:t?"invokeYellow.300":"base.500",borderRadius:"base",borderStyle:"dashed",transitionProperty:"common",transitionDuration:"0.1s",alignItems:"center",justifyContent:"center",children:n&&o.jsx(O,{fontSize:"lg",fontWeight:"semibold",color:t?"invokeYellow.300":"base.500",transitionProperty:"common",transitionDuration:"0.1s",textAlign:"center",children:n})})]})},w0=l.memo(pq),fq=e=>{const{dropLabel:t,data:n,disabled:s}=e,r=l.useRef(Gl()),{isOver:a,setNodeRef:i,active:c}=uq({id:r.current,disabled:s,data:n});return o.jsx(xe,{ref:i,position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",pointerEvents:c?"auto":"none",children:o.jsx(Ox,{children:x5(n,c==null?void 0:c.data.current)&&o.jsx(w0,{isOver:a,label:t})})})},tr=l.memo(fq),mq={id:"add-raster-layer-from-image-drop-data",actionType:"ADD_RASTER_LAYER_FROM_IMAGE"},gq={id:"add-control-layer-from-image-drop-data",actionType:"ADD_CONTROL_LAYER_FROM_IMAGE"},xq={id:"add-control-layer-from-image-drop-data",actionType:"ADD_REGIONAL_REFERENCE_IMAGE_FROM_IMAGE"},bq={id:"add-control-layer-from-image-drop-data",actionType:"ADD_GLOBAL_REFERENCE_IMAGE_FROM_IMAGE"},uA=l.memo(()=>{const{t:e}=S();return jt().isOpen?null:o.jsx(o.Fragment,{children:o.jsxs(va,{gridTemplateRows:"1fr 1fr",gridTemplateColumns:"1fr 1fr",position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:[o.jsx(ln,{position:"relative",children:o.jsx(tr,{dropLabel:e("controlLayers.canvasContextMenu.newRasterLayer"),data:mq})}),o.jsx(ln,{position:"relative",children:o.jsx(tr,{dropLabel:e("controlLayers.canvasContextMenu.newControlLayer"),data:gq})}),o.jsx(ln,{position:"relative",children:o.jsx(tr,{dropLabel:e("controlLayers.canvasContextMenu.newRegionalReferenceImage"),data:xq})}),o.jsx(ln,{position:"relative",children:o.jsx(tr,{dropLabel:e("controlLayers.canvasContextMenu.newGlobalReferenceImage"),data:bq})})]})})});uA.displayName="CanvasDropArea";const yq=ze.object({type:ze.literal("canny_edge_detection"),low_threshold:ze.number().int().gte(0).lte(255),high_threshold:ze.number().int().gte(0).lte(255)}),vq=ze.object({type:ze.literal("color_map"),tile_size:ze.number().int().gte(1)}),Cq=ze.object({type:ze.literal("content_shuffle"),scale_factor:ze.number().int().gte(1)}),hA=ze.enum(["large","base","small","small_v2"]),wq=e=>hA.safeParse(e).success,jq=ze.object({type:ze.literal("depth_anything_depth_estimation"),model_size:hA}),Sq=ze.object({type:ze.literal("hed_edge_detection"),scribble:ze.boolean()}),kq=ze.object({type:ze.literal("lineart_anime_edge_detection")}),Iq=ze.object({type:ze.literal("lineart_edge_detection"),coarse:ze.boolean()}),_q=ze.object({type:ze.literal("mediapipe_face_detection"),max_faces:ze.number().int().gte(1),min_confidence:ze.number().gte(0).lte(1)}),Mq=ze.object({type:ze.literal("mlsd_detection"),score_threshold:ze.number().gte(0),distance_threshold:ze.number().gte(0)}),Aq=ze.object({type:ze.literal("normal_map")}),Eq=ze.object({type:ze.literal("pidi_edge_detection"),quantize_edges:ze.boolean(),scribble:ze.boolean()}),Lq=ze.object({type:ze.literal("dw_openpose_detection"),draw_body:ze.boolean(),draw_face:ze.boolean(),draw_hands:ze.boolean()}),Tq=ze.object({type:ze.literal("spandrel_filter"),model:Dn.nullable(),autoScale:ze.boolean(),scale:ze.number().gte(1).lte(16)});ze.discriminatedUnion("type",[yq,vq,Cq,jq,Sq,kq,Iq,_q,Mq,Aq,Eq,Lq,Tq]);const Pq=ze.enum(["canny_edge_detection","color_map","content_shuffle","depth_anything_depth_estimation","hed_edge_detection","lineart_anime_edge_detection","lineart_edge_detection","mediapipe_face_detection","mlsd_detection","normal_map","pidi_edge_detection","dw_openpose_detection","spandrel_filter"]),pA=e=>Pq.safeParse(e).success,An={canny_edge_detection:{type:"canny_edge_detection",buildDefaults:()=>({type:"canny_edge_detection",low_threshold:100,high_threshold:200}),buildGraph:({image_name:e},{low_threshold:t,high_threshold:n})=>{const s=new Ms(Te("canny_edge_detection_filter")),r=s.addNode({id:Te("canny_edge_detection"),type:"canny_edge_detection",image:{image_name:e},low_threshold:t,high_threshold:n});return{graph:s,outputNodeId:r.id}}},color_map:{type:"color_map",buildDefaults:()=>({type:"color_map",tile_size:64}),buildGraph:({image_name:e},{tile_size:t})=>{const n=new Ms(Te("color_map_filter")),s=n.addNode({id:Te("color_map"),type:"color_map",image:{image_name:e},tile_size:t});return{graph:n,outputNodeId:s.id}}},content_shuffle:{type:"content_shuffle",buildDefaults:()=>({type:"content_shuffle",scale_factor:256}),buildGraph:({image_name:e},{scale_factor:t})=>{const n=new Ms(Te("content_shuffle_filter")),s=n.addNode({id:Te("content_shuffle"),type:"content_shuffle",image:{image_name:e},scale_factor:t});return{graph:n,outputNodeId:s.id}}},depth_anything_depth_estimation:{type:"depth_anything_depth_estimation",buildDefaults:()=>({type:"depth_anything_depth_estimation",model_size:"small_v2"}),buildGraph:({image_name:e},{model_size:t})=>{const n=new Ms(Te("depth_anything_depth_estimation_filter")),s=n.addNode({id:Te("depth_anything_depth_estimation"),type:"depth_anything_depth_estimation",image:{image_name:e},model_size:t});return{graph:n,outputNodeId:s.id}}},hed_edge_detection:{type:"hed_edge_detection",buildDefaults:()=>({type:"hed_edge_detection",scribble:!1}),buildGraph:({image_name:e},{scribble:t})=>{const n=new Ms(Te("hed_edge_detection_filter")),s=n.addNode({id:Te("hed_edge_detection"),type:"hed_edge_detection",image:{image_name:e},scribble:t});return{graph:n,outputNodeId:s.id}}},lineart_anime_edge_detection:{type:"lineart_anime_edge_detection",buildDefaults:()=>({type:"lineart_anime_edge_detection"}),buildGraph:({image_name:e})=>{const t=new Ms(Te("lineart_anime_edge_detection_filter")),n=t.addNode({id:Te("lineart_anime_edge_detection"),type:"lineart_anime_edge_detection",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},lineart_edge_detection:{type:"lineart_edge_detection",buildDefaults:()=>({type:"lineart_edge_detection",coarse:!1}),buildGraph:({image_name:e},{coarse:t})=>{const n=new Ms(Te("lineart_edge_detection_filter")),s=n.addNode({id:Te("lineart_edge_detection"),type:"lineart_edge_detection",image:{image_name:e},coarse:t});return{graph:n,outputNodeId:s.id}}},mediapipe_face_detection:{type:"mediapipe_face_detection",buildDefaults:()=>({type:"mediapipe_face_detection",max_faces:1,min_confidence:.5}),buildGraph:({image_name:e},{max_faces:t,min_confidence:n})=>{const s=new Ms(Te("mediapipe_face_detection_filter")),r=s.addNode({id:Te("mediapipe_face_detection"),type:"mediapipe_face_detection",image:{image_name:e},max_faces:t,min_confidence:n});return{graph:s,outputNodeId:r.id}}},mlsd_detection:{type:"mlsd_detection",buildDefaults:()=>({type:"mlsd_detection",score_threshold:.1,distance_threshold:20}),buildGraph:({image_name:e},{score_threshold:t,distance_threshold:n})=>{const s=new Ms(Te("mlsd_detection_filter")),r=s.addNode({id:Te("mlsd_detection"),type:"mlsd_detection",image:{image_name:e},score_threshold:t,distance_threshold:n});return{graph:s,outputNodeId:r.id}}},normal_map:{type:"normal_map",buildDefaults:()=>({type:"normal_map"}),buildGraph:({image_name:e})=>{const t=new Ms(Te("normal_map_filter")),n=t.addNode({id:Te("normal_map"),type:"normal_map",image:{image_name:e}});return{graph:t,outputNodeId:n.id}}},pidi_edge_detection:{type:"pidi_edge_detection",buildDefaults:()=>({type:"pidi_edge_detection",quantize_edges:!1,scribble:!1}),buildGraph:({image_name:e},{quantize_edges:t,scribble:n})=>{const s=new Ms(Te("pidi_edge_detection_filter")),r=s.addNode({id:Te("pidi_edge_detection"),type:"pidi_edge_detection",image:{image_name:e},quantize_edges:t,scribble:n});return{graph:s,outputNodeId:r.id}}},dw_openpose_detection:{type:"dw_openpose_detection",buildDefaults:()=>({type:"dw_openpose_detection",draw_body:!0,draw_face:!0,draw_hands:!0}),buildGraph:({image_name:e},{draw_body:t,draw_face:n,draw_hands:s})=>{const r=new Ms(Te("dw_openpose_detection_filter")),a=r.addNode({id:Te("dw_openpose_detection"),type:"dw_openpose_detection",image:{image_name:e},draw_body:t,draw_face:n,draw_hands:s});return{graph:r,outputNodeId:a.id}}},spandrel_filter:{type:"spandrel_filter",buildDefaults:()=>({type:"spandrel_filter",model:null,autoScale:!0,scale:1}),buildGraph:({image_name:e},{model:t,scale:n,autoScale:s})=>{Fe(t!==null);const r=new Ms(Te("spandrel_filter")),a=r.addNode(s?{id:Te("spandrel_image_to_image_autoscale"),type:"spandrel_image_to_image_autoscale",image_to_image_model:t,image:{image_name:e},scale:n}:{id:Te("spandrel_image_to_image"),type:"spandrel_image_to_image",image_to_image_model:t,image:{image_name:e}});return{graph:r,outputNodeId:a.id}},validateConfig:e=>!!e.model}},Rq={canny_image_processor:"canny_edge_detection",mlsd_image_processor:"mlsd_detection",depth_anything_image_processor:"depth_anything_depth_estimation",normalbae_image_processor:"normal_map",pidi_image_processor:"pidi_edge_detection",lineart_image_processor:"lineart_edge_detection",lineart_anime_image_processor:"lineart_anime_edge_detection",hed_image_processor:"hed_edge_detection",content_shuffle_image_processor:"content_shuffle",dw_openpose_image_processor:"dw_openpose_detection",mediapipe_face_processor:"mediapipe_face_detection",zoe_depth_image_processor:"depth_anything_depth_estimation",color_map_image_processor:"color_map"},Dq=e=>{var s;if(!e)return An.canny_edge_detection;const t=(s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor;if(!t)return An.canny_edge_detection;if(pA(t))return An[t];const n=Rq[t];return n?An[n]:An.canny_edge_detection},oh=An.canny_edge_detection.buildDefaults(),fA=({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(a=>{e({...t,low_threshold:a})},[e,t]),r=l.useCallback(a=>{e({...t,high_threshold:a})},[e,t]);return o.jsxs(o.Fragment,{children:[o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.canny_edge_detection.low_threshold")}),o.jsx(qe,{value:t.low_threshold,onChange:s,defaultValue:oh.low_threshold,min:0,max:255}),o.jsx(Ve,{value:t.low_threshold,onChange:s,defaultValue:oh.low_threshold,min:0,max:255})]}),o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.canny_edge_detection.high_threshold")}),o.jsx(qe,{value:t.high_threshold,onChange:r,defaultValue:oh.high_threshold,min:0,max:255}),o.jsx(Ve,{value:t.high_threshold,onChange:r,defaultValue:oh.high_threshold,min:0,max:255})]})]})};fA.displayName="FilterCannyEdgeDetection";const hC=An.color_map.buildDefaults(),mA=l.memo(({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(r=>{e({...t,tile_size:r})},[t,e]);return o.jsx(o.Fragment,{children:o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.color_map.tile_size")}),o.jsx(qe,{value:t.tile_size,defaultValue:hC.tile_size,onChange:s,min:1,max:256,step:1,marks:!0}),o.jsx(Ve,{value:t.tile_size,defaultValue:hC.tile_size,onChange:s,min:1,max:4096,step:1})]})})});mA.displayName="FilterColorMap";const pC=An.content_shuffle.buildDefaults(),gA=l.memo(({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(r=>{e({...t,scale_factor:r})},[t,e]);return o.jsx(o.Fragment,{children:o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.content_shuffle.scale_factor")}),o.jsx(qe,{value:t.scale_factor,defaultValue:pC.scale_factor,onChange:s,min:0,max:4096,marks:!0}),o.jsx(Ve,{value:t.scale_factor,defaultValue:pC.scale_factor,onChange:s,min:0,max:4096})]})})});gA.displayName="FilterContentShuffle";const xA=l.memo(({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(i=>{wq(i==null?void 0:i.value)&&e({...t,model_size:i.value})},[t,e]),r=l.useMemo(()=>[{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small_v2"),value:"small_v2"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_small"),value:"small"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_base"),value:"base"},{label:n("controlLayers.filter.depth_anything_depth_estimation.model_size_large"),value:"large"}],[n]),a=l.useMemo(()=>r.filter(i=>i.value===t.model_size)[0],[r,t.model_size]);return o.jsx(o.Fragment,{children:o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.depth_anything_depth_estimation.model_size")}),o.jsx(Ne,{value:a,options:r,onChange:s,isSearchable:!1})]})})});xA.displayName="FilterDepthAnythingDepthEstimation";const Hm=An.dw_openpose_detection.buildDefaults(),bA=l.memo(({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(i=>{e({...t,draw_body:i.target.checked})},[t,e]),r=l.useCallback(i=>{e({...t,draw_face:i.target.checked})},[t,e]),a=l.useCallback(i=>{e({...t,draw_hands:i.target.checked})},[t,e]);return o.jsx(o.Fragment,{children:o.jsxs(j,{sx:{flexDir:"row",gap:6},children:[o.jsxs(V,{w:"max-content",children:[o.jsx(U,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_body")}),o.jsx(ot,{defaultChecked:Hm.draw_body,isChecked:t.draw_body,onChange:s})]}),o.jsxs(V,{w:"max-content",children:[o.jsx(U,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_face")}),o.jsx(ot,{defaultChecked:Hm.draw_face,isChecked:t.draw_face,onChange:r})]}),o.jsxs(V,{w:"max-content",children:[o.jsx(U,{m:0,children:n("controlLayers.filter.dw_openpose_detection.draw_hands")}),o.jsx(ot,{defaultChecked:Hm.draw_hands,isChecked:t.draw_hands,onChange:a})]})]})})});bA.displayName="FilterDWOpenposeDetection";const yA=l.memo(({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(r=>{e({...t,scribble:r.target.checked})},[t,e]);return o.jsx(o.Fragment,{children:o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.hed_edge_detection.scribble")}),o.jsx(ot,{isChecked:t.scribble,onChange:s})]})})});yA.displayName="FilterHEDEdgeDetection";const vA=l.memo(({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(r=>{e({...t,coarse:r.target.checked})},[t,e]);return o.jsx(o.Fragment,{children:o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.lineart_edge_detection.coarse")}),o.jsx(ot,{isChecked:t.coarse,onChange:s})]})})});vA.displayName="FilterLineartEdgeDetection";const rh=An.mediapipe_face_detection.buildDefaults(),CA=l.memo(({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(a=>{e({...t,max_faces:a})},[t,e]),r=l.useCallback(a=>{e({...t,min_confidence:a})},[t,e]);return o.jsxs(o.Fragment,{children:[o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.max_faces")}),o.jsx(qe,{value:t.max_faces,onChange:s,defaultValue:rh.max_faces,min:1,max:20,marks:!0}),o.jsx(Ve,{value:t.max_faces,onChange:s,defaultValue:rh.max_faces,min:1,max:20})]}),o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.mediapipe_face_detection.min_confidence")}),o.jsx(qe,{value:t.min_confidence,onChange:r,defaultValue:rh.min_confidence,min:0,max:1,step:.01,marks:!0}),o.jsx(Ve,{value:t.min_confidence,onChange:r,defaultValue:rh.min_confidence,min:0,max:1,step:.01})]})]})});CA.displayName="FilterMediaPipeFaceDetection";const ah=An.mlsd_detection.buildDefaults(),wA=l.memo(({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(a=>{e({...t,distance_threshold:a})},[t,e]),r=l.useCallback(a=>{e({...t,score_threshold:a})},[t,e]);return o.jsxs(o.Fragment,{children:[o.jsxs(V,{children:[o.jsxs(U,{m:0,children:[n("controlLayers.filter.mlsd_detection.score_threshold")," "]}),o.jsx(qe,{value:t.score_threshold,onChange:r,defaultValue:ah.score_threshold,min:0,max:1,step:.01,marks:!0}),o.jsx(Ve,{value:t.score_threshold,onChange:r,defaultValue:ah.score_threshold,min:0,max:1,step:.01})]}),o.jsxs(V,{children:[o.jsxs(U,{m:0,children:[n("controlLayers.filter.mlsd_detection.distance_threshold")," "]}),o.jsx(qe,{value:t.distance_threshold,onChange:s,defaultValue:ah.distance_threshold,min:0,max:100,step:1,marks:!0}),o.jsx(Ve,{value:t.distance_threshold,onChange:s,defaultValue:ah.distance_threshold,min:0,max:1e3,step:1})]})]})});wA.displayName="FilterMLSDDetection";const jA=({onChange:e,config:t})=>{const{t:n}=S(),s=l.useCallback(a=>{e({...t,scribble:a.target.checked})},[t,e]),r=l.useCallback(a=>{e({...t,quantize_edges:a.target.checked})},[t,e]);return o.jsxs(o.Fragment,{children:[o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.pidi_edge_detection.scribble")}),o.jsx(ot,{isChecked:t.scribble,onChange:s})]}),o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.pidi_edge_detection.quantize_edges")}),o.jsx(ot,{isChecked:t.quantize_edges,onChange:r})]})]})};jA.displayName="FilterPiDiNetEdgeDetection";const jc=e=>{const{t}=S(),{modelConfigs:n,selectedModel:s,getIsDisabled:r,onChange:a,isLoading:i,optionsFilter:c=()=>!0}=e,d=l.useMemo(()=>n.filter(c).map(m=>({label:m.name,value:m.key,isDisabled:r?r(m):!1})),[c,r,n]),u=l.useMemo(()=>d.find(m=>s?m.value===s.key:!1),[d,s]),h=l.useCallback(m=>{if(!m){a(null);return}const g=n.find(x=>x.key===m.value);if(!g){a(null);return}a(g)},[n,a]),p=l.useMemo(()=>i?t("common.loading"):d.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[i,d,t]),f=l.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:d,value:u,onChange:h,placeholder:p,noOptionsMessage:f}},fC=An.spandrel_filter.buildDefaults(),SA=({onChange:e,config:t})=>{const{t:n}=S(),[s,{isLoading:r}]=_u(),a=l.useMemo(()=>{var g;if(!(!s.length||!t.model))return(g=s.find(x=>{var C;return x.key===((C=t.model)==null?void 0:C.key)}))==null?void 0:g.description},[s,t.model]),i=l.useCallback(g=>{e({...t,model:g})},[t,e]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=jc({modelConfigs:s,onChange:i,selectedModel:t.model,isLoading:r}),f=l.useCallback(g=>{e({...t,scale:g})},[e,t]),m=l.useCallback(g=>{e({...t,autoScale:g.target.checked})},[e,t]);return l.useEffect(()=>{const g=c[0];!t.model&&g&&u(g)},[t.model,u,c]),o.jsxs(o.Fragment,{children:[o.jsxs(V,{w:"full",orientation:"vertical",children:[o.jsxs(j,{w:"full",alignItems:"center",children:[o.jsx(U,{m:0,flexGrow:1,children:n("controlLayers.filter.spandrel_filter.autoScale")}),o.jsx(ot,{size:"sm",isChecked:t.autoScale,onChange:m})]}),o.jsx(ko,{children:n("controlLayers.filter.spandrel_filter.autoScaleDesc")})]}),o.jsxs(V,{isDisabled:!t.autoScale,children:[o.jsx(U,{m:0,children:n("controlLayers.filter.spandrel_filter.scale")}),o.jsx(qe,{value:t.scale,onChange:f,defaultValue:fC.scale,min:1,max:16}),o.jsx(Ve,{value:t.scale,onChange:f,defaultValue:fC.scale,min:1,max:16})]}),o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.filter.spandrel_filter.model")}),o.jsx(Ae,{label:a,children:o.jsx(xe,{w:"full",children:o.jsx(Ne,{value:d,placeholder:h,options:c,onChange:u,noOptionsMessage:p,isDisabled:c.length===0})})})]})]})};SA.displayName="FilterSpandrel";const kA=l.memo(({filterConfig:e,onChange:t})=>{const{t:n}=S();return e.type==="canny_edge_detection"?o.jsx(fA,{config:e,onChange:t}):e.type==="color_map"?o.jsx(mA,{config:e,onChange:t}):e.type==="content_shuffle"?o.jsx(gA,{config:e,onChange:t}):e.type==="depth_anything_depth_estimation"?o.jsx(xA,{config:e,onChange:t}):e.type==="dw_openpose_detection"?o.jsx(bA,{config:e,onChange:t}):e.type==="hed_edge_detection"?o.jsx(yA,{config:e,onChange:t}):e.type==="lineart_edge_detection"?o.jsx(vA,{config:e,onChange:t}):e.type==="mediapipe_face_detection"?o.jsx(CA,{config:e,onChange:t}):e.type==="mlsd_detection"?o.jsx(wA,{config:e,onChange:t}):e.type==="pidi_edge_detection"?o.jsx(jA,{config:e,onChange:t}):e.type==="spandrel_filter"?o.jsx(SA,{config:e,onChange:t}):o.jsx(Mt,{py:4,label:`${n(`controlLayers.filter.${e.type}.label`)} has no settings`,icon:null})});kA.displayName="Filter";const Oq=pe(Gs,e=>e.sd.disabledControlNetProcessors),IA=l.memo(({filterType:e,onChange:t})=>{const{t:n}=S(),s=w(Oq),r=l.useMemo(()=>To(An,(c,d)=>({value:d,label:n(`controlLayers.filter.${d}.label`)})).filter(c=>!k9(s,c.value)),[s,n]),a=l.useCallback(c=>{c&&(Fe(pA(c.value)),t(c.value))},[t]),i=l.useMemo(()=>r.find(c=>c.value===e)??null,[r,e]);return o.jsx(j,{gap:2,children:o.jsxs(V,{children:[o.jsx(Be,{feature:"controlNetProcessor",children:o.jsx(U,{m:0,children:n("controlLayers.filter.filterType")})}),o.jsx(Ne,{value:i,options:r,onChange:a,isSearchable:!1,isClearable:!1})]})})});IA.displayName="FilterTypeSelect";const _A=l.memo(({adapter:e})=>{const{t}=S(),n=E(),s=l.useRef(null);Oa("canvas",s,{focusOnMount:!0});const r=se(e.filterer.$filterConfig),a=js("canvas"),i=se(e.filterer.$isProcessing),c=se(e.filterer.$hasProcessed),d=w(Tj),u=w(Pj),h=l.useCallback(()=>{n(Rj())},[n]),p=l.useCallback(x=>{e.filterer.$filterConfig.set(x)},[e.filterer.$filterConfig]),f=l.useCallback(x=>{e.filterer.$filterConfig.set(An[x].buildDefaults())},[e.filterer.$filterConfig]),m=l.useCallback(()=>{n(b5())},[n]),g=l.useMemo(()=>{var x,C;return((C=(x=An[r.type]).validateConfig)==null?void 0:C.call(x,r))??!0},[r]);return Ie({id:"applyFilter",category:"canvas",callback:e.filterer.apply,options:{enabled:!i&&a},dependencies:[e.filterer,i,a]}),Ie({id:"cancelFilter",category:"canvas",callback:e.filterer.cancel,options:{enabled:!i&&a},dependencies:[e.filterer,i,a]}),o.jsxs(j,{ref:s,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,w:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[o.jsxs(j,{w:"full",gap:4,children:[o.jsx(Ct,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.filter.filter")}),o.jsx(dt,{}),o.jsxs(V,{w:"min-content",children:[o.jsx(U,{m:0,children:t("controlLayers.filter.autoProcess")}),o.jsx(ot,{size:"sm",isChecked:d,onChange:m})]}),o.jsxs(V,{w:"min-content",children:[o.jsx(U,{m:0,children:t("controlLayers.settings.isolatedPreview")}),o.jsx(ot,{size:"sm",isChecked:u,onChange:h})]})]}),o.jsx(IA,{filterType:r.type,onChange:f}),o.jsx(kA,{filterConfig:r,onChange:p}),o.jsxs(Tn,{isAttached:!1,size:"sm",w:"full",children:[o.jsx(me,{variant:"ghost",leftIcon:o.jsx(af,{}),onClick:e.filterer.processImmediate,isLoading:i,loadingText:t("controlLayers.filter.process"),isDisabled:!g||d,children:t("controlLayers.filter.process")}),o.jsx(dt,{}),o.jsx(me,{leftIcon:o.jsx(sf,{}),onClick:e.filterer.reset,isLoading:i,loadingText:t("controlLayers.filter.reset"),variant:"ghost",children:t("controlLayers.filter.reset")}),o.jsx(me,{variant:"ghost",leftIcon:o.jsx(Ei,{}),onClick:e.filterer.apply,isLoading:i,loadingText:t("controlLayers.filter.apply"),isDisabled:!g||!c,children:t("controlLayers.filter.apply")}),o.jsx(me,{variant:"ghost",leftIcon:o.jsx(sn,{}),onClick:e.filterer.cancel,loadingText:t("controlLayers.filter.cancel"),children:t("controlLayers.filter.cancel")})]})]})});_A.displayName="FilterContent";const MA=()=>{const e=At(),t=se(e.stateApi.$filteringAdapter);return t?o.jsx(_A,{adapter:t}):null};MA.displayName="Filter";const f1=l.memo(({label:e,value:t,color:n})=>o.jsxs(o.Fragment,{children:[o.jsx(ln,{children:o.jsxs(O,{textAlign:"end",children:[e,": "]})}),o.jsx(ln,{fontWeight:"semibold",children:o.jsx(O,{textAlign:"end",color:n,children:t})})]}));f1.displayName="CanvasHUDItem";const Nq=pe(cl,e=>e.rect),AA=l.memo(()=>{const{t:e}=S(),t=w(Nq);return o.jsx(f1,{label:e("controlLayers.HUD.bbox"),value:`${t.width}${t.height} px`})});AA.displayName="CanvasHUDItemBbox";const EA=l.memo(()=>{const{t:e}=S(),t=w(Dj),n=w(y5);return t==="none"?null:o.jsx(f1,{label:e("controlLayers.HUD.scaledBbox"),value:`${n.width}${n.height} px`})});EA.displayName="CanvasHUDItemScaledBbox";const LA=l.memo(()=>o.jsxs(va,{bg:"base.900",borderBottomEndRadius:"base",p:2,gap:1,borderRadius:"base",templateColumns:"1fr 1fr",opacity:.6,minW:64,children:[o.jsx(AA,{}),o.jsx(EA,{})]}));LA.displayName="CanvasHUD";class Xc extends Map{constructor(n){super(n);b(this,"subscriptions",new Set);b(this,"lastSnapshot",null);b(this,"set",(n,s)=>(super.set(n,s),this.notifySubscribers(),this));b(this,"delete",n=>{const s=super.delete(n);return this.notifySubscribers(),s});b(this,"clear",()=>{super.clear(),this.notifySubscribers()});b(this,"notifySubscribers",()=>{for(const n of this.subscriptions)n()});b(this,"subscribe",n=>(this.subscriptions.add(n),()=>{this.subscriptions.delete(n)}));b(this,"getSnapshot",()=>{const n=new Map(this);return(!this.lastSnapshot||!this.areSnapshotsEqual(this.lastSnapshot,n))&&(this.lastSnapshot=n),this.lastSnapshot});b(this,"areSnapshotsEqual",(n,s)=>{if(n.size!==s.size)return!1;for(const[r,a]of n)if(!Object.is(a,s.get(r)))return!1;return!0})}}const Bq=["top-left","top-center","top-right","middle-right","middle-left","bottom-left","bottom-center","bottom-right"],$q=["top-left","top-right","bottom-left","bottom-right"],Fq=[];class zq extends Zt{constructor(n){super();b(this,"type","bbox");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"subscriptions",new Set);b(this,"konva");b(this,"$aspectRatioBuffer",Ge(1));b(this,"initialize",()=>{this.log.debug("Initializing module");const{width:n,height:s}=this.manager.stateApi.runSelector(cl).rect;this.$aspectRatioBuffer.set(n/s),this.render()});b(this,"render",()=>{this.log.trace("Rendering");const{x:n,y:s,width:r,height:a}=this.manager.stateApi.runSelector(cl).rect,i=this.manager.tool.$tool.get();this.konva.group.visible(!0),this.manager.konva.previewLayer.listening(i==="bbox"&&!this.manager.$isBusy.get()),this.konva.proxyRect.setAttrs({x:n,y:s,width:r,height:a,scaleX:1,scaleY:1,listening:i==="bbox"}),this.syncOverlay(),this.konva.transformer.setAttrs({listening:i==="bbox",enabledAnchors:i==="bbox"?Bq:Fq})});b(this,"syncOverlay",()=>{const n=this.manager.stateApi.getSettings().bboxOverlay;if(this.konva.overlayGroup.visible(n),!n)return;const s=this.manager.stage.$stageAttrs.get();this.konva.overlayRect.setAttrs({x:-s.x/s.scale,y:-s.y/s.scale,width:s.width/s.scale,height:s.height/s.scale})});b(this,"onDragMove",()=>{const n=this.manager.stateApi.getGridSize(),s=this.manager.stateApi.getBbox(),r={...s.rect,x:Xs(this.konva.proxyRect.x(),n),y:Xs(this.konva.proxyRect.y(),n)};this.konva.proxyRect.setAttrs(r),(s.rect.x!==r.x||s.rect.y!==r.y)&&this.manager.stateApi.setGenerationBbox(r)});b(this,"onTransform",()=>{const n=this.konva.transformer.getActiveAnchor();if(!n)return;const s=this.manager.stateApi.$altKey.get(),r=this.manager.stateApi.$ctrlKey.get(),a=this.manager.stateApi.$metaKey.get(),i=this.manager.stateApi.$shiftKey.get();let c=r||a?this.manager.stateApi.getBboxGridSize():64;this.manager.stateApi.$altKey.get()&&(c=c*2);let d=this.konva.proxyRect.x(),u=this.konva.proxyRect.y(),h=qu(this.konva.proxyRect.width()*this.konva.proxyRect.scaleX(),c),p=qu(this.konva.proxyRect.height()*this.konva.proxyRect.scaleY(),c);if(i&&$q.includes(n)&&!s){let m=Math.sqrt(h*p*this.$aspectRatioBuffer.get()),g=m/this.$aspectRatioBuffer.get();m=qu(m,c),g=qu(g,c),n==="top-left"&&(d=d-(m-h),u=u-(g-p)),n==="top-right"&&(u=u-(g-p)),n==="bottom-left"&&(d=d-(m-h)),h=m,p=g}const f={x:Math.round(d),y:Math.round(u),width:h,height:p};this.konva.proxyRect.setAttrs({...f,scaleX:1,scaleY:1}),this.manager.stateApi.setGenerationBbox(f),i||this.$aspectRatioBuffer.set(f.width/f.height)});b(this,"onTransformEnd",()=>{this.$aspectRatioBuffer.set(this.konva.proxyRect.width()/this.konva.proxyRect.height())});b(this,"anchorStyleFunc",n=>{(n.hasName("top-center")||n.hasName("bottom-center"))&&(n.height(8),n.offsetY(4),n.width(30),n.offsetX(15)),(n.hasName("middle-left")||n.hasName("middle-right"))&&(n.height(30),n.offsetY(15),n.width(8),n.offsetX(4))});b(this,"fitToLayers",()=>{const n=this.manager.stage.getVisibleRect();if(n.height===0||n.width===0)return;const s=this.manager.stateApi.getBboxGridSize(),r=Py(n.x,s),a=Py(n.y,s),i=Zh(n.width,s),c=Zh(n.height,s);this.manager.stateApi.setGenerationBbox({x:r,y:a,width:i,height:c})});b(this,"anchorDragBoundFunc",(n,s)=>{const r=this.konva.transformer.getStage();Fe(r,"Stage must exist");const i=(this.manager.stateApi.$ctrlKey.get()||this.manager.stateApi.$metaKey.get()?this.manager.stateApi.getBboxGridSize():64)*r.scaleX(),c=r.getAbsolutePosition(),d=c.x%i,u=c.y%i;return{x:Xs(s.x,i)+d,y:Xs(s.y,i)+u}});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,aspectRatioBuffer:this.$aspectRatioBuffer.get(),konva:{group:Ca(this.konva.group),proxyRect:Ca(this.konva.proxyRect),transformer:Ca(this.konva.transformer)}}));b(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating bbox module"),this.konva={group:new Oe.Group({name:`${this.type}:group`,listening:!0}),proxyRect:new Oe.Rect({name:`${this.type}:rect`,listening:!1,strokeEnabled:!0,draggable:!0,stroke:"rgb(42,42,42)",strokeWidth:1,strokeScaleEnabled:!1,perfectDrawEnabled:!1}),overlayGroup:new Oe.Group({name:`${this.type}:overlayGroup`,listening:!1,clipFunc:s=>{const r=this.manager.stage.getScaledStageRect(),a=this.manager.stateApi.runSelector(cl).rect;s.beginPath(),s.moveTo(r.x,r.y),s.lineTo(r.x+r.width,r.y),s.lineTo(r.x+r.width,r.y+r.height),s.lineTo(r.x,r.y+r.height),s.closePath(),s.moveTo(a.x,a.y),s.lineTo(a.x,a.y+a.height),s.lineTo(a.x+a.width,a.y+a.height),s.lineTo(a.x+a.width,a.y),s.closePath()}}),overlayRect:new Oe.Rect({name:`${this.type}:overlay`,listening:!1,strokeEnabled:!1,draggable:!1,fill:"hsl(220 12% 10% / 0.8)",perfectDrawEnabled:!1}),transformer:new Oe.Transformer({name:`${this.type}:transformer`,borderDash:[5,5],borderStroke:"rgba(212,216,234,1)",borderEnabled:!0,borderStrokeWidth:1,rotateEnabled:!1,keepRatio:!1,ignoreStroke:!0,listening:!1,flipEnabled:!1,anchorFill:"rgba(212,216,234,1)",anchorStroke:"rgb(42,42,42)",anchorSize:12,anchorCornerRadius:3,shiftBehavior:"none",centeredScaling:!1,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc})},this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.transformer.on("transform",this.onTransform),this.konva.transformer.on("transformend",this.onTransformEnd),this.konva.transformer.nodes([this.konva.proxyRect]),this.konva.overlayGroup.add(this.konva.overlayRect),this.konva.group.add(this.konva.overlayGroup),this.konva.group.add(this.konva.proxyRect),this.konva.group.add(this.konva.transformer),this.subscriptions.add(this.manager.tool.$tool.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(cl,this.render)),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.syncOverlay)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Oj,this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render))}}const Ui=typeof performance=="object"&&performance&&typeof performance.now=="function"?performance:Date,TA=new Set,j0=typeof process=="object"&&process?process:{},PA=(e,t,n,s)=>{typeof j0.emitWarning=="function"?j0.emitWarning(e,t,n,s):console.error(`[${n}] ${t}: ${e}`)};let bp=globalThis.AbortController,mC=globalThis.AbortSignal;var cw;if(typeof bp>"u"){mC=class{constructor(){b(this,"onabort");b(this,"_onabort",[]);b(this,"reason");b(this,"aborted",!1)}addEventListener(s,r){this._onabort.push(r)}},bp=class{constructor(){b(this,"signal",new mC);t()}abort(s){var r,a;if(!this.signal.aborted){this.signal.reason=s,this.signal.aborted=!0;for(const i of this.signal._onabort)i(s);(a=(r=this.signal).onabort)==null||a.call(r,s)}}};let e=((cw=j0.env)==null?void 0:cw.LRU_CACHE_IGNORE_AC_WARNING)!=="1";const t=()=>{e&&(e=!1,PA("AbortController is not defined. If using lru-cache in node 14, load an AbortController polyfill from the `node-abort-controller` package. A minimal polyfill is provided for use by LRUCache.fetch(), but it should not be relied upon in other contexts (eg, passing it to other APIs that use AbortController/AbortSignal might have undesirable effects). You may disable this with LRU_CACHE_IGNORE_AC_WARNING=1 in the env.","NO_ABORT_CONTROLLER","ENOTSUP",t))}}const Vq=e=>!TA.has(e),oa=e=>e&&e===Math.floor(e)&&e>0&&isFinite(e),RA=e=>oa(e)?e<=Math.pow(2,8)?Uint8Array:e<=Math.pow(2,16)?Uint16Array:e<=Math.pow(2,32)?Uint32Array:e<=Number.MAX_SAFE_INTEGER?Ph:null:null;class Ph extends Array{constructor(t){super(t),this.fill(0)}}var $l;const Xa=class Xa{constructor(t,n){b(this,"heap");b(this,"length");if(!L(Xa,$l))throw new TypeError("instantiate Stack using Stack.create(n)");this.heap=new n(t),this.length=0}static create(t){const n=RA(t);if(!n)return[];He(Xa,$l,!0);const s=new Xa(t,n);return He(Xa,$l,!1),s}push(t){this.heap[this.length++]=t}pop(){return this.heap[--this.length]}};$l=new WeakMap,xt(Xa,$l,!1);let S0=Xa;var dw,uw,go,Ls,xo,bo,Fl,zl,jn,yo,fn,Gt,et,Xn,Ts,Hn,_n,vo,Mn,Co,wo,Ps,jo,pa,es,Se,k0,oi,Ar,Od,Rs,DA,ri,Vl,Nd,ra,aa,I0,Rh,Dh,Wt,_0,ed,ia,M0;const Cy=class Cy{constructor(t){xt(this,Se);xt(this,go);xt(this,Ls);xt(this,xo);xt(this,bo);xt(this,Fl);xt(this,zl);b(this,"ttl");b(this,"ttlResolution");b(this,"ttlAutopurge");b(this,"updateAgeOnGet");b(this,"updateAgeOnHas");b(this,"allowStale");b(this,"noDisposeOnSet");b(this,"noUpdateTTL");b(this,"maxEntrySize");b(this,"sizeCalculation");b(this,"noDeleteOnFetchRejection");b(this,"noDeleteOnStaleGet");b(this,"allowStaleOnFetchAbort");b(this,"allowStaleOnFetchRejection");b(this,"ignoreFetchAbort");xt(this,jn);xt(this,yo);xt(this,fn);xt(this,Gt);xt(this,et);xt(this,Xn);xt(this,Ts);xt(this,Hn);xt(this,_n);xt(this,vo);xt(this,Mn);xt(this,Co);xt(this,wo);xt(this,Ps);xt(this,jo);xt(this,pa);xt(this,es);xt(this,oi,()=>{});xt(this,Ar,()=>{});xt(this,Od,()=>{});xt(this,Rs,()=>!1);xt(this,ri,t=>{});xt(this,Vl,(t,n,s)=>{});xt(this,Nd,(t,n,s,r)=>{if(s||r)throw new TypeError("cannot set size without setting maxSize or maxEntrySize on cache");return 0});b(this,dw,"LRUCache");const{max:n=0,ttl:s,ttlResolution:r=1,ttlAutopurge:a,updateAgeOnGet:i,updateAgeOnHas:c,allowStale:d,dispose:u,disposeAfter:h,noDisposeOnSet:p,noUpdateTTL:f,maxSize:m=0,maxEntrySize:g=0,sizeCalculation:x,fetchMethod:C,memoMethod:y,noDeleteOnFetchRejection:v,noDeleteOnStaleGet:I,allowStaleOnFetchRejection:k,allowStaleOnFetchAbort:M,ignoreFetchAbort:_}=t;if(n!==0&&!oa(n))throw new TypeError("max option must be a nonnegative integer");const A=n?RA(n):Array;if(!A)throw new Error("invalid max value: "+n);if(He(this,go,n),He(this,Ls,m),this.maxEntrySize=g||L(this,Ls),this.sizeCalculation=x,this.sizeCalculation){if(!L(this,Ls)&&!this.maxEntrySize)throw new TypeError("cannot set sizeCalculation without setting maxSize or maxEntrySize");if(typeof this.sizeCalculation!="function")throw new TypeError("sizeCalculation set to non-function")}if(y!==void 0&&typeof y!="function")throw new TypeError("memoMethod must be a function if defined");if(He(this,zl,y),C!==void 0&&typeof C!="function")throw new TypeError("fetchMethod must be a function if specified");if(He(this,Fl,C),He(this,pa,!!C),He(this,fn,new Map),He(this,Gt,new Array(n).fill(void 0)),He(this,et,new Array(n).fill(void 0)),He(this,Xn,new A(n)),He(this,Ts,new A(n)),He(this,Hn,0),He(this,_n,0),He(this,vo,S0.create(n)),He(this,jn,0),He(this,yo,0),typeof u=="function"&&He(this,xo,u),typeof h=="function"?(He(this,bo,h),He(this,Mn,[])):(He(this,bo,void 0),He(this,Mn,void 0)),He(this,jo,!!L(this,xo)),He(this,es,!!L(this,bo)),this.noDisposeOnSet=!!p,this.noUpdateTTL=!!f,this.noDeleteOnFetchRejection=!!v,this.allowStaleOnFetchRejection=!!k,this.allowStaleOnFetchAbort=!!M,this.ignoreFetchAbort=!!_,this.maxEntrySize!==0){if(L(this,Ls)!==0&&!oa(L(this,Ls)))throw new TypeError("maxSize must be a positive integer if specified");if(!oa(this.maxEntrySize))throw new TypeError("maxEntrySize must be a positive integer if specified");Le(this,Se,DA).call(this)}if(this.allowStale=!!d,this.noDeleteOnStaleGet=!!I,this.updateAgeOnGet=!!i,this.updateAgeOnHas=!!c,this.ttlResolution=oa(r)||r===0?r:1,this.ttlAutopurge=!!a,this.ttl=s||0,this.ttl){if(!oa(this.ttl))throw new TypeError("ttl must be a positive integer if specified");Le(this,Se,k0).call(this)}if(L(this,go)===0&&this.ttl===0&&L(this,Ls)===0)throw new TypeError("At least one of max, maxSize, or ttl is required");if(!this.ttlAutopurge&&!L(this,go)&&!L(this,Ls)){const D="LRU_CACHE_UNBOUNDED";Vq(D)&&(TA.add(D),PA("TTL caching without ttlAutopurge, max, or maxSize can result in unbounded memory consumption.","UnboundedCacheWarning",D,Cy))}}static unsafeExposeInternals(t){return{starts:L(t,wo),ttls:L(t,Ps),sizes:L(t,Co),keyMap:L(t,fn),keyList:L(t,Gt),valList:L(t,et),next:L(t,Xn),prev:L(t,Ts),get head(){return L(t,Hn)},get tail(){return L(t,_n)},free:L(t,vo),isBackgroundFetch:n=>{var s;return Le(s=t,Se,Wt).call(s,n)},backgroundFetch:(n,s,r,a)=>{var i;return Le(i=t,Se,Dh).call(i,n,s,r,a)},moveToTail:n=>{var s;return Le(s=t,Se,ed).call(s,n)},indexes:n=>{var s;return Le(s=t,Se,ra).call(s,n)},rindexes:n=>{var s;return Le(s=t,Se,aa).call(s,n)},isStale:n=>{var s;return L(s=t,Rs).call(s,n)}}}get max(){return L(this,go)}get maxSize(){return L(this,Ls)}get calculatedSize(){return L(this,yo)}get size(){return L(this,jn)}get fetchMethod(){return L(this,Fl)}get memoMethod(){return L(this,zl)}get dispose(){return L(this,xo)}get disposeAfter(){return L(this,bo)}getRemainingTTL(t){return L(this,fn).has(t)?1/0:0}*entries(){for(const t of Le(this,Se,ra).call(this))L(this,et)[t]!==void 0&&L(this,Gt)[t]!==void 0&&!Le(this,Se,Wt).call(this,L(this,et)[t])&&(yield[L(this,Gt)[t],L(this,et)[t]])}*rentries(){for(const t of Le(this,Se,aa).call(this))L(this,et)[t]!==void 0&&L(this,Gt)[t]!==void 0&&!Le(this,Se,Wt).call(this,L(this,et)[t])&&(yield[L(this,Gt)[t],L(this,et)[t]])}*keys(){for(const t of Le(this,Se,ra).call(this)){const n=L(this,Gt)[t];n!==void 0&&!Le(this,Se,Wt).call(this,L(this,et)[t])&&(yield n)}}*rkeys(){for(const t of Le(this,Se,aa).call(this)){const n=L(this,Gt)[t];n!==void 0&&!Le(this,Se,Wt).call(this,L(this,et)[t])&&(yield n)}}*values(){for(const t of Le(this,Se,ra).call(this))L(this,et)[t]!==void 0&&!Le(this,Se,Wt).call(this,L(this,et)[t])&&(yield L(this,et)[t])}*rvalues(){for(const t of Le(this,Se,aa).call(this))L(this,et)[t]!==void 0&&!Le(this,Se,Wt).call(this,L(this,et)[t])&&(yield L(this,et)[t])}[(uw=Symbol.iterator,dw=Symbol.toStringTag,uw)](){return this.entries()}find(t,n={}){for(const s of Le(this,Se,ra).call(this)){const r=L(this,et)[s],a=Le(this,Se,Wt).call(this,r)?r.__staleWhileFetching:r;if(a!==void 0&&t(a,L(this,Gt)[s],this))return this.get(L(this,Gt)[s],n)}}forEach(t,n=this){for(const s of Le(this,Se,ra).call(this)){const r=L(this,et)[s],a=Le(this,Se,Wt).call(this,r)?r.__staleWhileFetching:r;a!==void 0&&t.call(n,a,L(this,Gt)[s],this)}}rforEach(t,n=this){for(const s of Le(this,Se,aa).call(this)){const r=L(this,et)[s],a=Le(this,Se,Wt).call(this,r)?r.__staleWhileFetching:r;a!==void 0&&t.call(n,a,L(this,Gt)[s],this)}}purgeStale(){let t=!1;for(const n of Le(this,Se,aa).call(this,{allowStale:!0}))L(this,Rs).call(this,n)&&(Le(this,Se,ia).call(this,L(this,Gt)[n],"expire"),t=!0);return t}info(t){const n=L(this,fn).get(t);if(n===void 0)return;const s=L(this,et)[n],r=Le(this,Se,Wt).call(this,s)?s.__staleWhileFetching:s;if(r===void 0)return;const a={value:r};if(L(this,Ps)&&L(this,wo)){const i=L(this,Ps)[n],c=L(this,wo)[n];if(i&&c){const d=i-(Ui.now()-c);a.ttl=d,a.start=Date.now()}}return L(this,Co)&&(a.size=L(this,Co)[n]),a}dump(){const t=[];for(const n of Le(this,Se,ra).call(this,{allowStale:!0})){const s=L(this,Gt)[n],r=L(this,et)[n],a=Le(this,Se,Wt).call(this,r)?r.__staleWhileFetching:r;if(a===void 0||s===void 0)continue;const i={value:a};if(L(this,Ps)&&L(this,wo)){i.ttl=L(this,Ps)[n];const c=Ui.now()-L(this,wo)[n];i.start=Math.floor(Date.now()-c)}L(this,Co)&&(i.size=L(this,Co)[n]),t.unshift([s,i])}return t}load(t){this.clear();for(const[n,s]of t){if(s.start){const r=Date.now()-s.start;s.start=Ui.now()-r}this.set(n,s.value,s)}}set(t,n,s={}){var f,m,g,x,C;if(n===void 0)return this.delete(t),this;const{ttl:r=this.ttl,start:a,noDisposeOnSet:i=this.noDisposeOnSet,sizeCalculation:c=this.sizeCalculation,status:d}=s;let{noUpdateTTL:u=this.noUpdateTTL}=s;const h=L(this,Nd).call(this,t,n,s.size||0,c);if(this.maxEntrySize&&h>this.maxEntrySize)return d&&(d.set="miss",d.maxEntrySizeExceeded=!0),Le(this,Se,ia).call(this,t,"set"),this;let p=L(this,jn)===0?void 0:L(this,fn).get(t);if(p===void 0)p=L(this,jn)===0?L(this,_n):L(this,vo).length!==0?L(this,vo).pop():L(this,jn)===L(this,go)?Le(this,Se,Rh).call(this,!1):L(this,jn),L(this,Gt)[p]=t,L(this,et)[p]=n,L(this,fn).set(t,p),L(this,Xn)[L(this,_n)]=p,L(this,Ts)[p]=L(this,_n),He(this,_n,p),Uu(this,jn)._++,L(this,Vl).call(this,p,h,d),d&&(d.set="add"),u=!1;else{Le(this,Se,ed).call(this,p);const y=L(this,et)[p];if(n!==y){if(L(this,pa)&&Le(this,Se,Wt).call(this,y)){y.__abortController.abort(new Error("replaced"));const{__staleWhileFetching:v}=y;v!==void 0&&!i&&(L(this,jo)&&((f=L(this,xo))==null||f.call(this,v,t,"set")),L(this,es)&&((m=L(this,Mn))==null||m.push([v,t,"set"])))}else i||(L(this,jo)&&((g=L(this,xo))==null||g.call(this,y,t,"set")),L(this,es)&&((x=L(this,Mn))==null||x.push([y,t,"set"])));if(L(this,ri).call(this,p),L(this,Vl).call(this,p,h,d),L(this,et)[p]=n,d){d.set="replace";const v=y&&Le(this,Se,Wt).call(this,y)?y.__staleWhileFetching:y;v!==void 0&&(d.oldValue=v)}}else d&&(d.set="update")}if(r!==0&&!L(this,Ps)&&Le(this,Se,k0).call(this),L(this,Ps)&&(u||L(this,Od).call(this,p,r,a),d&&L(this,Ar).call(this,d,p)),!i&&L(this,es)&&L(this,Mn)){const y=L(this,Mn);let v;for(;v=y==null?void 0:y.shift();)(C=L(this,bo))==null||C.call(this,...v)}return this}pop(){var t;try{for(;L(this,jn);){const n=L(this,et)[L(this,Hn)];if(Le(this,Se,Rh).call(this,!0),Le(this,Se,Wt).call(this,n)){if(n.__staleWhileFetching)return n.__staleWhileFetching}else if(n!==void 0)return n}}finally{if(L(this,es)&&L(this,Mn)){const n=L(this,Mn);let s;for(;s=n==null?void 0:n.shift();)(t=L(this,bo))==null||t.call(this,...s)}}}has(t,n={}){const{updateAgeOnHas:s=this.updateAgeOnHas,status:r}=n,a=L(this,fn).get(t);if(a!==void 0){const i=L(this,et)[a];if(Le(this,Se,Wt).call(this,i)&&i.__staleWhileFetching===void 0)return!1;if(L(this,Rs).call(this,a))r&&(r.has="stale",L(this,Ar).call(this,r,a));else return s&&L(this,oi).call(this,a),r&&(r.has="hit",L(this,Ar).call(this,r,a)),!0}else r&&(r.has="miss");return!1}peek(t,n={}){const{allowStale:s=this.allowStale}=n,r=L(this,fn).get(t);if(r===void 0||!s&&L(this,Rs).call(this,r))return;const a=L(this,et)[r];return Le(this,Se,Wt).call(this,a)?a.__staleWhileFetching:a}async fetch(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:a=this.noDeleteOnStaleGet,ttl:i=this.ttl,noDisposeOnSet:c=this.noDisposeOnSet,size:d=0,sizeCalculation:u=this.sizeCalculation,noUpdateTTL:h=this.noUpdateTTL,noDeleteOnFetchRejection:p=this.noDeleteOnFetchRejection,allowStaleOnFetchRejection:f=this.allowStaleOnFetchRejection,ignoreFetchAbort:m=this.ignoreFetchAbort,allowStaleOnFetchAbort:g=this.allowStaleOnFetchAbort,context:x,forceRefresh:C=!1,status:y,signal:v}=n;if(!L(this,pa))return y&&(y.fetch="get"),this.get(t,{allowStale:s,updateAgeOnGet:r,noDeleteOnStaleGet:a,status:y});const I={allowStale:s,updateAgeOnGet:r,noDeleteOnStaleGet:a,ttl:i,noDisposeOnSet:c,size:d,sizeCalculation:u,noUpdateTTL:h,noDeleteOnFetchRejection:p,allowStaleOnFetchRejection:f,allowStaleOnFetchAbort:g,ignoreFetchAbort:m,status:y,signal:v};let k=L(this,fn).get(t);if(k===void 0){y&&(y.fetch="miss");const M=Le(this,Se,Dh).call(this,t,k,I,x);return M.__returned=M}else{const M=L(this,et)[k];if(Le(this,Se,Wt).call(this,M)){const P=s&&M.__staleWhileFetching!==void 0;return y&&(y.fetch="inflight",P&&(y.returnedStale=!0)),P?M.__staleWhileFetching:M.__returned=M}const _=L(this,Rs).call(this,k);if(!C&&!_)return y&&(y.fetch="hit"),Le(this,Se,ed).call(this,k),r&&L(this,oi).call(this,k),y&&L(this,Ar).call(this,y,k),M;const A=Le(this,Se,Dh).call(this,t,k,I,x),N=A.__staleWhileFetching!==void 0&&s;return y&&(y.fetch=_?"stale":"refresh",N&&_&&(y.returnedStale=!0)),N?A.__staleWhileFetching:A.__returned=A}}async forceFetch(t,n={}){const s=await this.fetch(t,n);if(s===void 0)throw new Error("fetch() returned undefined");return s}memo(t,n={}){const s=L(this,zl);if(!s)throw new Error("no memoMethod provided to constructor");const{context:r,forceRefresh:a,...i}=n,c=this.get(t,i);if(!a&&c!==void 0)return c;const d=s(t,c,{options:i,context:r});return this.set(t,d,i),d}get(t,n={}){const{allowStale:s=this.allowStale,updateAgeOnGet:r=this.updateAgeOnGet,noDeleteOnStaleGet:a=this.noDeleteOnStaleGet,status:i}=n,c=L(this,fn).get(t);if(c!==void 0){const d=L(this,et)[c],u=Le(this,Se,Wt).call(this,d);return i&&L(this,Ar).call(this,i,c),L(this,Rs).call(this,c)?(i&&(i.get="stale"),u?(i&&s&&d.__staleWhileFetching!==void 0&&(i.returnedStale=!0),s?d.__staleWhileFetching:void 0):(a||Le(this,Se,ia).call(this,t,"expire"),i&&s&&(i.returnedStale=!0),s?d:void 0)):(i&&(i.get="hit"),u?d.__staleWhileFetching:(Le(this,Se,ed).call(this,c),r&&L(this,oi).call(this,c),d))}else i&&(i.get="miss")}delete(t){return Le(this,Se,ia).call(this,t,"delete")}clear(){return Le(this,Se,M0).call(this,"delete")}};go=new WeakMap,Ls=new WeakMap,xo=new WeakMap,bo=new WeakMap,Fl=new WeakMap,zl=new WeakMap,jn=new WeakMap,yo=new WeakMap,fn=new WeakMap,Gt=new WeakMap,et=new WeakMap,Xn=new WeakMap,Ts=new WeakMap,Hn=new WeakMap,_n=new WeakMap,vo=new WeakMap,Mn=new WeakMap,Co=new WeakMap,wo=new WeakMap,Ps=new WeakMap,jo=new WeakMap,pa=new WeakMap,es=new WeakMap,Se=new WeakSet,k0=function(){const t=new Ph(L(this,go)),n=new Ph(L(this,go));He(this,Ps,t),He(this,wo,n),He(this,Od,(a,i,c=Ui.now())=>{if(n[a]=i!==0?c:0,t[a]=i,i!==0&&this.ttlAutopurge){const d=setTimeout(()=>{L(this,Rs).call(this,a)&&Le(this,Se,ia).call(this,L(this,Gt)[a],"expire")},i+1);d.unref&&d.unref()}}),He(this,oi,a=>{n[a]=t[a]!==0?Ui.now():0}),He(this,Ar,(a,i)=>{if(t[i]){const c=t[i],d=n[i];if(!c||!d)return;a.ttl=c,a.start=d,a.now=s||r();const u=a.now-d;a.remainingTTL=c-u}});let s=0;const r=()=>{const a=Ui.now();if(this.ttlResolution>0){s=a;const i=setTimeout(()=>s=0,this.ttlResolution);i.unref&&i.unref()}return a};this.getRemainingTTL=a=>{const i=L(this,fn).get(a);if(i===void 0)return 0;const c=t[i],d=n[i];if(!c||!d)return 1/0;const u=(s||r())-d;return c-u},He(this,Rs,a=>{const i=n[a],c=t[a];return!!c&&!!i&&(s||r())-i>c})},oi=new WeakMap,Ar=new WeakMap,Od=new WeakMap,Rs=new WeakMap,DA=function(){const t=new Ph(L(this,go));He(this,yo,0),He(this,Co,t),He(this,ri,n=>{He(this,yo,L(this,yo)-t[n]),t[n]=0}),He(this,Nd,(n,s,r,a)=>{if(Le(this,Se,Wt).call(this,s))return 0;if(!oa(r))if(a){if(typeof a!="function")throw new TypeError("sizeCalculation must be a function");if(r=a(s,n),!oa(r))throw new TypeError("sizeCalculation return invalid (expect positive integer)")}else throw new TypeError("invalid size value (must be positive integer). When maxSize or maxEntrySize is used, sizeCalculation or size must be set.");return r}),He(this,Vl,(n,s,r)=>{if(t[n]=s,L(this,Ls)){const a=L(this,Ls)-t[n];for(;L(this,yo)>a;)Le(this,Se,Rh).call(this,!0)}He(this,yo,L(this,yo)+t[n]),r&&(r.entrySize=s,r.totalCalculatedSize=L(this,yo))})},ri=new WeakMap,Vl=new WeakMap,Nd=new WeakMap,ra=function*({allowStale:t=this.allowStale}={}){if(L(this,jn))for(let n=L(this,_n);!(!Le(this,Se,I0).call(this,n)||((t||!L(this,Rs).call(this,n))&&(yield n),n===L(this,Hn)));)n=L(this,Ts)[n]},aa=function*({allowStale:t=this.allowStale}={}){if(L(this,jn))for(let n=L(this,Hn);!(!Le(this,Se,I0).call(this,n)||((t||!L(this,Rs).call(this,n))&&(yield n),n===L(this,_n)));)n=L(this,Xn)[n]},I0=function(t){return t!==void 0&&L(this,fn).get(L(this,Gt)[t])===t},Rh=function(t){var a,i;const n=L(this,Hn),s=L(this,Gt)[n],r=L(this,et)[n];return L(this,pa)&&Le(this,Se,Wt).call(this,r)?r.__abortController.abort(new Error("evicted")):(L(this,jo)||L(this,es))&&(L(this,jo)&&((a=L(this,xo))==null||a.call(this,r,s,"evict")),L(this,es)&&((i=L(this,Mn))==null||i.push([r,s,"evict"]))),L(this,ri).call(this,n),t&&(L(this,Gt)[n]=void 0,L(this,et)[n]=void 0,L(this,vo).push(n)),L(this,jn)===1?(He(this,Hn,He(this,_n,0)),L(this,vo).length=0):He(this,Hn,L(this,Xn)[n]),L(this,fn).delete(s),Uu(this,jn)._--,n},Dh=function(t,n,s,r){const a=n===void 0?void 0:L(this,et)[n];if(Le(this,Se,Wt).call(this,a))return a;const i=new bp,{signal:c}=s;c==null||c.addEventListener("abort",()=>i.abort(c.reason),{signal:i.signal});const d={signal:i.signal,options:s,context:r},u=(x,C=!1)=>{const{aborted:y}=i.signal,v=s.ignoreFetchAbort&&x!==void 0;if(s.status&&(y&&!C?(s.status.fetchAborted=!0,s.status.fetchError=i.signal.reason,v&&(s.status.fetchAbortIgnored=!0)):s.status.fetchResolved=!0),y&&!v&&!C)return p(i.signal.reason);const I=m;return L(this,et)[n]===m&&(x===void 0?I.__staleWhileFetching?L(this,et)[n]=I.__staleWhileFetching:Le(this,Se,ia).call(this,t,"fetch"):(s.status&&(s.status.fetchUpdated=!0),this.set(t,x,d.options))),x},h=x=>(s.status&&(s.status.fetchRejected=!0,s.status.fetchError=x),p(x)),p=x=>{const{aborted:C}=i.signal,y=C&&s.allowStaleOnFetchAbort,v=y||s.allowStaleOnFetchRejection,I=v||s.noDeleteOnFetchRejection,k=m;if(L(this,et)[n]===m&&(!I||k.__staleWhileFetching===void 0?Le(this,Se,ia).call(this,t,"fetch"):y||(L(this,et)[n]=k.__staleWhileFetching)),v)return s.status&&k.__staleWhileFetching!==void 0&&(s.status.returnedStale=!0),k.__staleWhileFetching;if(k.__returned===k)throw x},f=(x,C)=>{var v;const y=(v=L(this,Fl))==null?void 0:v.call(this,t,a,d);y&&y instanceof Promise&&y.then(I=>x(I===void 0?void 0:I),C),i.signal.addEventListener("abort",()=>{(!s.ignoreFetchAbort||s.allowStaleOnFetchAbort)&&(x(void 0),s.allowStaleOnFetchAbort&&(x=I=>u(I,!0)))})};s.status&&(s.status.fetchDispatched=!0);const m=new Promise(f).then(u,h),g=Object.assign(m,{__abortController:i,__staleWhileFetching:a,__returned:void 0});return n===void 0?(this.set(t,g,{...d.options,status:void 0}),n=L(this,fn).get(t)):L(this,et)[n]=g,g},Wt=function(t){if(!L(this,pa))return!1;const n=t;return!!n&&n instanceof Promise&&n.hasOwnProperty("__staleWhileFetching")&&n.__abortController instanceof bp},_0=function(t,n){L(this,Ts)[n]=t,L(this,Xn)[t]=n},ed=function(t){t!==L(this,_n)&&(t===L(this,Hn)?He(this,Hn,L(this,Xn)[t]):Le(this,Se,_0).call(this,L(this,Ts)[t],L(this,Xn)[t]),Le(this,Se,_0).call(this,L(this,_n),t),He(this,_n,t))},ia=function(t,n){var r,a,i,c;let s=!1;if(L(this,jn)!==0){const d=L(this,fn).get(t);if(d!==void 0)if(s=!0,L(this,jn)===1)Le(this,Se,M0).call(this,n);else{L(this,ri).call(this,d);const u=L(this,et)[d];if(Le(this,Se,Wt).call(this,u)?u.__abortController.abort(new Error("deleted")):(L(this,jo)||L(this,es))&&(L(this,jo)&&((r=L(this,xo))==null||r.call(this,u,t,n)),L(this,es)&&((a=L(this,Mn))==null||a.push([u,t,n]))),L(this,fn).delete(t),L(this,Gt)[d]=void 0,L(this,et)[d]=void 0,d===L(this,_n))He(this,_n,L(this,Ts)[d]);else if(d===L(this,Hn))He(this,Hn,L(this,Xn)[d]);else{const h=L(this,Ts)[d];L(this,Xn)[h]=L(this,Xn)[d];const p=L(this,Xn)[d];L(this,Ts)[p]=L(this,Ts)[d]}Uu(this,jn)._--,L(this,vo).push(d)}}if(L(this,es)&&((i=L(this,Mn))!=null&&i.length)){const d=L(this,Mn);let u;for(;u=d==null?void 0:d.shift();)(c=L(this,bo))==null||c.call(this,...u)}return s},M0=function(t){var n,s,r;for(const a of Le(this,Se,aa).call(this,{allowStale:!0})){const i=L(this,et)[a];if(Le(this,Se,Wt).call(this,i))i.__abortController.abort(new Error("deleted"));else{const c=L(this,Gt)[a];L(this,jo)&&((n=L(this,xo))==null||n.call(this,i,c,t)),L(this,es)&&((s=L(this,Mn))==null||s.push([i,c,t]))}}if(L(this,fn).clear(),L(this,et).fill(void 0),L(this,Gt).fill(void 0),L(this,Ps)&&L(this,wo)&&(L(this,Ps).fill(0),L(this,wo).fill(0)),L(this,Co)&&L(this,Co).fill(0),He(this,Hn,0),He(this,_n,0),L(this,vo).length=0,He(this,yo,0),He(this,jn,0),L(this,es)&&L(this,Mn)){const a=L(this,Mn);let i;for(;i=a==null?void 0:a.shift();)(r=L(this,bo))==null||r.call(this,...i)}};let cd=Cy;const Hq={imageNameCacheSize:100,canvasElementCacheSize:32,generationModeCacheSize:100};class Wq extends Zt{constructor(n){super();b(this,"type","cache");b(this,"id");b(this,"path");b(this,"log");b(this,"parent");b(this,"manager");b(this,"config",Hq);b(this,"imageNameCache",new cd({max:this.config.imageNameCacheSize}));b(this,"canvasElementCache",new cd({max:this.config.canvasElementCacheSize}));b(this,"generationModeCache",new cd({max:this.config.generationModeCacheSize}));b(this,"clearAll",()=>{this.canvasElementCache.clear(),this.imageNameCache.clear(),this.generationModeCache.clear()});b(this,"destroy",()=>{this.log.debug("Destroying cache module"),this.clearAll()});this.id=Te("cache"),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating cache module")}}class Gq extends Zt{constructor(n){super();b(this,"type","compositor");b(this,"id");b(this,"path");b(this,"log");b(this,"parent");b(this,"manager");b(this,"$isCompositing",Ge(!1));b(this,"$isProcessing",Ge(!1));b(this,"$isUploading",Ge(!1));b(this,"$isBusy",Mo([this.$isCompositing,this.$isProcessing,this.$isUploading],(n,s,r)=>n||s||r));b(this,"getCompositeRasterLayerEntityIds",()=>{const n=[],s=this.manager.stateApi.getRasterLayersState().entities.map(({id:r})=>r);for(const r of s){const a=this.manager.adapters.rasterLayers.get(r);if(!a){this.log.warn({id:r},"Raster layer adapter not found");continue}a.state.isEnabled&&a.state.objects.length>0&&n.push(a.id)}return n});b(this,"getCompositeRasterLayerHash",n=>{const s=[];for(const a of this.getCompositeRasterLayerEntityIds()){const i=this.manager.adapters.rasterLayers.get(a);if(!i){this.log.warn({id:a},"Raster layer adapter not found");continue}s.push(i.getHashableState())}return vm({extra:n,adapterHashes:s})});b(this,"getCompositeRasterLayerCanvas",n=>{const s=this.getCompositeRasterLayerHash({rect:n}),r=this.manager.cache.canvasElementCache.get(s);if(r)return this.log.trace({rect:n},"Using cached composite raster layer canvas"),r;this.log.trace({rect:n},"Building composite raster layer canvas"),this.$isCompositing.set(!0);const a=document.createElement("canvas");a.width=n.width,a.height=n.height;const i=a.getContext("2d");Fe(i!==null,"Canvas 2D context is null"),i.imageSmoothingEnabled=!1;for(const c of this.getCompositeRasterLayerEntityIds()){const d=this.manager.adapters.rasterLayers.get(c);if(!d){this.log.warn({id:c},"Raster layer adapter not found");continue}this.log.trace({id:c},"Drawing raster layer to composite canvas");const u=d.getCanvas(n);i.drawImage(u,0,0)}return this.manager.cache.canvasElementCache.set(s,a),this.$isCompositing.set(!1),a});b(this,"rasterizeAndUploadCompositeRasterLayer",async(n,s)=>{this.log.trace({rect:n},"Rasterizing composite raster layer"),Fe(n.width>0&&n.height>0,"Unable to rasterize empty rect");const r=this.getCompositeRasterLayerCanvas(n);this.$isProcessing.set(!0);const a=await ss(()=>Gh(r));if(this.$isProcessing.set(!1),a.isErr())throw a.error;const i=a.value;this.manager._isDebugging&&Og(i,"Composite raster layer canvas"),this.$isUploading.set(!0);const c=await ss(()=>Ng({blob:i,fileName:"composite-raster-layer.png",image_category:"general",is_intermediate:s.is_intermediate,board_id:s.is_intermediate?void 0:ao(this.manager.store.getState()),metadata:s.metadata}));if(this.$isUploading.set(!1),c.isErr())throw c.error;return c.value});b(this,"getCompositeRasterLayerImageDTO",async n=>{let s=null;const r=this.getCompositeRasterLayerHash({rect:n}),a=this.manager.cache.imageNameCache.get(r);return a&&(s=await Hl(a),s)?(this.log.trace({rect:n,imageName:a,imageDTO:s},"Using cached composite raster layer image"),s):(s=await this.rasterizeAndUploadCompositeRasterLayer(n,{is_intermediate:!0}),this.manager.cache.imageNameCache.set(r,s.image_name),s)});b(this,"getCompositeInpaintMaskEntityIds",()=>{const n=[],s=this.manager.stateApi.getInpaintMasksState().entities.map(({id:r})=>r);for(const r of s){const a=this.manager.adapters.inpaintMasks.get(r);if(!a){this.log.warn({id:r},"Inpaint mask adapter not found");continue}a.state.isEnabled&&a.state.objects.length>0&&n.push(a.id)}return n});b(this,"getCompositeInpaintMaskHash",n=>{const s=[];for(const a of this.getCompositeInpaintMaskEntityIds()){const i=this.manager.adapters.inpaintMasks.get(a);if(!i){this.log.warn({id:a},"Inpaint mask adapter not found");continue}s.push(i.getHashableState())}return vm({extra:n,adapterHashes:s})});b(this,"getCompositeInpaintMaskCanvas",n=>{const s=this.getCompositeInpaintMaskHash({rect:n}),r=this.manager.cache.canvasElementCache.get(s);if(r)return this.log.trace({rect:n},"Using cached composite inpaint mask canvas"),r;this.log.trace({rect:n},"Building composite inpaint mask canvas"),this.$isCompositing.set(!0);const a=document.createElement("canvas");a.width=n.width,a.height=n.height;const i=a.getContext("2d");Fe(i!==null),i.imageSmoothingEnabled=!1;for(const c of this.getCompositeInpaintMaskEntityIds()){const d=this.manager.adapters.inpaintMasks.get(c);if(!d){this.log.warn({id:c},"Inpaint mask adapter not found");continue}this.log.trace({id:c},"Drawing inpaint mask to composite canvas");const u=d.getCanvas(n);i.drawImage(u,0,0)}return this.manager.cache.canvasElementCache.set(s,a),this.$isCompositing.set(!1),a});b(this,"rasterizeAndUploadCompositeInpaintMask",async(n,s)=>{this.log.trace({rect:n},"Rasterizing composite inpaint mask"),Fe(n.width>0&&n.height>0,"Unable to rasterize empty rect");const r=this.getCompositeInpaintMaskCanvas(n);this.$isProcessing.set(!0);const a=await ss(()=>Gh(r));if(this.$isProcessing.set(!1),a.isErr())throw a.error;const i=a.value;this.manager._isDebugging&&Og(i,"Composite inpaint mask canvas"),this.$isUploading.set(!0);const c=await ss(()=>Ng({blob:i,fileName:"composite-inpaint-mask.png",image_category:"general",is_intermediate:!s,board_id:s?ao(this.manager.store.getState()):void 0}));if(this.$isUploading.set(!1),c.isErr())throw c.error;return c.value});b(this,"getCompositeInpaintMaskImageDTO",async n=>{let s=null;const r=this.getCompositeInpaintMaskHash({rect:n}),a=this.manager.cache.imageNameCache.get(r);return a&&(s=await Hl(a),s)?(this.log.trace({rect:n,cachedImageName:a,imageDTO:s},"Using cached composite inpaint mask image"),s):(s=await this.rasterizeAndUploadCompositeInpaintMask(n,!1),this.manager.cache.imageNameCache.set(r,s.image_name),s)});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isCompositing:this.$isCompositing.get(),$isProcessing:this.$isProcessing.get(),$isUploading:this.$isUploading.get(),$isBusy:this.$isBusy.get()}));this.id=Te("canvas_compositor"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating compositor module")}getGenerationMode(){const{rect:n}=this.manager.stateApi.getBbox(),s=this.getCompositeInpaintMaskHash({rect:n}),r=this.getCompositeRasterLayerHash({rect:n}),a=vm({rect:n,compositeInpaintMaskHash:s,compositeRasterLayerHash:r}),i=this.manager.cache.generationModeCache.get(a);if(i)return this.log.trace({rect:n,cachedGenerationMode:i},"Using cached generation mode"),i;const c=this.getCompositeInpaintMaskCanvas(n);this.$isProcessing.set(!0);const d=Bg(c),u=Ry(d);this.$isProcessing.set(!1);const h=this.getCompositeRasterLayerCanvas(n);this.$isProcessing.set(!0);const p=Bg(h),f=Ry(p);this.$isProcessing.set(!1);let m;return f==="FULLY_TRANSPARENT"?m="txt2img":f==="PARTIALLY_TRANSPARENT"?m="outpaint":u==="FULLY_TRANSPARENT"?m="img2img":m="inpaint",this.manager.cache.generationModeCache.set(a,m),m}}function Uq(e,t=!1){const n=(16777216+(e.r<<16)+(e.g<<8)+e.b).toString(16).slice(1),s=Math.round(e.a*255).toString(16).padStart(2,"0");return t?`#${n}${s}`:`#${n}`}function Zq(e,t){e=e.replace(/^#/,"");const n=parseInt(e.substring(0,2),16),s=parseInt(e.substring(2,4),16),r=parseInt(e.substring(4,6),16);return{r:n,g:s,b:r,a:t}}const Sc=e=>{const{r:t,g:n,b:s,a:r}=e;return`rgba(${t}, ${n}, ${s}, ${r})`},Hr=e=>{const{r:t,g:n,b:s}=e;return`rgba(${t}, ${n}, ${s})`};class dd extends Zt{constructor(n,s){super();b(this,"type","object_brush_line");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"state");b(this,"konva");b(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:cn(this.state)}));const{id:r,clip:a}=n;this.id=r,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Oe.Group({name:`${this.type}:group`,clip:a,listening:!1}),line:new Oe.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line");const{points:r,color:a,strokeWidth:i}=n;return this.konva.line.setAttrs({points:r.length===2?[...r,...r]:r,stroke:Sc(a),strokeWidth:i}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class yp extends Zt{constructor(n,s){super();b(this,"type","object_brush_line_with_pressure");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"state");b(this,"konva");b(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:cn(this.state)}));const{id:r,clip:a}=n;this.id=r,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Oe.Group({name:`${this.type}:group`,clip:a,listening:!1}),line:new Oe.Path({name:`${this.type}:path`,listening:!1,shadowForStrokeEnabled:!1,globalCompositeOperation:"source-over",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating brush line with pressure");const{points:r,color:a,strokeWidth:i}=n;return this.konva.line.setAttrs({data:Nj(r,{size:i/2,simulatePressure:!1,last:!0,thinning:1}),fill:Sc(a)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class ud extends Zt{constructor(n,s){super();b(this,"type","object_eraser_line");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"state");b(this,"konva");b(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:cn(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating eraser line renderer module"),this.konva={group:new Oe.Group({name:`${this.type}:group`,clip:n.clip,listening:!1}),line:new Oe.Line({name:`${this.type}:line`,listening:!1,shadowForStrokeEnabled:!1,stroke:"red",tension:.3,lineCap:"round",lineJoin:"round",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line");const{points:r,strokeWidth:a}=n;return this.konva.line.setAttrs({points:r.length===2?[...r,...r]:r,strokeWidth:a}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting brush line visibility"),this.konva.group.visible(n)}}class vp extends Zt{constructor(n,s){super();b(this,"type","object_eraser_line_with_pressure");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"state");b(this,"konva");b(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,state:cn(this.state)}));const{id:r,clip:a}=n;this.id=r,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Oe.Group({name:`${this.type}:group`,clip:a,listening:!1}),line:new Oe.Path({name:`${this.type}:path`,listening:!1,fill:"red",shadowForStrokeEnabled:!1,globalCompositeOperation:"destination-out",perfectDrawEnabled:!1})},this.konva.group.add(this.konva.line),this.state=n}update(n,s=!1){if(s||this.state!==n){this.log.trace({state:n},"Updating eraser line with pressure");const{points:r,strokeWidth:a}=n;return this.konva.line.setAttrs({data:Nj(r,{size:a/2,simulatePressure:!1,last:!0,thinning:1})}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting eraser line visibility"),this.konva.group.visible(n)}}const qq=new Error("request for lock canceled");var Kq=function(e,t,n,s){function r(a){return a instanceof n?a:new n(function(i){i(a)})}return new(n||(n=Promise))(function(a,i){function c(h){try{u(s.next(h))}catch(p){i(p)}}function d(h){try{u(s.throw(h))}catch(p){i(p)}}function u(h){h.done?a(h.value):r(h.value).then(c,d)}u((s=s.apply(e,t||[])).next())})};class Qq{constructor(t,n=qq){this._value=t,this._cancelError=n,this._queue=[],this._weightedWaiters=[]}acquire(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return new Promise((s,r)=>{const a={resolve:s,reject:r,weight:t,priority:n},i=OA(this._queue,c=>n<=c.priority);i===-1&&t<=this._value?this._dispatchItem(a):this._queue.splice(i+1,0,a)})}runExclusive(t){return Kq(this,arguments,void 0,function*(n,s=1,r=0){const[a,i]=yield this.acquire(s,r);try{return yield n(a)}finally{i()}})}waitForUnlock(t=1,n=0){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);return this._couldLockImmediately(t,n)?Promise.resolve():new Promise(s=>{this._weightedWaiters[t-1]||(this._weightedWaiters[t-1]=[]),Yq(this._weightedWaiters[t-1],{resolve:s,priority:n})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(t){this._value=t,this._dispatchQueue()}release(t=1){if(t<=0)throw new Error(`invalid weight ${t}: must be positive`);this._value+=t,this._dispatchQueue()}cancel(){this._queue.forEach(t=>t.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(t){const n=this._value;this._value-=t.weight,t.resolve([n,this._newReleaser(t.weight)])}_newReleaser(t){let n=!1;return()=>{n||(n=!0,this.release(t))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let t=this._value;t>0;t--){const n=this._weightedWaiters[t-1];n&&(n.forEach(s=>s.resolve()),this._weightedWaiters[t-1]=[])}else{const t=this._queue[0].priority;for(let n=this._value;n>0;n--){const s=this._weightedWaiters[n-1];if(!s)continue;const r=s.findIndex(a=>a.priority<=t);(r===-1?s:s.splice(0,r)).forEach(a=>a.resolve())}}}_couldLockImmediately(t,n){return(this._queue.length===0||this._queue[0].priority<n)&&t<=this._value}}function Yq(e,t){const n=OA(e,s=>t.priority<=s.priority);e.splice(n+1,0,t)}function OA(e,t){for(let n=e.length-1;n>=0;n--)if(t(e[n]))return n;return-1}var Jq=function(e,t,n,s){function r(a){return a instanceof n?a:new n(function(i){i(a)})}return new(n||(n=Promise))(function(a,i){function c(h){try{u(s.next(h))}catch(p){i(p)}}function d(h){try{u(s.throw(h))}catch(p){i(p)}}function u(h){h.done?a(h.value):r(h.value).then(c,d)}u((s=s.apply(e,t||[])).next())})};class m1{constructor(t){this._semaphore=new Qq(1,t)}acquire(){return Jq(this,arguments,void 0,function*(t=0){const[,n]=yield this._semaphore.acquire(1,t);return n})}runExclusive(t,n=0){return this._semaphore.runExclusive(()=>t(),1,n)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(t=0){return this._semaphore.waitForUnlock(1,t)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}class Ll extends Zt{constructor(n,s){super();b(this,"type","object_image");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"state");b(this,"konva");b(this,"imageElement",null);b(this,"isLoading",!1);b(this,"isError",!1);b(this,"mutex",new m1);b(this,"updateImageSource",async n=>{try{this.log.trace({imageName:n},"Updating image source"),this.isLoading=!0,this.konva.group.visible(!0),this.konva.image||(this.konva.placeholder.group.visible(!1),this.konva.placeholder.text.text(ve("common.loadingImage","Loading Image")));const s=await Hl(n);if(s===null){this.onFailedToLoadImage();return}this.imageElement=await Bj(s.image_url),await this.updateImageElement()}catch{this.onFailedToLoadImage()}});b(this,"onFailedToLoadImage",()=>{var n;this.log({image:this.state.image},"Failed to load image"),(n=this.konva.image)==null||n.visible(!1),this.isLoading=!1,this.isError=!0,this.konva.placeholder.text.text(ve("common.imageFailedToLoad","Image Failed to Load")),this.konva.placeholder.group.visible(!0)});b(this,"updateImageElement",async()=>{const n=await this.mutex.acquire();try{if(this.imageElement){const{width:s,height:r}=this.state.image;this.konva.image?(this.log.trace("Updating Konva image attrs"),this.konva.image.setAttrs({image:this.imageElement,width:s,height:r})):(this.log.trace("Creating new Konva image"),this.konva.image=new Oe.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,width:s,height:r,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.placeholder.rect.setAttrs({width:s,height:r}),this.konva.placeholder.text.setAttrs({width:s,height:r,fontSize:s/16}),this.isLoading=!1,this.isError=!1,this.konva.placeholder.group.visible(!1)}}finally{n()}});b(this,"update",async(n,s=!1)=>{var r;if(s||this.state!==n){this.log.trace({state:n},"Updating image");const{image:a}=n,{width:i,height:c,image_name:d}=a;return(s||this.state.image.image_name!==d&&!this.isLoading)&&await this.updateImageSource(d),(r=this.konva.image)==null||r.setAttrs({width:i,height:c}),this.state=n,!0}return!1});b(this,"destroy",()=>{this.log.debug("Destroying image renderer module"),this.konva.group.destroy()});b(this,"setVisibility",n=>{this.log.trace({isVisible:n},"Setting image visibility"),this.konva.group.visible(n)});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isLoading:this.isLoading,isError:this.isError,state:cn(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module");const{width:r,height:a}=n.image;this.konva={group:new Oe.Group({name:`${this.type}:group`,listening:!1}),placeholder:{group:new Oe.Group({name:`${this.type}:placeholder_group`,listening:!1}),rect:new Oe.Rect({name:`${this.type}:placeholder_rect`,fill:"hsl(220 12% 45% / 1)",width:r,height:a,listening:!1,perfectDrawEnabled:!1}),text:new Oe.Text({name:`${this.type}:placeholder_text`,fill:"hsl(220 12% 10% / 1)",width:r,height:a,align:"center",verticalAlign:"middle",fontFamily:'"Inter Variable", sans-serif',fontSize:r/16,fontStyle:"600",text:ve("common.loadingImage","Loading Image"),listening:!1,perfectDrawEnabled:!1})},image:null},this.konva.placeholder.group.add(this.konva.placeholder.rect),this.konva.placeholder.group.add(this.konva.placeholder.text),this.konva.group.add(this.konva.placeholder.group),this.state=n}}class Cp extends Zt{constructor(n,s){super();b(this,"type","object_rect");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"state");b(this,"konva");b(this,"isFirstRender",!1);b(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,isFirstRender:this.isFirstRender,state:cn(this.state)}));this.id=n.id,this.parent=s,this.manager=s.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug({state:n},"Creating module"),this.konva={group:new Oe.Group({name:`${this.type}:group`,listening:!1}),rect:new Oe.Rect({name:`${this.type}:rect`,listening:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.rect),this.state=n}update(n,s=!1){if(s||this.state!==n){this.isFirstRender=!1,this.log.trace({state:n},"Updating rect");const{rect:r,color:a}=n;return this.konva.rect.setAttrs({x:r.x,y:r.y,width:r.width,height:r.height,fill:Sc(a)}),this.state=n,!0}return!1}setVisibility(n){this.log.trace({isVisible:n},"Setting rect visibility"),this.konva.group.visible(n)}}class Ef extends Zt{constructor(n){super();b(this,"type","buffer_renderer");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"subscriptions",new Set);b(this,"state",null);b(this,"renderer",null);b(this,"konva");b(this,"renderBufferObject",async()=>{let n=!1;if(!this.state)return!1;let s=null;return this.renderer&&this.renderer.id!==this.state.id&&(s=this.renderer,this.renderer=null),this.state.type==="brush_line"?(Fe(this.renderer instanceof dd||!this.renderer),this.renderer||(this.renderer=new dd(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="brush_line_with_pressure"?(Fe(this.renderer instanceof yp||!this.renderer),this.renderer||(this.renderer=new yp(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line"?(Fe(this.renderer instanceof ud||!this.renderer),this.renderer||(this.renderer=new ud(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="eraser_line_with_pressure"?(Fe(this.renderer instanceof vp||!this.renderer),this.renderer||(this.renderer=new vp(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="rect"?(Fe(this.renderer instanceof Cp||!this.renderer),this.renderer||(this.renderer=new Cp(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=this.renderer.update(this.state,!0)):this.state.type==="image"&&(Fe(this.renderer instanceof Ll||!this.renderer),this.renderer||(this.renderer=new Ll(this.state,this),this.konva.group.add(this.renderer.konva.group)),n=await this.renderer.update(this.state,!0)),s&&s.destroy(),n});b(this,"hasBuffer",()=>this.state!==null||this.renderer!==null);b(this,"setBuffer",async(n,s=!1)=>(this.log.trace("Setting buffer"),this.state=n,s&&this.konva.group.offset({x:0,y:0}),await this.renderBufferObject()));b(this,"clearBuffer",()=>{var n;(this.state||this.renderer)&&(this.log.trace("Clearing buffer"),(n=this.renderer)==null||n.destroy(),this.renderer=null,this.state=null)});b(this,"commitBuffer",n=>{const{pushToState:s}={...n,pushToState:!0};if(!this.state||!this.renderer){this.log.trace("No buffer to commit");return}if(this.log.trace({buffer:this.renderer.repr()},"Committing buffer"),this.parent.renderer.adoptObjectRenderer(this.renderer),s){const r=this.parent.entityIdentifier;switch(this.state.type){case"brush_line":case"brush_line_with_pressure":this.manager.stateApi.addBrushLine({entityIdentifier:r,brushLine:this.state});break;case"eraser_line":case"eraser_line_with_pressure":this.manager.stateApi.addEraserLine({entityIdentifier:r,eraserLine:this.state});break;case"rect":this.manager.stateApi.addRect({entityIdentifier:r,rect:this.state});break}}this.renderer=null,this.state=null});b(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.renderer&&this.renderer.destroy()});b(this,"repr",()=>{var n;return{id:this.id,type:this.type,path:this.path,parent:this.parent.id,bufferState:cn(this.state),bufferRenderer:(n=this.renderer)==null?void 0:n.repr()}});this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Oe.Group({name:`${this.type}:buffer_group`,listening:!1})},this.parent.konva.layer.add(this.konva.group),this.subscriptions.add(this.manager.tool.$tool.listen(()=>{this.hasBuffer()&&!this.manager.$isBusy.get()&&this.commitBuffer()}))}}const Xq={processDebounceMs:1e3};class NA extends Zt{constructor(n){super();b(this,"type","canvas_filterer");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"imageState",null);b(this,"subscriptions",new Set);b(this,"config",Xq);b(this,"abortController",null);b(this,"$isFiltering",Ge(!1));b(this,"$hasProcessed",Ge(!1));b(this,"$isProcessing",Ge(!1));b(this,"$filterConfig",Ge(An.canny_edge_detection.buildDefaults()));b(this,"start",n=>{const s=this.manager.stateApi.$filteringAdapter.get();if(s&&Fe(!1,`Already filtering an entity: ${s.id}`),this.log.trace("Initializing filter"),n)this.$filterConfig.set(n);else if(this.parent.type==="control_layer_adapter"&&this.parent.state.controlAdapter.model){const r=DZ(this.parent.state.controlAdapter.model.key,wj),a=this.manager.stateApi.runSelector(r),i=Dq(a);this.$filterConfig.set(i.buildDefaults())}else this.$filterConfig.set(An.canny_edge_detection.buildDefaults());this.$isFiltering.set(!0),this.manager.stateApi.$filteringAdapter.set(this.parent),this.manager.stateApi.getSettings().autoProcessFilter&&this.processImmediate()});b(this,"processImmediate",async()=>{var m;const n=this.$filterConfig.get(),s=An[n.type];if(!(((m=s.validateConfig)==null?void 0:m.call(s,n))??!0)){this.log.error({config:n},"Invalid filter config");return}this.log.trace({config:n},"Processing filter");const a=this.parent.transformer.getRelativeRect(),i=await ss(()=>this.parent.renderer.rasterize({rect:a,attrs:{filters:[],opacity:1}}));if(i.isErr()){this.log.error({error:ya(i.error)},"Error rasterizing entity"),this.$isProcessing.set(!1);return}this.$isProcessing.set(!0);const c=i.value,d=v5(()=>s.buildGraph(c,n));if(d.isErr()){this.log.error({error:ya(d.error)},"Error building filter graph"),this.$isProcessing.set(!1);return}const u=new AbortController;this.abortController=u;const{graph:h,outputNodeId:p}=d.value,f=await ss(()=>this.manager.stateApi.runGraphAndReturnImageOutput({graph:h,outputNodeId:p,prepend:!0,signal:u.signal}));if(f.isErr()){this.log.error({error:ya(f.error)},"Error processing filter"),this.$isProcessing.set(!1),this.abortController=null;return}this.log.trace({imageDTO:f.value},"Filter processed"),this.imageState=Nr(f.value),await this.parent.bufferRenderer.setBuffer(this.imageState,!0),this.$isProcessing.set(!1),this.$hasProcessed.set(!0),this.abortController=null});b(this,"process",Ai(this.processImmediate,this.config.processDebounceMs));b(this,"apply",()=>{const n=this.imageState;if(!n){this.log.warn("No image state to apply filter to");return}this.log.trace("Applying filter"),this.parent.bufferRenderer.commitBuffer();const s=this.parent.transformer.getRelativeRect();this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:n,position:{x:Math.round(s.x),y:Math.round(s.y)},replaceObjects:!0}),this.imageState=null,this.$isFiltering.set(!1),this.$hasProcessed.set(!1),this.manager.stateApi.$filteringAdapter.set(null)});b(this,"reset",()=>{var n;this.log.trace("Resetting filter"),(n=this.abortController)==null||n.abort(),this.abortController=null,this.parent.bufferRenderer.clearBuffer(),this.parent.transformer.updatePosition(),this.parent.renderer.syncKonvaCache(!0),this.imageState=null,this.$hasProcessed.set(!1)});b(this,"cancel",()=>{this.log.trace("Cancelling filter"),this.reset(),this.$isProcessing.set(!1),this.$isFiltering.set(!1),this.$hasProcessed.set(!1),this.manager.stateApi.$filteringAdapter.set(null)});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$isFiltering:this.$isFiltering.get(),$hasProcessed:this.$hasProcessed.get(),$isProcessing:this.$isProcessing.get(),$filterConfig:this.$filterConfig.get()}));this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating filter module"),this.subscriptions.add(this.$filterConfig.listen(()=>{this.manager.stateApi.getSettings().autoProcessFilter&&this.$isFiltering.get()&&this.process()})),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Tj,s=>{s&&this.$isFiltering.get()&&this.process()}))}}const eK=e=>{const t=e.data.length/4;for(let n=0;n<t;n++){const s=e.data[n*4+0],r=e.data[n*4+1],a=e.data[n*4+2],i=e.data[n*4+3],c=Math.min(s,r,a),d=Math.max(s,r,a);e.data[n*4+3]=Math.min(i,(c+d)/2)}},tK=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="6px" height="6px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
    <path d="M1,-2L13,10" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
    <path d="M-1,2L10,13" style="fill:none;stroke:black;stroke-width:1.2px;"/>\r
</svg>\r
`,nK=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="6px" height="6px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0,10L9,1" style="fill:none;stroke:black;stroke-width:1.3px;"/>\r
    <path d="M-1,5L8,-4" style="fill:none;stroke:black;stroke-width:1.3px;"/>\r
</svg>\r
`,sK=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="12px" height="12px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0.5,-1L0.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M4.5,-1L4.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M8.5,-1L8.5,12" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M-1,0.5L12,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M-1,4.5L12,4.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M-1,8.5L12,8.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
</svg>\r
`,oK=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="9px" height="9px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M10,0.5L-1,0.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M10,3.5L-1,3.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M10,6.5L-1,6.5" style="fill:none;stroke:black;stroke-width:1px;"/>\r
</svg>\r
`,rK=`<?xml version="1.0" encoding="UTF-8" standalone="no"?>\r
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\r
<svg width="9px" height="9px" version="1.1"\r
    xmlns="http://www.w3.org/2000/svg"\r
    xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve"\r
    xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:1.5;">\r
    <path d="M0.5,-1L0.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M3.5,-1L3.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>\r
    <path d="M6.5,-1L6.5,10" style="fill:none;stroke:black;stroke-width:1px;"/>\r
</svg>\r
`;function aK(e,t){let n="data:image/svg+xml;utf8,";return e==="crosshatch"?n+=tK:e==="diagonal"?n+=nK:e==="horizontal"?n+=oK:e==="vertical"?n+=rK:e==="grid"&&(n+=sK),n=n.replaceAll("stroke:black",`stroke:${Hr(t)}`),n}function iK(e,...t){const n=new Image;return n.onload=()=>{e.fillPatternImage(n)},n.crossOrigin=qd.get()?"use-credentials":"anonymous",n.src=aK(...t),n}class Lf extends Zt{constructor(n){super();b(this,"type","object_renderer");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"subscriptions",new Set);b(this,"renderers",new Xc);b(this,"konva");b(this,"initialize",async()=>{this.log.debug("Initializing module"),await this.render()});b(this,"render",async()=>{let n=!1;const s=this.parent.state.objects,r=s.map(a=>a.id);for(const a of this.renderers.values())r.includes(a.id)||(this.renderers.delete(a.id),a.destroy(),n=!0);for(const a of s)n=await this.renderObject(a)||n;return this.syncKonvaCache(n),n});b(this,"adoptObjectRenderer",n=>{this.renderers.set(n.id,n),n.konva.group.moveTo(this.konva.objectGroup)});b(this,"syncKonvaCache",(n=!1)=>{if(this.renderers.size===0){this.log.trace("Clearing object group cache"),this.konva.objectGroup.clearCache();return}const s=this.parent.konva.layer.visible(),r=this.konva.objectGroup.isCached();s&&(n||!r)&&(this.log.trace("Caching object group"),this.konva.objectGroup.clearCache(),this.konva.objectGroup.cache({pixelRatio:1,imageSmoothingEnabled:!1}))});b(this,"updateTransparencyEffect",()=>{if(this.parent.state.type==="control_layer"){const n=this.parent.state.withTransparencyEffect?[eK]:[];this.konva.objectGroup.filters(n)}});b(this,"updateCompositingRectFill",Kg(n=>{if(!n&&!this.hasObjects())return;this.log.trace("Updating compositing rect fill"),Fe(this.konva.compositing,"Missing compositing rect"),Fe(this.parent.state.type==="inpaint_mask"||this.parent.state.type==="regional_guidance");const s=this.parent.state.fill;s.style==="solid"?this.konva.compositing.rect.setAttrs({fill:Hr(s.color),fillPriority:"color"}):(this.konva.compositing.rect.setAttrs({fillPriority:"pattern"}),iK(this.konva.compositing.rect,s.style,s.color))},100));b(this,"updateCompositingRectSize",n=>{if(!n&&!this.hasObjects())return;this.log.trace("Updating compositing rect size"),Fe(this.konva.compositing,"Missing compositing rect");const s=this.manager.stage.unscale(1);this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect(),fillPatternScaleX:s,fillPatternScaleY:s})});b(this,"updateCompositingRectPosition",n=>{!n&&!this.hasObjects()||(this.log.trace("Updating compositing rect position"),Fe(this.konva.compositing,"Missing compositing rect"),this.konva.compositing.rect.setAttrs({...this.manager.stage.getScaledStageRect()}))});b(this,"updateOpacity",Kg(()=>{this.log.trace("Updating opacity");const n=this.parent.state.opacity;this.konva.compositing?this.konva.compositing.group.opacity(n):this.konva.objectGroup.opacity(n),this.parent.bufferRenderer.konva.group.opacity(n)},100));b(this,"renderObject",async(n,s=!1)=>{let r=!1,a=this.renderers.get(n.id);const i=!a;return n.type==="brush_line"?(Fe(a instanceof dd||!a),a||(a=new dd(n,this),this.renderers.set(a.id,a),this.konva.objectGroup.add(a.konva.group)),r=a.update(n,s||i)):n.type==="brush_line_with_pressure"?(Fe(a instanceof yp||!a),a||(a=new yp(n,this),this.renderers.set(a.id,a),this.konva.objectGroup.add(a.konva.group)),r=a.update(n,s||i)):n.type==="eraser_line"?(Fe(a instanceof ud||!a),a||(a=new ud(n,this),this.renderers.set(a.id,a),this.konva.objectGroup.add(a.konva.group)),r=a.update(n,s||i)):n.type==="eraser_line_with_pressure"?(Fe(a instanceof vp||!a),a||(a=new vp(n,this),this.renderers.set(a.id,a),this.konva.objectGroup.add(a.konva.group)),r=a.update(n,s||i)):n.type==="rect"?(Fe(a instanceof Cp||!a),a||(a=new Cp(n,this),this.renderers.set(a.id,a),this.konva.objectGroup.add(a.konva.group)),r=a.update(n,s||i)):n.type==="image"&&(Fe(a instanceof Ll||!a),a||(a=new Ll(n,this),this.renderers.set(a.id,a),this.konva.objectGroup.add(a.konva.group)),r=await a.update(n,s||i)),r&&this.konva.objectGroup.isCached()&&this.konva.objectGroup.clearCache(),r});b(this,"needsPixelBbox",()=>{let n=!1;for(const s of this.renderers.values()){const r=s instanceof ud,a=s instanceof Ll,i=s instanceof dd&&s.state.clip;if(r||i||a){n=!0;break}}return n});b(this,"hasObjects",()=>this.renderers.size>0||this.parent.bufferRenderer.hasBuffer());b(this,"rasterize",async n=>{const s=this.manager.stateApi.$rasterizingAdapter.get();s&&Fe(!1,`Already rasterizing an entity: ${s.id}`);const{rect:r,replaceObjects:a,attrs:i,bg:c,ignoreCache:d}={replaceObjects:!1,ignoreCache:!1,attrs:{},...n};let u=null;const h={rect:r,attrs:i,bg:c},p=this.parent.hash(h),f=this.manager.cache.imageNameCache.get(p);if(f&&!d&&(u=await Hl(f),u))return this.log.trace({rect:r,cachedImageName:f,imageDTO:u},"Using cached rasterized image"),u;this.log.trace({rasterizeArgs:h},"Rasterizing entity"),this.manager.stateApi.$rasterizingAdapter.set(this.parent);const m=await this.getBlob(h);this.manager._isDebugging&&Og(m,"Rasterized entity"),u=await Ng({blob:m,fileName:`${this.id}_rasterized.png`,image_category:"other",is_intermediate:!0});const g=Nr(u);return a&&(await this.parent.bufferRenderer.setBuffer(g),this.parent.bufferRenderer.commitBuffer({pushToState:!1})),this.manager.stateApi.rasterizeEntity({entityIdentifier:this.parent.entityIdentifier,imageObject:g,position:{x:Math.round(r.x),y:Math.round(r.y)},replaceObjects:a}),this.manager.cache.imageNameCache.set(p,u.image_name),this.manager.stateApi.$rasterizingAdapter.set(null),u});b(this,"cloneObjectGroup",(n={})=>{const{attrs:s}=n,r=this.konva.objectGroup.clone();return s&&r.setAttrs(s),r.hasChildren()&&r.cache({pixelRatio:1,imageSmoothingEnabled:!1}),r});b(this,"getCanvas",(n={})=>{const{rect:s,attrs:r,bg:a}=n,i=this.cloneObjectGroup({attrs:r}),c=C5({node:i,rect:s,bg:a});return i.destroy(),c});b(this,"getBlob",async(n={})=>{const{rect:s,attrs:r,bg:a}=n,i=this.cloneObjectGroup({attrs:r});return await w5({node:i,rect:s,bg:a})});b(this,"getImageData",(n={})=>{const{rect:s,attrs:r,bg:a}=n,i=this.cloneObjectGroup({attrs:r}),c=j5({node:i,rect:s,bg:a});return i.destroy(),c});b(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear();for(const n of this.renderers.values())n.destroy();this.renderers.clear()});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,parent:this.parent.id,renderers:Array.from(this.renderers.values()).map(n=>n.repr()),konva:{objectGroup:Ca(this.konva.objectGroup)}}));if(this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={objectGroup:new Oe.Group({name:`${this.type}:object_group`,listening:!1}),compositing:null},this.parent.konva.layer.add(this.konva.objectGroup),this.parent.entityIdentifier.type==="inpaint_mask"||this.parent.entityIdentifier.type==="regional_guidance"){const s=new Oe.Rect({name:`${this.type}:compositing_rect`,globalCompositeOperation:"source-in",listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1});this.konva.compositing={group:new Oe.Group({name:`${this.type}:compositing_group`,listening:!1}),rect:s,patternImage:new Image},this.konva.compositing.group.add(this.konva.compositing.rect),this.parent.konva.layer.add(this.konva.compositing.group)}this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,r)=>{this.konva.compositing&&((s.width!==r.width||s.height!==r.height||s.scale!==r.scale)&&this.updateCompositingRectSize(),(s.x!==r.x||s.y!==r.y)&&this.updateCompositingRectPosition())}))}}const lK={RECT_CALC_DEBOUNCE_MS:300,ANCHOR_HIT_PADDING:10,OUTLINE_PADDING:0,OUTLINE_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_FILL_COLOR:"hsl(200 76% 50% / 1)",SCALE_ANCHOR_STROKE_COLOR:"hsl(200 76% 77% / 1)",SCALE_ANCHOR_CORNER_RADIUS_RATIO:.5,SCALE_ANCHOR_STROKE_WIDTH:2,SCALE_ANCHOR_SIZE:8,ROTATE_ANCHOR_FILL_COLOR:"hsl(200 76% 95% / 1)",ROTATE_ANCHOR_STROKE_COLOR:"hsl(200 76% 40% / 1)",ROTATE_ANCHOR_SIZE:12};class Tf extends Zt{constructor(n){super();b(this,"type","entity_transformer");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"config",lK);b(this,"$nodeRect",Ge(Vi()));b(this,"$pixelRect",Ge(Vi()));b(this,"$isPendingRectCalculation",Ge(!0));b(this,"subscriptions",new Set);b(this,"$isTransforming",Ge(!1));b(this,"$interactionMode",Ge("off"));b(this,"$isDragEnabled",Ge(!1));b(this,"$isTransformEnabled",Ge(!1));b(this,"$isProcessing",Ge(!1));b(this,"$silentTransform",Ge(!1));b(this,"transformMutex",new m1);b(this,"konva");b(this,"initialize",()=>{this.log.debug("Initializing module"),this.syncInteractionState()});b(this,"anchorStyleFunc",n=>{n.hasName("rotater")&&n.setAttrs({height:this.config.ROTATE_ANCHOR_SIZE,width:this.config.ROTATE_ANCHOR_SIZE,cornerRadius:this.config.ROTATE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,fill:this.config.ROTATE_ANCHOR_FILL_COLOR,stroke:this.config.SCALE_ANCHOR_FILL_COLOR,offsetX:this.config.ROTATE_ANCHOR_SIZE/2,offsetY:this.config.ROTATE_ANCHOR_SIZE/2}),n.hitFunc(s=>{s.beginPath(),s.rect(-this.config.ANCHOR_HIT_PADDING,-this.config.ANCHOR_HIT_PADDING,n.width()+this.config.ANCHOR_HIT_PADDING*2,n.height()+this.config.ANCHOR_HIT_PADDING*2),s.closePath(),s.fillStrokeShape(n)})});b(this,"anchorDragBoundFunc",(n,s)=>{if(this.konva.transformer.getActiveAnchor()==="rotater")return s;const r=this.manager.stateApi.$shiftKey.get()?this.manager.stateApi.getGridSize():1,a=this.manager.stage.getScale(),i=this.manager.stage.getPosition(),c=Xs(s.x/a,r),d=Xs(s.y/a,r),u=i.x%(a*r),h=i.y%(a*r),p=c*a+u,f=d*a+h;return{x:p,y:f}});b(this,"boxBoundFunc",(n,s)=>this.konva.transformer.getActiveAnchor()!=="rotater"?s:this.manager.stateApi.$shiftKey.get()&&Math.abs(s.rotation%(Math.PI/4))>0?n:s);b(this,"snapProxyRectToPixelGrid",()=>{const n=this.konva.proxyRect.x(),s=this.konva.proxyRect.y(),r=Math.round(n),a=Math.round(s),i=this.konva.proxyRect.width(),c=this.konva.proxyRect.height(),d=this.konva.proxyRect.scaleX(),u=this.konva.proxyRect.scaleY(),h=Math.max(Math.abs(Math.round(i*d)),1),p=Math.max(Math.abs(Math.round(c*u)),1),f=h/i*Math.sign(d),m=p/c*Math.sign(u);this.konva.proxyRect.setAttrs({x:r,y:a,scaleX:f,scaleY:m}),this.syncObjectGroupWithProxyRect()});b(this,"fitToBboxFill",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=n.width/this.konva.proxyRect.width(),r=n.height/this.konva.proxyRect.height();this.konva.proxyRect.setAttrs({x:n.x,y:n.y,scaleX:s,scaleY:r,rotation:0}),this.syncObjectGroupWithProxyRect()});b(this,"fitToBboxContain",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getGridSize(),r=this.konva.proxyRect.width(),a=this.konva.proxyRect.height(),i=n.width/r,c=n.height/a,d=Math.min(i,c),u=(n.width-r*d)/2,h=(n.height-a*d)/2;this.konva.proxyRect.setAttrs({x:ir(Xs(n.x+u,s),n.x,n.x+n.width),y:ir(Xs(n.y+h,s),n.y,n.y+n.height),scaleX:d,scaleY:d,rotation:0}),this.syncObjectGroupWithProxyRect()});b(this,"fitToBboxCover",()=>{if(!this.$isTransformEnabled.get()){this.log.warn("Cannot fit to bbox contain when transform is disabled. Did you forget to call `await adapter.transformer.startTransform()`?");return}const{rect:n}=this.manager.stateApi.getBbox(),s=this.manager.stateApi.getGridSize(),r=this.konva.proxyRect.width(),a=this.konva.proxyRect.height(),i=n.width/r,c=n.height/a,d=Math.max(i,c),u=(n.width-r*d)/2,h=(n.height-a*d)/2;this.konva.proxyRect.setAttrs({x:Xs(n.x+u,s),y:Xs(n.y+h,s),scaleX:d,scaleY:d,rotation:0}),this.syncObjectGroupWithProxyRect()});b(this,"onDragMove",()=>{const n=this.manager.stateApi.getGridSize();this.konva.proxyRect.x(Xs(this.konva.proxyRect.x(),n)),this.konva.proxyRect.y(Xs(this.konva.proxyRect.y(),n));const s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s}),this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y()})});b(this,"onDragEnd",()=>{if(this.$isTransforming.get())return;const n=this.$pixelRect.get(),s={x:this.konva.proxyRect.x()-n.x,y:this.konva.proxyRect.y()-n.y};this.log.trace({position:s},"Position changed"),this.manager.stateApi.setEntityPosition({entityIdentifier:this.parent.entityIdentifier,position:s})});b(this,"syncObjectGroupWithProxyRect",()=>{this.parent.renderer.konva.objectGroup.setAttrs({x:this.konva.proxyRect.x(),y:this.konva.proxyRect.y(),scaleX:this.konva.proxyRect.scaleX(),scaleY:this.konva.proxyRect.scaleY(),rotation:this.konva.proxyRect.rotation()})});b(this,"update",(n,s)=>{const r=this.manager.stage.unscale(1),a=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:n.x+s.x-a,y:n.y+s.y-a,width:s.width+a*2,height:s.height+a*2,strokeWidth:r}),this.konva.proxyRect.setAttrs({x:n.x+s.x,y:n.y+s.y,width:s.width,height:s.height})});b(this,"syncInteractionState",()=>{var i;if(this.log.trace("Syncing interaction state"),this.manager.$isBusy.get()&&!this.$isTransforming.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if((i=this.parent.filterer)!=null&&i.$isFiltering.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(this.manager.stateApi.$isTransforming.get()&&!this.$isTransforming.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const n=this.$pixelRect.get();if(this.$isPendingRectCalculation.get()||n.width===0||n.height===0){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}const r=this.manager.tool.$tool.get(),a=this.manager.stateApi.getIsSelected(this.parent.id);if(this.parent.$isEmpty.get()){this.parent.konva.layer.listening(!1),this._setInteractionMode("off");return}if(a&&!this.$isTransforming.get()&&r==="move"){this.parent.konva.layer.listening(!0),this._setInteractionMode("drag");return}a&&this.$isTransforming.get()?r==="view"?(this.parent.konva.layer.listening(!1),this._setInteractionMode("off")):(this.parent.konva.layer.listening(!0),this._setInteractionMode("all")):(this.parent.konva.layer.listening(!1),this._setInteractionMode("off"))});b(this,"syncScale",()=>{const n=this.manager.stage.unscale(1),s=this.manager.stage.unscale(this.config.OUTLINE_PADDING);this.konva.outlineRect.setAttrs({x:this.konva.proxyRect.x()-s,y:this.konva.proxyRect.y()-s,width:this.konva.proxyRect.width()*this.konva.proxyRect.scaleX()+s*2,height:this.konva.proxyRect.height()*this.konva.proxyRect.scaleY()+s*2,strokeWidth:n}),this.konva.transformer.forceUpdate()});b(this,"startTransform",async n=>{const s=this.manager.stateApi.$transformingAdapter.get();s&&Fe(!1,`Already transforming an entity: ${s.id}`),await this.transformMutex.acquire(),this.log.debug("Starting transform");const{silent:r}={silent:!1,...n};this.$silentTransform.set(r),this.$isTransforming.set(!0),this.manager.stateApi.$transformingAdapter.set(this.parent),this.syncInteractionState()});b(this,"applyTransform",async()=>{if(!this.$isTransforming.get()){this.log.warn("Cannot apply transform when not transforming. Did you forget to call `await adapter.transformer.startTransform()`?");return}this.log.debug("Applying transform"),this.$isProcessing.set(!0),this._setInteractionMode("off");const n=this.getRelativeRect(),s=await ss(()=>this.parent.renderer.rasterize({rect:n,replaceObjects:!0,ignoreCache:!0,attrs:{opacity:1,filters:[]}}));s.isErr()&&this.log.error({error:ya(s.error)},"Failed to rasterize entity"),this.requestRectCalculation(),this.stopTransform()});b(this,"resetTransform",()=>{this.resetScale(),this.updatePosition(),this.updateBbox()});b(this,"stopTransform",()=>{this.log.debug("Stopping transform"),this.$isTransforming.set(!1),this.resetTransform(),this.syncInteractionState(),this.manager.stateApi.$transformingAdapter.set(null),this.$isProcessing.set(!1),this.transformMutex.release()});b(this,"resetScale",()=>{const n={scaleX:1,scaleY:1,rotation:0};this.parent.renderer.konva.objectGroup.setAttrs(n),this.parent.bufferRenderer.konva.group.setAttrs(n),this.konva.outlineRect.setAttrs(n),this.konva.proxyRect.setAttrs(n)});b(this,"updatePosition",n=>{this.log.trace("Updating position");const s=fx(n,"position",this.parent.state.position),r=this.$pixelRect.get(),a={x:s.x+r.x,y:s.y+r.y,offsetX:r.x,offsetY:r.y};this.parent.renderer.konva.objectGroup.setAttrs(a),this.parent.bufferRenderer.konva.group.setAttrs(a),this.update(s,r)});b(this,"_setInteractionMode",n=>{this.$interactionMode.set(n),n==="drag"?(this._enableDrag(),this._disableTransform(),this._showBboxOutline()):n==="all"?(this._enableDrag(),this._enableTransform(),this._hideBboxOutline()):n==="off"&&(this._disableDrag(),this._disableTransform(),this._hideBboxOutline())});b(this,"updateBbox",()=>{const n=this.$nodeRect.get(),s=this.$pixelRect.get();if(this.log.trace({nodeRect:n,pixelRect:s},"Updating bbox"),this.$isPendingRectCalculation.get()){this.syncInteractionState();return}if(s.width===0||s.height===0)this.parent.renderer.hasObjects()&&(this.manager.stateApi.resetEntity({entityIdentifier:this.parent.entityIdentifier}),this.syncInteractionState());else{this.syncInteractionState(),this.update(this.parent.state.position,s);const r={x:this.parent.state.position.x+s.x,y:this.parent.state.position.y+s.y,offsetX:s.x,offsetY:s.y};this.parent.renderer.konva.objectGroup.setAttrs(r),this.parent.bufferRenderer.konva.group.setAttrs(r)}});b(this,"calculateRect",Ai(()=>{this.log.debug("Calculating bbox");const n=this.parent.getCanvas();if(!this.parent.renderer.hasObjects()){this.log.trace("No objects, resetting bbox"),this.$nodeRect.set(Vi()),this.$pixelRect.set(Vi()),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const s=this.parent.renderer.konva.objectGroup.getClientRect({skipTransform:!0});if(!this.parent.renderer.needsPixelBbox()){this.$nodeRect.set({...s}),this.$pixelRect.set({...s}),this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get()},"Got bbox from client rect"),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release();return}const r=Bg(n);this.manager.worker.requestBbox({buffer:r.data.buffer,width:r.width,height:r.height},a=>{if(a){const{minX:i,minY:c,maxX:d,maxY:u}=a;this.$nodeRect.set({...s}),this.$pixelRect.set({x:Math.round(s.x)+i,y:Math.round(s.y)+c,width:d-i,height:u-c})}else this.$nodeRect.set(Vi()),this.$pixelRect.set(Vi());this.log.trace({nodeRect:this.$nodeRect.get(),pixelRect:this.$pixelRect.get(),extents:a},"Got bbox from worker"),this.parent.$canvasCache.set(n),this.$isPendingRectCalculation.set(!1),this.updateBbox(),this.transformMutex.release()})},this.config.RECT_CALC_DEBOUNCE_MS));b(this,"requestRectCalculation",async()=>{await this.transformMutex.acquire(),this.$isPendingRectCalculation.set(!0),this.syncInteractionState(),this.calculateRect()});b(this,"getRelativeRect",()=>this.konva.proxyRect.getClientRect({relativeTo:this.parent.konva.layer}));b(this,"_enableTransform",()=>{this.$isTransformEnabled.set(!0),this.konva.transformer.visible(!0),this.konva.transformer.listening(!0),this.konva.transformer.nodes([this.konva.proxyRect])});b(this,"_disableTransform",()=>{this.$isTransformEnabled.set(!1),this.konva.transformer.visible(!1),this.konva.transformer.listening(!1),this.konva.transformer.nodes([])});b(this,"_enableDrag",()=>{this.$isDragEnabled.set(!0),this.konva.proxyRect.visible(!0),this.konva.proxyRect.listening(!0)});b(this,"_disableDrag",()=>{this.$isDragEnabled.set(!1),this.konva.proxyRect.visible(!1),this.konva.proxyRect.listening(!1)});b(this,"_showBboxOutline",()=>{this.konva.outlineRect.visible(!0)});b(this,"_hideBboxOutline",()=>{this.konva.outlineRect.visible(!1)});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$nodeRect:this.$nodeRect.get(),$pixelRect:this.$pixelRect.get(),$isPendingRectCalculation:this.$isPendingRectCalculation.get(),$isTransforming:this.$isTransforming.get(),$interactionMode:this.$interactionMode.get(),$isDragEnabled:this.$isDragEnabled.get(),$isTransformEnabled:this.$isTransformEnabled.get(),$isProcessing:this.$isProcessing.get(),konva:{transformer:Ca(this.konva.transformer),proxyRect:Ca(this.konva.proxyRect),outlineRect:Ca(this.konva.outlineRect)}}));b(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.outlineRect.destroy(),this.konva.transformer.destroy(),this.konva.proxyRect.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={outlineRect:new Oe.Rect({listening:!1,draggable:!1,name:`${this.type}:outline_rect`,stroke:this.config.OUTLINE_COLOR,perfectDrawEnabled:!1,hitStrokeWidth:0}),transformer:new Oe.Transformer({name:`${this.type}:transformer`,visible:!1,listening:!1,rotateEnabled:!0,flipEnabled:!0,keepRatio:!0,shiftBehavior:"inverted",padding:this.config.OUTLINE_PADDING,stroke:this.config.OUTLINE_COLOR,anchorFill:this.config.SCALE_ANCHOR_FILL_COLOR,anchorStroke:this.config.SCALE_ANCHOR_STROKE_COLOR,anchorStrokeWidth:this.config.SCALE_ANCHOR_STROKE_WIDTH,anchorSize:this.config.SCALE_ANCHOR_SIZE,anchorCornerRadius:this.config.SCALE_ANCHOR_SIZE*this.config.SCALE_ANCHOR_CORNER_RADIUS_RATIO,anchorStyleFunc:this.anchorStyleFunc,anchorDragBoundFunc:this.anchorDragBoundFunc,boundBoxFunc:this.boxBoundFunc}),proxyRect:new Oe.Rect({name:`${this.type}:proxy_rect`,listening:!1,draggable:!0})},this.konva.transformer.on("transform",this.syncObjectGroupWithProxyRect),this.konva.transformer.on("transformend",this.snapProxyRectToPixelGrid),this.konva.proxyRect.on("dragmove",this.onDragMove),this.konva.proxyRect.on("dragend",this.onDragEnd),this.subscriptions.add(this.manager.stage.$stageAttrs.listen((s,r)=>{s.scale!==r.scale&&this.syncScale()})),this.subscriptions.add(this.manager.stateApi.$shiftKey.listen(s=>{this.konva.transformer.rotationSnaps(s?[0,45,90,135,180,225,270,315]:[])})),this.subscriptions.add(this.manager.tool.$tool.listen(this.syncInteractionState)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(un,this.syncInteractionState)),this.subscriptions.add(this.manager.$isBusy.listen(this.syncInteractionState)),this.parent.konva.layer.add(this.konva.outlineRect),this.parent.konva.layer.add(this.konva.proxyRect),this.parent.konva.layer.add(this.konva.transformer)}}class cK extends zp{constructor(n,s){super(n,s,"control_layer_adapter");b(this,"renderer");b(this,"bufferRenderer");b(this,"transformer");b(this,"filterer");b(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.withTransparencyEffect!==s.withTransparencyEffect)&&this.renderer.updateTransparencyEffect())});b(this,"syncTransparencyEffect",()=>{this.renderer.updateTransparencyEffect()});b(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});b(this,"getHashableState",()=>{const n=["name","controlAdapter","withTransparencyEffect"];return hi(this.state,n)});this.renderer=new Lf(this),this.bufferRenderer=new Ef(this),this.transformer=new Tf(this),this.filterer=new NA(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class dK extends zp{constructor(n,s){super(n,s,"inpaint_mask_adapter");b(this,"renderer");b(this,"bufferRenderer");b(this,"transformer");b(this,"filterer");b(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!s),s||(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});b(this,"getHashableState",()=>{const n=["fill","name","opacity"];return hi(this.state,n)});b(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new Lf(this),this.bufferRenderer=new Ef(this),this.transformer=new Tf(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class uK extends zp{constructor(n,s){super(n,s,"raster_layer_adapter");b(this,"renderer");b(this,"bufferRenderer");b(this,"transformer");b(this,"filterer");b(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity())});b(this,"getCanvas",n=>{this.log.trace({rect:n},"Getting canvas");const s={opacity:this.state.opacity,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});b(this,"getHashableState",()=>{const n=["name"];return hi(this.state,n)});this.renderer=new Lf(this),this.bufferRenderer=new Ef(this),this.transformer=new Tf(this),this.filterer=new NA(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class hK extends zp{constructor(n,s){super(n,s,"regional_guidance_adapter");b(this,"renderer");b(this,"bufferRenderer");b(this,"transformer");b(this,"filterer");b(this,"sync",async(n,s)=>{if(!n){this.destroy();return}this.state=n,!(s&&s===this.state)&&((!s||this.state.isEnabled!==s.isEnabled)&&this.syncIsEnabled(),(!s||this.state.isLocked!==s.isLocked)&&this.syncIsLocked(),(!s||this.state.objects!==s.objects)&&await this.syncObjects(),(!s||this.state.position!==s.position)&&this.syncPosition(),(!s||this.state.opacity!==s.opacity)&&this.syncOpacity(),(!s||this.state.fill!==s.fill)&&this.renderer.updateCompositingRectFill(!s),s||(this.renderer.updateCompositingRectSize(!0),this.renderer.updateCompositingRectPosition(!0)))});b(this,"getHashableState",()=>{const n=["fill","name","opacity"];return hi(this.state,n)});b(this,"getCanvas",n=>{const s={opacity:1,filters:[]};return this.renderer.getCanvas({rect:n,attrs:s})});this.renderer=new Lf(this),this.bufferRenderer=new Ef(this),this.transformer=new Tf(this),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(this.selectState,this.sync))}}class pK extends Zt{constructor(n){super();b(this,"type","entity_renderer");b(this,"id");b(this,"path");b(this,"log");b(this,"parent");b(this,"manager");b(this,"subscriptions",new Set);b(this,"initialize",()=>{this.log.debug("Initializing module"),this.createNewRasterLayers(this.manager.stateApi.runSelector(Dy)),this.createNewControlLayers(this.manager.stateApi.runSelector(Oy)),this.createNewRegionalGuidance(this.manager.stateApi.runSelector(By)),this.createNewInpaintMasks(this.manager.stateApi.runSelector(Ny)),this.arrangeEntities(this.manager.stateApi.runSelector(Je),null)});b(this,"createNewRasterLayers",n=>{for(const s of n)this.manager.adapters.rasterLayers.has(s.id)||this.manager.createAdapter(dl(s)).initialize()});b(this,"createNewControlLayers",n=>{for(const s of n)this.manager.adapters.controlLayers.has(s.id)||this.manager.createAdapter(dl(s)).initialize()});b(this,"createNewRegionalGuidance",n=>{for(const s of n)this.manager.adapters.regionMasks.has(s.id)||this.manager.createAdapter(dl(s)).initialize()});b(this,"createNewInpaintMasks",n=>{for(const s of n)this.manager.adapters.inpaintMasks.has(s.id)||this.manager.createAdapter(dl(s)).initialize()});b(this,"arrangeEntities",(n,s)=>{var r,a,i,c,d,u;if(!s||n.rasterLayers.entities!==s.rasterLayers.entities||n.controlLayers.entities!==s.controlLayers.entities||n.regionalGuidance.entities!==s.regionalGuidance.entities||n.inpaintMasks.entities!==s.inpaintMasks.entities||((r=n.selectedEntityIdentifier)==null?void 0:r.id)!==((a=s.selectedEntityIdentifier)==null?void 0:a.id)){this.log.trace("Arranging entities");let h=0;this.manager.background.konva.layer.zIndex(h++);for(const{id:p}of this.manager.stateApi.getRasterLayersState().entities)(i=this.manager.adapters.rasterLayers.get(p))==null||i.konva.layer.zIndex(h++);for(const{id:p}of this.manager.stateApi.getControlLayersState().entities)(c=this.manager.adapters.controlLayers.get(p))==null||c.konva.layer.zIndex(h++);for(const{id:p}of this.manager.stateApi.getRegionsState().entities)(d=this.manager.adapters.regionMasks.get(p))==null||d.konva.layer.zIndex(h++);for(const{id:p}of this.manager.stateApi.getInpaintMasksState().entities)(u=this.manager.adapters.inpaintMasks.get(p))==null||u.konva.layer.zIndex(h++);this.manager.konva.previewLayer.zIndex(h++)}});b(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear()});this.id=Te("canvas_renderer"),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Dy,this.createNewRasterLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Oy,this.createNewControlLayers)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Ny,this.createNewInpaintMasks)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(By,this.createNewRegionalGuidance)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Je,this.arrangeEntities))}}const fK=e=>!!e.image;class mK extends Zt{constructor(n){super();b(this,"type","progress_image");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"konva");b(this,"isLoading",!1);b(this,"isError",!1);b(this,"imageElement",null);b(this,"subscriptions",new Set);b(this,"$lastProgressEvent",Ge(null));b(this,"hasActiveGeneration",!1);b(this,"mutex",new m1);b(this,"setSocketEventListeners",()=>{const n=r=>{r.destination==="canvas"&&fK(r)&&this.hasActiveGeneration&&this.$lastProgressEvent.set(r)},s=()=>{this.$lastProgressEvent.set(null)};return this.manager.socket.on("invocation_progress",n),this.manager.socket.on("connect",s),this.manager.socket.on("connect_error",s),this.manager.socket.on("disconnect",s),()=>{this.manager.socket.off("invocation_progress",n),this.manager.socket.off("connect",s),this.manager.socket.off("connect_error",s),this.manager.socket.off("disconnect",s)}});b(this,"getNodes",()=>[this.konva.group]);b(this,"render",async()=>{var u;const n=await this.mutex.acquire(),s=this.$lastProgressEvent.get(),r=this.manager.stateApi.runSelector($g);if(!s||!r){this.konva.group.visible(!1),(u=this.konva.image)==null||u.destroy(),this.konva.image=null,this.imageElement=null,this.isLoading=!1,this.isError=!1,n();return}this.isLoading=!0;const{x:a,y:i,width:c,height:d}=this.manager.stateApi.getBbox().rect;try{this.imageElement=await Bj(s.image.dataURL),this.konva.image?this.konva.image.setAttrs({image:this.imageElement,x:a,y:i,width:c,height:d}):(this.konva.image=new Oe.Image({name:`${this.type}:image`,listening:!1,image:this.imageElement,x:a,y:i,width:c,height:d,perfectDrawEnabled:!1}),this.konva.group.add(this.konva.image)),this.konva.group.visible(this.manager.stagingArea.$shouldShowStagedImage.get())}catch{this.isError=!0}finally{this.isLoading=!1,n()}});b(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating progress image module"),this.konva={group:new Oe.Group({name:`${this.type}:group`,listening:!1}),image:null},this.subscriptions.add(this.manager.stagingArea.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription($g,this.render)),this.subscriptions.add(this.setSocketEventListeners()),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(S5,({data:s})=>{s&&(s.in_progress>0||s.pending>0)?this.hasActiveGeneration=!0:(this.hasActiveGeneration=!1,this.$lastProgressEvent.set(null))})),this.subscriptions.add(this.$lastProgressEvent.listen(this.render))}}const gK={MIN_SCALE:.1,MAX_SCALE:20,SCALE_FACTOR:.999};class xK extends Zt{constructor(n,s){super();b(this,"type","stage");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"container");b(this,"konva");b(this,"config",gK);b(this,"$stageAttrs",Ge({x:0,y:0,width:0,height:0,scale:0}));b(this,"subscriptions",new Set);b(this,"resizeObserver",null);b(this,"setContainer",n=>{this.container=n,this.konva.stage.container(n),this.setResizeObserver()});b(this,"setResizeObserver",()=>{this.resizeObserver&&this.resizeObserver.disconnect(),this.resizeObserver=new ResizeObserver(this.fitStageToContainer),this.resizeObserver.observe(this.container)});b(this,"initialize",()=>{this.log.debug("Initializing module"),this.container.style.touchAction="none",this.container.style.userSelect="none",this.container.style.webkitUserSelect="none",this.konva.stage.container(this.container),this.setResizeObserver(),this.fitStageToContainer(),this.konva.stage.on("wheel",this.onStageMouseWheel),this.konva.stage.on("dragmove",this.onStageDragMove),this.konva.stage.on("dragend",this.onStageDragEnd),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.subscriptions.add(()=>this.konva.stage.off("wheel",this.onStageMouseWheel)),this.subscriptions.add(()=>this.konva.stage.off("dragmove",this.onStageDragMove)),this.subscriptions.add(()=>this.konva.stage.off("dragend",this.onStageDragEnd)),this.subscriptions.add(this.manager.tool.$tool.listen(this.stopDragging))});b(this,"fitStageToContainer",()=>{this.log.trace("Fitting stage to container");const n=this.konva.stage.container().offsetWidth,s=this.konva.stage.container().offsetHeight;if(n===0||s===0)return;const r=this.konva.stage.width()===0||this.konva.stage.height()===0;this.konva.stage.width(n),this.konva.stage.height(s),this.syncStageAttrs(),r&&this.fitLayersToStage()});b(this,"getVisibleRect",n=>{const s=[];for(const r of this.manager.getAllAdapters())r.state.isEnabled&&(n&&r.state.type!==n||r.renderer.hasObjects()&&s.push(r.transformer.getRelativeRect()));return k5(...s)});b(this,"fitBboxToStage",()=>{const{rect:n}=this.manager.stateApi.getBbox();this.log.trace({rect:n},"Fitting bbox to stage"),this.fitRect(n)});b(this,"fitLayersToStage",()=>{const n=this.getVisibleRect();n.width===0||n.height===0?this.fitBboxToStage():(this.log.trace({rect:n},"Fitting layers to stage"),this.fitRect(n))});b(this,"fitRect",n=>{const{width:s,height:r}=this.getSize();if(s===0||r===0)return;const a=20,i=s-a*2,c=r-a*2,d=this.constrainScale(Math.min(Math.min(i/n.width,c/n.height),1)),u=Math.floor(-n.x*d+a+(i-n.width*d)/2),h=Math.floor(-n.y*d+a+(c-n.height*d)/2);this.konva.stage.setAttrs({x:u,y:h,scaleX:d,scaleY:d}),this.syncStageAttrs({x:u,y:h,scale:d})});b(this,"getCenter",(n=!1)=>{const s=this.getScale(),{x:r,y:a}=this.getPosition(),{width:i,height:c}=this.getSize(),d={x:(i/2-r)/s,y:(c/2-a)/s};return n?this.konva.stage.getAbsoluteTransform().point(d):d});b(this,"constrainScale",n=>ir(Math.round(n*100)/100,this.config.MIN_SCALE,this.config.MAX_SCALE));b(this,"setScale",(n,s=this.getCenter(!0))=>{this.log.trace("Setting scale");const r=this.constrainScale(n),{x:a,y:i}=this.getPosition(),c=this.getScale(),d=(s.x-a)/c,u=(s.y-i)/c,h=Math.floor(s.x-d*r),p=Math.floor(s.y-u*r);this.konva.stage.setAttrs({x:h,y:p,scaleX:r,scaleY:r}),this.syncStageAttrs()});b(this,"onStageMouseWheel",n=>{if(n.evt.preventDefault(),n.evt.ctrlKey||n.evt.metaKey)return;const s=this.konva.stage.getPointerPosition();if(s){const r=n.evt.ctrlKey?-n.evt.deltaY:n.evt.deltaY,a=this.manager.stage.getScale()*this.config.SCALE_FACTOR**r;this.manager.stage.setScale(a,s)}});b(this,"onStagePointerDown",n=>{n.evt.button===1&&this.startDragging()});b(this,"startDragging",()=>{this.setIsDraggable(!0),this.konva.stage.isDragging()||this.konva.stage.startDrag(),this.manager.tool.render()});b(this,"stopDragging",()=>{this.setIsDraggable(this.manager.tool.$tool.get()==="view"),this.konva.stage.isDragging()&&this.konva.stage.stopDrag(),this.manager.tool.render()});b(this,"onStageDragMove",n=>{n.target===this.konva.stage&&this.syncStageAttrs()});b(this,"onStageDragEnd",n=>{n.target===this.konva.stage&&this.stopDragging()});b(this,"getScale",()=>this.konva.stage.scaleX());b(this,"getPosition",()=>this.konva.stage.position());b(this,"unscale",n=>n/this.getScale());b(this,"setCursor",n=>{this.container.style.cursor!==n&&(this.container.style.cursor=n)});b(this,"syncStageAttrs",n=>{this.$stageAttrs.set({x:this.konva.stage.x(),y:this.konva.stage.y(),width:this.konva.stage.width(),height:this.konva.stage.height(),scale:this.konva.stage.scaleX(),...n})});b(this,"setIsDraggable",n=>{this.konva.stage.draggable(n)});b(this,"addLayer",n=>{this.konva.stage.add(n)});b(this,"getScaledStageRect",(n=!0)=>{const{x:s,y:r}=this.getPosition(),{width:a,height:i}=this.getSize(),c=this.getScale();return{x:n?Math.floor(-s/c):-s/c,y:n?Math.floor(-r/c):-r/c,width:n?Math.ceil(a/c):a/c,height:n?Math.ceil(i/c):i/c}});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$stageAttrs:this.$stageAttrs.get(),konva:{stage:Ca(this.konva.stage)}}));b(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.resizeObserver&&this.resizeObserver.disconnect(),this.konva.stage.destroy()});this.id=Te("stage"),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.container=n,this.konva={stage:new Oe.Stage({id:Te("konva_stage"),container:n})}}getSize(){return this.konva.stage.size()}}class bK extends Zt{constructor(n){super();b(this,"type","staging_area");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"subscriptions",new Set);b(this,"konva");b(this,"image");b(this,"selectedImage");b(this,"$shouldShowStagedImage",Ge(!0));b(this,"$isStaging",Ge(!1));b(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.$isStaging.set(this.manager.stateApi.runSelector(Pn))});b(this,"render",async()=>{var d;this.log.trace("Rendering staging area");const n=this.manager.stateApi.runSelector(Fg),{x:s,y:r,width:a,height:i}=this.manager.stateApi.getBbox().rect,c=this.$shouldShowStagedImage.get();if(this.selectedImage=n.stagedImages[n.selectedStagedImageIndex]??null,this.konva.group.position({x:s,y:r}),this.selectedImage){const{imageDTO:u}=this.selectedImage;if(!this.image){const{image_name:h}=u;this.image=new Ll({id:"staging-area-image",type:"image",image:{image_name:h,width:a,height:i}},this),this.konva.group.add(this.image.konva.group)}!this.image.isLoading&&!this.image.isError&&(await this.image.update({...this.image.state,image:Rp(u)},!0),this.manager.progressImage.$lastProgressEvent.set(null)),this.image.konva.group.visible(c)}else(d=this.image)==null||d.destroy(),this.image=null});b(this,"getNodes",()=>[this.konva.group]);b(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.image&&this.image.destroy();for(const n of this.getNodes())n.destroy()});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,selectedImage:this.selectedImage,$shouldShowStagedImage:this.$shouldShowStagedImage.get(),$isStaging:this.$isStaging.get()}));this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Oe.Group({name:`${this.type}:group`,listening:!1})},this.image=null,this.selectedImage=null,this.subscriptions.add(this.$shouldShowStagedImage.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Fg,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Pn,s=>{this.$isStaging.set(s)}))}}const yK={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",HIDE_FILL_TIMEOUT_MS:1500};class vK extends Zt{constructor(n){super();b(this,"type","brush_tool");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"config",yK);b(this,"hideFillTimeoutId",null);b(this,"konva");b(this,"render",()=>{if(this.parent.$tool.get()!=="brush"){this.setVisibility(!1);return}const s=this.parent.$cursorPos.get(),r=this.parent.getCanDraw();if(!s||!r){this.setVisibility(!1);return}const a=this.parent.$isMouseDown.get(),i=this.parent.$lastPointerType.get();if(i!=="mouse"&&a){this.setVisibility(!1);return}this.setVisibility(!0),this.hideFillTimeoutId!==null&&(window.clearTimeout(this.hideFillTimeoutId),this.hideFillTimeoutId=null);const c=this.manager.stateApi.getSettings(),d=this.manager.stateApi.getBrushPreviewColor(),u=Uo(s.relative,c.brushWidth),h=c.brushWidth/2;this.konva.fillCircle.setAttrs({x:u.x,y:u.y,radius:h,fill:Sc(d),visible:!a&&i==="mouse"});const p=this.manager.stage.unscale(1),f=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:s.relative.x,y:s.relative.y,innerRadius:h,outerRadius:h+p}),this.konva.outerBorder.setAttrs({x:s.relative.x,y:s.relative.y,innerRadius:h+p,outerRadius:h+f}),this.hideFillTimeoutId=window.setTimeout(()=>{this.konva.fillCircle.visible(!1),this.hideFillTimeoutId=null},this.config.HIDE_FILL_TIMEOUT_MS)});b(this,"setVisibility",n=>{this.konva.group.visible(n)});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));b(this,"destroy",()=>{this.log.debug("Destroying module"),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Oe.Group({name:`${this.type}:brush_group`,listening:!1}),fillCircle:new Oe.Circle({name:`${this.type}:brush_fill_circle`,listening:!1,strokeEnabled:!1,perfectDrawEnabled:!1}),innerBorder:new Oe.Ring({name:`${this.type}:brush_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Oe.Ring({name:`${this.type}:brush_outer_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.fillCircle,this.konva.innerBorder,this.konva.outerBorder)}}const CK={RING_INNER_RADIUS:25,RING_OUTER_RADIUS:35,RING_BORDER_INNER_COLOR:"rgba(0,0,0,1)",RING_BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)",CROSSHAIR_INNER_RADIUS:5,CROSSHAIR_LINE_THICKNESS:1.5,CROSSHAIR_LINE_BORDER_THICKNESS:.75,CROSSHAIR_LINE_LENGTH:10,CROSSHAIR_LINE_COLOR:"rgba(0,0,0,1)",CROSSHAIR_BORDER_COLOR:"rgba(255,255,255,0.8)"};class wK extends Zt{constructor(n){super();b(this,"type","color_picker_tool");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"config",CK);b(this,"konva");b(this,"render",()=>{const n=this.parent.$tool.get();if(n!=="colorPicker"){this.setVisibility(!1);return}const s=this.parent.$cursorPos.get(),r=this.parent.getCanDraw();if(!s||n!=="colorPicker"||!r){this.setVisibility(!1);return}this.setVisibility(!0);const{x:a,y:i}=s.relative,c=this.manager.stateApi.getSettings(),d=this.parent.$colorUnderCursor.get(),u=this.manager.stage.unscale(this.config.RING_INNER_RADIUS),h=this.manager.stage.unscale(this.config.RING_OUTER_RADIUS),p=this.manager.stage.unscale(1),f=this.manager.stage.unscale(2);this.konva.ringCandidateColor.setAttrs({x:a,y:i,fill:Hr(d),innerRadius:u,outerRadius:h}),this.konva.ringCurrentColor.setAttrs({x:a,y:i,fill:Hr(c.color),innerRadius:u,outerRadius:h}),this.konva.ringInnerBorder.setAttrs({x:a,y:i,innerRadius:h,outerRadius:h+p}),this.konva.ringOuterBorder.setAttrs({x:a,y:i,innerRadius:h+p,outerRadius:h+f});const m=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_LENGTH),g=this.manager.stage.unscale(this.config.CROSSHAIR_INNER_RADIUS),x=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS),C=this.manager.stage.unscale(this.config.CROSSHAIR_LINE_THICKNESS+this.config.CROSSHAIR_LINE_BORDER_THICKNESS*2);this.konva.crosshairNorthOuter.setAttrs({strokeWidth:C,points:[a,i-m,a,i-g]}),this.konva.crosshairNorthInner.setAttrs({strokeWidth:x,points:[a,i-m,a,i-g]}),this.konva.crosshairEastOuter.setAttrs({strokeWidth:C,points:[a+g,i,a+m,i]}),this.konva.crosshairEastInner.setAttrs({strokeWidth:x,points:[a+g,i,a+m,i]}),this.konva.crosshairSouthOuter.setAttrs({strokeWidth:C,points:[a,i+g,a,i+m]}),this.konva.crosshairSouthInner.setAttrs({strokeWidth:x,points:[a,i+g,a,i+m]}),this.konva.crosshairWestOuter.setAttrs({strokeWidth:C,points:[a-g,i,a-m,i]}),this.konva.crosshairWestInner.setAttrs({strokeWidth:x,points:[a-g,i,a-m,i]})});b(this,"setVisibility",n=>{this.konva.group.visible(n)});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));b(this,"destroy",()=>{this.log.debug("Destroying color picker tool preview module"),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Oe.Group({name:`${this.type}:color_picker_group`,listening:!1}),ringCandidateColor:new Oe.Ring({name:`${this.type}:color_picker_candidate_color_ring`,innerRadius:0,outerRadius:0,strokeEnabled:!1,perfectDrawEnabled:!1}),ringCurrentColor:new Oe.Arc({name:`${this.type}:color_picker_current_color_arc`,innerRadius:0,outerRadius:0,angle:180,strokeEnabled:!1,perfectDrawEnabled:!1}),ringInnerBorder:new Oe.Ring({name:`${this.type}:color_picker_inner_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),ringOuterBorder:new Oe.Ring({name:`${this.type}:color_picker_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.RING_BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),crosshairNorthInner:new Oe.Line({name:`${this.type}:color_picker_crosshair_north1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairNorthOuter:new Oe.Line({name:`${this.type}:color_picker_crosshair_north2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairEastInner:new Oe.Line({name:`${this.type}:color_picker_crosshair_east1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairEastOuter:new Oe.Line({name:`${this.type}:color_picker_crosshair_east2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairSouthInner:new Oe.Line({name:`${this.type}:color_picker_crosshair_south1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairSouthOuter:new Oe.Line({name:`${this.type}:color_picker_crosshair_south2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1}),crosshairWestInner:new Oe.Line({name:`${this.type}:color_picker_crosshair_west1_line`,stroke:this.config.CROSSHAIR_LINE_COLOR,perfectDrawEnabled:!1}),crosshairWestOuter:new Oe.Line({name:`${this.type}:color_picker_crosshair_west2_line`,stroke:this.config.CROSSHAIR_BORDER_COLOR,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.ringCandidateColor,this.konva.ringCurrentColor,this.konva.ringInnerBorder,this.konva.ringOuterBorder,this.konva.crosshairNorthOuter,this.konva.crosshairNorthInner,this.konva.crosshairEastOuter,this.konva.crosshairEastInner,this.konva.crosshairSouthOuter,this.konva.crosshairSouthInner,this.konva.crosshairWestOuter,this.konva.crosshairWestInner)}}const jK={BORDER_INNER_COLOR:"rgba(0,0,0,1)",BORDER_OUTER_COLOR:"rgba(255,255,255,0.8)"};class SK extends Zt{constructor(n){super();b(this,"type","eraser_tool");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"config",jK);b(this,"konva");b(this,"render",()=>{if(this.parent.$tool.get()!=="eraser"){this.setVisibility(!1);return}const s=this.parent.$cursorPos.get(),r=this.parent.getCanDraw();if(!s||!r){this.setVisibility(!1);return}const a=this.parent.$isMouseDown.get();if(this.parent.$lastPointerType.get()!=="mouse"&&a){this.setVisibility(!1);return}this.setVisibility(!0);const c=this.manager.stateApi.getSettings(),d=Uo(s.relative,c.eraserWidth),u=c.eraserWidth/2;this.konva.cutoutCircle.setAttrs({x:d.x,y:d.y,radius:u});const h=this.manager.stage.unscale(1),p=this.manager.stage.unscale(2);this.konva.innerBorder.setAttrs({x:s.relative.x,y:s.relative.y,innerRadius:u,outerRadius:u+h}),this.konva.outerBorder.setAttrs({x:s.relative.x,y:s.relative.y,innerRadius:u+h,outerRadius:u+p})});b(this,"setVisibility",n=>{this.konva.group.visible(n)});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));b(this,"destroy",()=>{this.log.debug("Destroying eraser tool preview module"),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=this.parent.manager,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={group:new Oe.Group({name:`${this.type}:eraser_group`,listening:!1}),cutoutCircle:new Oe.Circle({name:`${this.type}:eraser_cutout_circle`,listening:!1,strokeEnabled:!1,fill:"white",globalCompositeOperation:"destination-out",perfectDrawEnabled:!1}),innerBorder:new Oe.Ring({name:`${this.type}:eraser_inner_border_ring`,listening:!1,innerRadius:0,outerRadius:0,fill:this.config.BORDER_INNER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1}),outerBorder:new Oe.Ring({name:`${this.type}:eraser_outer_border_ring`,innerRadius:0,outerRadius:0,fill:this.config.BORDER_OUTER_COLOR,strokeEnabled:!1,perfectDrawEnabled:!1})},this.konva.group.add(this.konva.cutoutCircle,this.konva.innerBorder,this.konva.outerBorder)}}Oe.dragButtons=[0];const kK="Escape",gC=" ",xC="Alt",IK={BRUSH_SPACING_TARGET_SCALE:.1};class _K extends Zt{constructor(n){super();b(this,"type","tool");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"subscriptions",new Set);b(this,"config",IK);b(this,"brushToolPreview");b(this,"eraserToolPreview");b(this,"colorPickerToolPreview");b(this,"$tool",Ge("brush"));b(this,"$toolBuffer",Ge(null));b(this,"$isMouseDown",Ge(!1));b(this,"$cursorPos",Ge(null));b(this,"$colorUnderCursor",Ge($j));b(this,"$lastPointerType",Ge(null));b(this,"konva");b(this,"initialize",()=>{this.log.debug("Initializing module"),this.render(),this.syncCursorStyle()});b(this,"setToolVisibility",(n,s)=>{this.brushToolPreview.setVisibility(s&&n==="brush"),this.eraserToolPreview.setVisibility(s&&n==="eraser"),this.colorPickerToolPreview.setVisibility(n==="colorPicker")});b(this,"syncCursorStyle",()=>{var a;const n=this.manager.stage,s=this.$tool.get(),r=this.manager.stage.konva.stage.isDragging();s==="view"&&!r?n.setCursor("grab"):this.manager.stage.konva.stage.isDragging()?n.setCursor("grabbing"):this.manager.stateApi.$isTransforming.get()?n.setCursor("default"):this.manager.stateApi.$isFiltering.get()||this.manager.stagingArea.$isStaging.get()?n.setCursor("not-allowed"):s==="bbox"?n.setCursor("default"):this.manager.stateApi.getRenderedEntityCount()===0?n.setCursor("not-allowed"):(a=this.manager.stateApi.getSelectedEntityAdapter())!=null&&a.$isInteractable.get()?s==="colorPicker"||s==="brush"||s==="eraser"?n.setCursor("none"):s==="move"?n.setCursor("default"):s==="rect"?n.setCursor("crosshair"):n.setCursor("not-allowed"):n.setCursor("not-allowed")});b(this,"render",()=>{const n=this.manager.stateApi.getRenderedEntityCount(),s=this.$cursorPos.get(),r=this.manager.stateApi.$isFiltering.get(),a=this.manager.stagingArea.$isStaging.get(),i=this.manager.stage.konva.stage.isDragging();this.syncCursorStyle(),!s||r||a||n===0||i?this.konva.group.visible(!1):(this.konva.group.visible(!0),this.brushToolPreview.render(),this.eraserToolPreview.render(),this.colorPickerToolPreview.render())});b(this,"syncCursorPositions",()=>{const n=this.konva.stage.getRelativePointerPosition(),s=this.konva.stage.getPointerPosition();!n||!s||this.$cursorPos.set({relative:n,absolute:s})});b(this,"getClip",n=>{if(this.manager.stateApi.getSettings().clipToBbox){const{x:r,y:a,width:i,height:c}=this.manager.stateApi.getBbox().rect;return{x:r-n.position.x,y:a-n.position.y,width:i,height:c}}else{const{x:r,y:a}=this.manager.stage.getPosition(),i=this.manager.stage.getScale(),{width:c,height:d}=this.manager.stage.getSize();return{x:-r/i-n.position.x,y:-a/i-n.position.y,width:c/i,height:d/i}}});b(this,"setEventListeners",()=>(this.konva.stage.on("pointerenter",this.onStagePointerEnter),this.konva.stage.on("pointerdown",this.onStagePointerDown),this.konva.stage.on("pointerup",this.onStagePointerUp),this.konva.stage.on("pointermove",this.onStagePointerMove),this.manager.stage.container.addEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.on("wheel",this.onStageMouseWheel),window.addEventListener("keydown",this.onKeyDown),window.addEventListener("keyup",this.onKeyUp),window.addEventListener("pointerup",this.onWindowPointerUp),window.addEventListener("blur",this.onWindowBlur),()=>{this.konva.stage.off("pointerenter",this.onStagePointerEnter),this.konva.stage.off("pointerdown",this.onStagePointerDown),this.konva.stage.off("pointerup",this.onStagePointerUp),this.konva.stage.off("pointermove",this.onStagePointerMove),this.manager.stage.container.removeEventListener("pointerleave",this.onStagePointerLeave),this.konva.stage.off("wheel",this.onStageMouseWheel),window.removeEventListener("keydown",this.onKeyDown),window.removeEventListener("keyup",this.onKeyUp),window.removeEventListener("pointerup",this.onWindowPointerUp),window.removeEventListener("blur",this.onWindowBlur)}));b(this,"getCanDraw",()=>{if(this.manager.stateApi.getRenderedEntityCount()===0||this.manager.$isBusy.get())return!1;const n=this.manager.stateApi.getSelectedEntityAdapter();return!(!n||!n.$isInteractable.get())});b(this,"onStagePointerEnter",async n=>{var s;try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.syncCursorPositions();const r=this.$cursorPos.get(),a=this.$isMouseDown.get(),i=this.manager.stateApi.getSettings(),c=this.$tool.get(),d=this.manager.stateApi.getSelectedEntityAdapter();if(!r||!a||!(d!=null&&d.$isInteractable.get()))return;if(((s=d.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&d.bufferRenderer.hasBuffer()){d.bufferRenderer.commitBuffer();return}if(c==="brush"){const u=Hi(r.relative,d.state.position),h=Uo(u,i.brushWidth);n.evt.pointerType==="pen"&&i.pressureSensitivity?await d.bufferRenderer.setBuffer({id:Te("brush_line_with_pressure"),type:"brush_line_with_pressure",points:[h.x,h.y,n.evt.pressure],strokeWidth:i.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.getClip(d.state)}):await d.bufferRenderer.setBuffer({id:Te("brush_line"),type:"brush_line",points:[h.x,h.y],strokeWidth:i.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.getClip(d.state)});return}if(c==="eraser"){const u=Hi(r.relative,d.state.position),h=Uo(u,i.brushWidth);d.bufferRenderer.state&&d.bufferRenderer.hasBuffer()&&d.bufferRenderer.commitBuffer(),n.evt.pointerType==="pen"&&i.pressureSensitivity?await d.bufferRenderer.setBuffer({id:Te("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:[h.x,h.y],strokeWidth:i.eraserWidth,clip:this.getClip(d.state)}):await d.bufferRenderer.setBuffer({id:Te("eraser_line"),type:"eraser_line",points:[h.x,h.y],strokeWidth:i.eraserWidth,clip:this.getClip(d.state)});return}}finally{this.render()}});b(this,"onStagePointerDown",async n=>{try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;const s=I5(n);this.$isMouseDown.set(s),this.syncCursorPositions();const r=this.$cursorPos.get(),a=this.$tool.get(),i=this.manager.stateApi.getSettings(),c=this.manager.stateApi.getSelectedEntityAdapter();if(!r||!s||!(c!=null&&c.$isInteractable.get()))return;const d=Hi(r.relative,c.state.position);if(a==="brush")if(n.evt.pointerType==="pen"&&i.pressureSensitivity){const u=$y(c.state.objects,"brush_line_with_pressure"),h=Uo(d,i.brushWidth);c.bufferRenderer.hasBuffer()&&c.bufferRenderer.commitBuffer();let p;n.evt.shiftKey&&u?p=[u.x,u.y,u.pressure,h.x,h.y,n.evt.pressure]:p=[h.x,h.y,n.evt.pressure],await c.bufferRenderer.setBuffer({id:Te("brush_line_with_pressure"),type:"brush_line_with_pressure",points:p,strokeWidth:i.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.getClip(c.state)})}else{const u=Fy(c.state.objects,"brush_line"),h=Uo(d,i.brushWidth);c.bufferRenderer.hasBuffer()&&c.bufferRenderer.commitBuffer();let p;n.evt.shiftKey&&u?p=[u.x,u.y,h.x,h.y]:p=[h.x,h.y],await c.bufferRenderer.setBuffer({id:Te("brush_line"),type:"brush_line",points:p,strokeWidth:i.brushWidth,color:this.manager.stateApi.getCurrentColor(),clip:this.getClip(c.state)})}if(a==="eraser")if(n.evt.pointerType==="pen"&&i.pressureSensitivity){const u=$y(c.state.objects,"eraser_line_with_pressure"),h=Uo(d,i.eraserWidth);c.bufferRenderer.hasBuffer()&&c.bufferRenderer.commitBuffer();let p;n.evt.shiftKey&&u?p=[u.x,u.y,u.pressure,h.x,h.y,n.evt.pressure]:p=[h.x,h.y,n.evt.pressure],await c.bufferRenderer.setBuffer({id:Te("eraser_line_with_pressure"),type:"eraser_line_with_pressure",points:p,strokeWidth:i.eraserWidth,clip:this.getClip(c.state)})}else{const u=Fy(c.state.objects,"eraser_line"),h=Uo(d,i.eraserWidth);c.bufferRenderer.hasBuffer()&&c.bufferRenderer.commitBuffer();let p;n.evt.shiftKey&&u?p=[u.x,u.y,h.x,h.y]:p=[h.x,h.y],await c.bufferRenderer.setBuffer({id:Te("eraser_line"),type:"eraser_line",points:p,strokeWidth:i.eraserWidth,clip:this.getClip(c.state)})}a==="rect"&&(c.bufferRenderer.hasBuffer()&&c.bufferRenderer.commitBuffer(),await c.bufferRenderer.setBuffer({id:Te("rect"),type:"rect",rect:{x:Math.round(d.x),y:Math.round(d.y),width:0,height:0},color:this.manager.stateApi.getCurrentColor()}))}finally{this.render()}});b(this,"onStagePointerUp",n=>{var s,r,a,i,c;try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;const d=this.$tool.get(),u=this.manager.stateApi.getSettings();if(d==="colorPicker"){const p=this.$colorUnderCursor.get();p&&this.manager.stateApi.setColor({...u.color,...p});return}const h=this.manager.stateApi.getSelectedEntityAdapter();if(!(h!=null&&h.$isInteractable.get()))return;d==="brush"&&((((s=h.bufferRenderer.state)==null?void 0:s.type)==="brush_line"||((r=h.bufferRenderer.state)==null?void 0:r.type)==="brush_line_with_pressure")&&h.bufferRenderer.hasBuffer()?h.bufferRenderer.commitBuffer():h.bufferRenderer.clearBuffer()),d==="eraser"&&((((a=h.bufferRenderer.state)==null?void 0:a.type)==="eraser_line"||((i=h.bufferRenderer.state)==null?void 0:i.type)==="eraser_line_with_pressure")&&h.bufferRenderer.hasBuffer()?h.bufferRenderer.commitBuffer():h.bufferRenderer.clearBuffer()),d==="rect"&&(((c=h.bufferRenderer.state)==null?void 0:c.type)==="rect"&&h.bufferRenderer.hasBuffer()?h.bufferRenderer.commitBuffer():h.bufferRenderer.clearBuffer())}finally{this.render()}});b(this,"syncColorUnderCursor",_5(()=>{const n=this.$cursorPos.get();if(!n)return;const s=M5(this.konva.stage,n.absolute);s&&this.$colorUnderCursor.set(s)}));b(this,"onStagePointerMove",async n=>{try{if(this.$lastPointerType.set(n.evt.pointerType),!this.getCanDraw())return;this.syncCursorPositions();const s=this.$cursorPos.get();if(!s)return;const r=this.$tool.get();r==="colorPicker"&&this.syncColorUnderCursor();const a=this.$isMouseDown.get(),i=this.manager.stateApi.getSelectedEntityAdapter();if(!a||!(i!=null&&i.$isInteractable.get()))return;const c=i.bufferRenderer.state;if(!c)return;const d=this.manager.stateApi.getSettings();if(r==="brush"&&(c.type==="brush_line"||c.type==="brush_line_with_pressure")){const u=zy(c.points),h=d.brushWidth*this.config.BRUSH_SPACING_TARGET_SCALE;if(!u||!Vy(s.relative,u,h))return;const p=Hi(s.relative,i.state.position),f=Uo(p,d.brushWidth);if(u.x===f.x&&u.y===f.y)return;c.points.push(f.x,f.y),c.type==="brush_line_with_pressure"&&c.points.push(n.evt.pressure),await i.bufferRenderer.setBuffer(c)}else if(r==="eraser"&&(c.type==="eraser_line"||c.type==="eraser_line_with_pressure")){const u=zy(c.points),h=d.eraserWidth*this.config.BRUSH_SPACING_TARGET_SCALE;if(!u||!Vy(s.relative,u,h))return;const p=Hi(s.relative,i.state.position),f=Uo(p,d.eraserWidth);if(u.x===f.x&&u.y===f.y)return;c.points.push(f.x,f.y),c.type==="eraser_line_with_pressure"&&c.points.push(n.evt.pressure),await i.bufferRenderer.setBuffer(c)}else if(r==="rect"&&c.type==="rect"){const u=Hi(s.relative,i.state.position),h=A5(u);c.rect.width=Math.round(h.x-c.rect.x),c.rect.height=Math.round(h.y-c.rect.y),await i.bufferRenderer.setBuffer(c)}else i==null||i.bufferRenderer.clearBuffer()}finally{this.render()}});b(this,"onStagePointerLeave",n=>{var s;try{if(this.$lastPointerType.set(n.pointerType),this.$cursorPos.set(null),!this.getCanDraw())return;const r=this.manager.stateApi.getSelectedEntityAdapter();r&&((s=r.bufferRenderer.state)==null?void 0:s.type)!=="rect"&&r.bufferRenderer.hasBuffer()&&r.bufferRenderer.commitBuffer()}finally{this.render()}});b(this,"onStageMouseWheel",n=>{if(!this.getCanDraw()||(n.evt.preventDefault(),!n.evt.ctrlKey&&!n.evt.metaKey))return;const s=this.manager.stateApi.getSettings(),r=this.$tool.get();let a=n.evt.deltaY;s.invertScrollForToolWidth&&(a=-a),r==="brush"?this.manager.stateApi.setBrushWidth(Hy(s.brushWidth,a)):r==="eraser"&&this.manager.stateApi.setEraserWidth(Hy(s.eraserWidth,a)),this.render()});b(this,"onWindowPointerUp",n=>{try{this.$isMouseDown.set(!1);const s=this.manager.stateApi.getSelectedEntityAdapter();s&&s.bufferRenderer.hasBuffer()&&!this.manager.$isBusy.get()&&s.bufferRenderer.commitBuffer()}finally{this.render()}});b(this,"onWindowBlur",()=>{this.revertToolBuffer()});b(this,"onKeyDown",n=>{var s;if(!n.repeat&&!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)){if(n.key===kK){n.preventDefault();const r=this.manager.stateApi.getSelectedEntityAdapter();r&&!((s=r.filterer)!=null&&s.$isFiltering.get())&&!r.transformer.$isTransforming.get()&&r.bufferRenderer.hasBuffer()&&r.bufferRenderer.clearBuffer();return}if(n.key===gC){n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("view"),this.manager.stateApi.$spaceKey.set(!0),this.$cursorPos.set(null);return}n.key===xC&&(n.preventDefault(),this.$toolBuffer.set(this.$tool.get()),this.$tool.set("colorPicker"))}});b(this,"onKeyUp",n=>{if(!n.repeat&&!(n.target instanceof HTMLInputElement||n.target instanceof HTMLTextAreaElement)){if(n.key===gC){n.preventDefault(),this.revertToolBuffer(),this.manager.stateApi.$spaceKey.set(!1);return}if(n.key===xC){n.preventDefault(),this.revertToolBuffer();return}}});b(this,"revertToolBuffer",()=>{const n=this.$toolBuffer.get();n&&(this.$tool.set(n),this.$toolBuffer.set(null))});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config,$tool:this.$tool.get(),$toolBuffer:this.$toolBuffer.get(),$isMouseDown:this.$isMouseDown.get(),$cursorPos:this.$cursorPos.get(),$colorUnderCursor:this.$colorUnderCursor.get(),brushToolPreview:this.brushToolPreview.repr(),eraserToolPreview:this.eraserToolPreview.repr(),colorPickerToolPreview:this.colorPickerToolPreview.repr()}));b(this,"destroy",()=>{this.log.debug("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.group.destroy()});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating tool module"),this.brushToolPreview=new vK(this),this.eraserToolPreview=new SK(this),this.colorPickerToolPreview=new wK(this),this.konva={stage:this.manager.stage.konva.stage,group:new Oe.Group({name:`${this.type}:group`,listening:!1})},this.konva.group.add(this.brushToolPreview.konva.group),this.konva.group.add(this.eraserToolPreview.konva.group),this.konva.group.add(this.colorPickerToolPreview.konva.group),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.$isBusy.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Ra,this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(Je,this.render)),this.subscriptions.add(this.$tool.listen(()=>{this.manager.tool.$isMouseDown.set(!1),this.render()}));const s=this.setEventListeners();this.subscriptions.add(s)}}class MK extends Zt{constructor(n){super();b(this,"type","worker");b(this,"id");b(this,"path");b(this,"log");b(this,"parent");b(this,"manager");b(this,"worker",new Worker(new URL(""+new URL("worker-Dywf1EVc.js",import.meta.url).href,import.meta.url),{type:"module",name:"worker"}));b(this,"tasks",new Map);b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,tasks:Array.from(this.tasks.keys())}));b(this,"destroy",()=>{this.log.trace("Destroying worker module"),this.worker.terminate(),this.tasks.clear()});this.id=Te(this.type),this.parent=n,this.manager=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.worker.onmessage=s=>{const{type:r,data:a}=s.data;if(r==="log")a.ctx?this.log[a.level](a.ctx,a.message):this.log[a.level](a.message);else if(r==="extents"){const i=this.tasks.get(a.id);if(!i)return;i.onComplete(a.extents),this.tasks.delete(a.id)}},this.worker.onerror=s=>{this.log.error({message:s.message},"Worker error")},this.worker.onmessageerror=()=>{this.log.error("Worker message error")}}requestBbox(n,s){const r=Te("bbox_calculation"),a={type:"get_bbox",data:{...n,id:r}};this.tasks.set(r,{task:a,onComplete:s}),this.worker.postMessage(a,[n.buffer])}}const Pf="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAIAAAAC64paAAAFwWlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4KPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iWE1QIENvcmUgNS41LjAiPgogPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIgogICAgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIgogICAgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIgogICAgeG1sbnM6ZGM9Imh0dHA6Ly9wdXJsLm9yZy9kYy9lbGVtZW50cy8xLjEvIgogICAgeG1sbnM6ZXhpZj0iaHR0cDovL25zLmFkb2JlLmNvbS9leGlmLzEuMC8iCiAgICB4bWxuczp0aWZmPSJodHRwOi8vbnMuYWRvYmUuY29tL3RpZmYvMS4wLyIKICAgIHhtbG5zOnhtcE1NPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvbW0vIgogICAgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIKICAgeG1wOkNyZWF0ZURhdGU9IjIwMjQtMDktMTNUMjA6NTM6MTMrMTAwMCIKICAgeG1wOk1vZGlmeURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHhtcDpNZXRhZGF0YURhdGU9IjIwMjQtMDktMTNUMjE6MTg6NDArMTA6MDAiCiAgIHBob3Rvc2hvcDpEYXRlQ3JlYXRlZD0iMjAyNC0wOS0xM1QyMDo1MzoxMysxMDAwIgogICBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIgogICBwaG90b3Nob3A6SUNDUHJvZmlsZT0iR2VuZXJpYyBSR0IgUHJvZmlsZSIKICAgZXhpZjpQaXhlbFhEaW1lbnNpb249IjIwIgogICBleGlmOlBpeGVsWURpbWVuc2lvbj0iMjAiCiAgIGV4aWY6Q29sb3JTcGFjZT0iNjU1MzUiCiAgIHRpZmY6SW1hZ2VXaWR0aD0iMjAiCiAgIHRpZmY6SW1hZ2VMZW5ndGg9IjIwIgogICB0aWZmOlJlc29sdXRpb25Vbml0PSIyIgogICB0aWZmOlhSZXNvbHV0aW9uPSI5Ni8xIgogICB0aWZmOllSZXNvbHV0aW9uPSI5Ni8xIj4KICAgPGRjOnRpdGxlPgogICAgPHJkZjpBbHQ+CiAgICAgPHJkZjpsaSB4bWw6bGFuZz0ieC1kZWZhdWx0Ij50cmFuc3BhcmVudF9iZ19kYXJrPC9yZGY6bGk+CiAgICA8L3JkZjpBbHQ+CiAgIDwvZGM6dGl0bGU+CiAgIDx4bXBNTTpIaXN0b3J5PgogICAgPHJkZjpTZXE+CiAgICAgPHJkZjpsaQogICAgICBzdEV2dDphY3Rpb249InByb2R1Y2VkIgogICAgICBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZmZpbml0eSBQaG90byAyIDIuNS41IgogICAgICBzdEV2dDp3aGVuPSIyMDI0LTA5LTEzVDIxOjE4OjQwKzEwOjAwIi8+CiAgICA8L3JkZjpTZXE+CiAgIDwveG1wTU06SGlzdG9yeT4KICA8L3JkZjpEZXNjcmlwdGlvbj4KIDwvcmRmOlJERj4KPC94OnhtcG1ldGE+Cjw/eHBhY2tldCBlbmQ9InIiPz5YzHPhAAAETGlDQ1BHZW5lcmljIFJHQiBQcm9maWxlAABIic1VXWgcVRQ+m7m7CSSOUmNTU0kHtTaENExSqRtqo/uXZNu4WTbZtA0Fncze3Zlm9seZ2dSWYiEI/rwYFXxVq4IPBZ8K8T8FMSJKCyVKMIiCYOsfhUpfNKznzp3dnaRZ9dE73JnvnvPdc+8958y5AC3PGWreapIA8gXbTI2EpaPHpqXmVWiCu6EVOqFVUa1SKJkcA2xKqWTALe3m1+Bj3yt7ma1b9f/YWjPUUgF8Ldj7MpaaB2gKAvhfUEumDdD8KXKCJ+0Sw38hbjdxgwAtdzCc4/h+hmc4DjqcyVQEMduzqGpKBvFxxL0zHnnOg/kenNY+QgvU1FWJ+SJpFrO6Qat7bYcRoFDAboIOKkiQQkkYv0mUFCGLUgMo/O/aMsz/1Jd9vufo8J1HfB754u37fWysWjTDxku7+Vg+ew7gCYB3BM5bevjsFJO3uJPzRrnqr13Y26zZicP47cYYPpNRogxjTHznVSU24eLLc/pUwsV/lOxwCvEDGOsd5dl0CHEP4qGsOZzmdpo0rTxaxQuntckjiLchXpwtHmZztyP+ojCTGHftfK9aEYw/3AsgBDQaZ3HtQtxtFlPjfF1hOEOjMcS9iE/odnyS2xdeteYmYlU7p7VIgq8lfHxCOZRE3In4MjVGUq79n0t20l2XtBWMxBi3Qwao5ZzXkdva5Chfl0zbmJB8Lnk6qw/HXf7rmjmacvHnJcP5x3Bv5LpZTqU5338PLaRdm/4hxYyNuDgDUz4Fc60IM/hWMSvXPflY8uRjPWcpjqqcvRs4SUfPcd1Kzpl51c32SNfbUEapBr+iVPPwIjgqoyzXwA7fwTXXTpF0EJnsw36AjJGDJEgGQSKPkEfJEImidJAcqM31/ldsP9dqdp7EFanDm0LeRdTboOD7B2QUwdraFwud5W4unzcf19VLL15fPvPhjjp3hSwev9K2fGbDf27BbAOvjf+b7/0/+q/6V/C96l+rM/zf+tfwWd10uo1er9aYEOoMR5bHrjsay7Of5IYo1nGxocVitrDQyXXMA/TZxM0EzPfW+fI38m/yivyG/Jb8i/CKcEH4SHhPeF/4EiRhSbgofCJ8JrwrfOCJUePcqcXcOUf1FEyzlUcxP8WwuFO8T4yKu8Td4ljdntgh9ouj4h7U7KxFx7ue9+w6HHPqMPfW1mtxnifOvtswznqDfyiNLB1OOkzLybMCnNrEcWeSLtJP4puyOshyvWb7P90igVggGgiBFOgJDAb6A4cYrjIDe1A3iG+sWjZ9ymaFOFIsnTL1nGZLA7L8kBTCq5pK8YLa1ysphiE5KksyqUXNOZrpA3bP8xJ+I+Xc377tl+oy+zGAg7+zuleXTZcBzuP93vFgXdaNtfGu1/Am2a+WzTn3TvD5vgKwsvsG+KgtjPXqu0rlBtat5pcB1l+qVP48V6msv4n21/B2Mf4GjzuDirebG+gAAAAJcEhZcwAADsQAAA7EAZUrDhsAAAAsSURBVDiNYxSTkGXADdg5OPDIMuGRIwhGNY8MzSz409DPHz9oZfOo5pGhGQABmwOMaHIlKQAAAABJRU5ErkJggg==",AK={GRID_LINE_COLOR_COARSE:Wy(27),GRID_LINE_COLOR_FINE:Wy(18),CHECKERBOARD_PATTERN_DATAURL:Pf},Tp=class Tp extends Zt{constructor(n){super();b(this,"type","background");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"subscriptions",new Set);b(this,"config",AK);b(this,"checkboardPattern",new Image);b(this,"konva");b(this,"initialize",()=>{this.log.debug("Initializing module"),this.checkboardPattern.onload=()=>{this.konva.patternRect.fillPatternImage(this.checkboardPattern),this.render()},this.checkboardPattern.src=qd.get()?"use-credentials":"anonymous",this.checkboardPattern.src=this.config.CHECKERBOARD_PATTERN_DATAURL,this.render()});b(this,"render",()=>{if(!this.manager.stateApi.runSelector(qh)){this.konva.linesGroup.visible(!1);const k=this.manager.stage.unscale(1);this.konva.patternRect.setAttrs({visible:!0,...this.manager.stage.getScaledStageRect(),fillPatternScaleX:k,fillPatternScaleY:k});return}this.konva.linesGroup.visible(!0),this.konva.patternRect.visible(!1);const s=this.manager.stage.getScale(),{x:r,y:a}=this.manager.stage.getPosition(),{width:i,height:c}=this.manager.stage.getSize(),d=Tp.getGridSpacing(s),u={x1:0,y1:0,x2:i,y2:c},h={x:Math.ceil(r/s/d)*d,y:Math.ceil(a/s/d)*d},p={x1:-h.x,y1:-h.y,x2:i/s-h.x+d,y2:c/s-h.y+d},f={x1:Math.min(u.x1,p.x1),y1:Math.min(u.y1,p.y1),x2:Math.max(u.x2,p.x2),y2:Math.max(u.y2,p.y2)},m=f.x2-f.x1,g=f.y2-f.y1,x=Math.round(m/d)+1,C=Math.round(g/d)+1,y=1/s;let v=0,I=0;this.konva.linesGroup.destroyChildren(),this.konva.lines=[];for(let k=0;k<x;k++){v=f.x1+k*d;const M=new Oe.Line({x:v,y:f.y1,points:[0,0,0,g],stroke:v%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:y,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(M),this.konva.linesGroup.add(M)}for(let k=0;k<C;k++){I=f.y1+k*d;const M=new Oe.Line({x:f.x1,y:I,points:[0,0,m,0],stroke:I%64?this.config.GRID_LINE_COLOR_FINE:this.config.GRID_LINE_COLOR_COARSE,strokeWidth:y,listening:!1,perfectDrawEnabled:!1});this.konva.lines.push(M),this.konva.linesGroup.add(M)}});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,config:this.config}));b(this,"destroy",()=>{this.log.trace("Destroying module"),this.subscriptions.forEach(n=>n()),this.subscriptions.clear(),this.konva.layer.destroy()});this.id=Te(this.type),this.manager=n,this.parent=n,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating module"),this.konva={layer:new Oe.Layer({name:`${this.type}:layer`,listening:!1,imageSmoothingEnabled:!1}),linesGroup:new Oe.Group({name:`${this.type}:linesGroup`}),lines:[],patternRect:new Oe.Rect({name:`${this.type}:patternRect`,perfectDrawEnabled:!1})},this.konva.layer.add(this.konva.patternRect),this.konva.layer.add(this.konva.linesGroup),this.subscriptions.add(this.manager.stage.$stageAttrs.listen(this.render)),this.subscriptions.add(this.manager.stateApi.createStoreSubscription(qh,this.render))}};b(Tp,"getGridSpacing",n=>n>=2?8:n>=1&&n<2?16:n>=.5&&n<1?32:n>=.25&&n<.5?64:n>=.125&&n<.25?128:256);let A0=Tp;class g1 extends Error{constructor(n,s,r){super(s);b(this,"type");b(this,"traceback");this.name="QueueError",this.type=n,this.traceback=r,Error.captureStackTrace&&Error.captureStackTrace(this,g1)}toString(){return`${this.name} [${this.type}]: ${this.message}
Traceback:
${this.traceback}`}}class EK extends Zt{constructor(n,s){super();b(this,"type","state_api");b(this,"id");b(this,"path");b(this,"parent");b(this,"manager");b(this,"log");b(this,"store");b(this,"runSelector",n=>n(this.store.getState()));b(this,"createStoreSubscription",(n,s)=>E5(this.store,n,s));b(this,"addStoreListener",n=>this.store.dispatch(L5(n)));b(this,"getCanvasState",()=>this.runSelector(Je));b(this,"resetEntity",n=>{this.store.dispatch(Fj(n))});b(this,"setEntityPosition",n=>{this.store.dispatch(T5(n))});b(this,"addBrushLine",n=>{this.store.dispatch(P5(n))});b(this,"addEraserLine",n=>{this.store.dispatch(R5(n))});b(this,"addRect",n=>{this.store.dispatch(D5(n))});b(this,"rasterizeEntity",n=>{this.store.dispatch(_j(n))});b(this,"setGenerationBbox",n=>{this.store.dispatch(O5(n))});b(this,"setBrushWidth",n=>{this.store.dispatch(zj(n))});b(this,"setEraserWidth",n=>{this.store.dispatch(Vj(n))});b(this,"setColor",n=>this.store.dispatch(zg(n)));b(this,"runGraphAndReturnImageOutput",n=>{const{graph:s,outputNodeId:r,destination:a,prepend:i,timeout:c,signal:d}=n;if(!s.hasNode(r))throw new Error(`Graph does not contain node with id: ${r}`);const u=Te(s.id),h={prepend:i,batch:{graph:s.getGraph(),origin:u,destination:a,runs:1}};let p=null;const f=()=>{p!==null&&(window.clearTimeout(p),p=null)};let m=()=>{this.log.warn("cancelGraph called before cancelGraph is set")};return new Promise((x,C)=>{const y=async M=>{if(M.origin!==u||M.invocation_source_id!==r)return;f(),k();const{result:_}=M;if(_.type!=="image_output"){C(new Error(`Graph output node did not return an image output, got: ${_}`));return}const A=await ss(()=>Kw(_.image.image_name));if(A.isErr()){C(A.error);return}x(A.value)},v=M=>{if(M.origin===u&&!(M.status==="pending"||M.status==="in_progress")){if(M.status==="completed"){this.log.warn("Queue item completed without output node completion event");return}if(f(),k(),M.status==="failed"){const{error_type:_,error_message:A,error_traceback:D}=M;C(_&&A&&D?new g1(_,A,D):new Error("Queue item failed, but no error details were provided"))}else C(new Error("Graph canceled"))}};this.store.dispatch(ul.endpoints.enqueueBatch.initiate(h,{fixedCacheKey:"enqueueBatch",track:!1})).unwrap().then(M=>{const _=M.batch.batch_id;Fe(_,"Enqueue result is missing batch_id"),m=()=>{this.store.dispatch(ul.endpoints.cancelByBatchIds.initiate({batch_ids:[_]},{track:!1}))}}).catch(M=>{C(M)}),this.manager.socket.on("invocation_complete",y),this.manager.socket.on("queue_item_status_changed",v);const k=()=>{this.manager.socket.off("invocation_complete",y),this.manager.socket.off("queue_item_status_changed",v)};c&&(p=window.setTimeout(()=>{this.log.trace("Graph canceled by timeout"),k(),m(),C(new Error("Graph timed out"))},c)),d&&d.addEventListener("abort",()=>{this.log.trace("Graph canceled by signal"),f(),k(),m(),C(new Error("Graph canceled"))})})});b(this,"getBbox",()=>this.runSelector(cl));b(this,"getSettings",()=>this.runSelector(Ra));b(this,"getGridSize",()=>this.getSettings().snapToGrid?this.$ctrlKey.get()||this.$metaKey.get()?8:64:1);b(this,"getRegionsState",()=>this.getCanvasState().regionalGuidance);b(this,"getRasterLayersState",()=>this.getCanvasState().rasterLayers);b(this,"getControlLayersState",()=>this.getCanvasState().controlLayers);b(this,"getInpaintMasksState",()=>this.getCanvasState().inpaintMasks);b(this,"getStagingArea",()=>this.runSelector(Fg));b(this,"getBboxGridSize",()=>this.runSelector(Xd));b(this,"getIsSelected",n=>{var s;return((s=this.getCanvasState().selectedEntityIdentifier)==null?void 0:s.id)===n});b(this,"getIsTypeHidden",n=>{switch(n){case"raster_layer":return this.getRasterLayersState().isHidden;case"control_layer":return this.getControlLayersState().isHidden;case"inpaint_mask":return this.getInpaintMasksState().isHidden;case"regional_guidance":return this.getRegionsState().isHidden;default:Fe(!1,"Unhandled entity type")}});b(this,"getRenderedEntityCount",()=>{const n=N5(this.getCanvasState());let s=0;for(const r of n)r.isEnabled&&s++;return s});b(this,"getSelectedEntityAdapter",()=>{const n=this.getCanvasState();return n.selectedEntityIdentifier?this.manager.getAdapter(n.selectedEntityIdentifier):null});b(this,"getCurrentColor",()=>{let n=this.getSettings().color;const s=this.getSelectedEntityAdapter();return s&&(s.state.type==="regional_guidance"||s.state.type==="inpaint_mask")&&(n=$j),n});b(this,"getBrushPreviewColor",()=>{const n=this.getSelectedEntityAdapter();return(n==null?void 0:n.state.type)==="regional_guidance"||(n==null?void 0:n.state.type)==="inpaint_mask"?{...n.state.fill.color,a:.5}:this.getSettings().color});b(this,"$filteringAdapter",Ge(null));b(this,"$isFiltering",Mo(this.$filteringAdapter,n=>!!n));b(this,"$transformingAdapter",Ge(null));b(this,"$isTransforming",Mo(this.$transformingAdapter,n=>!!n));b(this,"$rasterizingAdapter",Ge(null));b(this,"$isRasterizing",Mo(this.$rasterizingAdapter,n=>!!n));b(this,"$spaceKey",Ge(!1));b(this,"$altKey",B5);b(this,"$ctrlKey",$5);b(this,"$metaKey",F5);b(this,"$shiftKey",$x);this.id=Te(this.type),this.parent=s,this.manager=s,this.path=this.manager.buildPath(this),this.log=this.manager.buildLogger(this),this.log.debug("Creating state api module"),this.store=n}}class LK extends Zt{constructor(n,s,r){super();b(this,"type","manager");b(this,"id");b(this,"path");b(this,"manager");b(this,"parent");b(this,"log");b(this,"store");b(this,"socket");b(this,"adapters",{rasterLayers:new Xc,controlLayers:new Xc,regionMasks:new Xc,inpaintMasks:new Xc});b(this,"stateApi");b(this,"background");b(this,"stage");b(this,"worker");b(this,"cache");b(this,"entityRenderer");b(this,"compositor");b(this,"tool");b(this,"bbox");b(this,"stagingArea");b(this,"progressImage");b(this,"konva");b(this,"_isDebugging",!1);b(this,"$isBusy");b(this,"getAdapter",n=>{switch(n.type){case"raster_layer":return this.adapters.rasterLayers.get(n.id)??null;case"control_layer":return this.adapters.controlLayers.get(n.id)??null;case"regional_guidance":return this.adapters.regionMasks.get(n.id)??null;case"inpaint_mask":return this.adapters.inpaintMasks.get(n.id)??null;default:return null}});b(this,"deleteAdapter",n=>{switch(n.type){case"raster_layer":return this.adapters.rasterLayers.delete(n.id);case"control_layer":return this.adapters.controlLayers.delete(n.id);case"regional_guidance":return this.adapters.regionMasks.delete(n.id);case"inpaint_mask":return this.adapters.inpaintMasks.delete(n.id);default:return!1}});b(this,"getAllAdapters",()=>[...this.adapters.rasterLayers.values(),...this.adapters.controlLayers.values(),...this.adapters.regionMasks.values(),...this.adapters.inpaintMasks.values()]);b(this,"createAdapter",n=>{if(z5(n)){const s=new uK(n,this);return this.adapters.rasterLayers.set(s.id,s),s}else if(V5(n)){const s=new cK(n,this);return this.adapters.controlLayers.set(s.id,s),s}else if(H5(n)){const s=new hK(n,this);return this.adapters.regionMasks.set(s.id,s),s}else if(W5(n)){const s=new dK(n,this);return this.adapters.inpaintMasks.set(s.id,s),s}else Fe(!1,"Unhandled entity type")});b(this,"getAllModules",()=>[this.bbox,this.stagingArea,this.tool,this.progressImage,this.stateApi,this.background,this.worker,this.entityRenderer,this.compositor,this.stage]);b(this,"initialize",()=>{var n;this.log.debug("Initializing");for(const s of this.getAllModules())(n=s.initialize)==null||n.call(s);yd.set(this)});b(this,"destroy",()=>{this.log.debug("Destroying module");for(const n of this.getAllAdapters())n.destroy();for(const n of this.getAllModules())n.destroy();yd.set(null)});b(this,"repr",()=>({id:this.id,type:this.type,path:this.path,$isBusy:this.$isBusy.get(),rasterLayers:Array.from(this.adapters.rasterLayers.values()).map(n=>n.repr()),controlLayers:Array.from(this.adapters.controlLayers.values()).map(n=>n.repr()),inpaintMasks:Array.from(this.adapters.inpaintMasks.values()).map(n=>n.repr()),regionMasks:Array.from(this.adapters.regionMasks.values()).map(n=>n.repr()),stateApi:this.stateApi.repr(),bbox:this.bbox.repr(),stagingArea:this.stagingArea.repr(),tool:this.tool.repr(),progressImage:this.progressImage.repr(),background:this.background.repr(),worker:this.worker.repr(),entityRenderer:this.entityRenderer.repr(),compositor:this.compositor.repr(),stage:this.stage.repr()}));b(this,"getLoggingContext",()=>({path:this.path}));b(this,"buildPath",n=>n.parent.path.concat(n.id));b(this,"buildLogger",n=>this.log.child(s=>({...s,context:{...s.context,...n.getLoggingContext()}})));this.id=Te(this.type),this.path=[this.id],this.manager=this,this.parent=this,this.log=Do("canvas").child(a=>({...a,context:{...this.getLoggingContext(),...a.context}})),this.log.debug("Creating canvas manager module"),this.store=s,this.socket=r,this.stateApi=new EK(this.store,this),this.stage=new xK(n,this),this.worker=new MK(this),this.cache=new Wq(this),this.entityRenderer=new pK(this),this.compositor=new Gq(this),this.stagingArea=new bK(this),this.$isBusy=Mo([this.stateApi.$isFiltering,this.stateApi.$isTransforming,this.stateApi.$isRasterizing,this.stagingArea.$isStaging,this.compositor.$isBusy],(a,i,c,d,u)=>a||i||c||d||u),this.background=new A0(this),this.stage.addLayer(this.background.konva.layer),this.konva={previewLayer:new Oe.Layer({listening:!1,imageSmoothingEnabled:!1})},this.stage.addLayer(this.konva.previewLayer),this.tool=new _K(this),this.progressImage=new mK(this),this.bbox=new zq(this),this.konva.previewLayer.add(this.stagingArea.konva.group),this.konva.previewLayer.add(this.progressImage.konva.group),this.konva.previewLayer.add(this.bbox.konva.group),this.konva.previewLayer.add(this.tool.konva.group)}enableDebugging(){this._isDebugging=!0,this.logDebugInfo()}disableDebugging(){this._isDebugging=!1}logDebugInfo(){console.log("Canvas manager",{managerInstance:this,managerInfo:this.repr()})}}function TK(e){const t=bC(e),[n,s]=l.useState(t),{defaultDpr:r,maxDpr:a,round:i}=e||{};return l.useEffect(()=>{if(!(typeof window<"u"&&"matchMedia"in window))return;const d=()=>s(bC({defaultDpr:r,maxDpr:a,round:i})),u=window.matchMedia(`screen and (resolution: ${n}dppx)`);return u.addEventListener?u.addEventListener("change",d):u.addListener(d),()=>{u.removeEventListener?u.removeEventListener("change",d):u.removeListener(d)}},[n,r,a,i]),n}function bC(e){const{defaultDpr:t=1,maxDpr:n=3,round:s=!0}=e||{},a=typeof window<"u"&&typeof window.devicePixelRatio=="number"?window.devicePixelRatio:t;return Math.min(Math.max(1,s?Math.floor(a):a),n)}const Wm=Do("canvas");Oe.showWarnings=!1;const PK=()=>{wt("useKonvaPixelRatioWatcher");const e=TK({round:!1});l.useLayoutEffect(()=>{Oe.pixelRatio=e},[e])},RK=()=>{wt("useInvokeCanvas"),PK();const e=Hj(),t=se(Wj),[n,s]=l.useState(null);return l.useLayoutEffect(()=>{if(Wm.debug("Initializing renderer"),!n)return Wm.debug("No stage container, skipping initialization"),()=>{};if(!t)return Wm.debug("Socket not connected, skipping initialization"),()=>{};const r=yd.get();if(r){r.stage.setContainer(n);return}new LK(n,e,t).initialize()},[n,t,e]),s},BA=l.memo(()=>{const e=RK();return o.jsx(xe,{position:"absolute",top:0,right:0,bottom:0,left:0,ref:e,borderRadius:"base",overflow:"hidden","data-testid":"control-layers-canvas"})});BA.displayName="InvokeCanvasComponent";const DK={destination:"canvas"},OK=()=>{G5(DK)},$A=l.memo(e=>(OK(),w(Pn)?e.children:null));$A.displayName="StagingAreaIsStagingGate";const FA=l.memo(()=>{const e=E(),t=At(),n=w(U5),s=w(Fx),r=w(un),a=w(eu),i=se(t.stagingArea.$shouldShowStagedImage),c=js("canvas"),{t:d}=S(),u=l.useCallback(()=>{if(!s)return;const{x:h,y:p}=n,{imageDTO:f,offsetX:m,offsetY:g}=s,x=Nr(f),C={position:{x:h+m,y:p+g},objects:[x]};e(Op({overrides:C,isSelected:(r==null?void 0:r.type)==="raster_layer"})),e(zx())},[n,e,r==null?void 0:r.type,s]);return lo(["enter"],u,{preventDefault:!0,enabled:c&&i&&a>1},[c,i,a]),o.jsx(Q,{tooltip:`${d("common.accept")} (Enter)`,"aria-label":`${d("common.accept")} (Enter)`,icon:o.jsx(Ei,{}),onClick:u,colorScheme:"invokeBlue",isDisabled:!s})});FA.displayName="StagingAreaToolbarAcceptButton";const zA=l.memo(()=>{const e=E(),{t}=S(),n=l.useCallback(()=>{e(zx())},[e]);return o.jsx(Q,{tooltip:`${t("controlLayers.stagingArea.discardAll")} (Esc)`,"aria-label":t("controlLayers.stagingArea.discardAll"),icon:o.jsx(Hs,{}),onClick:n,colorScheme:"error",fontSize:16})});zA.displayName="StagingAreaToolbarDiscardAllButton";const VA=l.memo(()=>{const e=E(),t=w(Gj),n=w(Fx),s=w(eu),{t:r}=S(),a=l.useCallback(()=>{n&&e(s===1?zx():Z5({index:t}))},[n,s,e,t]);return o.jsx(Q,{tooltip:r("controlLayers.stagingArea.discard"),"aria-label":r("controlLayers.stagingArea.discard"),icon:o.jsx(sn,{}),onClick:a,colorScheme:"invokeBlue",fontSize:16,isDisabled:!n})});VA.displayName="StagingAreaToolbarDiscardSelectedButton";const HA=l.memo(()=>{const e=w(Gj),t=w(eu),n=l.useMemo(()=>t>0?`${(e??0)+1} of ${t}`:"0 of 0",[t,e]);return o.jsx(me,{colorScheme:"base",pointerEvents:"none",minW:28,children:n})});HA.displayName="StagingAreaToolbarImageCountButton";const WA=l.memo(()=>{const e=E(),t=At(),n=w(eu),s=se(t.stagingArea.$shouldShowStagedImage),r=js("canvas"),{t:a}=S(),i=l.useCallback(()=>{e(q5())},[e]);return lo(["right"],i,{preventDefault:!0,enabled:r&&s&&n>1},[r,s,n]),o.jsx(Q,{tooltip:`${a("controlLayers.stagingArea.next")} (Right)`,"aria-label":`${a("controlLayers.stagingArea.next")} (Right)`,icon:o.jsx(AW,{}),onClick:i,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});WA.displayName="StagingAreaToolbarNextButton";const GA=l.memo(()=>{const e=E(),t=At(),n=w(eu),s=se(t.stagingArea.$shouldShowStagedImage),r=js("canvas"),{t:a}=S(),i=l.useCallback(()=>{e(K5())},[e]);return lo(["left"],i,{preventDefault:!0,enabled:r&&s&&n>1},[r,s,n]),o.jsx(Q,{tooltip:`${a("controlLayers.stagingArea.previous")} (Left)`,"aria-label":`${a("controlLayers.stagingArea.previous")} (Left)`,icon:o.jsx(IW,{}),onClick:i,colorScheme:"invokeBlue",isDisabled:n<=1||!s})});GA.displayName="StagingAreaToolbarPrevButton";const UA=l.memo(()=>{const e=w(ao),t=w(Fx),[n]=aj(),[s]=Q5(),{t:r}=S(),a=l.useCallback(async()=>{t&&(e!=="none"?(await n({imageDTOs:[t.imageDTO],board_id:e}).unwrap(),s({imageDTO:{...t.imageDTO,board_id:e},is_intermediate:!1})):s({imageDTO:t.imageDTO,is_intermediate:!1}))},[n,e,s,t]);return o.jsx(Q,{tooltip:r("controlLayers.stagingArea.saveToGallery"),"aria-label":r("controlLayers.stagingArea.saveToGallery"),icon:o.jsx($r,{}),onClick:a,colorScheme:"invokeBlue",isDisabled:!t||!t.imageDTO.is_intermediate})});UA.displayName="StagingAreaToolbarSaveSelectedToGalleryButton";const ZA=l.memo(()=>{const e=At(),t=se(e.stagingArea.$shouldShowStagedImage),{t:n}=S(),s=l.useCallback(()=>{e.stagingArea.$shouldShowStagedImage.set(!t)},[e.stagingArea.$shouldShowStagedImage,t]);return o.jsx(Q,{tooltip:n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"aria-label":n(t?"controlLayers.stagingArea.showResultsOn":"controlLayers.stagingArea.showResultsOff"),"data-alert":!t,icon:t?o.jsx(yu,{}):o.jsx(UW,{}),onClick:s,colorScheme:"invokeBlue"})});ZA.displayName="StagingAreaToolbarToggleShowResultsButton";const qA=l.memo(()=>o.jsxs(o.Fragment,{children:[o.jsxs(Tn,{borderRadius:"base",shadow:"dark-lg",children:[o.jsx(GA,{}),o.jsx(HA,{}),o.jsx(WA,{})]}),o.jsxs(Tn,{borderRadius:"base",shadow:"dark-lg",children:[o.jsx(FA,{}),o.jsx(ZA,{}),o.jsx(UA,{}),o.jsx(VA,{}),o.jsx(zA,{})]})]}));qA.displayName="StagingAreaToolbar";const KA=l.memo(()=>{const{t:e}=S(),t=E(),n=w(Oj),s=l.useCallback(()=>{t(Y5())},[t]);return o.jsxs(V,{children:[o.jsx(U,{m:0,flexGrow:1,children:e("controlLayers.bboxOverlay")}),o.jsx(ot,{size:"sm",isChecked:n,onChange:s})]})});KA.displayName="CanvasSettingsBboxOverlaySwitch";const QA=l.memo(()=>{const{t:e}=S(),t=At(),n=l.useCallback(()=>{t.cache.clearAll()},[t]);return o.jsx(me,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.clearCaches")})});QA.displayName="CanvasSettingsClearCachesButton";const YA=l.memo(()=>{const{t:e}=S(),t=E(),n=l.useCallback(()=>{t(J5())},[t]);return o.jsx(me,{onClick:n,size:"sm",children:e("controlLayers.clearHistory")})});YA.displayName="CanvasSettingsClearHistoryButton";const NK=pe(Ra,e=>e.clipToBbox),JA=l.memo(()=>{const{t:e}=S(),t=E(),n=w(NK),s=l.useCallback(r=>t(X5(r.target.checked)),[t]);return o.jsxs(V,{w:"full",children:[o.jsx(U,{flexGrow:1,children:e("controlLayers.clipToBbox")}),o.jsx(kn,{isChecked:n,onChange:s})]})});JA.displayName="CanvasSettingsClipToBboxCheckbox";const XA=l.memo(()=>{const{t:e}=S(),t=E(),n=w(qh),s=l.useCallback(()=>{t(eO())},[t]);return o.jsxs(V,{children:[o.jsx(U,{m:0,flexGrow:1,children:e("controlLayers.dynamicGrid")}),o.jsx(ot,{size:"sm",isChecked:n,onChange:s})]})});XA.displayName="CanvasSettingsDynamicGridSwitch";const eE=l.memo(()=>{const{t:e}=S(),t=E(),n=w(tO),s=l.useCallback(()=>{t(nO())},[t]);return o.jsxs(V,{w:"full",children:[o.jsx(U,{flexGrow:1,children:e("controlLayers.settings.snapToGrid.label")}),o.jsx(kn,{isChecked:n,onChange:s})]})});eE.displayName="CanvasSettingsSnapToGrid";const BK=pe(Ra,e=>e.invertScrollForToolWidth),tE=l.memo(()=>{const{t:e}=S(),t=E(),n=w(BK),s=l.useCallback(r=>{t(sO(r.target.checked))},[t]);return o.jsxs(V,{w:"full",children:[o.jsx(U,{flexGrow:1,children:e("controlLayers.settings.invertBrushSizeScrollDirection")}),o.jsx(kn,{isChecked:n,onChange:s})]})});tE.displayName="CanvasSettingsInvertScrollCheckbox";const nE=l.memo(()=>{const{t:e}=S(),t=E(),n=w(Pj),s=l.useCallback(()=>{t(Rj())},[t]);return o.jsxs(V,{children:[o.jsx(U,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedFilteringPreview")}),o.jsx(ot,{size:"sm",isChecked:n,onChange:s})]})});nE.displayName="CanvasSettingsIsolatedFilteringPreviewSwitch";const sE=l.memo(()=>{const{t:e}=S(),t=E(),n=w(oO),s=l.useCallback(()=>{t(rO())},[t]);return o.jsxs(V,{children:[o.jsx(U,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedStagingPreview")}),o.jsx(ot,{size:"sm",isChecked:n,onChange:s})]})});sE.displayName="CanvasSettingsIsolatedStagingPreviewSwitch";const oE=l.memo(()=>{const{t:e}=S(),t=E(),n=w(Uj),s=l.useCallback(()=>{t(Zj())},[t]);return o.jsxs(V,{children:[o.jsx(U,{m:0,flexGrow:1,children:e("controlLayers.settings.isolatedTransformingPreview")}),o.jsx(ot,{size:"sm",isChecked:n,onChange:s})]})});oE.displayName="CanvasSettingsIsolatedTransformingPreviewSwitch";const rE=l.memo(()=>{const{t:e}=S(),t=At(),n=l.useCallback(()=>{t.logDebugInfo()},[t]);return o.jsx(me,{onClick:n,size:"sm",children:e("controlLayers.logDebugInfo")})});rE.displayName="CanvasSettingsLogDebugInfoButton";const aE=l.memo(()=>{const{t:e}=S(),t=E(),n=w(aO),s=l.useCallback(()=>{t(iO())},[t]);return o.jsxs(V,{w:"full",children:[o.jsx(U,{flexGrow:1,children:e("controlLayers.outputOnlyMaskedRegions")}),o.jsx(kn,{isChecked:n,onChange:s})]})});aE.displayName="CanvasSettingsOutputOnlyMaskedRegionsCheckbox";const iE=l.memo(()=>{const{t:e}=S(),t=E(),n=w(Sj),s=l.useCallback(()=>t(lO()),[t]);return o.jsxs(V,{w:"full",children:[o.jsx(U,{flexGrow:1,children:e("controlLayers.settings.preserveMask.label")}),o.jsx(kn,{isChecked:n,onChange:s})]})});iE.displayName="CanvasSettingsPreserveMaskCheckbox";const lE=l.memo(()=>{const{t:e}=S(),t=E(),n=w(cO),s=l.useCallback(()=>{t(dO())},[t]);return o.jsxs(V,{w:"full",children:[o.jsx(U,{flexGrow:1,children:e("controlLayers.settings.pressureSensitivity")}),o.jsx(kn,{isChecked:n,onChange:s})]})});lE.displayName="CanvasSettingsPressureSensitivityCheckbox";const cE=l.memo(()=>{const{t:e}=S(),t=At(),n=l.useCallback(()=>{for(const s of t.getAllAdapters())s.transformer.requestRectCalculation()},[t]);return o.jsx(me,{onClick:n,size:"sm",colorScheme:"warning",children:e("controlLayers.recalculateRects")})});cE.displayName="CanvasSettingsRecalculateRectsButton";const $K=pe(Ra,e=>e.showHUD),dE=l.memo(()=>{const{t:e}=S(),t=E(),n=w($K),s=l.useCallback(()=>{t(uO())},[t]);return o.jsxs(V,{children:[o.jsx(U,{m:0,flexGrow:1,children:e("controlLayers.showHUD")}),o.jsx(ot,{size:"sm",isChecked:n,onChange:s})]})});dE.displayName="CanvasSettingsShowHUDSwitch";const uE=l.memo(()=>{const{t:e}=S(),t=E(),n=w($g),s=l.useCallback(()=>{t(hO())},[t]);return o.jsxs(V,{children:[o.jsx(U,{m:0,flexGrow:1,children:e("controlLayers.showProgressOnCanvas")}),o.jsx(ot,{size:"sm",isChecked:n,onChange:s})]})});uE.displayName="CanvasSettingsShowProgressOnCanvas";const hE=l.memo(()=>{const{t:e}=S();return o.jsxs(Qn,{isLazy:!0,children:[o.jsx(ds,{children:o.jsx(Q,{"aria-label":e("common.settingsLabel"),icon:o.jsx(xc,{}),variant:"link",alignSelf:"stretch"})}),o.jsxs(Yn,{children:[o.jsx(Zr,{}),o.jsx(Jn,{children:o.jsxs(j,{direction:"column",gap:2,children:[o.jsx(tE,{}),o.jsx(iE,{}),o.jsx(JA,{}),o.jsx(aE,{}),o.jsx(eE,{}),o.jsx(lE,{}),o.jsx(uE,{}),o.jsx(sE,{}),o.jsx(nE,{}),o.jsx(oE,{}),o.jsx(XA,{}),o.jsx(KA,{}),o.jsx(dE,{}),o.jsx(FK,{})]})})]})]})});hE.displayName="CanvasSettingsPopover";const FK=()=>Da()?o.jsxs(o.Fragment,{children:[o.jsx(zt,{}),o.jsx(QA,{}),o.jsx(cE,{}),o.jsx(rE,{}),o.jsx(YA,{})]}):null,pE=[{r:0,g:0,b:0,a:1},{r:255,g:255,b:255,a:1},{r:255,g:90,b:94,a:1},{r:255,g:146,b:75,a:1},{r:255,g:202,b:59,a:1},{r:197,g:202,b:48,a:1},{r:138,g:201,b:38,a:1},{r:83,g:165,b:117,a:1},{r:23,g:130,b:196,a:1},{r:66,g:103,b:172,a:1},{r:107,g:76,b:147,a:1}],zK=pE,VK=pE.map(({r:e,g:t,b:n})=>({r:e,g:t,b:n}));function $a(){return($a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)Object.prototype.hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e}).apply(this,arguments)}function Mu(e,t){if(e==null)return{};var n,s,r={},a=Object.keys(e);for(s=0;s<a.length;s++)t.indexOf(n=a[s])>=0||(r[n]=e[n]);return r}function Id(e){var t=l.useRef(e),n=l.useRef(function(s){t.current&&t.current(s)});return t.current=e,n.current}var Ql=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=1),e>n?n:e<t?t:e},hd=function(e){return"touches"in e},E0=function(e){return e&&e.ownerDocument.defaultView||self},yC=function(e,t,n){var s=e.getBoundingClientRect(),r=hd(t)?function(a,i){for(var c=0;c<a.length;c++)if(a[c].identifier===i)return a[c];return a[0]}(t.touches,n):t;return{left:Ql((r.pageX-(s.left+E0(e).pageXOffset))/s.width),top:Ql((r.pageY-(s.top+E0(e).pageYOffset))/s.height)}},vC=function(e){!hd(e)&&e.preventDefault()},x1=te.memo(function(e){var t=e.onMove,n=e.onKey,s=Mu(e,["onMove","onKey"]),r=l.useRef(null),a=Id(t),i=Id(n),c=l.useRef(null),d=l.useRef(!1),u=l.useMemo(function(){var m=function(C){vC(C),(hd(C)?C.touches.length>0:C.buttons>0)&&r.current?a(yC(r.current,C,c.current)):x(!1)},g=function(){return x(!1)};function x(C){var y=d.current,v=E0(r.current),I=C?v.addEventListener:v.removeEventListener;I(y?"touchmove":"mousemove",m),I(y?"touchend":"mouseup",g)}return[function(C){var y=C.nativeEvent,v=r.current;if(v&&(vC(y),!function(k,M){return M&&!hd(k)}(y,d.current)&&v)){if(hd(y)){d.current=!0;var I=y.changedTouches||[];I.length&&(c.current=I[0].identifier)}v.focus(),a(yC(v,y,c.current)),x(!0)}},function(C){var y=C.which||C.keyCode;y<37||y>40||(C.preventDefault(),i({left:y===39?.05:y===37?-.05:0,top:y===40?.05:y===38?-.05:0}))},x]},[i,a]),h=u[0],p=u[1],f=u[2];return l.useEffect(function(){return f},[f]),te.createElement("div",$a({},s,{onTouchStart:h,onMouseDown:h,className:"react-colorful__interactive",ref:r,onKeyDown:p,tabIndex:0,role:"slider"}))}),Au=function(e){return e.filter(Boolean).join(" ")},b1=function(e){var t=e.color,n=e.left,s=e.top,r=s===void 0?.5:s,a=Au(["react-colorful__pointer",e.className]);return te.createElement("div",{className:a,style:{top:100*r+"%",left:100*n+"%"}},te.createElement("div",{className:"react-colorful__pointer-fill",style:{backgroundColor:t}}))},rs=function(e,t,n){return t===void 0&&(t=0),n===void 0&&(n=Math.pow(10,t)),Math.round(n*e)/n},fE=function(e){var t=e.s,n=e.v,s=e.a,r=(200-t)*n/100;return{h:rs(e.h),s:rs(r>0&&r<200?t*n/100/(r<=100?r:200-r)*100:0),l:rs(r/2),a:rs(s,2)}},L0=function(e){var t=fE(e);return"hsl("+t.h+", "+t.s+"%, "+t.l+"%)"},Gm=function(e){var t=fE(e);return"hsla("+t.h+", "+t.s+"%, "+t.l+"%, "+t.a+")"},mE=function(e){var t=e.h,n=e.s,s=e.v,r=e.a;t=t/360*6,n/=100,s/=100;var a=Math.floor(t),i=s*(1-n),c=s*(1-(t-a)*n),d=s*(1-(1-t+a)*n),u=a%6;return{r:rs(255*[s,c,i,i,d,s][u]),g:rs(255*[d,s,s,c,i,i][u]),b:rs(255*[i,i,d,s,s,c][u]),a:rs(r,2)}},gE=function(e){var t=e.r,n=e.g,s=e.b,r=e.a,a=Math.max(t,n,s),i=a-Math.min(t,n,s),c=i?a===t?(n-s)/i:a===n?2+(s-t)/i:4+(t-n)/i:0;return{h:rs(60*(c<0?c+6:c)),s:rs(a?i/a*100:0),v:rs(a/255*100),a:r}},xE=te.memo(function(e){var t=e.hue,n=e.onChange,s=Au(["react-colorful__hue",e.className]);return te.createElement("div",{className:s},te.createElement(x1,{onMove:function(r){n({h:360*r.left})},onKey:function(r){n({h:Ql(t+360*r.left,0,360)})},"aria-label":"Hue","aria-valuenow":rs(t),"aria-valuemax":"360","aria-valuemin":"0"},te.createElement(b1,{className:"react-colorful__hue-pointer",left:t/360,color:L0({h:t,s:100,v:100,a:1})})))}),bE=te.memo(function(e){var t=e.hsva,n=e.onChange,s={backgroundColor:L0({h:t.h,s:100,v:100,a:1})};return te.createElement("div",{className:"react-colorful__saturation",style:s},te.createElement(x1,{onMove:function(r){n({s:100*r.left,v:100-100*r.top})},onKey:function(r){n({s:Ql(t.s+100*r.left,0,100),v:Ql(t.v-100*r.top,0,100)})},"aria-label":"Color","aria-valuetext":"Saturation "+rs(t.s)+"%, Brightness "+rs(t.v)+"%"},te.createElement(b1,{className:"react-colorful__saturation-pointer",top:1-t.v/100,left:t.s/100,color:L0(t)})))}),y1=function(e,t){if(e===t)return!0;for(var n in e)if(e[n]!==t[n])return!1;return!0};function yE(e,t,n){var s=Id(n),r=l.useState(function(){return e.toHsva(t)}),a=r[0],i=r[1],c=l.useRef({color:t,hsva:a});l.useEffect(function(){if(!e.equal(t,c.current.color)){var u=e.toHsva(t);c.current={hsva:u,color:t},i(u)}},[t,e]),l.useEffect(function(){var u;y1(a,c.current.hsva)||e.equal(u=e.fromHsva(a),c.current.color)||(c.current={hsva:a,color:u},s(u))},[a,e,s]);var d=l.useCallback(function(u){i(function(h){return Object.assign({},h,u)})},[]);return[a,d]}var HK=typeof window<"u"?l.useLayoutEffect:l.useEffect,WK=function(){return typeof __webpack_nonce__<"u"?__webpack_nonce__:void 0},CC=new Map,vE=function(e){HK(function(){var t=e.current?e.current.ownerDocument:document;if(t!==void 0&&!CC.has(t)){var n=t.createElement("style");n.innerHTML=`.react-colorful{position:relative;display:flex;flex-direction:column;width:200px;height:200px;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;cursor:default}.react-colorful__saturation{position:relative;flex-grow:1;border-color:transparent;border-bottom:12px solid #000;border-radius:8px 8px 0 0;background-image:linear-gradient(0deg,#000,transparent),linear-gradient(90deg,#fff,hsla(0,0%,100%,0))}.react-colorful__alpha-gradient,.react-colorful__pointer-fill{content:"";position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;border-radius:inherit}.react-colorful__alpha-gradient,.react-colorful__saturation{box-shadow:inset 0 0 0 1px rgba(0,0,0,.05)}.react-colorful__alpha,.react-colorful__hue{position:relative;height:24px}.react-colorful__hue{background:linear-gradient(90deg,red 0,#ff0 17%,#0f0 33%,#0ff 50%,#00f 67%,#f0f 83%,red)}.react-colorful__last-control{border-radius:0 0 8px 8px}.react-colorful__interactive{position:absolute;left:0;top:0;right:0;bottom:0;border-radius:inherit;outline:none;touch-action:none}.react-colorful__pointer{position:absolute;z-index:1;box-sizing:border-box;width:28px;height:28px;transform:translate(-50%,-50%);background-color:#fff;border:2px solid #fff;border-radius:50%;box-shadow:0 2px 4px rgba(0,0,0,.2)}.react-colorful__interactive:focus .react-colorful__pointer{transform:translate(-50%,-50%) scale(1.1)}.react-colorful__alpha,.react-colorful__alpha-pointer{background-color:#fff;background-image:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill-opacity=".05"><path d="M8 0h8v8H8zM0 8h8v8H0z"/></svg>')}.react-colorful__saturation-pointer{z-index:3}.react-colorful__hue-pointer{z-index:2}`,CC.set(t,n);var s=WK();s&&n.setAttribute("nonce",s),t.head.appendChild(n)}},[])},GK=function(e){var t=e.className,n=e.colorModel,s=e.color,r=s===void 0?n.defaultColor:s,a=e.onChange,i=Mu(e,["className","colorModel","color","onChange"]),c=l.useRef(null);vE(c);var d=yE(n,r,a),u=d[0],h=d[1],p=Au(["react-colorful",t]);return te.createElement("div",$a({},i,{ref:c,className:p}),te.createElement(bE,{hsva:u,onChange:h}),te.createElement(xE,{hue:u.h,onChange:h,className:"react-colorful__last-control"}))},UK=function(e){var t=e.className,n=e.hsva,s=e.onChange,r={backgroundImage:"linear-gradient(90deg, "+Gm(Object.assign({},n,{a:0}))+", "+Gm(Object.assign({},n,{a:1}))+")"},a=Au(["react-colorful__alpha",t]),i=rs(100*n.a);return te.createElement("div",{className:a},te.createElement("div",{className:"react-colorful__alpha-gradient",style:r}),te.createElement(x1,{onMove:function(c){s({a:c.left})},onKey:function(c){s({a:Ql(n.a+c.left)})},"aria-label":"Alpha","aria-valuetext":i+"%","aria-valuenow":i,"aria-valuemin":"0","aria-valuemax":"100"},te.createElement(b1,{className:"react-colorful__alpha-pointer",left:n.a,color:Gm(n)})))},ZK=function(e){var t=e.className,n=e.colorModel,s=e.color,r=s===void 0?n.defaultColor:s,a=e.onChange,i=Mu(e,["className","colorModel","color","onChange"]),c=l.useRef(null);vE(c);var d=yE(n,r,a),u=d[0],h=d[1],p=Au(["react-colorful",t]);return te.createElement("div",$a({},i,{ref:c,className:p}),te.createElement(bE,{hsva:u,onChange:h}),te.createElement(xE,{hue:u.h,onChange:h}),te.createElement(UK,{hsva:u,onChange:h,className:"react-colorful__last-control"}))},qK={defaultColor:{r:0,g:0,b:0,a:1},toHsva:gE,fromHsva:mE,equal:y1},CE=function(e){return te.createElement(ZK,$a({},e,{colorModel:qK}))},KK={defaultColor:{r:0,g:0,b:0},toHsva:function(e){return gE({r:e.r,g:e.g,b:e.b,a:1})},fromHsva:function(e){return{r:(t=mE(e)).r,g:t.g,b:t.b};var t},equal:y1},QK=function(e){return te.createElement(GK,$a({},e,{colorModel:KK}))},YK=/^#?([0-9A-F]{3,8})$/i,JK=function(e){var t=e.color,n=t===void 0?"":t,s=e.onChange,r=e.onBlur,a=e.escape,i=e.validate,c=e.format,d=e.process,u=Mu(e,["color","onChange","onBlur","escape","validate","format","process"]),h=l.useState(function(){return a(n)}),p=h[0],f=h[1],m=Id(s),g=Id(r),x=l.useCallback(function(y){var v=a(y.target.value);f(v),i(v)&&m(d?d(v):v)},[a,d,i,m]),C=l.useCallback(function(y){i(y.target.value)||f(a(n)),g(y)},[n,a,i,g]);return l.useEffect(function(){f(a(n))},[n,a]),te.createElement("input",$a({},u,{value:c?c(p):p,spellCheck:"false",onChange:x,onBlur:C}))},wC=function(e){return"#"+e},XK=function(e){var t=e.prefixed,n=e.alpha,s=Mu(e,["prefixed","alpha"]),r=l.useCallback(function(i){return i.replace(/([^0-9A-F]+)/gi,"").substring(0,n?8:6)},[n]),a=l.useCallback(function(i){return function(c,d){var u=YK.exec(c),h=u?u[1].length:0;return h===3||h===6||!!d&&h===4||!!d&&h===8}(i,n)},[n]);return te.createElement(JK,$a({},s,{escape:r,format:t?wC:void 0,process:wC,validate:a}))};const Um={width:6,height:6,borderColor:"base.100"},eQ={".react-colorful__hue-pointer":Um,".react-colorful__saturation-pointer":Um,".react-colorful__alpha-pointer":Um,gap:4,flexDir:"column"},tQ={width:"100%"},ih="3.5rem",nQ=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:r=!1}=e,{t:a}=S(),i=l.useCallback(h=>n({...t,r:h}),[t,n]),c=l.useCallback(h=>n({...t,g:h}),[t,n]),d=l.useCallback(h=>n({...t,b:h}),[t,n]),u=l.useCallback(h=>n({...t,a:h}),[t,n]);return o.jsxs(j,{sx:eQ,children:[o.jsx(CE,{color:t,onChange:n,style:tQ}),s&&o.jsxs(j,{gap:2,children:[o.jsxs(V,{gap:0,children:[o.jsx(U,{children:a("common.red")[0]}),o.jsx(Ve,{value:t.r,onChange:i,min:0,max:255,step:1,w:ih,defaultValue:90})]}),o.jsxs(V,{gap:0,children:[o.jsx(U,{children:a("common.green")[0]}),o.jsx(Ve,{value:t.g,onChange:c,min:0,max:255,step:1,w:ih,defaultValue:90})]}),o.jsxs(V,{gap:0,children:[o.jsx(U,{children:a("common.blue")[0]}),o.jsx(Ve,{value:t.b,onChange:d,min:0,max:255,step:1,w:ih,defaultValue:255})]}),o.jsxs(V,{gap:0,children:[o.jsx(U,{children:a("common.alpha")[0]}),o.jsx(Ve,{value:t.a,onChange:u,step:.1,min:0,max:1,w:ih,defaultValue:1})]})]}),r&&o.jsx(j,{gap:2,justifyContent:"space-between",children:zK.map((h,p)=>o.jsx(sQ,{color:h,onChange:n},p))})]})},wE=l.memo(nQ),sQ=({color:e,onChange:t})=>{const n=l.useCallback(()=>{t(e)},[e,t]);return o.jsx(xe,{role:"button",onClick:n,h:8,w:8,bg:Sc(e),borderRadius:"base"})},oQ=pe(Ra,e=>e.color),jE=l.memo(()=>{const{t:e}=S(),t=w(oQ),n=E(),s=l.useCallback(a=>{n(zg(a))},[n]),r=jt();return Ie({id:"setFillToWhite",category:"canvas",callback:()=>n(zg({r:255,g:255,b:255,a:1})),options:{preventDefault:!0,enabled:!r.isOpen},dependencies:[n,r.isOpen]}),o.jsxs(Qn,{isLazy:!0,children:[o.jsx(ds,{children:o.jsx(j,{role:"button","aria-label":e("controlLayers.fill.fillColor"),tabIndex:-1,w:8,h:8,children:o.jsx(Ae,{label:e("controlLayers.fill.fillColor"),children:o.jsx(j,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:o.jsx(xe,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Sc(t)})})})})}),o.jsxs(Yn,{children:[o.jsx(Zr,{}),o.jsx(Jn,{minH:64,children:o.jsx(wE,{color:t,onChange:s,withNumberInput:!0,withSwatches:!0})})]})]})});jE.displayName="ToolFillColorPicker";const Jr=e=>{const t=At();return se(Mo(t.tool.$tool,s=>s===e))},Ri=e=>{const t=At();return l.useCallback(()=>{t.tool.$tool.set(e)},[t.tool.$tool,e])},rQ=pe(Ra,e=>e.brushWidth),aQ=e=>`${e} px`;function SE(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function yl(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function iQ(e){return`${String(SE(e))} px`}const lQ=[yl(1),yl(50),yl(200),yl(600)],cQ=yl(50),kE=l.memo(()=>{const e=E(),{t}=S(),n=jt(),s=Jr("brush"),r=w(rQ),[a,i]=l.useState(r),c=l.useCallback(g=>{e(zj(ir(Math.round(g),1,600)))},[e]),d=l.useCallback(()=>{let g=Math.round(r*1.15);g===r&&(g+=1),c(g)},[c,r]),u=l.useCallback(()=>{let g=Math.round(r*.85);g===r&&(g-=1),c(g)},[c,r]),h=l.useCallback(g=>{c(SE(g))},[c]),p=l.useCallback(()=>{isNaN(Number(a))?(c(50),i(50)):c(a)},[a,c]),f=l.useCallback((g,x)=>{i(x)},[]),m=l.useCallback(g=>{g.key==="Enter"&&p()},[p]);return l.useEffect(()=>{i(r)},[r]),Ie({id:"decrementToolWidth",category:"canvas",callback:u,options:{enabled:s&&!n.isOpen},dependencies:[u,s,n.isOpen]}),Ie({id:"incrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),o.jsxs(Qn,{children:[o.jsxs(V,{w:"min-content",gap:2,children:[o.jsx(U,{m:0,children:t("controlLayers.width")}),o.jsx(tu,{children:o.jsxs(Vp,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:a,onChange:f,onBlur:p,w:"76px",format:aQ,defaultValue:50,onKeyDown:m,clampValueOnBlur:!1,children:[o.jsx(Hp,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),o.jsx(ds,{children:o.jsx(Q,{"aria-label":"open-slider",icon:o.jsx(Fo,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),o.jsxs(Yn,{w:200,pt:0,pb:2,px:4,children:[o.jsx(Zr,{}),o.jsx(Jn,{children:o.jsx(qe,{min:0,max:100,value:yl(a),onChange:h,defaultValue:cQ,marks:lQ,formatValue:iQ,alwaysShowMarks:!0})})]})]})});kE.displayName="ToolBrushWidth";const dQ=pe(Ra,e=>e.eraserWidth),uQ=e=>`${e} px`;function IE(e){return e<=40?1+49*e/40:e<=70?50+150*(e-40)/30:200+400*(e-70)/30}function vl(e){return e<=50?(e-1)*40/49:e<=200?40+(e-50)*30/150:70+(e-200)*30/400}function hQ(e){return`${String(IE(e))} px`}const pQ=[vl(1),vl(50),vl(200),vl(600)],fQ=vl(50),_E=l.memo(()=>{const e=E(),{t}=S(),n=jt(),s=Jr("eraser"),r=w(dQ),[a,i]=l.useState(r),c=l.useCallback(g=>{e(Vj(ir(Math.round(g),1,600)))},[e]),d=l.useCallback(()=>{let g=Math.round(r*1.15);g===r&&(g+=1),c(g)},[c,r]),u=l.useCallback(()=>{let g=Math.round(r*.85);g===r&&(g-=1),c(g)},[c,r]),h=l.useCallback(g=>{c(IE(g))},[c]),p=l.useCallback(()=>{isNaN(Number(a))?(c(50),i(50)):c(a)},[a,c]),f=l.useCallback((g,x)=>{i(x)},[]),m=l.useCallback(g=>{g.key==="Enter"&&p()},[p]);return l.useEffect(()=>{i(r)},[r]),Ie({id:"decrementToolWidth",category:"canvas",callback:u,options:{enabled:s&&!n.isOpen},dependencies:[u,s,n.isOpen]}),Ie({id:"incrementToolWidth",category:"canvas",callback:d,options:{enabled:s&&!n.isOpen},dependencies:[d,s,n.isOpen]}),o.jsxs(Qn,{children:[o.jsxs(V,{w:"min-content",gap:2,children:[o.jsx(U,{m:0,children:t("controlLayers.width")}),o.jsx(tu,{children:o.jsxs(Vp,{variant:"outline",display:"flex",alignItems:"center",min:1,max:600,value:a,onChange:f,onBlur:p,w:"76px",format:uQ,defaultValue:50,onKeyDown:m,clampValueOnBlur:!1,children:[o.jsx(Hp,{_focusVisible:{zIndex:0},title:"",paddingInlineEnd:7}),o.jsx(ds,{children:o.jsx(Q,{"aria-label":"open-slider",icon:o.jsx(Fo,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})})]}),o.jsxs(Yn,{w:200,pt:0,pb:2,px:4,children:[o.jsx(Zr,{}),o.jsx(Jn,{children:o.jsx(qe,{min:0,max:100,value:vl(a),onChange:h,defaultValue:fQ,marks:pQ,formatValue:hQ,alwaysShowMarks:!0})})]})]})});_E.displayName="ToolEraserWidth";const ME=l.memo(()=>{const e=At(),t=se(e.tool.$tool);return t==="brush"?o.jsx(kE,{}):t==="eraser"?o.jsx(_E,{}):null});ME.displayName="ToolSettings";const AE=l.memo(()=>{const{t:e}=S(),t=At(),n=Ht(),s=l.useCallback(()=>{t.bbox.fitToLayers()},[t.bbox]);return o.jsx(Q,{onClick:s,variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.fitBboxToLayers"),tooltip:e("controlLayers.fitBboxToLayers"),icon:o.jsx(iG,{}),isDisabled:n})});AE.displayName="CanvasToolbarFitBboxToLayersButton";const EE=l.memo(()=>{const{t:e}=S(),t=E(),n=Ht(),s=w(qj),r=l.useCallback(()=>{t(Kj())},[t]);return o.jsx(Q,{"aria-label":e("hotkeys.canvas.redo.title"),tooltip:e("hotkeys.canvas.redo.title"),onClick:r,icon:o.jsx(SW,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});EE.displayName="CanvasToolbarRedoButton";const LE=l.memo(()=>{const{t:e}=S(),t=E(),n=At(),s=l.useCallback(()=>{t(Qw()),n.stage.fitLayersToStage()},[n.stage,t]);return o.jsx(Q,{"aria-label":e("controlLayers.resetCanvas"),tooltip:e("controlLayers.resetCanvas"),onClick:s,colorScheme:"error",icon:o.jsx(Ob,{}),variant:"link",alignSelf:"stretch"})});LE.displayName="CanvasToolbarResetCanvasButton";const TE=l.memo(()=>{const{t:e}=S(),t=At(),n=js("canvas"),s=jt();return Ie({id:"fitLayersToCanvas",category:"canvas",callback:t.stage.fitLayersToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ie({id:"fitBboxToCanvas",category:"canvas",callback:t.stage.fitBboxToStage,options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ie({id:"setZoomTo100Percent",category:"canvas",callback:()=>t.stage.setScale(1),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ie({id:"setZoomTo200Percent",category:"canvas",callback:()=>t.stage.setScale(2),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ie({id:"setZoomTo400Percent",category:"canvas",callback:()=>t.stage.setScale(4),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),Ie({id:"setZoomTo800Percent",category:"canvas",callback:()=>t.stage.setScale(8),options:{enabled:n&&!s.isOpen,preventDefault:!0},dependencies:[n,s.isOpen]}),o.jsx(Q,{tooltip:e("hotkeys.canvas.fitLayersToCanvas.title"),"aria-label":e("hotkeys.canvas.fitLayersToCanvas.title"),onClick:t.stage.fitLayersToStage,icon:o.jsx(bu,{}),variant:"link",alignSelf:"stretch"})});TE.displayName="CanvasToolbarResetViewButton";const PE=l.memo(()=>{const{t:e}=S(),t=Da(),n=Ht(),s=rA(),r=aA();return o.jsx(Q,{variant:"link",alignSelf:"stretch",onClick:t?r:s,icon:o.jsx($r,{}),"aria-label":e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),tooltip:e(t?"controlLayers.saveBboxToGallery":"controlLayers.saveCanvasToGallery"),isDisabled:n})});PE.displayName="CanvasToolbarSaveToGalleryButton";function mQ(e){return isNaN(Number(e))?"":`${wb(Number(e),2).toLocaleString()}%`}function RE(e){return e<=40?10+90*e/40:e<=70?100+400*(e-40)/30:500+1500*(e-70)/30}function Qa(e){return e<=100?(e-10)*40/90:e<=500?40+(e-100)*30/400:70+(e-500)*30/1500}function gQ(e){return String(RE(e))}const T0=[Qa(10),Qa(50),Qa(100),Qa(500),Qa(2e3)],xQ=Qa(100),bQ=T0.slice(1,T0.length-1),DE=l.memo(()=>{const e=At(),t=se(Mo(e.stage.$stageAttrs,d=>d.scale)),[n,s]=l.useState(t*100),r=l.useCallback(d=>{let u=d;$x.get()||(u=Qj(d,bQ,2));const h=RE(u);e.stage.setScale(h/100)},[e]),a=l.useCallback(()=>{if(isNaN(Number(n))){e.stage.setScale(1),s(100);return}e.stage.setScale(n/100)},[e,n]),i=l.useCallback((d,u)=>{s(u)},[]),c=l.useCallback(d=>{d.key==="Enter"&&a()},[a]);return l.useEffect(()=>{s(t*100)},[t]),o.jsxs(j,{alignItems:"center",children:[o.jsx(yQ,{}),o.jsxs(Qn,{children:[o.jsx(tu,{children:o.jsxs(Vp,{variant:"outline",display:"flex",alignItems:"center",min:e.stage.config.MIN_SCALE*100,max:e.stage.config.MAX_SCALE*100,value:n,onChange:i,onBlur:a,w:"76px",format:mQ,defaultValue:100,onKeyDown:c,clampValueOnBlur:!1,children:[o.jsx(Hp,{paddingInlineEnd:7,title:"",_focusVisible:{zIndex:0}}),o.jsx(ds,{children:o.jsx(Q,{"aria-label":"open-slider",icon:o.jsx(Fo,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full"})})]})}),o.jsxs(Yn,{w:200,pt:0,pb:2,px:4,children:[o.jsx(Zr,{}),o.jsx(Jn,{children:o.jsx(qe,{min:0,max:100,value:Qa(n),onChange:r,defaultValue:xQ,marks:T0,formatValue:gQ,alwaysShowMarks:!0})})]})]}),o.jsx(vQ,{})]})});DE.displayName="CanvasToolbarScale";const OE=[.1,.15,.2,.25,.5,.75,1,1.5,2,2.5,5,7.5,10,15,20],yQ=()=>{const e=At(),t=se(Mo(e.stage.$stageAttrs,s=>s.scale)),n=l.useCallback(()=>{const s=OE.slice().reverse().find(r=>r<t)??e.stage.config.MIN_SCALE;e.stage.setScale(Math.max(s,e.stage.config.MIN_SCALE))},[e.stage,t]);return o.jsx(Q,{onClick:n,icon:o.jsx(VI,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t<=e.stage.config.MIN_SCALE})},vQ=()=>{const e=At(),t=se(Mo(e.stage.$stageAttrs,s=>s.scale)),n=l.useCallback(()=>{const s=OE.find(r=>r>t)??e.stage.config.MAX_SCALE;e.stage.setScale(Math.min(s,e.stage.config.MAX_SCALE))},[e.stage,t]);return o.jsx(Q,{onClick:n,icon:o.jsx(HI,{}),"aria-label":"Zoom out",variant:"link",alignSelf:"stretch",isDisabled:t>=e.stage.config.MAX_SCALE})},NE=l.memo(()=>{const{t:e}=S(),t=E(),n=Ht(),s=w(Yj),r=l.useCallback(()=>{t(Jj())},[t]);return o.jsx(Q,{"aria-label":e("hotkeys.canvas.undo.title"),tooltip:e("hotkeys.canvas.undo.title"),onClick:r,icon:o.jsx(Kr,{}),variant:"link",alignSelf:"stretch",isDisabled:n||!s})});NE.displayName="CanvasToolbarUndoButton";function BE(){wt(BE.name);const e=E(),t=w(un),n=Ht(),s=w(Wp),r=w(bn),a=jt(),i=l.useCallback(()=>{t!==null&&e(Bx({entityIdentifier:t}))},[e,t]),c=l.useMemo(()=>t!==null&&!n&&s==="layers"&&r==="canvas",[t,n,s,r]);Ie({id:"deleteSelected",category:"canvas",callback:i,options:{enabled:c&&!a.isOpen},dependencies:[c,i,a.isOpen]})}const CQ=()=>{const e=E(),[t,n]=l.useState(null),[s,r]=l.useState(null),a=w(un),i=w(pO),c=jt();l.useEffect(()=>{(s==null?void 0:s.id)!==(a==null?void 0:a.id)&&(n(s),r(a))},[s,a]);const d=l.useCallback(()=>{i?(s==null?void 0:s.id)!==i.id?(n(s),r(i),e(kl({entityIdentifier:i}))):t&&(r(t),e(kl({entityIdentifier:t}))):t!==null&&s!==null&&(n(s),r(t),e(kl({entityIdentifier:t})))},[i,s,e,t]);Ie({id:"quickSwitch",category:"canvas",callback:d,options:{enabled:!c.isOpen},dependencies:[d,c.isOpen]})},wQ=()=>{wt("useCanvasFilterHotkey");const e=w(un),t=_f(e);Ie({id:"filterSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})};function $E(){wt($E.name);const e=E(),t=w(un),n=Ht(),s=br(t),r=se((s==null?void 0:s.$isInteractable)??wd),a=jt(),i=l.useCallback(()=>{t===null||s===null||(s.bufferRenderer.clearBuffer(),e(Fj({entityIdentifier:t})))},[s,e,t]),c=l.useMemo(()=>t!==null&&Vg(t),[t]);Ie({id:"resetSelected",category:"canvas",callback:i,options:{enabled:c&&!n&&r&&!a.isOpen},dependencies:[c,n,r,i,a.isOpen]})}const jQ=()=>{wt("useCanvasTransformHotkey");const e=w(un),t=p1(e);Ie({id:"transformSelected",category:"canvas",callback:t.start,options:{enabled:!t.isDisabled,preventDefault:!0},dependencies:[t]})},SQ=()=>{wt("useCanvasUndoRedo");const e=Vx(),t=Ht(),n=jt(),s=w(Yj),r=l.useCallback(()=>{e(Jj())},[e]);Ie({id:"undo",category:"canvas",callback:r,options:{enabled:s&&!t&&!n.isOpen,preventDefault:!0},dependencies:[s,t,r,n.isOpen]});const a=w(qj),i=l.useCallback(()=>{e(Kj())},[e]);Ie({id:"redo",category:"canvas",callback:i,options:{enabled:a&&!t&&!n.isOpen,preventDefault:!0},dependencies:[a,i,t,n.isOpen]})},kQ=pt(Je,e=>{const t=e.selectedEntityIdentifier,n=Xj(e);let s=null;if(!t)s=n[0]??null;else{const r=n.findIndex(a=>a.id===t.id);s=n[(r+1)%n.length]??null}return s?dl(s):null}),IQ=pt(Je,e=>{const t=e.selectedEntityIdentifier,n=Xj(e);let s=null;if(!t)s=n[0]??null;else{const r=n.findIndex(a=>a.id===t.id);s=n[(r-1+n.length)%n.length]??null}return s?dl(s):null}),_Q=()=>{wt("useNextPrevEntityHotkeys");const e=E(),t=w(kQ),n=w(IQ),s=l.useCallback(()=>{t&&e(kl({entityIdentifier:t}))},[e,t]),r=l.useCallback(()=>{n&&e(kl({entityIdentifier:n}))},[e,n]);lo([""],r,{preventDefault:!0,ignoreModifiers:!0},[r]),Ie({category:"canvas",id:"prevEntity",callback:r,options:{preventDefault:!0},dependencies:[r]}),lo([""],s,{preventDefault:!0,ignoreModifiers:!0},[s]),Ie({category:"canvas",id:"nextEntity",callback:s,options:{preventDefault:!0},dependencies:[s]})},FE=l.memo(()=>($E(),BE(),SQ(),CQ(),_Q(),jQ(),wQ(),o.jsxs(j,{w:"full",gap:2,alignItems:"center",children:[o.jsx(jE,{}),o.jsx(ME,{}),o.jsx(dt,{}),o.jsxs(j,{alignItems:"center",h:"full",children:[o.jsx(DE,{}),o.jsx(TE,{}),o.jsx(AE,{})]}),o.jsx(zt,{orientation:"vertical"}),o.jsxs(j,{alignItems:"center",h:"full",children:[o.jsx(PE,{}),o.jsx(NE,{}),o.jsx(EE,{}),o.jsx(LE,{}),o.jsx(hE,{})]})]})));FE.displayName="CanvasToolbar";const MQ=ze.enum(["fill","contain","cover"]),zE=l.memo(({adapter:e})=>{const{t}=S(),[n,s]=l.useState("contain"),r=se(e.transformer.$isProcessing),a=l.useCallback(()=>{if(n==="contain"){e.transformer.fitToBboxContain();return}if(n==="cover"){e.transformer.fitToBboxCover();return}if(n==="fill"){e.transformer.fitToBboxFill();return}Fe(!1)},[e.transformer,n]),i=l.useMemo(()=>[{value:"contain",label:t("controlLayers.transform.fitModeContain")},{value:"cover",label:t("controlLayers.transform.fitModeCover")},{value:"fill",label:t("controlLayers.transform.fitModeFill")}],[t]),c=l.useMemo(()=>i.find(u=>u.value===n)??null,[i,n]),d=l.useCallback(u=>{u&&s(MQ.parse(u.value))},[]);return o.jsxs(j,{gap:4,w:"full",children:[o.jsxs(V,{maxW:64,children:[o.jsx(U,{m:0,children:t("controlLayers.transform.fitMode")}),o.jsx(Ne,{options:i,value:c,onChange:d,isSearchable:!1,isClearable:!1})]}),o.jsx(me,{leftIcon:o.jsx(bu,{}),size:"sm",onClick:a,isLoading:r,loadingText:t("controlLayers.transform.fitToBbox"),variant:"ghost",children:t("controlLayers.transform.fitToBbox")})]})});zE.displayName="TransformFitToBboxButtons";const VE=l.memo(({adapter:e})=>{const{t}=S(),n=E(),s=l.useRef(null);Oa("canvas",s,{focusOnMount:!0});const r=js("canvas"),a=se(e.transformer.$isProcessing),i=w(Uj),c=l.useCallback(()=>{n(Zj())},[n]),d=se(e.transformer.$silentTransform);return Ie({id:"applyTransform",category:"canvas",callback:e.transformer.applyTransform,options:{enabled:!a&&r},dependencies:[e.transformer,a,r]}),Ie({id:"cancelTransform",category:"canvas",callback:e.transformer.stopTransform,options:{enabled:!a&&r},dependencies:[e.transformer,a,r]}),d?null:o.jsxs(j,{ref:s,bg:"base.800",borderRadius:"base",p:4,flexDir:"column",gap:4,minW:420,h:"auto",shadow:"dark-lg",transitionProperty:"height",transitionDuration:"normal",children:[o.jsxs(j,{w:"full",gap:4,children:[o.jsx(Ct,{size:"md",color:"base.300",userSelect:"none",children:t("controlLayers.transform.transform")}),o.jsx(dt,{}),o.jsxs(V,{w:"min-content",children:[o.jsx(U,{m:0,children:t("controlLayers.settings.isolatedPreview")}),o.jsx(ot,{size:"sm",isChecked:i,onChange:c})]})]}),o.jsx(zE,{adapter:e}),o.jsxs(Tn,{isAttached:!1,size:"sm",w:"full",children:[o.jsx(dt,{}),o.jsx(me,{leftIcon:o.jsx(sf,{}),onClick:e.transformer.resetTransform,isLoading:a,loadingText:t("controlLayers.transform.reset"),variant:"ghost",children:t("controlLayers.transform.reset")}),o.jsx(me,{leftIcon:o.jsx(Ei,{}),onClick:e.transformer.applyTransform,isLoading:a,loadingText:t("controlLayers.transform.apply"),variant:"ghost",children:t("controlLayers.transform.apply")}),o.jsx(me,{leftIcon:o.jsx(sn,{}),onClick:e.transformer.stopTransform,isLoading:a,loadingText:t("common.cancel"),variant:"ghost",children:t("controlLayers.transform.cancel")})]})]})});VE.displayName="TransformContent";const AQ=()=>{const e=At(),t=se(e.stateApi.$transformingAdapter);return t?o.jsx(VE,{adapter:t}):null},HE=l.memo(()=>{const{t:e}=S(),t=E(),n=w(eS),s=w(Hx),r=l.useCallback(()=>{t(Cm("slider"))},[t]),a=l.useCallback(()=>{t(Cm("side-by-side"))},[t]),i=l.useCallback(()=>{t(Cm("hover"))},[t]),c=l.useCallback(()=>{t(fO())},[t]);Ie({id:"swapImages",category:"viewer",callback:c,dependencies:[c]});const d=l.useCallback(()=>{t(mO(s==="contain"?"fill":"contain"))},[t,s]),u=l.useCallback(()=>{t(zd(null))},[t]);lo("esc",u,[u]);const h=l.useCallback(()=>{t(gO())},[t]);return Ie({id:"nextComparisonMode",category:"viewer",callback:h,dependencies:[h]}),o.jsxs(j,{w:"full",gap:2,children:[o.jsx(j,{flex:1,justifyContent:"center",children:o.jsxs(j,{gap:2,marginInlineEnd:"auto",children:[o.jsx(Q,{icon:o.jsx(gG,{}),"aria-label":`${e("gallery.swapImages")} (C)`,tooltip:`${e("gallery.swapImages")} (C)`,onClick:c}),n!=="side-by-side"&&o.jsx(Q,{"aria-label":e("gallery.stretchToFit"),tooltip:e("gallery.stretchToFit"),onClick:d,colorScheme:s==="fill"?"invokeBlue":"base",variant:"outline",icon:o.jsx(bu,{})})]})}),o.jsx(j,{flex:1,gap:4,justifyContent:"center",children:o.jsxs(Tn,{variant:"outline",children:[o.jsx(me,{flexShrink:0,onClick:r,colorScheme:n==="slider"?"invokeBlue":"base",children:e("gallery.slider")}),o.jsx(me,{flexShrink:0,onClick:a,colorScheme:n==="side-by-side"?"invokeBlue":"base",children:e("gallery.sideBySide")}),o.jsx(me,{flexShrink:0,onClick:i,colorScheme:n==="hover"?"invokeBlue":"base",children:e("gallery.hover")})]})}),o.jsx(j,{flex:1,justifyContent:"center",children:o.jsxs(j,{gap:2,marginInlineStart:"auto",alignItems:"center",children:[o.jsx(Ae,{label:o.jsx(EQ,{}),children:o.jsx(j,{alignItems:"center",children:o.jsx(it,{boxSize:6,color:"base.500",as:_G,lineHeight:0})})}),o.jsx(me,{variant:"ghost","aria-label":`${e("gallery.exitCompare")} (Esc)`,tooltip:`${e("gallery.exitCompare")} (Esc)`,onClick:u,children:e("gallery.exitCompare")})]})})]})});HE.displayName="CompareToolbar";const EQ=()=>o.jsxs(Si,{children:[o.jsx(Qt,{children:o.jsx(Cs,{i18nKey:"gallery.compareHelp1",components:{Kbd:o.jsx(qc,{})}})}),o.jsx(Qt,{children:o.jsx(Cs,{i18nKey:"gallery.compareHelp2",components:{Kbd:o.jsx(qc,{})}})}),o.jsx(Qt,{children:o.jsx(Cs,{i18nKey:"gallery.compareHelp3",components:{Kbd:o.jsx(qc,{})}})}),o.jsx(Qt,{children:o.jsx(Cs,{i18nKey:"gallery.compareHelp4",components:{Kbd:o.jsx(qc,{})}})})]}),LQ=({imageDTO:e})=>o.jsx(j,{pointerEvents:"none",flexDirection:"column",position:"absolute",top:0,insetInlineStart:0,p:2,alignItems:"flex-start",gap:2,children:o.jsxs(Rn,{variant:"solid",colorScheme:"base",children:[e.width,"  ",e.height]})}),TQ=l.memo(LQ),PQ=Do("gallery"),v1=({postUploadAction:e,isDisabled:t,allowMultiple:n=!1})=>{const s=w(ao),[r]=vx(),a=w(Np),{t:i}=S(),c=l.useCallback(f=>{for(const[m,g]of f.entries())r({file:g,image_category:"user",is_intermediate:!1,postUploadAction:e??{type:"TOAST"},board_id:s==="none"?void 0:s,isFirstUploadOfBatch:m===0})},[s,e,r]),d=l.useCallback(f=>{if(f.length>0){const m=f.map(x=>({errors:x.errors.map(({message:C})=>C),file:x.file.path}));PQ.error({errors:m},"Invalid upload");const g=a===void 0?i("toast.uploadFailedInvalidUploadDesc"):i("toast.uploadFailedInvalidUploadDesc_withCount",{count:a});he({id:"UPLOAD_FAILED",title:i("toast.uploadFailed"),description:g,status:"error"});return}},[a,i]),{getRootProps:u,getInputProps:h,open:p}=Na({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:c,onDropRejected:d,disabled:t,noDrag:!0,multiple:n&&(a===void 0||a>1),maxFiles:a});return{getUploadButtonProps:u,getUploadInputProps:h,openUploader:p}},RQ=e=>{const{data:t,disabled:n,...s}=e,r=l.useRef(Gl()),{attributes:a,listeners:i,setNodeRef:c}=hq({id:r.current,disabled:n,data:t});return o.jsx(xe,{ref:c,position:"absolute",w:"full",h:"full",top:0,insetInlineStart:0,...a,...i,...s})},DQ=l.memo(RQ),OQ=o.jsx(it,{as:gc,boxSize:16}),NQ=o.jsx(Mt,{icon:fi}),WE={touchAction:"none",userSelect:"none",webkitUserSelect:"none"},BQ={...WE,".gallery-image-container::before":{content:'""',display:"inline-block",position:"absolute",top:0,left:0,right:0,bottom:0,pointerEvents:"none",borderRadius:"base"},'&[data-selected="selected"]>.gallery-image-container::before':{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-500), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},'&[data-selected="selectedForCompare"]>.gallery-image-container::before':{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-300), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"},"&:hover>.gallery-image-container::before":{boxShadow:"inset 0px 0px 0px 2px var(--invoke-colors-invokeBlue-300), inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-800)"},'&:hover[data-selected="selected"]>.gallery-image-container::before':{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeBlue-400), inset 0px 0px 0px 4px var(--invoke-colors-invokeBlue-800)"},'&:hover[data-selected="selectedForCompare"]>.gallery-image-container::before':{boxShadow:"inset 0px 0px 0px 3px var(--invoke-colors-invokeGreen-200), inset 0px 0px 0px 4px var(--invoke-colors-invokeGreen-800)"}},$Q=e=>{const{imageDTO:t,onError:n,onClick:s,withMetadataOverlay:r=!1,isDropDisabled:a=!1,isDragDisabled:i=!1,isUploadDisabled:c=!1,minSize:d=24,postUploadAction:u,imageSx:h,fitContainer:p=!1,droppableData:f,draggableData:m,dropLabel:g,isSelected:x=!1,isSelectedForCompare:C=!1,thumbnail:y=!1,noContentFallback:v=NQ,uploadElement:I=OQ,useThumbailFallback:k,withHoverOverlay:M=!1,children:_,dataTestId:A,...D}=e,N=l.useCallback(z=>{t&&z.button===1&&window.open(t.image_url,"_blank")},[t]),P=l.useRef(null);return rZ(t,P),o.jsxs(j,{ref:P,width:"full",height:"full",alignItems:"center",justifyContent:"center",position:"relative",minW:d||void 0,minH:d||void 0,userSelect:"none",cursor:i||!t?"default":"pointer",sx:M?BQ:WE,"data-selected":C?"selectedForCompare":x?"selected":void 0,...D,children:[t&&o.jsxs(j,{className:"gallery-image-container",w:"full",h:"full",position:p?"absolute":"relative",alignItems:"center",justifyContent:"center",children:[o.jsx(nn,{src:y?t.thumbnail_url:t.image_url,fallbackStrategy:"beforeLoadOrError",fallbackSrc:k?t.thumbnail_url:void 0,fallback:k?void 0:o.jsx(s_,{image:t}),onError:n,draggable:!1,w:t.width,objectFit:"contain",maxW:"full",maxH:"full",borderRadius:"base",sx:h,"data-testid":A}),r&&o.jsx(TQ,{imageDTO:t})]}),!t&&!c&&o.jsx(GE,{isUploadDisabled:c,postUploadAction:u,uploadElement:I,minSize:d}),!t&&c&&v,t&&!i&&o.jsx(DQ,{data:m,disabled:i||!t,onClick:s,onAuxClick:N}),_,!a&&o.jsx(tr,{data:f,disabled:a,dropLabel:g})]})},Di=l.memo($Q),GE=l.memo(({isUploadDisabled:e,postUploadAction:t,uploadElement:n,minSize:s})=>{const{getUploadButtonProps:r,getUploadInputProps:a}=v1({postUploadAction:t,isDisabled:e}),i=l.useMemo(()=>{const c={minH:s,w:"full",h:"full",alignItems:"center",justifyContent:"center",borderRadius:"base",transitionProperty:"common",transitionDuration:"0.1s",color:"base.500"};return e||Object.assign(c,{cursor:"pointer",bg:"base.700",_hover:{bg:"base.650",color:"base.300"}}),c},[e,s]);return o.jsxs(j,{sx:i,...r(),children:[o.jsx("input",{...a()}),n]})});GE.displayName="UploadButton";const UE=e=>{const t=w(xO),[n]=Bk(e!=null&&e.has_workflow?e.image_name:null,t);return bO(n??Kn)};var ZE={},kc={},Rf={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.EolStyle=void 0,function(t){t[t.Crlf=0]="Crlf",t[t.Lf=1]="Lf"}(e.EolStyle||(e.EolStyle={}))})(Rf);var Df={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.CommentPolicy=void 0,function(t){t[t.TreatAsError=0]="TreatAsError",t[t.Remove=1]="Remove",t[t.Preserve=2]="Preserve"}(e.CommentPolicy||(e.CommentPolicy={}))})(Df);var Of={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.NumberListAlignment=void 0,function(t){t[t.Left=0]="Left",t[t.Right=1]="Right",t[t.Decimal=2]="Decimal",t[t.Normalize=3]="Normalize"}(e.NumberListAlignment||(e.NumberListAlignment={}))})(Of);Object.defineProperty(kc,"__esModule",{value:!0});kc.FracturedJsonOptions=void 0;const FQ=Rf,zQ=Df,VQ=Of;class HQ{constructor(){this.JsonEolStyle=FQ.EolStyle.Lf,this.MaxInlineLength=2e9,this.MaxTotalLineLength=120,this.MaxInlineComplexity=2,this.MaxCompactArrayComplexity=1,this.MaxTableRowComplexity=2,this.MinCompactArrayRowItems=3,this.AlwaysExpandDepth=-1,this.NestedBracketPadding=!0,this.SimpleBracketPadding=!1,this.ColonPadding=!0,this.CommaPadding=!0,this.CommentPadding=!0,this.OmitTrailingWhitespace=!1,this.NumberListAlignment=VQ.NumberListAlignment.Normalize,this.IndentSpaces=4,this.UseTabToIndent=!1,this.PrefixString="",this.CommentPolicy=zQ.CommentPolicy.TreatAsError,this.PreserveBlankLines=!1,this.AllowTrailingCommas=!1}}kc.FracturedJsonOptions=HQ;var Xr={};Object.defineProperty(Xr,"__esModule",{value:!0});Xr.FracturedJsonError=void 0;class WQ extends Error{constructor(t,n){const s=n?`${t} at idx=${n.Index}, row=${n.Row}, col=${n.Column}`:t;super(s),this.InputPosition=n}}Xr.FracturedJsonError=WQ;var Nf={},Bf={};Object.defineProperty(Bf,"__esModule",{value:!0});Bf.StringJoinBuffer=void 0;class GQ{constructor(t){this._lineBuff=[],this._docBuff=[],this._trimTrailingWhitespace=t}Add(...t){return this._lineBuff.push(...t),this}EndLine(t){return this.AddLineToWriter(t),this}Flush(){return this.AddLineToWriter(""),this}AsString(){return this._docBuff.join("")}AddLineToWriter(t){if(this._lineBuff.length===0&&t.length===0)return;let n=this._lineBuff.join("");this._trimTrailingWhitespace&&(n=n.trimEnd()),this._docBuff.push(n+t),this._lineBuff=[]}}Bf.StringJoinBuffer=GQ;var $f={},Ff={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.BracketPaddingType=void 0,function(t){t[t.Empty=0]="Empty",t[t.Simple=1]="Simple",t[t.Complex=2]="Complex"}(e.BracketPaddingType||(e.BracketPaddingType={}))})(Ff);var Oi={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.JsonItemType=void 0,function(t){t[t.Null=0]="Null",t[t.False=1]="False",t[t.True=2]="True",t[t.String=3]="String",t[t.Number=4]="Number",t[t.Object=5]="Object",t[t.Array=6]="Array",t[t.BlankLine=7]="BlankLine",t[t.LineComment=8]="LineComment",t[t.BlockComment=9]="BlockComment"}(e.JsonItemType||(e.JsonItemType={}))})(Oi);Object.defineProperty($f,"__esModule",{value:!0});$f.PaddedFormattingTokens=void 0;const Ys=Ff,UQ=Rf,lh=Oi;class ZQ{constructor(t,n){this._arrStart=[],this._arrStart[Ys.BracketPaddingType.Empty]="[",this._arrStart[Ys.BracketPaddingType.Simple]=t.SimpleBracketPadding?"[ ":"[",this._arrStart[Ys.BracketPaddingType.Complex]=t.NestedBracketPadding?"[ ":"[",this._arrEnd=[],this._arrEnd[Ys.BracketPaddingType.Empty]="]",this._arrEnd[Ys.BracketPaddingType.Simple]=t.SimpleBracketPadding?" ]":"]",this._arrEnd[Ys.BracketPaddingType.Complex]=t.NestedBracketPadding?" ]":"]",this._objStart=[],this._objStart[Ys.BracketPaddingType.Empty]="{",this._objStart[Ys.BracketPaddingType.Simple]=t.SimpleBracketPadding?"{ ":"{",this._objStart[Ys.BracketPaddingType.Complex]=t.NestedBracketPadding?"{ ":"{",this._objEnd=[],this._objEnd[Ys.BracketPaddingType.Empty]="}",this._objEnd[Ys.BracketPaddingType.Simple]=t.SimpleBracketPadding?" }":"}",this._objEnd[Ys.BracketPaddingType.Complex]=t.NestedBracketPadding?" }":"}",this._comma=t.CommaPadding?", ":",",this._colon=t.ColonPadding?": ":":",this._comment=t.CommentPadding?" ":"",this._eol=t.JsonEolStyle===UQ.EolStyle.Crlf?`\r
`:`
`,this._arrStartLen=this._arrStart.map(n),this._arrEndLen=this._arrEnd.map(n),this._objStartLen=this._objStart.map(n),this._objEndLen=this._objEnd.map(n),this._indentStrings=["",t.UseTabToIndent?"	":" ".repeat(t.IndentSpaces)],this._spaceStrings=[""," "],this._commaLen=n(this._comma),this._colonLen=n(this._colon),this._commentLen=n(this._comment),this._literalNullLen=n("null"),this._literalTrueLen=n("true"),this._literalFalseLen=n("false"),this._prefixStringLen=n(t.PrefixString),this._dummyComma=" ".repeat(this._commaLen)}get Comma(){return this._comma}get Colon(){return this._colon}get Comment(){return this._comment}get EOL(){return this._eol}get CommaLen(){return this._commaLen}get ColonLen(){return this._colonLen}get CommentLen(){return this._commentLen}get LiteralNullLen(){return this._literalNullLen}get LiteralTrueLen(){return this._literalTrueLen}get LiteralFalseLen(){return this._literalFalseLen}get PrefixStringLen(){return this._prefixStringLen}get DummyComma(){return this._dummyComma}ArrStart(t){return this._arrStart[t]}ArrEnd(t){return this._arrEnd[t]}ObjStart(t){return this._objStart[t]}ObjEnd(t){return this._objEnd[t]}Start(t,n){return t===lh.JsonItemType.Array?this.ArrStart(n):this.ObjStart(n)}End(t,n){return t===lh.JsonItemType.Array?this.ArrEnd(n):this.ObjEnd(n)}ArrStartLen(t){return this._arrStartLen[t]}ArrEndLen(t){return this._arrEndLen[t]}ObjStartLen(t){return this._objStartLen[t]}ObjEndLen(t){return this._objEndLen[t]}StartLen(t,n){return t===lh.JsonItemType.Array?this.ArrStartLen(n):this.ObjStartLen(n)}EndLen(t,n){return t===lh.JsonItemType.Array?this.ArrEndLen(n):this.ObjEndLen(n)}Indent(t){if(t>=this._indentStrings.length)for(let n=this._indentStrings.length;n<=t;++n)this._indentStrings.push(this._indentStrings[n-1]+this._indentStrings[1]);return this._indentStrings[t]}Spaces(t){if(t>=this._spaceStrings.length)for(let n=this._spaceStrings.length;n<=t;++n)this._spaceStrings.push(" ".repeat(n));return this._spaceStrings[t]}}$f.PaddedFormattingTokens=ZQ;var zf={};Object.defineProperty(zf,"__esModule",{value:!0});zf.TableTemplate=void 0;const hn=Oi,jC=Ff,ta=Of;class Pr{constructor(t,n){this.LocationInParent=void 0,this.Type=hn.JsonItemType.Null,this.IsRowDataCompatible=!0,this.RowCount=0,this.NameLength=0,this.SimpleValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.PadType=jC.BracketPaddingType.Simple,this.AllowNumberNormalization=!1,this.IsNumberList=!1,this.CompositeValueLength=0,this.TotalLength=0,this.Children=[],this._maxDigBeforeDecRaw=0,this._maxDigAfterDecRaw=0,this._maxDigBeforeDecNorm=0,this._maxDigAfterDecNorm=0,this._pads=t,this._numberListAlignment=n,this.AllowNumberNormalization=n===ta.NumberListAlignment.Normalize,this.IsNumberList=!0}MeasureTableRoot(t){for(const n of t.Children)this.MeasureRowSegment(n);this.PruneAndRecompute(Number.MAX_VALUE),this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.RowCount>=2)}TryToFit(t){for(let n=this.GetTemplateComplexity();n>=0;--n){if(this.TotalLength<=t)return!0;this.PruneAndRecompute(n-1)}return!1}FormatNumber(t,n){const s=this._numberListAlignment===ta.NumberListAlignment.Normalize&&!this.AllowNumberNormalization?ta.NumberListAlignment.Left:this._numberListAlignment;switch(s){case ta.NumberListAlignment.Left:t.Add(n.Value,this._pads.Spaces(this.SimpleValueLength-n.ValueLength));return;case ta.NumberListAlignment.Right:t.Add(this._pads.Spaces(this.SimpleValueLength-n.ValueLength),n.Value);return}let r,a,i,c;if(s===ta.NumberListAlignment.Normalize){if(n.Type===hn.JsonItemType.Null){t.Add(this._pads.Spaces(this._maxDigBeforeDecNorm-n.ValueLength),n.Value,this._pads.Spaces(this.CompositeValueLength-this._maxDigBeforeDecNorm));return}r=this._maxDigBeforeDecNorm,a=this._maxDigAfterDecNorm,i=Number(n.Value).toFixed(a),c=i.length}else r=this._maxDigBeforeDecRaw,a=this._maxDigAfterDecRaw,i=n.Value,c=n.ValueLength;let d,u;const h=i.search(Pr._dotOrE);h>0?(d=r-h,u=this.CompositeValueLength-d-c):(d=r-c,u=this.CompositeValueLength-r),t.Add(this._pads.Spaces(d),i,this._pads.Spaces(u))}MeasureRowSegment(t){if(!(t.Type===hn.JsonItemType.BlankLine||t.Type===hn.JsonItemType.BlockComment||t.Type===hn.JsonItemType.LineComment)&&(t.Type===hn.JsonItemType.False||t.Type===hn.JsonItemType.True?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===hn.JsonItemType.True||this.Type===hn.JsonItemType.Null),this.Type=hn.JsonItemType.True,this.IsNumberList=!1):t.Type===hn.JsonItemType.Number?(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===hn.JsonItemType.Number||this.Type===hn.JsonItemType.Null),this.Type=hn.JsonItemType.Number):t.Type===hn.JsonItemType.Null?(this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,this._pads.LiteralNullLen),this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,this._pads.LiteralNullLen)):(this.IsRowDataCompatible&&(this.IsRowDataCompatible=this.Type===t.Type||this.Type===hn.JsonItemType.Null),this.Type===hn.JsonItemType.Null&&(this.Type=t.Type),this.IsNumberList=!1),this.IsRowDataCompatible&&(this.IsRowDataCompatible=!t.RequiresMultipleLines),this.RowCount+=1,this.NameLength=Math.max(this.NameLength,t.NameLength),this.SimpleValueLength=Math.max(this.SimpleValueLength,t.ValueLength),this.MiddleCommentLength=Math.max(this.MiddleCommentLength,t.MiddleCommentLength),this.PrefixCommentLength=Math.max(this.PrefixCommentLength,t.PrefixCommentLength),this.PostfixCommentLength=Math.max(this.PostfixCommentLength,t.PostfixCommentLength),t.Complexity>=2&&(this.PadType=jC.BracketPaddingType.Complex),!!this.IsRowDataCompatible)){if(t.Type===hn.JsonItemType.Array)for(let n=0;n<t.Children.length;++n)this.Children.length<=n&&this.Children.push(new Pr(this._pads,this._numberListAlignment)),this.Children[n].MeasureRowSegment(t.Children[n]);else if(t.Type===hn.JsonItemType.Object){if(this.ContainsDuplicateKeys(t.Children)){this.IsRowDataCompatible=!1;return}for(const n of t.Children){let s=this.Children.find(r=>r.LocationInParent===n.Name);s||(s=new Pr(this._pads,this._numberListAlignment),s.LocationInParent=n.Name,this.Children.push(s)),s.MeasureRowSegment(n)}}else if(t.Type===hn.JsonItemType.Number&&this.IsNumberList){const s=Number(t.Value),r=s.toString();this.AllowNumberNormalization&&(this.AllowNumberNormalization=!isNaN(s)&&s!==1/0&&s!==-1/0&&r.length<=15&&r.indexOf("e")<0&&(s!==0||Pr._trulyZeroValString.test(t.Value)));const a=r.indexOf(".");this._maxDigBeforeDecNorm=Math.max(this._maxDigBeforeDecNorm,a>=0?a:r.length),this._maxDigAfterDecNorm=Math.max(this._maxDigAfterDecNorm,a>=0?r.length-a-1:0);const i=t.Value.search(Pr._dotOrE);this._maxDigBeforeDecRaw=Math.max(this._maxDigBeforeDecRaw,i>=0?i:t.ValueLength),this._maxDigAfterDecRaw=Math.max(this._maxDigAfterDecRaw,i>=0?t.ValueLength-i-1:0)}this.AllowNumberNormalization&&(this.AllowNumberNormalization=this.IsNumberList)}}PruneAndRecompute(t){(t<=0||!this.IsRowDataCompatible)&&(this.Children=[]);for(const n of this.Children)n.PruneAndRecompute(t-1);if(this.IsNumberList)this.CompositeValueLength=this.GetNumberFieldWidth();else if(this.Children.length>0){const n=this.Children.map(s=>s.TotalLength).reduce((s,r)=>s+r);this.CompositeValueLength=n+Math.max(0,this._pads.CommaLen*(this.Children.length-1))+this._pads.ArrStartLen(this.PadType)+this._pads.ArrEndLen(this.PadType)}else this.CompositeValueLength=this.SimpleValueLength;this.TotalLength=(this.PrefixCommentLength>0?this.PrefixCommentLength+this._pads.CommentLen:0)+(this.NameLength>0?this.NameLength+this._pads.ColonLen:0)+(this.MiddleCommentLength>0?this.MiddleCommentLength+this._pads.CommentLen:0)+this.CompositeValueLength+(this.PostfixCommentLength>0?this.PostfixCommentLength+this._pads.CommentLen:0)}GetTemplateComplexity(){if(this.Children.length===0)return 0;const t=this.Children.map(n=>n.GetTemplateComplexity());return 1+Math.max(...t)}ContainsDuplicateKeys(t){const n=t.map(s=>s.Name);return n.some((s,r)=>n.indexOf(s)!==r)}GetNumberFieldWidth(){if(this._numberListAlignment===ta.NumberListAlignment.Normalize&&this.AllowNumberNormalization){const t=this._maxDigAfterDecNorm>0?1:0;return this._maxDigBeforeDecNorm+t+this._maxDigAfterDecNorm}else if(this._numberListAlignment===ta.NumberListAlignment.Decimal){const t=this._maxDigAfterDecRaw>0?1:0;return this._maxDigBeforeDecRaw+t+this._maxDigAfterDecRaw}return this.SimpleValueLength}}zf.TableTemplate=Pr;Pr._trulyZeroValString=new RegExp("^-?[0.]+([eE].*)?$");Pr._dotOrE=new RegExp("[.eE]");var Vf={},Hf={};Object.defineProperty(Hf,"__esModule",{value:!0});Hf.TokenEnumerator=void 0;const qQ=Xr;class KQ{constructor(t){this._generator=t}get Current(){if(!this._current)throw new qQ.FracturedJsonError("Illegal enumerator usage");return this._current}MoveNext(){const t=this._generator.next();return this._current=t.value,!t.done}}Hf.TokenEnumerator=KQ;var Eu={};Object.defineProperty(Eu,"__esModule",{value:!0});Eu.JsonItem=void 0;const QQ=Oi;class YQ{constructor(){this.Type=QQ.JsonItemType.Null,this.InputPosition={Index:0,Row:0,Column:0},this.Complexity=0,this.Name="",this.Value="",this.PrefixComment="",this.MiddleComment="",this.PostfixComment="",this.IsPostCommentLineStyle=!1,this.NameLength=0,this.ValueLength=0,this.PrefixCommentLength=0,this.MiddleCommentLength=0,this.PostfixCommentLength=0,this.MinimumTotalLength=0,this.RequiresMultipleLines=!1,this.Children=[]}}Eu.JsonItem=YQ;var C1={};(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.TokenType=void 0,function(t){t[t.Invalid=0]="Invalid",t[t.BeginArray=1]="BeginArray",t[t.EndArray=2]="EndArray",t[t.BeginObject=3]="BeginObject",t[t.EndObject=4]="EndObject",t[t.String=5]="String",t[t.Number=6]="Number",t[t.Null=7]="Null",t[t.True=8]="True",t[t.False=9]="False",t[t.BlockComment=10]="BlockComment",t[t.LineComment=11]="LineComment",t[t.BlankLine=12]="BlankLine",t[t.Comma=13]="Comma",t[t.Colon=14]="Colon"}(e.TokenType||(e.TokenType={}))})(C1);var Wf={},Gf={};Object.defineProperty(Gf,"__esModule",{value:!0});Gf.ScannerState=void 0;const JQ=Xr;class XQ{constructor(t){this.CurrentPosition={Index:0,Row:0,Column:0},this.TokenPosition={Index:0,Row:0,Column:0},this.NonWhitespaceSinceLastNewline=!1,this._originalText=t}Advance(t){if(this.CurrentPosition.Index>=SC)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Column+=1,this.NonWhitespaceSinceLastNewline||(this.NonWhitespaceSinceLastNewline=!t)}NewLine(){if(this.CurrentPosition.Index>=SC)throw new Error("Maximum document length exceeded");this.CurrentPosition.Index+=1,this.CurrentPosition.Row+=1,this.CurrentPosition.Column=0,this.NonWhitespaceSinceLastNewline=!1}SetTokenStart(){this.TokenPosition=Object.assign({},this.CurrentPosition)}MakeTokenFromBuffer(t,n=!1){const s=this._originalText.substring(this.TokenPosition.Index,this.CurrentPosition.Index);return{Type:t,Text:n?s.trimEnd():s,InputPosition:Object.assign({},this.TokenPosition)}}MakeToken(t,n){return{Type:t,Text:n,InputPosition:Object.assign({},this.TokenPosition)}}Current(){return this.AtEnd()?NaN:this._originalText.charCodeAt(this.CurrentPosition.Index)}AtEnd(){return this.CurrentPosition.Index>=this._originalText.length}Throw(t){throw new JQ.FracturedJsonError(t,this.CurrentPosition)}}Gf.ScannerState=XQ;const SC=2e9;Object.defineProperty(Wf,"__esModule",{value:!0});Wf.TokenGenerator=void 0;const eY=Gf,Wn=C1;function*tY(e){const t=new eY.ScannerState(e);for(;;){if(t.AtEnd())return;const n=t.Current();switch(n){case oY:case aY:case rY:t.Advance(!0);break;case qE:t.NonWhitespaceSinceLastNewline||(yield t.MakeToken(Wn.TokenType.BlankLine,`
`)),t.NewLine(),t.SetTokenStart();break;case iY:yield Zi(t,"{",Wn.TokenType.BeginObject);break;case lY:yield Zi(t,"}",Wn.TokenType.EndObject);break;case cY:yield Zi(t,"[",Wn.TokenType.BeginArray);break;case dY:yield Zi(t,"]",Wn.TokenType.EndArray);break;case uY:yield Zi(t,":",Wn.TokenType.Colon);break;case hY:yield Zi(t,",",Wn.TokenType.Comma);break;case JE:yield Zm(t,"true",Wn.TokenType.True);break;case j1:yield Zm(t,"false",Wn.TokenType.False);break;case YE:yield Zm(t,"null",Wn.TokenType.Null);break;case wp:yield nY(t);break;case w1:yield sY(t);break;case P0:yield kC(t);break;default:jr(n)||t.Throw("Unexpected character"),yield kC(t);break}}}Wf.TokenGenerator=tY;function Zi(e,t,n){e.SetTokenStart();const s=e.MakeToken(n,t);return e.Advance(!1),s}function Zm(e,t,n){e.SetTokenStart();for(let r=1;r<t.length;++r)e.AtEnd()&&e.Throw("Unexpected end of input while processing keyword"),e.Advance(!1),e.Current()!==t.charCodeAt(r)&&e.Throw("Unexpected keyword");const s=e.MakeToken(n,t);return e.Advance(!1),s}function nY(e){e.SetTokenStart(),e.AtEnd()&&e.Throw("Unexpected end of input while processing comment"),e.Advance(!1);let t=!1;e.Current()===IC?t=!0:e.Current()!==wp&&e.Throw("Bad character for start of comment"),e.Advance(!1);let n=!1;for(;;){if(e.AtEnd())if(t)e.Throw("Unexpected end of input while processing comment");else return e.MakeTokenFromBuffer(Wn.TokenType.LineComment,!0);const s=e.Current();if(s===qE){if(e.NewLine(),!t)return e.MakeTokenFromBuffer(Wn.TokenType.LineComment,!0);continue}if(e.Advance(!1),s===wp&&n)return e.MakeTokenFromBuffer(Wn.TokenType.BlockComment);n=s===IC}}function sY(e){e.SetTokenStart(),e.Advance(!1);let t=!1,n=0;for(;;){e.AtEnd()&&e.Throw("Unexpected end of input while processing string");const s=e.Current();if(n>0){yY(s)||e.Throw("Bad unicode escape in string"),n-=1,e.Advance(!1);continue}if(t){vY(s)||e.Throw("Bad escaped character in string"),s===XE&&(n=4),t=!1,e.Advance(!1);continue}if(CY(s)&&e.Throw("Control characters are not allowed in strings"),e.Advance(!1),s===w1)return e.MakeTokenFromBuffer(Wn.TokenType.String);s===KE&&(t=!0)}}function kC(e){e.SetTokenStart();let t=kt.Beginning;for(;;){const n=e.Current();let s=ms.ValidAndConsumed;switch(t){case kt.Beginning:n===P0?t=kt.PastLeadingSign:n===jp?t=kt.PastWhole:jr(n)?t=kt.PastFirstDigitOfWhole:s=ms.InvalidatesToken;break;case kt.PastLeadingSign:jr(n)?n===jp?t=kt.PastWhole:t=kt.PastFirstDigitOfWhole:s=ms.InvalidatesToken;break;case kt.PastFirstDigitOfWhole:n===_C?t=kt.PastDecimalPoint:n===qm||n===Km?t=kt.PastE:jr(n)||(s=ms.StartOfNewToken);break;case kt.PastWhole:n===_C?t=kt.PastDecimalPoint:n===qm||n===Km?t=kt.PastE:s=ms.StartOfNewToken;break;case kt.PastDecimalPoint:jr(n)?t=kt.PastFirstDigitOfFractional:s=ms.InvalidatesToken;break;case kt.PastFirstDigitOfFractional:n===qm||n===Km?t=kt.PastE:jr(n)||(s=ms.StartOfNewToken);break;case kt.PastE:n===pY||n===P0?t=kt.PastExpSign:jr(n)?t=kt.PastFirstDigitOfExponent:s=ms.InvalidatesToken;break;case kt.PastExpSign:jr(n)?t=kt.PastFirstDigitOfExponent:s=ms.InvalidatesToken;break;case kt.PastFirstDigitOfExponent:jr(n)||(s=ms.StartOfNewToken);break}if(s===ms.InvalidatesToken&&e.Throw("Bad character while processing number"),s===ms.StartOfNewToken)return e.MakeTokenFromBuffer(Wn.TokenType.Number);if(!e.AtEnd()){e.Advance(!1);continue}switch(t){case kt.PastFirstDigitOfWhole:case kt.PastWhole:case kt.PastFirstDigitOfFractional:case kt.PastFirstDigitOfExponent:return e.MakeTokenFromBuffer(Wn.TokenType.Number);default:e.Throw("Unexpected end of input while processing number");break}}}const oY=32,qE=10,rY=13,aY=9,wp=47,IC=42,KE=92,w1=34,iY=123,lY=125,cY=91,dY=93,uY=58,hY=44,pY=43,P0=45,_C=46,jp=48,QE=57,fY=97,mY=65,gY=98,qm=101,Km=69,j1=102,xY=70,YE=110,bY=114,JE=116,XE=117;function jr(e){return e>=jp&&e<=QE}function yY(e){return e>=jp&&e<=QE||e>=fY&&e<=j1||e>=mY&&e<=xY}function vY(e){switch(e){case w1:case KE:case wp:case gY:case j1:case YE:case bY:case JE:case XE:return!0;default:return!1}}function CY(e){return e>=0&&e<=31||e===127||e>=128&&e<=159}var kt;(function(e){e[e.Beginning=0]="Beginning",e[e.PastLeadingSign=1]="PastLeadingSign",e[e.PastFirstDigitOfWhole=2]="PastFirstDigitOfWhole",e[e.PastWhole=3]="PastWhole",e[e.PastDecimalPoint=4]="PastDecimalPoint",e[e.PastFirstDigitOfFractional=5]="PastFirstDigitOfFractional",e[e.PastE=6]="PastE",e[e.PastExpSign=7]="PastExpSign",e[e.PastFirstDigitOfExponent=8]="PastFirstDigitOfExponent"})(kt||(kt={}));var ms;(function(e){e[e.InvalidatesToken=0]="InvalidatesToken",e[e.ValidAndConsumed=1]="ValidAndConsumed",e[e.StartOfNewToken=2]="StartOfNewToken"})(ms||(ms={}));Object.defineProperty(Vf,"__esModule",{value:!0});Vf.Parser=void 0;const wY=kc,jY=Hf,Qm=Eu,Ln=Oi,tt=C1,pn=Xr,na=Df,SY=Wf;class Ya{constructor(){this.Options=new wY.FracturedJsonOptions}ParseTopLevel(t,n){const s=new jY.TokenEnumerator((0,SY.TokenGenerator)(t));return this.ParseTopLevelFromEnum(s,n)}ParseTopLevelFromEnum(t,n){const s=[];let r=!1;for(;;){if(!t.MoveNext())return s;const a=this.ParseItem(t),i=a.Type===Ln.JsonItemType.BlockComment||a.Type===Ln.JsonItemType.LineComment;if(a.Type===Ln.JsonItemType.BlankLine)this.Options.PreserveBlankLines&&s.push(a);else if(i){if(this.Options.CommentPolicy===na.CommentPolicy.TreatAsError)throw new pn.FracturedJsonError("Comments not allowed with current options",a.InputPosition);this.Options.CommentPolicy===na.CommentPolicy.Preserve&&s.push(a)}else{if(n&&r)throw new pn.FracturedJsonError("Unexpected start of second top level element",a.InputPosition);s.push(a),r=!0}}}ParseItem(t){switch(t.Current.Type){case tt.TokenType.BeginArray:return this.ParseArray(t);case tt.TokenType.BeginObject:return this.ParseObject(t);default:return this.ParseSimple(t.Current)}}ParseSimple(t){const n=new Qm.JsonItem;return n.Type=Ya.ItemTypeFromTokenType(t),n.Value=t.Text,n.InputPosition=t.InputPosition,n.Complexity=0,n}ParseArray(t){if(t.Current.Type!==tt.TokenType.BeginArray)throw new pn.FracturedJsonError("Parser logic error",t.Current.InputPosition);const n=t.Current.InputPosition;let s,r=-1,a;const i=[];let c=Ir.EmptyCollection,d=!1,u=0;for(;!d;){const p=Ya.GetNextTokenOrThrow(t,n);switch(a&&((a==null?void 0:a.InputPosition.Row)!==p.InputPosition.Row||p.Type===tt.TokenType.EndArray)&&(s?(s.PostfixComment=a.Value,s.IsPostCommentLineStyle=a.Type===Ln.JsonItemType.LineComment):i.push(a),a=void 0),s&&r!==p.InputPosition.Row&&(s=void 0),p.Type){case tt.TokenType.EndArray:if(c===Ir.CommaSeen&&!this.Options.AllowTrailingCommas)throw new pn.FracturedJsonError("Array may not end with a comma with current options",p.InputPosition);d=!0;break;case tt.TokenType.Comma:if(c!==Ir.ElementSeen)throw new pn.FracturedJsonError("Unexpected comma in array",p.InputPosition);c=Ir.CommaSeen;break;case tt.TokenType.BlankLine:if(!this.Options.PreserveBlankLines)break;i.push(this.ParseSimple(p));break;case tt.TokenType.BlockComment:if(this.Options.CommentPolicy===na.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===na.CommentPolicy.TreatAsError)throw new pn.FracturedJsonError("Comments not allowed with current options",p.InputPosition);a&&(i.push(a),a=void 0);const m=this.ParseSimple(p);if(Ya.IsMultilineComment(m)){i.push(m);break}if(s&&c===Ir.ElementSeen){s.PostfixComment=m.Value,s.IsPostCommentLineStyle=!1,s=void 0;break}a=m;break;case tt.TokenType.LineComment:if(this.Options.CommentPolicy===na.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===na.CommentPolicy.TreatAsError)throw new pn.FracturedJsonError("Comments not allowed with current options",p.InputPosition);if(a){i.push(a),i.push(this.ParseSimple(p)),a=void 0;break}if(s){s.PostfixComment=p.Text,s.IsPostCommentLineStyle=!0,s=void 0;break}i.push(this.ParseSimple(p));break;case tt.TokenType.False:case tt.TokenType.True:case tt.TokenType.Null:case tt.TokenType.String:case tt.TokenType.Number:case tt.TokenType.BeginArray:case tt.TokenType.BeginObject:if(c===Ir.ElementSeen)throw new pn.FracturedJsonError("Comma missing while processing array",p.InputPosition);const g=this.ParseItem(t);c=Ir.ElementSeen,u=Math.max(u,g.Complexity+1),a&&(g.PrefixComment=a.Value,a=void 0),i.push(g),s=g,r=t.Current.InputPosition.Row;break;default:throw new pn.FracturedJsonError("Unexpected token in array",p.InputPosition)}}const h=new Qm.JsonItem;return h.Type=Ln.JsonItemType.Array,h.InputPosition=n,h.Complexity=u,h.Children=i,h}ParseObject(t){if(t.Current.Type!==tt.TokenType.BeginObject)throw new pn.FracturedJsonError("Parser logic error",t.Current.InputPosition);const n=t.Current.InputPosition,s=[];let r,a,i=-1,c=[],d=[],u,h=!1,p=qt.BeforePropName,f=0,m=!1;for(;!m;){const x=Ya.GetNextTokenOrThrow(t,n),C=i!==x.InputPosition.Row,y=x.Type===tt.TokenType.EndObject,v=x.Type===tt.TokenType.String&&p===qt.AfterComma,I=u&&(x.Type===tt.TokenType.BlockComment||x.Type===tt.TokenType.LineComment);if(r&&a&&(C||y||v||I)){let M;v&&h&&!C&&(M=u,u=void 0),Ya.AttachObjectValuePieces(s,r,a,i,c,d,u),f=Math.max(f,a.Complexity+1),r=void 0,a=void 0,c=[],d=[],u=void 0,M&&c.push(M)}switch(x.Type){case tt.TokenType.BlankLine:if(!this.Options.PreserveBlankLines||p===qt.AfterPropName||p===qt.AfterColon)break;s.push(...c),c=[],s.push(this.ParseSimple(x));break;case tt.TokenType.BlockComment:case tt.TokenType.LineComment:if(this.Options.CommentPolicy===na.CommentPolicy.Remove)break;if(this.Options.CommentPolicy===na.CommentPolicy.TreatAsError)throw new pn.FracturedJsonError("Comments not allowed with current options",x.InputPosition);p===qt.BeforePropName||!r?c.push(this.ParseSimple(x)):p===qt.AfterPropName||p===qt.AfterColon?d.push(x):(u=this.ParseSimple(x),h=p===qt.AfterComma);break;case tt.TokenType.EndObject:if(p===qt.AfterPropName||p===qt.AfterColon)throw new pn.FracturedJsonError("Unexpected end of object",x.InputPosition);m=!0;break;case tt.TokenType.String:if(p===qt.BeforePropName||p===qt.AfterComma)r=x,p=qt.AfterPropName;else if(p===qt.AfterColon)a=this.ParseItem(t),i=t.Current.InputPosition.Row,p=qt.AfterPropValue;else throw new pn.FracturedJsonError("Unexpected string found while processing object",x.InputPosition);break;case tt.TokenType.False:case tt.TokenType.True:case tt.TokenType.Null:case tt.TokenType.Number:case tt.TokenType.BeginArray:case tt.TokenType.BeginObject:if(p!==qt.AfterColon)throw new pn.FracturedJsonError("Unexpected element while processing object",x.InputPosition);a=this.ParseItem(t),i=t.Current.InputPosition.Row,p=qt.AfterPropValue;break;case tt.TokenType.Colon:if(p!==qt.AfterPropName)throw new pn.FracturedJsonError("Unexpected colon while processing object",x.InputPosition);p=qt.AfterColon;break;case tt.TokenType.Comma:if(p!==qt.AfterPropValue)throw new pn.FracturedJsonError("Unexpected comma while processing object",x.InputPosition);p=qt.AfterComma;break;default:throw new pn.FracturedJsonError("Unexpected token while processing object",x.InputPosition)}}if(!this.Options.AllowTrailingCommas&&p===qt.AfterComma)throw new pn.FracturedJsonError("Object may not end with comma with current options",t.Current.InputPosition);const g=new Qm.JsonItem;return g.Type=Ln.JsonItemType.Object,g.InputPosition=n,g.Complexity=f,g.Children=s,g}static ItemTypeFromTokenType(t){switch(t.Type){case tt.TokenType.False:return Ln.JsonItemType.False;case tt.TokenType.True:return Ln.JsonItemType.True;case tt.TokenType.Null:return Ln.JsonItemType.Null;case tt.TokenType.Number:return Ln.JsonItemType.Number;case tt.TokenType.String:return Ln.JsonItemType.String;case tt.TokenType.BlankLine:return Ln.JsonItemType.BlankLine;case tt.TokenType.BlockComment:return Ln.JsonItemType.BlockComment;case tt.TokenType.LineComment:return Ln.JsonItemType.LineComment;default:throw new pn.FracturedJsonError("Unexpected Token",t.InputPosition)}}static GetNextTokenOrThrow(t,n){if(!t.MoveNext())throw new pn.FracturedJsonError("Unexpected end of input while processing array or object starting",n);return t.Current}static IsMultilineComment(t){return t.Type===Ln.JsonItemType.BlockComment&&t.Value.includes(`
`)}static AttachObjectValuePieces(t,n,s,r,a,i,c){if(s.Name=n.Text,i.length>0){let d="";for(let u=0;u<i.length;++u)d+=i[u].Text,(u<i.length-1||i[u].Type===tt.TokenType.LineComment)&&(d+=`
`);s.MiddleComment=d}if(a.length>0){const d=a.pop();d.Type===Ln.JsonItemType.BlockComment&&d.InputPosition.Row===s.InputPosition.Row?(s.PrefixComment=d.Value,t.push(...a)):(t.push(...a),t.push(d))}t.push(s),c&&(!this.IsMultilineComment(c)&&c.InputPosition.Row===r?(s.PostfixComment=c.Value,s.IsPostCommentLineStyle=c.Type===Ln.JsonItemType.LineComment):t.push(c))}}Vf.Parser=Ya;var Ir;(function(e){e[e.EmptyCollection=0]="EmptyCollection",e[e.ElementSeen=1]="ElementSeen",e[e.CommaSeen=2]="CommaSeen"})(Ir||(Ir={}));var qt;(function(e){e[e.BeforePropName=0]="BeforePropName",e[e.AfterPropName=1]="AfterPropName",e[e.AfterColon=2]="AfterColon",e[e.AfterPropValue=3]="AfterPropValue",e[e.AfterComma=4]="AfterComma"})(qt||(qt={}));var Uf={};Object.defineProperty(Uf,"__esModule",{value:!0});Uf.ConvertDataToDom=void 0;const kY=Eu,Wa=Oi,IY=Xr;function qa(e,t,n=100){var s;if(n<=0)throw new IY.FracturedJsonError("Depth limit exceeded - possible circular reference");const r=typeof e;switch(r){case"function":case"symbol":case"undefined":return}if(e&&e.toJSON){const i=JSON.parse(JSON.stringify(e));return qa(i,t,n-1)}const a=new kY.JsonItem;if(a.Name=t?JSON.stringify(t):"",e===null)a.Type=Wa.JsonItemType.Null,a.Value="null";else if(Array.isArray(e)){a.Type=Wa.JsonItemType.Array,a.Children=e.map(i=>{var c;return(c=qa(i,void 0,n-1))!==null&&c!==void 0?c:qa(null,void 0,n-1)}),a.Children=[];for(let i=0;i<e.length;++i)a.Children[i]=(s=qa(e[i],void 0,n-1))!==null&&s!==void 0?s:qa(null,void 0,n-1)}else if(r==="object"){a.Type=Wa.JsonItemType.Object;for(const i of Object.entries(e)){const c=qa(i[1],i[0],n-1);c&&a.Children.push(c)}}else{switch(r){case"string":a.Type=Wa.JsonItemType.String;break;case"number":case"bigint":a.Type=Wa.JsonItemType.Number;break;case"boolean":a.Type=e?Wa.JsonItemType.True:Wa.JsonItemType.False;break}a.Value=JSON.stringify(e)}if(a.Children.length>0){const i=a.Children.map(c=>c.Complexity).reduce((c,d)=>Math.max(c,d));a.Complexity=i+1}return a}Uf.ConvertDataToDom=qa;Object.defineProperty(Nf,"__esModule",{value:!0});Nf.Formatter=void 0;const MC=kc,qi=Bf,Ym=$f,Dt=Oi,wr=Ff,AC=zf,_Y=Xr,EC=Vf,MY=Uf;class zn{constructor(){this.Options=new MC.FracturedJsonOptions,this.StringLengthFunc=zn.StringLengthByCharCount,this._buffer=new qi.StringJoinBuffer(this.Options.OmitTrailingWhitespace),this._pads=new Ym.PaddedFormattingTokens(new MC.FracturedJsonOptions,zn.StringLengthByCharCount)}static StringLengthByCharCount(t){return t.length}Reformat(t,n=0){const s=new qi.StringJoinBuffer(this.Options.OmitTrailingWhitespace),r=new EC.Parser;r.Options=this.Options;const a=r.ParseTopLevel(t,!0);return this.FormatTopLevel(a,n,s),s.Flush(),s.AsString()}Serialize(t,n=0,s=100){const r=new qi.StringJoinBuffer(this.Options.OmitTrailingWhitespace),a=(0,MY.ConvertDataToDom)(t,void 0,s);if(a)return this.FormatTopLevel([a],n,r),r.Flush(),r.AsString()}Minify(t){const n=new qi.StringJoinBuffer(this.Options.OmitTrailingWhitespace),s=new EC.Parser;s.Options=this.Options;const r=s.ParseTopLevel(t,!0);return this.MinifyTopLevel(r,n),n.Flush(),n.AsString()}FormatTopLevel(t,n,s){this._buffer=s,this._pads=new Ym.PaddedFormattingTokens(this.Options,this.StringLengthFunc);for(const r of t)this.ComputeItemLengths(r),this.FormatItem(r,n,!1);this._buffer=new qi.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}MinifyTopLevel(t,n){this._buffer=n,this._pads=new Ym.PaddedFormattingTokens(this.Options,this.StringLengthFunc);let s=!0;for(const r of t)s=this.MinifyItem(r,s);this._buffer=new qi.StringJoinBuffer(this.Options.OmitTrailingWhitespace)}ComputeItemLengths(t){const n=`
`;for(const s of t.Children)this.ComputeItemLengths(s);switch(t.Type){case Dt.JsonItemType.Null:t.ValueLength=this._pads.LiteralNullLen;break;case Dt.JsonItemType.True:t.ValueLength=this._pads.LiteralTrueLen;break;case Dt.JsonItemType.False:t.ValueLength=this._pads.LiteralFalseLen;break;default:t.ValueLength=this.StringLengthFunc(t.Value);break}if(t.NameLength=this.StringLengthFunc(t.Name),t.PrefixCommentLength=this.StringLengthFunc(t.PrefixComment),t.MiddleCommentLength=this.StringLengthFunc(t.MiddleComment),t.PostfixCommentLength=this.StringLengthFunc(t.PostfixComment),t.RequiresMultipleLines=zn.IsCommentOrBlankLine(t.Type)||t.Children.some(s=>s.RequiresMultipleLines||s.IsPostCommentLineStyle)||t.PrefixComment.indexOf(n)>=0||t.MiddleComment.indexOf(n)>=0||t.PostfixComment.indexOf(n)>=0||t.Value.indexOf(n)>=0,t.Type===Dt.JsonItemType.Array||t.Type===Dt.JsonItemType.Object){const s=zn.GetPaddingType(t);t.ValueLength=this._pads.StartLen(t.Type,s)+this._pads.EndLen(t.Type,s)+t.Children.map(r=>r.MinimumTotalLength).reduce((r,a)=>r+a,0)+Math.max(0,this._pads.CommaLen*(t.Children.length-1))}t.MinimumTotalLength=(t.PrefixCommentLength>0?t.PrefixCommentLength+this._pads.CommentLen:0)+(t.NameLength>0?t.NameLength+this._pads.ColonLen:0)+(t.MiddleCommentLength>0?t.MiddleCommentLength+this._pads.CommentLen:0)+t.ValueLength+(t.PostfixCommentLength>0?t.PostfixCommentLength+this._pads.CommentLen:0)}FormatItem(t,n,s){switch(t.Type){case Dt.JsonItemType.Array:case Dt.JsonItemType.Object:this.FormatContainer(t,n,s);break;case Dt.JsonItemType.BlankLine:this.FormatBlankLine();break;case Dt.JsonItemType.BlockComment:case Dt.JsonItemType.LineComment:this.FormatStandaloneComment(t,n);break;default:t.RequiresMultipleLines?this.FormatSplitKeyValue(t,n,s):this.FormatInlineElement(t,n,s);break}}FormatContainer(t,n,s){n>this.Options.AlwaysExpandDepth&&(this.FormatContainerInline(t,n,s)||this.FormatContainerCompactMultiline(t,n,s))||n>=this.Options.AlwaysExpandDepth&&this.FormatContainerTable(t,n,s)||this.FormatContainerExpanded(t,n,s)}FormatContainerInline(t,n,s){if(t.RequiresMultipleLines)return!1;const r=t.MinimumTotalLength+(s?this._pads.CommaLen:0);return t.Complexity>this.Options.MaxInlineComplexity||r>this.AvailableLineSpace(n)?!1:(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(n)),this.InlineElement(t,s),this._buffer.EndLine(this._pads.EOL),!0)}FormatContainerCompactMultiline(t,n,s){if(t.Type!==Dt.JsonItemType.Array||t.Complexity>this.Options.MaxCompactArrayComplexity||t.RequiresMultipleLines)return!1;const r=new AC.TableTemplate(this._pads,this.Options.NumberListAlignment);r.MeasureTableRoot(t);const a=this.AvailableLineSpace(n+1);let i=this._pads.CommaLen;if(r.IsRowDataCompatible?i+=r.TotalLength:i+=t.Children.map(h=>h.MinimumTotalLength).reduce((h,p)=>h+p,0)/t.Children.length,i*this.Options.MinCompactArrayRowItems>a)return!1;const c=this.StandardFormatStart(t,n);this._buffer.Add(this._pads.Start(t.Type,wr.BracketPaddingType.Empty));const d=this.AvailableLineSpace(c+1);let u=-1;for(let h=0;h<t.Children.length;++h){const p=t.Children[h],f=h<t.Children.length-1,m=(f?this._pads.CommaLen:0)+(r.IsRowDataCompatible?r.TotalLength:p.MinimumTotalLength);u<m&&(this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(c+1)),u=d),r.IsRowDataCompatible?this.InlineTableRowSegment(r,p,f,!1):this.InlineElement(p,f),u-=m}return this._buffer.EndLine(this._pads.EOL).Add(this.Options.PrefixString,this._pads.Indent(c),this._pads.End(t.Type,wr.BracketPaddingType.Empty)),this.StandardFormatEnd(t,s),!0}FormatContainerTable(t,n,s){if(t.Complexity>this.Options.MaxTableRowComplexity+1)return!1;const r=this.AvailableLineSpace(n+1)-this._pads.CommaLen;if(t.Children.filter(u=>!zn.IsCommentOrBlankLine(u.Type)).some(u=>u.MinimumTotalLength>r))return!1;const i=new AC.TableTemplate(this._pads,this.Options.NumberListAlignment);if(i.MeasureTableRoot(t),!i.IsRowDataCompatible||!i.TryToFit(r))return!1;const c=this.StandardFormatStart(t,n);this._buffer.Add(this._pads.Start(t.Type,wr.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const d=zn.IndexOfLastElement(t.Children);for(let u=0;u<t.Children.length;++u){const h=t.Children[u];if(h.Type===Dt.JsonItemType.BlankLine){this.FormatBlankLine();continue}if(h.Type===Dt.JsonItemType.LineComment||h.Type===Dt.JsonItemType.BlockComment){this.FormatStandaloneComment(h,c+1);continue}this._buffer.Add(this.Options.PrefixString,this._pads.Indent(c+1)),this.InlineTableRowSegment(i,h,u<d,!0),this._buffer.EndLine(this._pads.EOL)}return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(c),this._pads.End(t.Type,wr.BracketPaddingType.Empty)),this.StandardFormatEnd(t,s),!0}FormatContainerExpanded(t,n,s){const r=this.StandardFormatStart(t,n);this._buffer.Add(this._pads.Start(t.Type,wr.BracketPaddingType.Empty)).EndLine(this._pads.EOL);const a=zn.IndexOfLastElement(t.Children);for(let i=0;i<t.Children.length;++i)this.FormatItem(t.Children[i],r+1,i<a);this._buffer.Add(this.Options.PrefixString,this._pads.Indent(r),this._pads.End(t.Type,wr.BracketPaddingType.Empty)),this.StandardFormatEnd(t,s)}FormatStandaloneComment(t,n){const s=zn.NormalizeMultilineComment(t.Value,t.InputPosition.Column);for(const r of s)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(n),r).EndLine(this._pads.EOL)}FormatBlankLine(){this._buffer.Add(this.Options.PrefixString).EndLine(this._pads.EOL)}FormatInlineElement(t,n,s){this._buffer.Add(this.Options.PrefixString,this._pads.Indent(n)),this.InlineElement(t,s),this._buffer.EndLine(this._pads.EOL)}FormatSplitKeyValue(t,n,s){this.StandardFormatStart(t,n),this._buffer.Add(t.Value),this.StandardFormatEnd(t,s)}StandardFormatStart(t,n){if(this._buffer.Add(this.Options.PrefixString,this._pads.Indent(n)),t.PrefixCommentLength>0&&this._buffer.Add(t.PrefixComment,this._pads.Comment),t.NameLength>0&&this._buffer.Add(t.Name,this._pads.Colon),t.MiddleCommentLength===0)return n;if(t.MiddleComment.indexOf(`
`)<0)return this._buffer.Add(t.MiddleComment,this._pads.Comment),n;const s=zn.NormalizeMultilineComment(t.MiddleComment,Number.MAX_VALUE);this._buffer.EndLine(this._pads.EOL);for(const r of s)this._buffer.Add(this.Options.PrefixString,this._pads.Indent(n+1),r).EndLine(this._pads.EOL);return this._buffer.Add(this.Options.PrefixString,this._pads.Indent(n+1)),n+1}StandardFormatEnd(t,n){n&&t.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),t.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,t.PostfixComment),n&&!t.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),this._buffer.EndLine(this._pads.EOL)}InlineElement(t,n){if(t.RequiresMultipleLines)throw new _Y.FracturedJsonError("Logic error - trying to inline invalid element");t.PrefixCommentLength>0&&this._buffer.Add(t.PrefixComment,this._pads.Comment),t.NameLength>0&&this._buffer.Add(t.Name,this._pads.Colon),t.MiddleCommentLength>0&&this._buffer.Add(t.MiddleComment,this._pads.Comment),this.InlineElementRaw(t),n&&t.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma),t.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,t.PostfixComment),n&&!t.IsPostCommentLineStyle&&this._buffer.Add(this._pads.Comma)}InlineElementRaw(t){if(t.Type===Dt.JsonItemType.Array){const n=zn.GetPaddingType(t);this._buffer.Add(this._pads.ArrStart(n));for(let s=0;s<t.Children.length;++s)this.InlineElement(t.Children[s],s<t.Children.length-1);this._buffer.Add(this._pads.ArrEnd(n))}else if(t.Type===Dt.JsonItemType.Object){const n=zn.GetPaddingType(t);this._buffer.Add(this._pads.ObjStart(n));for(let s=0;s<t.Children.length;++s)this.InlineElement(t.Children[s],s<t.Children.length-1);this._buffer.Add(this._pads.ObjEnd(n))}else this._buffer.Add(t.Value)}InlineTableRowSegment(t,n,s,r){t.PrefixCommentLength>0&&this._buffer.Add(n.PrefixComment,this._pads.Spaces(t.PrefixCommentLength-n.PrefixCommentLength),this._pads.Comment),t.NameLength>0&&this._buffer.Add(n.Name,this._pads.Spaces(t.NameLength-n.NameLength),this._pads.Colon),t.MiddleCommentLength>0&&this._buffer.Add(n.MiddleComment,this._pads.Spaces(t.MiddleCommentLength-n.MiddleCommentLength),this._pads.Comment),t.Children.length>0&&n.Type!==Dt.JsonItemType.Null?t.Type===Dt.JsonItemType.Array?this.InlineTableRawArray(t,n):this.InlineTableRawObject(t,n):t.IsNumberList?t.FormatNumber(this._buffer,n):(this.InlineElementRaw(n),this._buffer.Add(this._pads.Spaces(t.CompositeValueLength-n.ValueLength)));const a=n.IsPostCommentLineStyle||n.PostfixCommentLength===0;a&&(s?this._buffer.Add(this._pads.Comma):r&&this._buffer.Add(this._pads.DummyComma)),t.PostfixCommentLength>0&&this._buffer.Add(this._pads.Comment,n.PostfixComment,this._pads.Spaces(t.PostfixCommentLength-n.PostfixCommentLength)),a||(s?this._buffer.Add(this._pads.Comma):r&&this._buffer.Add(this._pads.DummyComma))}InlineTableRawArray(t,n){this._buffer.Add(this._pads.ArrStart(t.PadType));for(let s=0;s<t.Children.length;++s){const r=s===t.Children.length-1,a=s===n.Children.length-1,i=s>=n.Children.length,c=t.Children[s];i?(this._buffer.Add(this._pads.Spaces(c.TotalLength)),r||this._buffer.Add(this._pads.DummyComma)):(this.InlineTableRowSegment(c,n.Children[s],!a,!1),a&&!r&&this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ArrEnd(t.PadType))}InlineTableRawObject(t,n){function s(i){return n.Children.find(c=>c.Name===i.LocationInParent)}const r=t.Children.map(i=>({tt:i,ji:s(i)}));let a=r.length-1;for(;a>=0&&!r[a].ji;)a-=1;this._buffer.Add(this._pads.ObjStart(t.PadType));for(let i=0;i<r.length;++i){const c=r[i].tt,d=r[i].ji,u=i===a,h=i===r.length-1;d?(this.InlineTableRowSegment(c,d,!u,!1),u&&!h&&this._buffer.Add(this._pads.DummyComma)):(this._buffer.Add(this._pads.Spaces(c.TotalLength)),h||this._buffer.Add(this._pads.DummyComma))}this._buffer.Add(this._pads.ObjEnd(t.PadType))}AvailableLineSpace(t){return Math.min(this.Options.MaxInlineLength,this.Options.MaxTotalLineLength-this._pads.PrefixStringLen-this.Options.IndentSpaces*t)}MinifyItem(t,n){const s=`
`;if(this._buffer.Add(t.PrefixComment),t.Name.length>0&&this._buffer.Add(t.Name,":"),t.MiddleComment.indexOf(s)>=0){const r=zn.NormalizeMultilineComment(t.MiddleComment,Number.MAX_VALUE);for(const a of r)this._buffer.Add(a,s)}else this._buffer.Add(t.MiddleComment);if(t.Type===Dt.JsonItemType.Array||t.Type===Dt.JsonItemType.Object){let r;t.Type===Dt.JsonItemType.Array?(this._buffer.Add("["),r="]"):(this._buffer.Add("{"),r="}");let a=!1,i=!1;for(const c of t.Children)zn.IsCommentOrBlankLine(c.Type)||(a&&this._buffer.Add(","),a=!0),i=this.MinifyItem(c,i);this._buffer.Add(r)}else{if(t.Type===Dt.JsonItemType.BlankLine)return n||this._buffer.Add(s),this._buffer.Add(s),!0;if(t.Type===Dt.JsonItemType.LineComment)return n||this._buffer.Add(s),this._buffer.Add(t.Value,s),!0;if(t.Type===Dt.JsonItemType.BlockComment){if(n||this._buffer.Add(s),t.Value.indexOf(s)>=0){const r=zn.NormalizeMultilineComment(t.Value,t.InputPosition.Column);for(const a of r)this._buffer.Add(a,s);return!0}return this._buffer.Add(t.Value,s),!0}else this._buffer.Add(t.Value)}return this._buffer.Add(t.PostfixComment),t.PostfixComment.length>0&&t.IsPostCommentLineStyle?(this._buffer.Add(s),!0):!1}static GetPaddingType(t){return t.Children.length===0?wr.BracketPaddingType.Empty:t.Complexity>=2?wr.BracketPaddingType.Complex:wr.BracketPaddingType.Simple}static NormalizeMultilineComment(t,n){const r=t.replace(/\r/g,"").split(`
`).filter(a=>a.length>0);for(let a=1;a<r.length;++a){const i=r[a];let c=0;for(;c<i.length&&c<n&&/\s/.test(i[c]);)c+=1;r[a]=i.substring(c)}return r}static IndexOfLastElement(t){for(let n=t.length-1;n>=0;--n)if(!this.IsCommentOrBlankLine(t[n].Type))return n;return-1}static IsCommentOrBlankLine(t){return t===Dt.JsonItemType.BlankLine||t===Dt.JsonItemType.BlockComment||t===Dt.JsonItemType.LineComment}}Nf.Formatter=zn;(function(e){Object.defineProperty(e,"__esModule",{value:!0}),e.Formatter=e.FracturedJsonError=e.NumberListAlignment=e.EolStyle=e.CommentPolicy=e.FracturedJsonOptions=void 0;var t=kc;Object.defineProperty(e,"FracturedJsonOptions",{enumerable:!0,get:function(){return t.FracturedJsonOptions}});var n=Df;Object.defineProperty(e,"CommentPolicy",{enumerable:!0,get:function(){return n.CommentPolicy}});var s=Rf;Object.defineProperty(e,"EolStyle",{enumerable:!0,get:function(){return s.EolStyle}});var r=Of;Object.defineProperty(e,"NumberListAlignment",{enumerable:!0,get:function(){return r.NumberListAlignment}});var a=Xr;Object.defineProperty(e,"FracturedJsonError",{enumerable:!0,get:function(){return a.FracturedJsonError}});var i=Nf;Object.defineProperty(e,"Formatter",{enumerable:!0,get:function(){return i.Formatter}})})(ZE);const AY=new ZE.Formatter,EY=G_("scroll","scroll").options,LY=e=>{const{label:t,data:n,fileName:s,withDownload:r=!0,withCopy:a=!0,extraCopyActions:i}=e,c=l.useMemo(()=>(Pp(n)?n:AY.Serialize(n))??"",[n]),d=Da(),u=l.useCallback(()=>{navigator.clipboard.writeText(c)},[c]),h=l.useCallback(()=>{const f=new Blob([c]),m=document.createElement("a");m.href=URL.createObjectURL(f),m.download=`${s||t}.json`,document.body.appendChild(m),m.click(),m.remove()},[c,t,s]),{t:p}=S();return o.jsxs(j,{layerStyle:"second",borderRadius:"base",flexGrow:1,w:"full",h:"full",position:"relative",children:[o.jsx(xe,{position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"auto",p:4,fontSize:"sm",children:o.jsx(Vr,{defer:!0,style:TY,options:EY,children:o.jsx("pre",{children:c})})}),o.jsxs(j,{position:"absolute",top:0,insetInlineEnd:0,p:2,children:[r&&o.jsx(Ae,{label:`${p("gallery.download")} ${t} JSON`,children:o.jsx(Q,{"aria-label":`${p("gallery.download")} ${t} JSON`,icon:o.jsx(mc,{size:16}),variant:"ghost",opacity:.7,onClick:h})}),a&&o.jsx(Ae,{label:`${p("gallery.copy")} ${t} JSON`,children:o.jsx(Q,{"aria-label":`${p("gallery.copy")} ${t} JSON`,icon:o.jsx(gr,{size:16}),variant:"ghost",opacity:.7,onClick:u})}),d&&(i==null?void 0:i.map(({label:f,getData:m})=>o.jsx(PY,{label:f,getData:m,data:n},f)))]})]})},Wr=l.memo(LY),TY={height:"100%",width:"100%"},PY=({label:e,data:t,getData:n})=>{const{t:s}=S(),r=l.useCallback(()=>{navigator.clipboard.writeText(JSON.stringify(n(t),null,2))},[t,n]);return o.jsx(Ae,{label:`${s("gallery.copy")} ${e} JSON`,children:o.jsx(Q,{"aria-label":`${s("gallery.copy")} ${e} JSON`,icon:o.jsx(gr,{size:16}),variant:"ghost",opacity:.7,onClick:r})})},RY=({image:e})=>{const{t}=S(),{currentData:n}=UE(e),s=l.useMemo(()=>{if(n!=null&&n.graph)try{return JSON.parse(n.graph)}catch{return null}return null},[n]);return s?o.jsx(Wr,{fileName:`${e.image_name.replace(".png","")}_graph`,data:s,label:t("nodes.graph")}):o.jsx(Mt,{label:t("nodes.noGraph")})},DY=l.memo(RY),OY=()=>{const{t:e}=S();return o.jsx(O,{children:e("common.loading")})},NY=()=>{const{t:e}=S();return o.jsx(O,{children:e("metadata.parsingFailed")})},eL=(e,t)=>{const[n,s]=l.useState(Wi),[r,a]=l.useState(null);l.useEffect(()=>{(()=>{t.parse(e).then(f=>{s(f)}).catch(()=>{s(Za)})})()},[t,e]);const i=l.useMemo(()=>n===Wi||n===Za,[n]),c=l.useMemo(()=>t.getLabel(),[t]);l.useEffect(()=>{(()=>{if(n===Wi){a(null);return}if(n===Za){a(null);return}t.renderValue(n).then(f=>{a(f)}).catch(()=>{})})()},[t,n]);const d=l.useMemo(()=>n===Wi?o.jsx(OY,{}):n===Za?o.jsx(NY,{}):o.jsx(O,{children:r}),[r,n]),u=l.useCallback(()=>{if(!t.recall||n===Wi||n===Za)return null;t.recall(n,!0).catch(()=>{})},[t,n]),h=l.useMemo(()=>n===Wi||n===Za?null:n,[n]);return{label:c,isDisabled:i,value:n,renderedValue:d,onRecall:u,valueOrNull:h}},tL=l.memo(({label:e,...t})=>{const{t:n}=S();return o.jsx(Ae,{label:n("metadata.recallParameter",{label:e}),children:o.jsx(Q,{"aria-label":n("metadata.recallParameter",{label:e}),icon:o.jsx(jW,{}),size:"xs",variant:"ghost",...t})})});tL.displayName="RecallButton";const S1=l.memo(({label:e,onRecall:t,isDisabled:n,renderedValue:s,direction:r="row"})=>o.jsxs(j,{gap:2,children:[t&&o.jsx(tL,{label:e,onClick:t,isDisabled:n}),o.jsxs(j,{direction:r,fontSize:"sm",children:[o.jsxs(O,{fontWeight:"semibold",whiteSpace:"pre-wrap",pr:2,children:[e,":"]}),s]})]}));S1.displayName="MetadataItemView";const BY=Gp(({metadata:e,handlers:t,direction:n="row"})=>{const{label:s,isDisabled:r,value:a,renderedValue:i,onRecall:c}=eL(e,t);return a===Za||t.getIsVisible&&!yO(a)&&!t.getIsVisible(a)?null:o.jsx(S1,{label:s,onRecall:c,isDisabled:r,renderedValue:i,direction:n})}),Ot=Gp(BY);Ot.displayName="MetadataItem";const $Y=({metadata:e})=>{const[t,n]=l.useState([]);l.useEffect(()=>{(async()=>{try{const a=await rt.loras.parse(e);n(a)}catch{n([])}})()},[e]);const s=l.useMemo(()=>rt.loras.getLabel(),[]);return o.jsx(o.Fragment,{children:t.map(r=>o.jsx(FY,{label:s,lora:r,handlers:rt.loras},r.model.key))})},FY=({label:e,lora:t,handlers:n})=>{const s=l.useCallback(()=>{n.recallItem&&n.recallItem(t,!0).catch(()=>{})},[n,t]),[r,a]=l.useState(null);return l.useEffect(()=>{(async()=>{if(!n.renderItemValue){a(null);return}const c=await n.renderItemValue(t);a(c)})()},[n,t]),o.jsx(S1,{label:e,isDisabled:!1,onRecall:s,renderedValue:r})},zY=e=>{const t=w(bn),{metadata:n}=e;return!n||Object.keys(n).length===0?null:o.jsxs(o.Fragment,{children:[o.jsx(Ot,{metadata:n,handlers:rt.generationMode}),o.jsx(Ot,{metadata:n,handlers:rt.positivePrompt,direction:"column"}),o.jsx(Ot,{metadata:n,handlers:rt.negativePrompt,direction:"column"}),o.jsx(Ot,{metadata:n,handlers:rt.sdxlPositiveStylePrompt,direction:"column"}),o.jsx(Ot,{metadata:n,handlers:rt.sdxlNegativeStylePrompt,direction:"column"}),o.jsx(Ot,{metadata:n,handlers:rt.model}),o.jsx(Ot,{metadata:n,handlers:rt.vae}),o.jsx(Ot,{metadata:n,handlers:rt.width}),o.jsx(Ot,{metadata:n,handlers:rt.height}),o.jsx(Ot,{metadata:n,handlers:rt.seed}),o.jsx(Ot,{metadata:n,handlers:rt.steps}),o.jsx(Ot,{metadata:n,handlers:rt.scheduler}),o.jsx(Ot,{metadata:n,handlers:rt.cfgScale}),o.jsx(Ot,{metadata:n,handlers:rt.cfgRescaleMultiplier}),o.jsx(Ot,{metadata:n,handlers:rt.guidance}),t!=="canvas"&&o.jsx(Ot,{metadata:n,handlers:rt.strength}),o.jsx(Ot,{metadata:n,handlers:rt.hrfEnabled}),o.jsx(Ot,{metadata:n,handlers:rt.hrfMethod}),o.jsx(Ot,{metadata:n,handlers:rt.hrfStrength}),o.jsx(Ot,{metadata:n,handlers:rt.refinerCFGScale}),o.jsx(Ot,{metadata:n,handlers:rt.refinerModel}),o.jsx(Ot,{metadata:n,handlers:rt.refinerNegativeAestheticScore}),o.jsx(Ot,{metadata:n,handlers:rt.refinerPositiveAestheticScore}),o.jsx(Ot,{metadata:n,handlers:rt.refinerScheduler}),o.jsx(Ot,{metadata:n,handlers:rt.refinerStart}),o.jsx(Ot,{metadata:n,handlers:rt.refinerSteps}),o.jsx($Y,{metadata:n})]})},VY=l.memo(zY),HY=({image:e})=>{const{t}=S(),{currentData:n}=UE(e),s=l.useMemo(()=>{if(n!=null&&n.workflow)try{return JSON.parse(n.workflow)}catch{return null}return null},[n]);return s?o.jsx(Wr,{fileName:`${e.image_name.replace(".png","")}_workflow`,data:s,label:t("metadata.workflow")}):o.jsx(Mt,{label:t("nodes.noWorkflow")})},WY=l.memo(HY),GY=({image:e})=>{const{t}=S(),{metadata:n}=$k(e.image_name),s=eL(n,rt.createdBy);return o.jsxs(j,{layerStyle:"first",padding:4,gap:1,flexDirection:"column",width:"full",height:"full",borderRadius:"base",position:"absolute",overflow:"hidden",children:[o.jsx(wa,{href:e.image_url,label:e.image_name}),s.valueOrNull&&o.jsxs(O,{children:[t("metadata.createdBy"),": ",s.valueOrNull]}),o.jsxs(ki,{variant:"line",isLazy:!0,display:"flex",flexDir:"column",w:"full",h:"full",children:[o.jsxs(Ii,{children:[o.jsx(rn,{children:t("metadata.recallParameters")}),o.jsx(rn,{children:t("metadata.metadata")}),o.jsx(rn,{children:t("metadata.imageDetails")}),o.jsx(rn,{children:t("metadata.workflow")}),o.jsx(rn,{children:t("nodes.graph")})]}),o.jsxs(oc,{children:[o.jsx(mn,{children:n?o.jsx(Nn,{children:o.jsx(VY,{metadata:n})}):o.jsx(Mt,{label:t("metadata.noRecallParameters")})}),o.jsx(mn,{children:n?o.jsx(Wr,{fileName:`${e.image_name.replace(".png","")}_metadata`,data:n,label:t("metadata.metadata")}):o.jsx(Mt,{label:t("metadata.noMetaData")})}),o.jsx(mn,{children:e?o.jsx(Wr,{fileName:`${e.image_name.replace(".png","")}_details`,data:e,label:t("metadata.imageDetails")}):o.jsx(Mt,{label:t("metadata.noImageDetails")})}),o.jsx(mn,{children:o.jsx(WY,{image:e})}),o.jsx(mn,{children:o.jsx(DY,{image:e})})]})]})]})},UY=l.memo(GY),k1=()=>{const e=w(ac),t=_i(e);return{imageDTOs:l.useMemo(()=>{var s;return((s=t.data)==null?void 0:s.items)??Ss},[t.data]),queryResult:t}},R0="gallery-grid",ZY={minW:0,svg:{transitionProperty:"common",transitionDuration:"normal",fill:"base.100",_hover:{fill:"base.50"},filter:`drop-shadow(0px 0px 0.1rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))
      drop-shadow(0px 0px 0.3rem var(--invoke-colors-base-900))`}},qY=e=>{const{onClick:t,tooltip:n,icon:s,...r}=e;return o.jsx(Q,{onClick:t,"aria-label":n,icon:s,variant:"link",sx:ZY,"data-testid":n,...r})},Ic=l.memo(qY),KY={position:"relative",height:"full",width:"full","::before":{content:"''",display:"block",pt:"100%"}},QY=()=>o.jsx(_x,{sx:KY,children:o.jsx(xe,{position:"absolute",top:0,insetInlineStart:0,height:"full",width:"full"})}),nL=l.memo(QY),sL=e=>`gallery-image-${e}`,YY=e=>{const t=E(),n=w(vO),s=l.useMemo(()=>pe(ks,c=>c.selection.some(d=>d.image_name===(e==null?void 0:e.image_name))),[e==null?void 0:e.image_name]),r=w(s),a=dn("multiselect"),i=l.useCallback(c=>{if(e){if(!a){t(Wx([e]));return}t(CO({imageDTO:e,shiftKey:c.shiftKey,ctrlKey:c.ctrlKey,metaKey:c.metaKey,altKey:c.altKey}))}},[t,e,a]);return{areMultiplesSelected:n,isSelected:r,handleClick:i}},oL=Ge({}),rL=(e,t)=>e.top>=t.top&&e.bottom<=t.bottom&&e.left>=t.left&&e.right<=t.right,aL=(e,t)=>e>(t.endIndex-t.startIndex)/2+t.startIndex?"end":"start",JY=(e,t,n)=>{const s=l.useRef(null);return l.useEffect(()=>{var h,p,f,m;if(!e||n)return;const r=oL.get(),a=(h=r.virtuosoRangeRef)==null?void 0:h.current,i=(p=r.rootRef)==null?void 0:p.current,c=(f=r.virtuosoRef)==null?void 0:f.current;if(!a||!c||!i)return;const d=(m=s.current)==null?void 0:m.getBoundingClientRect(),u=i.getBoundingClientRect();(!d||!rL(d,u))&&c.scrollToIndex({index:t,align:aL(t,a)})},[e,t,n]),s},I1="gallery-image",XY={w:"full",h:"full"},eJ={containerType:"inline-size"},tJ={"@container (max-width: 80px)":{"&":{display:"none"}}},nJ=pe(ks,e=>e.alwaysShowImageSizeBadge),iL=l.memo(({index:e,imageDTO:t})=>t?o.jsx(lL,{index:e,imageDTO:t}):o.jsx(nL,{}));iL.displayName="GalleryImage";const lL=l.memo(({index:e,imageDTO:t})=>{const n=E(),s=w(Hd),r=l.useMemo(()=>pe(ks,v=>{var I;return((I=v.imageToCompare)==null?void 0:I.image_name)===t.image_name}),[t.image_name]),a=w(r),{handleClick:i,isSelected:c,areMultiplesSelected:d}=YY(t),u=JY(c,e,d),h=l.useMemo(()=>{if(d)return{id:"gallery-image",payloadType:"GALLERY_SELECTION",payload:{boardId:s}};if(t)return{id:"gallery-image",payloadType:"IMAGE_DTO",payload:{imageDTO:t}}},[t,s,d]),[p,f]=l.useState(!1),m=l.useCallback(()=>{f(!0)},[]),g=jt(),x=l.useCallback(()=>{g.open(),n(zd(null))},[n,g]),C=l.useCallback(()=>{f(!1)},[]),y=l.useMemo(()=>sL(t.image_name),[t.image_name]);return t?o.jsx(xe,{w:"full",h:"full",className:I1,"data-testid":y,sx:eJ,children:o.jsx(j,{ref:u,userSelect:"none",position:"relative",justifyContent:"center",alignItems:"center",aspectRatio:"1/1",onMouseOver:m,onMouseOut:C,children:o.jsx(Di,{onClick:i,onDoubleClick:x,imageDTO:t,draggableData:h,isSelected:c,isSelectedForCompare:a,minSize:0,imageSx:XY,isDropDisabled:!0,isUploadDisabled:!0,thumbnail:!0,withHoverOverlay:!0,children:o.jsx(cL,{imageDTO:t,isHovered:p})})})}):o.jsx(nL,{})});lL.displayName="GalleryImageContent";const cL=l.memo(({imageDTO:e,isHovered:t})=>{const n=w(nJ);return o.jsxs(o.Fragment,{children:[(t||n)&&o.jsx(pL,{imageDTO:e}),(t||e.starred)&&o.jsx(hL,{imageDTO:e}),t&&o.jsx(dL,{imageDTO:e}),t&&o.jsx(uL,{imageDTO:e})]})});cL.displayName="HoverIcons";const dL=l.memo(({imageDTO:e})=>{const t=Da(),{t:n}=S(),s=E(),r=l.useCallback(a=>{a.stopPropagation(),e&&s($d([e]))},[s,e]);return t?o.jsx(Ic,{onClick:r,icon:o.jsx(bc,{}),tooltip:n("gallery.deleteImage_one"),position:"absolute",bottom:2,insetInlineEnd:2}):null});dL.displayName="DeleteIcon";const uL=l.memo(({imageDTO:e})=>{const t=jt(),{t:n}=S(),s=l.useCallback(()=>{t.openImageInViewer(e)},[e,t]);return o.jsx(Ic,{onClick:s,icon:o.jsx(bu,{}),tooltip:n("gallery.openInViewer"),position:"absolute",insetBlockStart:2,insetInlineStart:2})});uL.displayName="OpenInViewerIconButton";const hL=l.memo(({imageDTO:e})=>{const t=se(Mx),[n]=Ax(),[s]=Ex(),r=l.useCallback(()=>{e&&(e.starred&&s({imageDTOs:[e]}),e.starred||n({imageDTOs:[e]}))},[n,s,e]),a=l.useMemo(()=>{if(e.starred)return t?t.on.icon:o.jsx(Bb,{});if(!e.starred)return t?t.off.icon:o.jsx(Db,{})},[e.starred,t]),i=l.useMemo(()=>e.starred?t?t.off.text:"Unstar":e.starred?"":t?t.on.text:"Star",[e.starred,t]);return o.jsx(Ic,{onClick:r,icon:a,tooltip:i,position:"absolute",top:2,insetInlineEnd:2})});hL.displayName="StarIcon";const pL=l.memo(({imageDTO:e})=>o.jsx(O,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:1,left:1,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",sx:tJ,pointerEvents:"none",children:`${e.width}x${e.height}`}));pL.displayName="SizeBadge";const Sp=()=>{const e=document.querySelector(`.${I1}`),t=document.querySelector(`.${R0}`);if(!e||!t)return 0;const n=t.parentElement;if(!n)return 0;const s=e.getBoundingClientRect(),r=n.getBoundingClientRect(),a=window.getComputedStyle(t),i=parseFloat(a.gap);if(!s.width||!s.height||!r.width||!r.height)return 0;let c=0,d=0;for(;d+s.width<=r.width+1;)c++,d+=s.width,d+i<=r.width&&(d+=i);return c},sJ=(e,t)=>{var u,h,p;const n=oL.get(),s=(u=n.virtuosoRangeRef)==null?void 0:u.current,r=(h=n.rootRef)==null?void 0:h.current,a=(p=n.virtuosoRef)==null?void 0:p.current;if(!s||!a||!r)return;const i=document.querySelector(`[data-testid="${sL(e)}"]`),c=i==null?void 0:i.getBoundingClientRect(),d=r.getBoundingClientRect();(!c||!rL(c,d))&&a.scrollToIndex({index:t,align:aL(t,s)})},oJ=(e,t)=>{const n=ir(t-1,0,e.length-1),s=e[n];return{index:n,image:s}},rJ=(e,t)=>{const n=ir(t+1,0,e.length-1),s=e[n];return{index:n,image:s}},aJ=(e,t)=>{const n=Sp(),r=t<n?t:ir(t-n,0,e.length-1),a=e[r];return{index:r,image:a}},iJ=(e,t)=>{const n=Sp(),r=t<e.length-n?ir(t+n,0,e.length-1):t,a=e[r];return{index:r,image:a}},lJ={left:oJ,right:rJ,up:aJ,down:iJ},fL=()=>{const e=E(),t=wO(),n=l.useMemo(()=>pe(Fd,jO,(k,M)=>t?M??k:k),[t]),s=w(n),{imageDTOs:r}=k1(),a=l.useMemo(()=>r.length,[r.length]),i=l.useMemo(()=>r.length===0||!s?0:r.findIndex(k=>k.image_name===s.image_name),[r,s]),c=l.useCallback((k,M)=>{const{index:_,image:A}=lJ[k](r,i);!A||_===i||(e(M?zd(A):yx(A)),sJ(A.image_name,_))},[r,i,e]),d=l.useMemo(()=>i===0,[i]),u=l.useMemo(()=>i===a-1,[i,a]),h=l.useMemo(()=>i<Sp(),[i]),p=l.useMemo(()=>i>=a-Sp(),[i,a]),f=l.useMemo(()=>i===0,[i]),m=l.useMemo(()=>i===a-1,[i,a]),g=l.useCallback(k=>{c("left",k)},[c]),x=l.useCallback(k=>{c("right",k)},[c]),C=l.useCallback(k=>{c("up",k)},[c]),y=l.useCallback(k=>{c("down",k)},[c]),v=l.useCallback(()=>{x()},[x]),I=l.useCallback(()=>{g()},[g]);return{handleLeftImage:g,handleRightImage:x,handleUpImage:C,handleDownImage:y,isOnFirstImage:d,isOnLastImage:u,isOnFirstRow:h,isOnLastRow:p,nextImage:v,prevImage:I,isOnFirstImageOfView:f,isOnLastImageOfView:m}},td=(e,t)=>{const n=t-e+1;return Array.from({length:n},(s,r)=>r+e)},nd="ellipsis",cJ=(e,t,n)=>{const s=Math.min(2*n+5,t),r=1,a=t,i=Math.max(e-n,r),c=Math.min(e+n,a),d=i>r+1,u=c<a-1,h=s-2;if(!d&&u)return[...td(1,h),nd,a];if(d&&!u){const f=td(a-h+1,a);return[r,nd,...f]}if(d&&u){const f=td(i,c);return[r,nd,...f,nd,a]}return td(r,a)},dJ=pe(ks,e=>e.offset),uJ=pe(ks,e=>e.limit),Zf=()=>{const e=E(),t=w(dJ),n=w(uJ),s=w(ac),{count:r,total:a}=_i(s,{selectFromResult:({data:_})=>({count:(_==null?void 0:_.items.length)??0,total:(_==null?void 0:_.total)??0})}),i=l.useMemo(()=>Math.ceil(t/(n||0)),[t,n]),c=l.useMemo(()=>Math.ceil(a/(n||0)),[a,n]),d=l.useMemo(()=>r?i+1<c:!1,[r,i,c]),u=l.useMemo(()=>r?t>0:!1,[r,t]),h=l.useCallback(_=>{e(tS(_))},[e]),p=l.useMemo(()=>Kg(h,500),[h]),f=l.useCallback(_=>{p({offset:t+(n||0),withHotkey:_})},[p,t,n]),m=l.useCallback(_=>{p({offset:Math.max(t-(n||0),0),withHotkey:_})},[p,t,n]),g=l.useCallback(_=>{p({offset:_*(n||0)})},[p,n]),x=l.useCallback(()=>{p({offset:0})},[p]),C=l.useCallback(()=>{p({offset:(c-1)*(n||0)})},[p,c,n]);l.useEffect(()=>{c&&i+1>c&&C()},[i,c,C]);const y=l.useMemo(()=>c>7?cJ(i+1,c,1):td(1,c),[i,c]),v=l.useMemo(()=>i>0,[i]),I=l.useMemo(()=>i<c-1,[i,c]),k=l.useMemo(()=>{const _=i*(n||0)+1,A=Math.min((i+1)*(n||0),a);return`${_}-${A} of ${a}`},[a,i,n]),M=l.useMemo(()=>Math.min((i+1)*(n||0),a),[i,n,a]);return{count:r,total:a,currentPage:i,pages:c,isNextEnabled:d,isPrevEnabled:u,goNext:f,goPrev:m,goToPage:g,goToFirst:x,goToLast:C,pageButtons:y,isFirstEnabled:v,isLastEnabled:I,rangeDisplay:k,numberOnPage:M}},hJ=({inset:e=8})=>{const{t}=S(),{prevImage:n,nextImage:s,isOnFirstImageOfView:r,isOnLastImageOfView:a}=fL(),{isFetching:i}=k1().queryResult,{isNextEnabled:c,goNext:d,isPrevEnabled:u,goPrev:h}=Zf(),p=l.useMemo(()=>!!(!r||u),[r,u]),f=l.useCallback(()=>{r?u&&!i&&h("arrow"):n()},[h,i,r,u,n]),m=l.useMemo(()=>!!(!a||c),[c,a]),g=l.useCallback(()=>{a?c&&!i&&d("arrow"):s()},[d,i,c,a,s]);return o.jsxs(xe,{pos:"relative",h:"full",w:"full",children:[p&&o.jsx(Q,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.previousImage"),icon:o.jsx(Tb,{size:64}),variant:"unstyled",onClick:f,isDisabled:i,color:"base.100",pointerEvents:"auto",insetInlineStart:e}),m&&o.jsx(Q,{position:"absolute",top:"50%",transform:"translate(0, -50%)","aria-label":t("accessibility.nextImage"),icon:o.jsx(Pb,{size:64}),variant:"unstyled",onClick:g,isDisabled:i,color:"base.100",pointerEvents:"auto",insetInlineEnd:e})]})},mL=l.memo(hJ),gL=l.memo(e=>o.jsx(it,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",...e,children:o.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})}));gL.displayName="InvokeLogoIcon";const xL=Symbol("LOADING"),pJ=()=>{const{data:e,isLoading:t}=nc({include_archived:!0}),{data:n,isLoading:s}=_i({board_id:"none",offset:0,limit:0,is_intermediate:!1});return l.useMemo(()=>t||s?xL:e&&e.length>0&&e.filter(i=>i.image_count>0).length>0?!0:n?n.total>0:!0,[e,n,t,s])},fJ=()=>{const e=pJ(),[t,{data:n}]=vf(),s=w(SO),r=dn("starterModels"),{t:a}=S(),i=E(),c=l.useCallback(()=>{i(Tt("models")),mi.set(3)},[i]),d=l.useCallback(()=>{i(Tt("models")),mi.set(0)},[i]),u=l.useMemo(()=>r&&n&&t.length===0,[t.length,n,r]);return e===xL?o.jsx(j,{position:"relative",width:"full",height:"full",alignItems:"center",justifyContent:"center",children:o.jsx(pr,{label:"Loading",color:"grey",position:"absolute",size:"sm",width:8,height:8,right:4,bottom:4})}):e?o.jsx(Mt,{icon:fi,label:a("gallery.noImageSelected")}):o.jsxs(j,{flexDir:"column",gap:4,alignItems:"center",textAlign:"center",maxW:"600px",children:[o.jsx(gL,{w:40,h:40}),o.jsxs(j,{flexDir:"column",gap:8,alignItems:"center",textAlign:"center",children:[o.jsx(O,{fontSize:"md",color:"base.200",pt:16,children:s?o.jsx(Cs,{i18nKey:"newUserExperience.toGetStartedLocal",components:{StrongComponent:o.jsx(O,{as:"span",color:"white",fontSize:"md",fontWeight:"semibold"})}}):o.jsx(Cs,{i18nKey:"newUserExperience.toGetStarted",components:{StrongComponent:o.jsx(O,{as:"span",color:"white",fontSize:"md",fontWeight:"semibold"})}})}),u&&o.jsxs(j,{flexDir:"column",gap:2,alignItems:"center",children:[o.jsx(O,{fontSize:"md",color:"base.200",children:a("newUserExperience.noModelsInstalled")}),o.jsxs(j,{gap:3,alignItems:"center",children:[o.jsx(me,{size:"sm",onClick:c,children:a("newUserExperience.downloadStarterModels")}),o.jsx(O,{fontSize:"sm",color:"base.200",children:a("common.or")}),o.jsx(me,{size:"sm",onClick:d,children:a("newUserExperience.importModels")})]})]}),o.jsx(zt,{}),o.jsx(O,{fontSize:"md",color:"base.200",children:o.jsx(Cs,{i18nKey:"newUserExperience.gettingStartedSeries",components:{LinkComponent:o.jsx(O,{as:"a",color:"white",fontSize:"md",fontWeight:"semibold",href:"https://www.youtube.com/playlist?list=PLvWK1Kc8iXGrQy8r9TYg6QdUuJ5MMx-ZO",target:"_blank"})}})})]})]})},mJ=pe(Wd,e=>e.shouldAntialiasProgressImage),gJ=()=>{const e=se(kO),t=se(nS),n=w(mJ),s=l.useMemo(()=>({imageRendering:n?"auto":"pixelated"}),[n]);return!e||t?null:o.jsx(nn,{src:e.dataURL,width:e.width,height:e.height,draggable:!1,"data-testid":"progress-image",objectFit:"contain",maxWidth:"full",maxHeight:"full",position:"absolute",borderRadius:"base",sx:s})},xJ=l.memo(gJ),bJ=()=>{const e=w(sS),t=w(IO),n=se(_O),s=se(nS),r=w(Gx),{currentData:a}=Gr(t??Kn),i=l.useMemo(()=>{if(a)return{id:"current-image",payloadType:"IMAGE_DTO",payload:{imageDTO:a}}},[a]),[c,d]=l.useState(!1),u=l.useRef(0),h=l.useCallback(()=>{d(!0),window.clearTimeout(u.current)},[]),p=l.useCallback(()=>{u.current=window.setTimeout(()=>{d(!1)},500)},[]);return o.jsxs(j,{onMouseOver:h,onMouseOut:p,width:"full",height:"full",alignItems:"center",justifyContent:"center",position:"relative",children:[n&&!s&&r?o.jsx(xJ,{}):o.jsx(Di,{imageDTO:a,draggableData:i,isDropDisabled:!0,isUploadDisabled:!0,fitContainer:!0,useThumbailFallback:!0,noContentFallback:o.jsx(fJ,{}),dataTestId:"image-preview"}),e&&a&&o.jsx(xe,{position:"absolute",opacity:.8,top:0,width:"full",height:"full",borderRadius:"base",children:o.jsx(UY,{image:a})}),o.jsx(Ox,{children:c&&a&&o.jsx(xe,{as:Nx.div,initial:vJ,animate:CJ,exit:wJ,position:"absolute",top:0,right:0,bottom:0,left:0,pointerEvents:"none",children:o.jsx(mL,{})},"nextPrevButtons")})]})},yJ=l.memo(bJ),vJ={opacity:0},CJ={opacity:1,transition:{duration:.07}},wJ={opacity:0,transition:{duration:.07}},D0="drop-shadow(0px 0px 4px rgb(0, 0, 0)) drop-shadow(0px 0px 4px rgba(0, 0, 0, 0.3))",bL=(e,t)=>{if(e.width===0||e.height===0)return{width:t.width,height:t.height};if(t.width<=e.width&&t.height<=e.height)return{width:t.width,height:t.height};const n=e.width/e.height,s=t.width/t.height;let r,a;return s>n?(r=e.width,a=r/s):(a=e.height,r=a*s),{width:r,height:a}},yL=(e,t,n,s)=>{const r=e==="fill"?t.width:t.width*s.width/n.width,a=e==="fill"?t.height:t.height*s.height/n.height;return{width:r,height:a}},vL=pt(ks,e=>{const t=e.selection.slice(-1)[0]??null,n=e.imageToCompare;return{firstImage:t,secondImage:n}}),CL=e=>{e.preventDefault()},gi=l.memo(({type:e,...t})=>{const{t:n}=S();return o.jsx(O,{position:"absolute",bottom:4,insetInlineEnd:e==="first"?void 0:4,insetInlineStart:e==="first"?4:void 0,textOverflow:"clip",whiteSpace:"nowrap",filter:D0,color:"base.50",transitionDuration:"0.2s",transitionProperty:"common",...t,children:n(e==="first"?"gallery.viewerImage":"gallery.compareImage")})});gi.displayName="ImageComparisonLabel";const wL=l.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=w(Hx),r=l.useRef(null),a=Jd(!1),i=l.useMemo(()=>bL(n,e),[n,e]),c=l.useMemo(()=>yL(s,i,e,t),[s,i,e,t]);return o.jsx(j,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:o.jsx(j,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:o.jsxs(xe,{ref:r,position:"relative",id:"image-comparison-hover-image-container",w:i.width,h:i.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[o.jsx(nn,{id:"image-comparison-hover-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:i.width,h:i.height,maxW:"full",maxH:"full",objectFit:"cover",objectPosition:"top left"}),o.jsx(gi,{type:"first",opacity:a.isTrue?0:1}),o.jsxs(xe,{id:"image-comparison-hover-second-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"hidden",opacity:a.isTrue?1:0,transitionDuration:"0.2s",transitionProperty:"common",children:[o.jsx(xe,{id:"image-comparison-hover-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:Pf,backgroundRepeat:"repeat"}),o.jsx(nn,{position:"relative",id:"image-comparison-hover-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:c.width,h:c.height,maxW:i.width,maxH:i.height,objectFit:s,objectPosition:"top left"}),o.jsx(gi,{type:"second",opacity:a.isTrue?1:0})]}),o.jsx(xe,{id:"image-comparison-hover-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseOver:a.setTrue,onMouseOut:a.setFalse,onContextMenu:CL,userSelect:"none"})]})})})});wL.displayName="ImageComparisonHover";const{createElement:Yl,createContext:jJ,createRef:Xme,forwardRef:jL,useCallback:ps,useContext:SL,useEffect:ci,useImperativeHandle:kL,useLayoutEffect:SJ,useMemo:kJ,useRef:bs,useState:Tl}=Ux,LC=Ux[`useId${Math.random()}`.slice(0,5)],IJ=SJ,qf=jJ(null);qf.displayName="PanelGroupContext";const di=IJ,_J=typeof LC=="function"?LC:()=>null;let MJ=0;function _1(e=null){const t=_J(),n=bs(e||t||null);return n.current===null&&(n.current=""+MJ++),e??n.current}function IL({children:e,className:t="",collapsedSize:n,collapsible:s,defaultSize:r,forwardedRef:a,id:i,maxSize:c,minSize:d,onCollapse:u,onExpand:h,onResize:p,order:f,style:m,tagName:g="div",...x}){const C=SL(qf);if(C===null)throw Error("Panel components must be rendered within a PanelGroup container");const{collapsePanel:y,expandPanel:v,getPanelSize:I,getPanelStyle:k,groupId:M,isPanelCollapsed:_,reevaluatePanelConstraints:A,registerPanel:D,resizePanel:N,unregisterPanel:P}=C,z=_1(i),W=bs({callbacks:{onCollapse:u,onExpand:h,onResize:p},constraints:{collapsedSize:n,collapsible:s,defaultSize:r,maxSize:c,minSize:d},id:z,idIsFromProps:i!==void 0,order:f});bs({didLogMissingDefaultSizeWarning:!1}),di(()=>{const{callbacks:ee,constraints:G}=W.current,re={...G};W.current.id=z,W.current.idIsFromProps=i!==void 0,W.current.order=f,ee.onCollapse=u,ee.onExpand=h,ee.onResize=p,G.collapsedSize=n,G.collapsible=s,G.defaultSize=r,G.maxSize=c,G.minSize=d,(re.collapsedSize!==G.collapsedSize||re.collapsible!==G.collapsible||re.maxSize!==G.maxSize||re.minSize!==G.minSize)&&A(W.current,re)}),di(()=>{const ee=W.current;return D(ee),()=>{P(ee)}},[f,z,D,P]),kL(a,()=>({collapse:()=>{y(W.current)},expand:ee=>{v(W.current,ee)},getId(){return z},getSize(){return I(W.current)},isCollapsed(){return _(W.current)},isExpanded(){return!_(W.current)},resize:ee=>{N(W.current,ee)}}),[y,v,I,_,z,N]);const X=k(W.current,r);return Yl(g,{...x,children:e,className:t,id:i,style:{...X,...m},"data-panel":"","data-panel-collapsible":s||void 0,"data-panel-group-id":M,"data-panel-id":z,"data-panel-size":parseFloat(""+X.flexGrow).toFixed(1)})}const or=jL((e,t)=>Yl(IL,{...e,forwardedRef:t}));IL.displayName="Panel";or.displayName="forwardRef(Panel)";let O0=null,ni=null;function AJ(e,t){if(t){const n=(t&LL)!==0,s=(t&TL)!==0,r=(t&PL)!==0,a=(t&RL)!==0;if(n)return r?"se-resize":a?"ne-resize":"e-resize";if(s)return r?"sw-resize":a?"nw-resize":"w-resize";if(r)return"s-resize";if(a)return"n-resize"}switch(e){case"horizontal":return"ew-resize";case"intersection":return"move";case"vertical":return"ns-resize"}}function EJ(){ni!==null&&(document.head.removeChild(ni),O0=null,ni=null)}function Jm(e,t){const n=AJ(e,t);O0!==n&&(O0=n,ni===null&&(ni=document.createElement("style"),document.head.appendChild(ni)),ni.innerHTML=`*{cursor: ${n}!important;}`)}function _L(e){return e.type==="keydown"}function ML(e){return e.type.startsWith("pointer")}function AL(e){return e.type.startsWith("mouse")}function Kf(e){if(ML(e)){if(e.isPrimary)return{x:e.clientX,y:e.clientY}}else if(AL(e))return{x:e.clientX,y:e.clientY};return{x:1/0,y:1/0}}function LJ(){if(typeof matchMedia=="function")return matchMedia("(pointer:coarse)").matches?"coarse":"fine"}function TJ(e,t,n){return e.x<t.x+t.width&&e.x+e.width>t.x&&e.y<t.y+t.height&&e.y+e.height>t.y}function PJ(e,t){if(e===t)throw new Error("Cannot compare node with itself");const n={a:RC(e),b:RC(t)};let s;for(;n.a.at(-1)===n.b.at(-1);)e=n.a.pop(),t=n.b.pop(),s=e;at(s,"Stacking order can only be calculated for elements with a common ancestor");const r={a:PC(TC(n.a)),b:PC(TC(n.b))};if(r.a===r.b){const a=s.childNodes,i={a:n.a.at(-1),b:n.b.at(-1)};let c=a.length;for(;c--;){const d=a[c];if(d===i.a)return 1;if(d===i.b)return-1}}return Math.sign(r.a-r.b)}const RJ=/\b(?:position|zIndex|opacity|transform|webkitTransform|mixBlendMode|filter|webkitFilter|isolation)\b/;function DJ(e){var t;const n=getComputedStyle((t=EL(e))!==null&&t!==void 0?t:e).display;return n==="flex"||n==="inline-flex"}function OJ(e){const t=getComputedStyle(e);return!!(t.position==="fixed"||t.zIndex!=="auto"&&(t.position!=="static"||DJ(e))||+t.opacity<1||"transform"in t&&t.transform!=="none"||"webkitTransform"in t&&t.webkitTransform!=="none"||"mixBlendMode"in t&&t.mixBlendMode!=="normal"||"filter"in t&&t.filter!=="none"||"webkitFilter"in t&&t.webkitFilter!=="none"||"isolation"in t&&t.isolation==="isolate"||RJ.test(t.willChange)||t.webkitOverflowScrolling==="touch")}function TC(e){let t=e.length;for(;t--;){const n=e[t];if(at(n,"Missing node"),OJ(n))return n}return null}function PC(e){return e&&Number(getComputedStyle(e).zIndex)||0}function RC(e){const t=[];for(;e;)t.push(e),e=EL(e);return t}function EL(e){const{parentNode:t}=e;return t&&t instanceof ShadowRoot?t.host:t}const LL=1,TL=2,PL=4,RL=8,NJ=LJ()==="coarse";let Lo=[],Pl=!1,ha=new Map,Qf=new Map;const _d=new Set;function BJ(e,t,n,s,r){var a;const{ownerDocument:i}=t,c={direction:n,element:t,hitAreaMargins:s,setResizeHandlerState:r},d=(a=ha.get(i))!==null&&a!==void 0?a:0;return ha.set(i,d+1),_d.add(c),kp(),function(){var h;Qf.delete(e),_d.delete(c);const p=(h=ha.get(i))!==null&&h!==void 0?h:1;if(ha.set(i,p-1),kp(),p===1&&ha.delete(i),Lo.includes(c)){const f=Lo.indexOf(c);f>=0&&Lo.splice(f,1),A1(),r("up",!0,null)}}}function DC(e){const{target:t}=e,{x:n,y:s}=Kf(e);Pl=!0,M1({target:t,x:n,y:s}),kp(),Lo.length>0&&(Ip("down",e),e.preventDefault(),e.stopPropagation())}function Wc(e){const{x:t,y:n}=Kf(e);if(Pl&&e.buttons===0&&(Pl=!1,Ip("up",e)),!Pl){const{target:s}=e;M1({target:s,x:t,y:n})}Ip("move",e),A1(),Lo.length>0&&e.preventDefault()}function Ki(e){const{target:t}=e,{x:n,y:s}=Kf(e);Qf.clear(),Pl=!1,Lo.length>0&&e.preventDefault(),Ip("up",e),M1({target:t,x:n,y:s}),A1(),kp()}function M1({target:e,x:t,y:n}){Lo.splice(0);let s=null;e instanceof HTMLElement&&(s=e),_d.forEach(r=>{const{element:a,hitAreaMargins:i}=r,c=a.getBoundingClientRect(),{bottom:d,left:u,right:h,top:p}=c,f=NJ?i.coarse:i.fine;if(t>=u-f&&t<=h+f&&n>=p-f&&n<=d+f){if(s!==null&&document.contains(s)&&a!==s&&!a.contains(s)&&!s.contains(a)&&PJ(s,a)>0){let g=s,x=!1;for(;g&&!g.contains(a);){if(TJ(g.getBoundingClientRect(),c)){x=!0;break}g=g.parentElement}if(x)return}Lo.push(r)}})}function Xm(e,t){Qf.set(e,t)}function A1(){let e=!1,t=!1;Lo.forEach(s=>{const{direction:r}=s;r==="horizontal"?e=!0:t=!0});let n=0;Qf.forEach(s=>{n|=s}),e&&t?Jm("intersection",n):e?Jm("horizontal",n):t?Jm("vertical",n):EJ()}function kp(){ha.forEach((e,t)=>{const{body:n}=t;n.removeEventListener("contextmenu",Ki),n.removeEventListener("pointerdown",DC),n.removeEventListener("pointerleave",Wc),n.removeEventListener("pointermove",Wc)}),window.removeEventListener("pointerup",Ki),window.removeEventListener("pointercancel",Ki),_d.size>0&&(Pl?(Lo.length>0&&ha.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("contextmenu",Ki),n.addEventListener("pointerleave",Wc),n.addEventListener("pointermove",Wc))}),window.addEventListener("pointerup",Ki),window.addEventListener("pointercancel",Ki)):ha.forEach((e,t)=>{const{body:n}=t;e>0&&(n.addEventListener("pointerdown",DC,{capture:!0}),n.addEventListener("pointermove",Wc))}))}function Ip(e,t){_d.forEach(n=>{const{setResizeHandlerState:s}=n,r=Lo.includes(n);s(e,r,t)})}function $J(){const[e,t]=Tl(0);return ps(()=>t(n=>n+1),[])}function at(e,t){if(!e)throw console.error(t),Error(t)}const E1=10;function xi(e,t,n=E1){return e.toFixed(n)===t.toFixed(n)?0:e>t?1:-1}function Rr(e,t,n=E1){return xi(e,t,n)===0}function Os(e,t,n){return xi(e,t,n)===0}function FJ(e,t,n){if(e.length!==t.length)return!1;for(let s=0;s<e.length;s++){const r=e[s],a=t[s];if(!Os(r,a,n))return!1}return!0}function Cl({panelConstraints:e,panelIndex:t,size:n}){const s=e[t];at(s!=null,`Panel constraints not found for index ${t}`);let{collapsedSize:r=0,collapsible:a,maxSize:i=100,minSize:c=0}=s;if(xi(n,c)<0)if(a){const d=(r+c)/2;xi(n,d)<0?n=r:n=c}else n=c;return n=Math.min(i,n),n=parseFloat(n.toFixed(E1)),n}function sd({delta:e,initialLayout:t,panelConstraints:n,pivotIndices:s,prevLayout:r,trigger:a}){if(Os(e,0))return t;const i=[...t],[c,d]=s;at(c!=null,"Invalid first pivot index"),at(d!=null,"Invalid second pivot index");let u=0;if(a==="keyboard"){{const p=e<0?d:c,f=n[p];at(f,`Panel constraints not found for index ${p}`);const{collapsedSize:m=0,collapsible:g,minSize:x=0}=f;if(g){const C=t[p];if(at(C!=null,`Previous layout not found for panel index ${p}`),Os(C,m)){const y=x-C;xi(y,Math.abs(e))>0&&(e=e<0?0-y:y)}}}{const p=e<0?c:d,f=n[p];at(f,`No panel constraints found for index ${p}`);const{collapsedSize:m=0,collapsible:g,minSize:x=0}=f;if(g){const C=t[p];if(at(C!=null,`Previous layout not found for panel index ${p}`),Os(C,x)){const y=C-m;xi(y,Math.abs(e))>0&&(e=e<0?0-y:y)}}}}{const p=e<0?1:-1;let f=e<0?d:c,m=0;for(;;){const x=t[f];at(x!=null,`Previous layout not found for panel index ${f}`);const y=Cl({panelConstraints:n,panelIndex:f,size:100})-x;if(m+=y,f+=p,f<0||f>=n.length)break}const g=Math.min(Math.abs(e),Math.abs(m));e=e<0?0-g:g}{let f=e<0?c:d;for(;f>=0&&f<n.length;){const m=Math.abs(e)-Math.abs(u),g=t[f];at(g!=null,`Previous layout not found for panel index ${f}`);const x=g-m,C=Cl({panelConstraints:n,panelIndex:f,size:x});if(!Os(g,C)&&(u+=g-C,i[f]=C,u.toPrecision(3).localeCompare(Math.abs(e).toPrecision(3),void 0,{numeric:!0})>=0))break;e<0?f--:f++}}if(FJ(r,i))return r;{const p=e<0?d:c,f=t[p];at(f!=null,`Previous layout not found for panel index ${p}`);const m=f+u,g=Cl({panelConstraints:n,panelIndex:p,size:m});if(i[p]=g,!Os(g,m)){let x=m-g,y=e<0?d:c;for(;y>=0&&y<n.length;){const v=i[y];at(v!=null,`Previous layout not found for panel index ${y}`);const I=v+x,k=Cl({panelConstraints:n,panelIndex:y,size:I});if(Os(v,k)||(x-=k-v,i[y]=k),Os(x,0))break;e>0?y--:y++}}}const h=i.reduce((p,f)=>f+p,0);return Os(h,100)?i:r}function zJ({layout:e,panelsArray:t,pivotIndices:n}){let s=0,r=100,a=0,i=0;const c=n[0];at(c!=null,"No pivot index found"),t.forEach((p,f)=>{const{constraints:m}=p,{maxSize:g=100,minSize:x=0}=m;f===c?(s=x,r=g):(a+=x,i+=g)});const d=Math.min(r,100-a),u=Math.max(s,100-i),h=e[c];return{valueMax:d,valueMin:u,valueNow:h}}function bi(e,t=document){return Array.from(t.querySelectorAll(`[data-panel-resize-handle-id][data-panel-group-id="${e}"]`))}function DL(e,t,n=document){const r=bi(e,n).findIndex(a=>a.getAttribute("data-panel-resize-handle-id")===t);return r??null}function OL(e,t,n){const s=DL(e,t,n);return s!=null?[s,s+1]:[-1,-1]}function Yf(e,t=document){var n;if(t instanceof HTMLElement&&(t==null||(n=t.dataset)===null||n===void 0?void 0:n.panelGroupId)==e)return t;const s=t.querySelector(`[data-panel-group][data-panel-group-id="${e}"]`);return s||null}function Jf(e,t=document){const n=t.querySelector(`[data-panel-resize-handle-id="${e}"]`);return n||null}function VJ(e,t,n,s=document){var r,a,i,c;const d=Jf(t,s),u=bi(e,s),h=d?u.indexOf(d):-1,p=(r=(a=n[h])===null||a===void 0?void 0:a.id)!==null&&r!==void 0?r:null,f=(i=(c=n[h+1])===null||c===void 0?void 0:c.id)!==null&&i!==void 0?i:null;return[p,f]}function HJ({committedValuesRef:e,eagerValuesRef:t,groupId:n,layout:s,panelDataArray:r,panelGroupElement:a,setLayout:i}){bs({didWarnAboutMissingResizeHandle:!1}),di(()=>{if(!a)return;const c=bi(n,a);for(let d=0;d<r.length-1;d++){const{valueMax:u,valueMin:h,valueNow:p}=zJ({layout:s,panelsArray:r,pivotIndices:[d,d+1]}),f=c[d];if(f!=null){const m=r[d];at(m,`No panel data found for index "${d}"`),f.setAttribute("aria-controls",m.id),f.setAttribute("aria-valuemax",""+Math.round(u)),f.setAttribute("aria-valuemin",""+Math.round(h)),f.setAttribute("aria-valuenow",p!=null?""+Math.round(p):"")}}return()=>{c.forEach((d,u)=>{d.removeAttribute("aria-controls"),d.removeAttribute("aria-valuemax"),d.removeAttribute("aria-valuemin"),d.removeAttribute("aria-valuenow")})}},[n,s,r,a]),ci(()=>{if(!a)return;const c=t.current;at(c,"Eager values not found");const{panelDataArray:d}=c,u=Yf(n,a);at(u!=null,`No group found for id "${n}"`);const h=bi(n,a);at(h,`No resize handles found for group id "${n}"`);const p=h.map(f=>{const m=f.getAttribute("data-panel-resize-handle-id");at(m,"Resize handle element has no handle id attribute");const[g,x]=VJ(n,m,d,a);if(g==null||x==null)return()=>{};const C=y=>{if(!y.defaultPrevented)switch(y.key){case"Enter":{y.preventDefault();const v=d.findIndex(I=>I.id===g);if(v>=0){const I=d[v];at(I,`No panel data found for index ${v}`);const k=s[v],{collapsedSize:M=0,collapsible:_,minSize:A=0}=I.constraints;if(k!=null&&_){const D=sd({delta:Os(k,M)?A-M:M-k,initialLayout:s,panelConstraints:d.map(N=>N.constraints),pivotIndices:OL(n,m,a),prevLayout:s,trigger:"keyboard"});s!==D&&i(D)}}break}}};return f.addEventListener("keydown",C),()=>{f.removeEventListener("keydown",C)}});return()=>{p.forEach(f=>f())}},[a,e,t,n,s,r,i])}function OC(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function NL(e,t){const n=e==="horizontal",{x:s,y:r}=Kf(t);return n?s:r}function WJ(e,t,n,s,r){const a=n==="horizontal",i=Jf(t,r);at(i,`No resize handle element found for id "${t}"`);const c=i.getAttribute("data-panel-group-id");at(c,"Resize handle element has no group id attribute");let{initialCursorPosition:d}=s;const u=NL(n,e),h=Yf(c,r);at(h,`No group element found for id "${c}"`);const p=h.getBoundingClientRect(),f=a?p.width:p.height;return(u-d)/f*100}function GJ(e,t,n,s,r,a){if(_L(e)){const i=n==="horizontal";let c=0;e.shiftKey?c=100:r!=null?c=r:c=10;let d=0;switch(e.key){case"ArrowDown":d=i?0:c;break;case"ArrowLeft":d=i?-c:0;break;case"ArrowRight":d=i?c:0;break;case"ArrowUp":d=i?0:-c;break;case"End":d=100;break;case"Home":d=-100;break}return d}else return s==null?0:WJ(e,t,n,s,a)}function UJ({panelDataArray:e}){const t=Array(e.length),n=e.map(a=>a.constraints);let s=0,r=100;for(let a=0;a<e.length;a++){const i=n[a];at(i,`Panel constraints not found for index ${a}`);const{defaultSize:c}=i;c!=null&&(s++,t[a]=c,r-=c)}for(let a=0;a<e.length;a++){const i=n[a];at(i,`Panel constraints not found for index ${a}`);const{defaultSize:c}=i;if(c!=null)continue;const d=e.length-s,u=r/d;s++,t[a]=u,r-=u}return t}function Qi(e,t,n){t.forEach((s,r)=>{const a=e[r];at(a,`Panel data not found for index ${r}`);const{callbacks:i,constraints:c,id:d}=a,{collapsedSize:u=0,collapsible:h}=c,p=n[d];if(p==null||s!==p){n[d]=s;const{onCollapse:f,onExpand:m,onResize:g}=i;g&&g(s,p),h&&(f||m)&&(m&&(p==null||Rr(p,u))&&!Rr(s,u)&&m(),f&&(p==null||!Rr(p,u))&&Rr(s,u)&&f())}})}function ch(e,t){if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!=t[n])return!1;return!0}function ZJ({defaultSize:e,dragState:t,layout:n,panelData:s,panelIndex:r,precision:a=3}){const i=n[r];let c;return i==null?c=e!=null?e.toPrecision(a):"1":s.length===1?c="1":c=i.toPrecision(a),{flexBasis:0,flexGrow:c,flexShrink:1,overflow:"hidden",pointerEvents:t!==null?"none":void 0}}function qJ(e,t=10){let n=null;return(...r)=>{n!==null&&clearTimeout(n),n=setTimeout(()=>{e(...r)},t)}}function NC(e){try{if(typeof localStorage<"u")e.getItem=t=>localStorage.getItem(t),e.setItem=(t,n)=>{localStorage.setItem(t,n)};else throw new Error("localStorage not supported in this environment")}catch(t){console.error(t),e.getItem=()=>null,e.setItem=()=>{}}}function BL(e){return`react-resizable-panels:${e}`}function $L(e){return e.map(t=>{const{constraints:n,id:s,idIsFromProps:r,order:a}=t;return r?s:a?`${a}:${JSON.stringify(n)}`:JSON.stringify(n)}).sort((t,n)=>t.localeCompare(n)).join(",")}function FL(e,t){try{const n=BL(e),s=t.getItem(n);if(s){const r=JSON.parse(s);if(typeof r=="object"&&r!=null)return r}}catch{}return null}function KJ(e,t,n){var s,r;const a=(s=FL(e,n))!==null&&s!==void 0?s:{},i=$L(t);return(r=a[i])!==null&&r!==void 0?r:null}function QJ(e,t,n,s,r){var a;const i=BL(e),c=$L(t),d=(a=FL(e,r))!==null&&a!==void 0?a:{};d[c]={expandToSizes:Object.fromEntries(n.entries()),layout:s};try{r.setItem(i,JSON.stringify(d))}catch(u){console.error(u)}}function BC({layout:e,panelConstraints:t}){const n=[...e],s=n.reduce((a,i)=>a+i,0);if(n.length!==t.length)throw Error(`Invalid ${t.length} panel layout: ${n.map(a=>`${a}%`).join(", ")}`);if(!Os(s,100)&&n.length>0)for(let a=0;a<t.length;a++){const i=n[a];at(i!=null,`No layout data found for index ${a}`);const c=100/s*i;n[a]=c}let r=0;for(let a=0;a<t.length;a++){const i=n[a];at(i!=null,`No layout data found for index ${a}`);const c=Cl({panelConstraints:t,panelIndex:a,size:i});i!=c&&(r+=i-c,n[a]=c)}if(!Os(r,0))for(let a=0;a<t.length;a++){const i=n[a];at(i!=null,`No layout data found for index ${a}`);const c=i+r,d=Cl({panelConstraints:t,panelIndex:a,size:c});if(i!==d&&(r-=d-i,n[a]=d,Os(r,0)))break}return n}const YJ=100,od={getItem:e=>(NC(od),od.getItem(e)),setItem:(e,t)=>{NC(od),od.setItem(e,t)}},$C={};function zL({autoSaveId:e=null,children:t,className:n="",direction:s,forwardedRef:r,id:a=null,onLayout:i=null,keyboardResizeBy:c=null,storage:d=od,style:u,tagName:h="div",...p}){const f=_1(a),m=bs(null),[g,x]=Tl(null),[C,y]=Tl([]),v=$J(),I=bs({}),k=bs(new Map),M=bs(0),_=bs({autoSaveId:e,direction:s,dragState:g,id:f,keyboardResizeBy:c,onLayout:i,storage:d}),A=bs({layout:C,panelDataArray:[],panelDataArrayChanged:!1});bs({didLogIdAndOrderWarning:!1,didLogPanelConstraintsWarning:!1,prevPanelIds:[]}),kL(r,()=>({getId:()=>_.current.id,getLayout:()=>{const{layout:F}=A.current;return F},setLayout:F=>{const{onLayout:Z}=_.current,{layout:B,panelDataArray:K}=A.current,$=BC({layout:F,panelConstraints:K.map(Y=>Y.constraints)});OC(B,$)||(y($),A.current.layout=$,Z&&Z($),Qi(K,$,I.current))}}),[]),di(()=>{_.current.autoSaveId=e,_.current.direction=s,_.current.dragState=g,_.current.id=f,_.current.onLayout=i,_.current.storage=d}),HJ({committedValuesRef:_,eagerValuesRef:A,groupId:f,layout:C,panelDataArray:A.current.panelDataArray,setLayout:y,panelGroupElement:m.current}),ci(()=>{const{panelDataArray:F}=A.current;if(e){if(C.length===0||C.length!==F.length)return;let Z=$C[e];Z==null&&(Z=qJ(QJ,YJ),$C[e]=Z);const B=[...F],K=new Map(k.current);Z(e,B,K,C,d)}},[e,C,d]),ci(()=>{});const D=ps(F=>{const{onLayout:Z}=_.current,{layout:B,panelDataArray:K}=A.current;if(F.constraints.collapsible){const $=K.map(Re=>Re.constraints),{collapsedSize:Y=0,panelSize:ae,pivotIndices:ue}=Ga(K,F,B);if(at(ae!=null,`Panel size not found for panel "${F.id}"`),!Rr(ae,Y)){k.current.set(F.id,ae);const we=ol(K,F)===K.length-1?ae-Y:Y-ae,De=sd({delta:we,initialLayout:B,panelConstraints:$,pivotIndices:ue,prevLayout:B,trigger:"imperative-api"});ch(B,De)||(y(De),A.current.layout=De,Z&&Z(De),Qi(K,De,I.current))}}},[]),N=ps((F,Z)=>{const{onLayout:B}=_.current,{layout:K,panelDataArray:$}=A.current;if(F.constraints.collapsible){const Y=$.map(Me=>Me.constraints),{collapsedSize:ae=0,panelSize:ue=0,minSize:Re=0,pivotIndices:we}=Ga($,F,K),De=Z??Re;if(Rr(ue,ae)){const Me=k.current.get(F.id),ht=Me!=null&&Me>=De?Me:De,We=ol($,F)===$.length-1?ue-ht:ht-ue,T=sd({delta:We,initialLayout:K,panelConstraints:Y,pivotIndices:we,prevLayout:K,trigger:"imperative-api"});ch(K,T)||(y(T),A.current.layout=T,B&&B(T),Qi($,T,I.current))}}},[]),P=ps(F=>{const{layout:Z,panelDataArray:B}=A.current,{panelSize:K}=Ga(B,F,Z);return at(K!=null,`Panel size not found for panel "${F.id}"`),K},[]),z=ps((F,Z)=>{const{panelDataArray:B}=A.current,K=ol(B,F);return ZJ({defaultSize:Z,dragState:g,layout:C,panelData:B,panelIndex:K})},[g,C]),W=ps(F=>{const{layout:Z,panelDataArray:B}=A.current,{collapsedSize:K=0,collapsible:$,panelSize:Y}=Ga(B,F,Z);return at(Y!=null,`Panel size not found for panel "${F.id}"`),$===!0&&Rr(Y,K)},[]),X=ps(F=>{const{layout:Z,panelDataArray:B}=A.current,{collapsedSize:K=0,collapsible:$,panelSize:Y}=Ga(B,F,Z);return at(Y!=null,`Panel size not found for panel "${F.id}"`),!$||xi(Y,K)>0},[]),ee=ps(F=>{const{panelDataArray:Z}=A.current;Z.push(F),Z.sort((B,K)=>{const $=B.order,Y=K.order;return $==null&&Y==null?0:$==null?-1:Y==null?1:$-Y}),A.current.panelDataArrayChanged=!0,v()},[v]);di(()=>{if(A.current.panelDataArrayChanged){A.current.panelDataArrayChanged=!1;const{autoSaveId:F,onLayout:Z,storage:B}=_.current,{layout:K,panelDataArray:$}=A.current;let Y=null;if(F){const ue=KJ(F,$,B);ue&&(k.current=new Map(Object.entries(ue.expandToSizes)),Y=ue.layout)}Y==null&&(Y=UJ({panelDataArray:$}));const ae=BC({layout:Y,panelConstraints:$.map(ue=>ue.constraints)});OC(K,ae)||(y(ae),A.current.layout=ae,Z&&Z(ae),Qi($,ae,I.current))}}),di(()=>{const F=A.current;return()=>{F.layout=[]}},[]);const G=ps(F=>function(B){B.preventDefault();const K=m.current;if(!K)return()=>null;const{direction:$,dragState:Y,id:ae,keyboardResizeBy:ue,onLayout:Re}=_.current,{layout:we,panelDataArray:De}=A.current,{initialLayout:Me}=Y??{},ht=OL(ae,F,K);let st=GJ(B,F,$,Y,ue,K);const We=$==="horizontal";document.dir==="rtl"&&We&&(st=-st);const T=De.map(de=>de.constraints),H=sd({delta:st,initialLayout:Me??we,panelConstraints:T,pivotIndices:ht,prevLayout:we,trigger:_L(B)?"keyboard":"mouse-or-touch"}),q=!ch(we,H);(ML(B)||AL(B))&&M.current!=st&&(M.current=st,!q&&st!==0?We?Xm(F,st<0?LL:TL):Xm(F,st<0?PL:RL):Xm(F,0)),q&&(y(H),A.current.layout=H,Re&&Re(H),Qi(De,H,I.current))},[]),re=ps((F,Z)=>{const{onLayout:B}=_.current,{layout:K,panelDataArray:$}=A.current,Y=$.map(Me=>Me.constraints),{panelSize:ae,pivotIndices:ue}=Ga($,F,K);at(ae!=null,`Panel size not found for panel "${F.id}"`);const we=ol($,F)===$.length-1?ae-Z:Z-ae,De=sd({delta:we,initialLayout:K,panelConstraints:Y,pivotIndices:ue,prevLayout:K,trigger:"imperative-api"});ch(K,De)||(y(De),A.current.layout=De,B&&B(De),Qi($,De,I.current))},[]),le=ps((F,Z)=>{const{layout:B,panelDataArray:K}=A.current,{collapsedSize:$=0,collapsible:Y}=Z,{collapsedSize:ae=0,collapsible:ue,maxSize:Re=100,minSize:we=0}=F.constraints,{panelSize:De}=Ga(K,F,B);De!=null&&(Y&&ue&&Rr(De,$)?Rr($,ae)||re(F,ae):De<we?re(F,we):De>Re&&re(F,Re))},[re]),Ce=ps((F,Z)=>{const{direction:B}=_.current,{layout:K}=A.current;if(!m.current)return;const $=Jf(F,m.current);at($,`Drag handle element not found for id "${F}"`);const Y=NL(B,Z);x({dragHandleId:F,dragHandleRect:$.getBoundingClientRect(),initialCursorPosition:Y,initialLayout:K})},[]),be=ps(()=>{x(null)},[]),ye=ps(F=>{const{panelDataArray:Z}=A.current,B=ol(Z,F);B>=0&&(Z.splice(B,1),delete I.current[F.id],A.current.panelDataArrayChanged=!0,v())},[v]),ne=kJ(()=>({collapsePanel:D,direction:s,dragState:g,expandPanel:N,getPanelSize:P,getPanelStyle:z,groupId:f,isPanelCollapsed:W,isPanelExpanded:X,reevaluatePanelConstraints:le,registerPanel:ee,registerResizeHandle:G,resizePanel:re,startDragging:Ce,stopDragging:be,unregisterPanel:ye,panelGroupElement:m.current}),[D,g,s,N,P,z,f,W,X,le,ee,G,re,Ce,be,ye]),R={display:"flex",flexDirection:s==="horizontal"?"row":"column",height:"100%",overflow:"hidden",width:"100%"};return Yl(qf.Provider,{value:ne},Yl(h,{...p,children:t,className:n,id:a,ref:m,style:{...R,...u},"data-panel-group":"","data-panel-group-direction":s,"data-panel-group-id":f}))}const Lu=jL((e,t)=>Yl(zL,{...e,forwardedRef:t}));zL.displayName="PanelGroup";Lu.displayName="forwardRef(PanelGroup)";function ol(e,t){return e.findIndex(n=>n===t||n.id===t.id)}function Ga(e,t,n){const s=ol(e,t),a=s===e.length-1?[s-1,s]:[s,s+1],i=n[s];return{...t.constraints,panelSize:i,pivotIndices:a}}function JJ({disabled:e,handleId:t,resizeHandler:n,panelGroupElement:s}){ci(()=>{if(e||n==null||s==null)return;const r=Jf(t,s);if(r==null)return;const a=i=>{if(!i.defaultPrevented)switch(i.key){case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"End":case"Home":{i.preventDefault(),n(i);break}case"F6":{i.preventDefault();const c=r.getAttribute("data-panel-group-id");at(c,`No group element found for id "${c}"`);const d=bi(c,s),u=DL(c,t,s);at(u!==null,`No resize element found for id "${t}"`);const h=i.shiftKey?u>0?u-1:d.length-1:u+1<d.length?u+1:0;d[h].focus();break}}};return r.addEventListener("keydown",a),()=>{r.removeEventListener("keydown",a)}},[s,e,t,n])}function VL({children:e=null,className:t="",disabled:n=!1,hitAreaMargins:s,id:r,onBlur:a,onDragging:i,onFocus:c,style:d={},tabIndex:u=0,tagName:h="div",...p}){var f,m;const g=bs(null),x=bs({onDragging:i});ci(()=>{x.current.onDragging=i});const C=SL(qf);if(C===null)throw Error("PanelResizeHandle components must be rendered within a PanelGroup container");const{direction:y,groupId:v,registerResizeHandle:I,startDragging:k,stopDragging:M,panelGroupElement:_}=C,A=_1(r),[D,N]=Tl("inactive"),[P,z]=Tl(!1),[W,X]=Tl(null),ee=bs({state:D});di(()=>{ee.current.state=D}),ci(()=>{if(n)X(null);else{const Ce=I(A);X(()=>Ce)}},[n,A,I]);const G=(f=s==null?void 0:s.coarse)!==null&&f!==void 0?f:15,re=(m=s==null?void 0:s.fine)!==null&&m!==void 0?m:5;return ci(()=>{if(n||W==null)return;const Ce=g.current;return at(Ce,"Element ref not attached"),BJ(A,Ce,y,{coarse:G,fine:re},(ye,ne,R)=>{if(ne)switch(ye){case"down":{N("drag"),at(R,'Expected event to be defined for "down" action'),k(A,R);const{onDragging:F}=x.current;F&&F(!0);break}case"move":{const{state:F}=ee.current;F!=="drag"&&N("hover"),at(R,'Expected event to be defined for "move" action'),W(R);break}case"up":{N("hover"),M();const{onDragging:F}=x.current;F&&F(!1);break}}else N("inactive")})},[G,y,n,re,I,A,W,k,M]),JJ({disabled:n,handleId:A,resizeHandler:W,panelGroupElement:_}),Yl(h,{...p,children:e,className:t,id:r,onBlur:()=>{z(!1),a==null||a()},onFocus:()=>{z(!0),c==null||c()},ref:g,role:"separator",style:{...{touchAction:"none",userSelect:"none"},...d},tabIndex:u,"data-panel-group-direction":y,"data-panel-group-id":v,"data-resize-handle":"","data-resize-handle-active":D==="drag"?"pointer":P?"keyboard":void 0,"data-resize-handle-state":D,"data-panel-resize-handle-enabled":!n,"data-panel-resize-handle-id":A})}VL.displayName="PanelResizeHandle";const XJ=Kd(VL),eX=e=>o.jsx(XJ,{...e,sx:tX}),Md=l.memo(eX),tX={'&[data-resize-handle-state="hover"]':{_before:{background:"base.600 !important"}},'&[data-resize-handle-state="drag"]':{_before:{background:"base.500 !important"}},'&[data-panel-group-direction="horizontal"]':{w:4,h:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"normal",content:'""',w:"2px",h:"full",background:"base.800",position:"absolute",left:"50%",top:0,transform:"translateX(-50%)"}},'&[data-panel-group-direction="vertical"]':{h:4,w:"full",position:"relative",_before:{transitionProperty:"background",transitionDuration:"normal",content:'""',w:"full",h:"2px",background:"base.800",position:"absolute",top:"50%",left:0,transform:"translateY(-50%)"}}},HL=l.memo(({firstImage:e,secondImage:t})=>{const n=l.useRef(null),s=l.useCallback(()=>{n.current&&n.current.setLayout([50,50])},[]);return o.jsx(j,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:o.jsx(j,{w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:o.jsxs(Lu,{ref:n,direction:"horizontal",id:"image-comparison-side-by-side",autoSaveId:"image-comparison-side-by-side",children:[o.jsx(or,{minSize:20,children:o.jsx(j,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:o.jsxs(j,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:e.width/e.height,children:[o.jsx(nn,{id:"image-comparison-side-by-side-first-image",w:e.width,h:e.height,maxW:"full",maxH:"full",src:e.image_url,fallbackSrc:e.thumbnail_url,objectFit:"contain",borderRadius:"base"}),o.jsx(gi,{type:"first"})]})})}),o.jsx(Md,{id:"image-comparison-side-by-side-handle",onDoubleClick:s}),o.jsx(or,{minSize:20,children:o.jsx(j,{position:"relative",w:"full",h:"full",alignItems:"center",justifyContent:"center",children:o.jsxs(j,{position:"absolute",maxW:"full",maxH:"full",aspectRatio:t.width/t.height,children:[o.jsx(nn,{id:"image-comparison-side-by-side-first-image",w:t.width,h:t.height,maxW:"full",maxH:"full",src:t.image_url,fallbackSrc:t.thumbnail_url,objectFit:"contain",borderRadius:"base"}),o.jsx(gi,{type:"second"})]})})})]})})})});HL.displayName="ImageComparisonSideBySide";const WL="50%",L1=2,nX=`${L1}px`,Xf=20,sX=`${Xf}px`,oX=`${Xf/2-L1/2}px`,rX=`calc(${WL} - ${Xf/2}px)`,GL=l.memo(({firstImage:e,secondImage:t,containerDims:n})=>{const s=w(Hx),[r,a]=l.useState(rX),[i,c]=l.useState(WL),d=l.useRef(null),u=l.useRef(null),h=l.useRef(null),p=l.useRef(0),f=l.useMemo(()=>bL(n,e),[n,e]),m=l.useMemo(()=>yL(s,f,e,t),[s,f,e,t]),g=l.useCallback(v=>{if(!d.current||!u.current)return;p.current=performance.now();const{x:I,width:k}=u.current.getBoundingClientRect(),M=(v-I)*100/k,_=L1*100/k,A=Math.min(100-_,Math.max(0,M));c(`${A}%`),a(`calc(${A}% - ${Xf/2}px)`)},[]),x=l.useCallback(v=>{h.current===null&&performance.now()>p.current+1e3/60&&(h.current=window.requestAnimationFrame(()=>{g(v.clientX),h.current=null}))},[g]),C=l.useCallback(()=>{window.removeEventListener("mousemove",x)},[x]),y=l.useCallback(v=>{g(v.clientX),window.addEventListener("mouseup",C,{once:!0}),window.addEventListener("mousemove",x)},[x,C,g]);return l.useEffect(()=>()=>{h.current!==null&&cancelAnimationFrame(h.current)},[]),o.jsx(j,{w:"full",h:"full",maxW:"full",maxH:"full",position:"relative",alignItems:"center",justifyContent:"center",children:o.jsx(j,{id:"image-comparison-wrapper",w:"full",h:"full",maxW:"full",maxH:"full",position:"absolute",alignItems:"center",justifyContent:"center",children:o.jsxs(xe,{ref:u,position:"relative",id:"image-comparison-image-container",w:f.width,h:f.height,maxW:"full",maxH:"full",userSelect:"none",overflow:"hidden",borderRadius:"base",children:[o.jsx(xe,{id:"image-comparison-bg",position:"absolute",top:0,left:0,right:0,bottom:0,backgroundImage:Pf,backgroundRepeat:"repeat"}),o.jsx(nn,{position:"relative",id:"image-comparison-second-image",src:t.image_url,fallbackSrc:t.thumbnail_url,w:m.width,h:m.height,maxW:f.width,maxH:f.height,objectFit:s,objectPosition:"top left"}),o.jsx(gi,{type:"second"}),o.jsxs(xe,{id:"image-comparison-first-image-container",position:"absolute",top:0,left:0,right:0,bottom:0,w:i,overflow:"hidden",children:[o.jsx(nn,{id:"image-comparison-first-image",src:e.image_url,fallbackSrc:e.thumbnail_url,w:f.width,h:f.height,objectFit:"cover",objectPosition:"top left"}),o.jsx(gi,{type:"first"})]}),o.jsxs(j,{id:"image-comparison-handle",ref:d,position:"absolute",top:0,bottom:0,left:r,w:sX,cursor:"ew-resize",filter:D0,opacity:.8,color:"base.50",children:[o.jsx(xe,{id:"image-comparison-handle-divider",w:nX,h:"full",bg:"currentColor",shadow:"dark-lg",position:"absolute",top:0,left:oX}),o.jsxs(j,{id:"image-comparison-handle-icons",gap:4,position:"absolute",left:"50%",top:"50%",transform:"translate(-50%, 0)",filter:D0,children:[o.jsx(it,{as:Tb}),o.jsx(it,{as:Pb})]})]}),o.jsx(xe,{id:"image-comparison-interaction-overlay",position:"absolute",top:0,right:0,bottom:0,left:0,onMouseDown:y,onContextMenu:CL,userSelect:"none",cursor:"ew-resize"})]})})})});GL.displayName="ImageComparisonSlider";const UL=l.memo(({containerDims:e})=>{const{t}=S(),n=w(eS),{firstImage:s,secondImage:r}=w(vL);if(!s||!r)return o.jsx(Mt,{label:t("gallery.selectAnImageToCompare"),icon:BI});if(n==="slider")return o.jsx(GL,{containerDims:e,firstImage:s,secondImage:r});if(n==="side-by-side")return o.jsx(HL,{containerDims:e,firstImage:s,secondImage:r});if(n==="hover")return o.jsx(wL,{containerDims:e,firstImage:s,secondImage:r})});UL.displayName="ImageComparison";const ZL=l.memo(()=>{const{t:e}=S(),{firstImage:t,secondImage:n}=w(vL),s=l.useMemo(()=>({id:"image-comparison",actionType:"SELECT_FOR_COMPARE",context:{firstImageName:t==null?void 0:t.image_name,secondImageName:n==null?void 0:n.image_name}}),[t==null?void 0:t.image_name,n==null?void 0:n.image_name]);return o.jsx(j,{position:"absolute",top:0,right:0,bottom:0,left:0,gap:2,pointerEvents:"none",children:o.jsx(tr,{data:s,dropLabel:e("gallery.selectForCompare")})})});ZL.displayName="ImageComparisonDroppable";const qL=l.memo(()=>{const e=E(),t=w(sS),n=w(Fd),{t:s}=S(),{currentData:r}=Gr((n==null?void 0:n.image_name)??Kn),a=l.useCallback(()=>e(MO(!t)),[e,t]);return Ie({id:"toggleMetadata",category:"viewer",callback:a,options:{enabled:!!r},dependencies:[r,t]}),o.jsx(Q,{icon:o.jsx(Li,{}),tooltip:`${s("parameters.info")} (I)`,"aria-label":`${s("parameters.info")} (I)`,onClick:a,isDisabled:!r,variant:"outline",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-metadata-button"})});qL.displayName="ToggleMetadataViewerButton";const KL=l.memo(()=>{const e=E(),t=w(Gx),{t:n}=S(),s=l.useCallback(()=>{e(oS(!t))},[e,t]);return o.jsx(Q,{"aria-label":n("settings.displayInProgress"),tooltip:n("settings.displayInProgress"),icon:o.jsx(YW,{}),onClick:s,variant:"outline",colorScheme:t?"invokeBlue":"base","data-testid":"toggle-show-progress-button"})});KL.displayName="ToggleProgressButton";const QL=l.memo(e=>{const{onClick:t,isDisabled:n}=e,{t:s}=S(),r=se(On),a=w(bj),i=`${s("gallery.deleteImage",{count:a})} (Del)`;return o.jsx(Q,{onClick:t,icon:o.jsx(Hs,{}),tooltip:i,"aria-label":i,isDisabled:n||!r,colorScheme:"error"})});QL.displayName="DeleteImageButton";const aX=()=>{const{t:e}=S(),[t,{isLoading:n}]=_u(),s=w(rS),r=E(),a=l.useMemo(()=>{var f;if(!(!t.length||!s))return(f=t.find(m=>m.key===(s==null?void 0:s.key)))==null?void 0:f.description},[t,s]),i=l.useCallback(f=>{r(AO(f))},[r]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=jc({modelConfigs:t,onChange:i,selectedModel:s,isLoading:n});return o.jsxs(V,{orientation:"vertical",children:[o.jsx(U,{children:e("upscaling.postProcessingModel")}),o.jsx(Ae,{label:a,children:o.jsx(xe,{w:"full",children:o.jsx(Ne,{value:d,placeholder:h,options:c,onChange:u,noOptionsMessage:p,isDisabled:c.length===0})})})]})},iX=l.memo(aX),lX=()=>{const[e,{isLoading:t}]=Sx({fixedCacheKey:"enqueueBatch"}),[n,{isLoading:s}]=aS({fixedCacheKey:"resumeProcessor"}),[r,{isLoading:a}]=iS({fixedCacheKey:"pauseProcessor"}),[i,{isLoading:c}]=jx({fixedCacheKey:"cancelQueueItem"}),[d,{isLoading:u}]=ej({fixedCacheKey:"clearQueue"}),[h,{isLoading:p}]=lS({fixedCacheKey:"pruneQueue"});return t||s||a||c||u||p},YL=l.memo(e=>{const{imageDTO:t}=e,n=E(),s=w(rS),r=lX(),{t:a}=S(),{isOpen:i,onOpen:c,onClose:d}=Is(),u=l.useCallback(()=>{d(),t&&n(Zw({imageDTO:t}))},[n,t,d]);return o.jsxs(Qn,{isOpen:i,onClose:d,isLazy:!0,children:[o.jsx(ds,{children:o.jsx(Q,{tooltip:a("parameters.postProcessing"),onClick:c,icon:o.jsx(vu,{}),"aria-label":a("parameters.postProcessing")})}),o.jsx(Yn,{children:o.jsx(Jn,{w:96,children:o.jsxs(j,{flexDirection:"column",gap:4,children:[o.jsx(iX,{}),!s&&o.jsx(cX,{}),o.jsx(me,{size:"sm",isDisabled:!t||r||!s,onClick:u,children:a("parameters.processImage")})]})})})]})});YL.displayName="PostProcessingPopover";const cX=()=>{const e=E(),t=l.useCallback(()=>{e(Tt("models")),mi.set(3)},[e]);return o.jsx(j,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:o.jsx(O,{children:o.jsx(Cs,{i18nKey:"upscaling.postProcessingMissingModelWarning",components:{LinkComponent:o.jsx(me,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:t})}})})})},dX=()=>{const e=w(Fd),{currentData:t}=Gr((e==null?void 0:e.image_name)??Kn);return t?o.jsx(JL,{imageDTO:t}):null},uX=l.memo(dX),JL=l.memo(({imageDTO:e})=>{const{t}=S(),n=se(bx),s=Ib(e),r=w(Pn),a=dn("upscaling");return o.jsxs(o.Fragment,{children:[o.jsx(Tn,{children:o.jsxs(Ta,{isLazy:!0,children:[o.jsx(Pa,{as:Q,"aria-label":t("parameters.imageActions"),tooltip:t("parameters.imageActions"),isDisabled:!e,icon:o.jsx(Nb,{})}),o.jsx(Un,{children:e&&o.jsx(dM,{imageDTO:e})})]})}),o.jsxs(Tn,{children:[o.jsx(Q,{icon:o.jsx(of,{}),tooltip:`${t("nodes.loadWorkflow")} (W)`,"aria-label":`${t("nodes.loadWorkflow")} (W)`,isDisabled:!s.hasWorkflow||!n,onClick:s.loadWorkflow}),o.jsx(Q,{icon:o.jsx(sf,{}),tooltip:`${t("parameters.remixImage")} (R)`,"aria-label":`${t("parameters.remixImage")} (R)`,isDisabled:!s.hasMetadata,onClick:s.remix}),o.jsx(Q,{icon:o.jsx(UI,{}),tooltip:`${t("parameters.usePrompt")} (P)`,"aria-label":`${t("parameters.usePrompt")} (P)`,isDisabled:!s.hasPrompts,onClick:s.recallPrompts}),o.jsx(Q,{icon:o.jsx(WI,{}),tooltip:`${t("parameters.useSeed")} (S)`,"aria-label":`${t("parameters.useSeed")} (S)`,isDisabled:!s.hasSeed,onClick:s.recallSeed}),o.jsx(Q,{icon:o.jsx(lG,{}),tooltip:`${t("parameters.useSize")} (D)`,"aria-label":`${t("parameters.useSize")} (D)`,onClick:s.recallSize,isDisabled:r}),o.jsx(Q,{icon:o.jsx(EI,{}),tooltip:`${t("parameters.useAll")} (A)`,"aria-label":`${t("parameters.useAll")} (A)`,isDisabled:!s.hasMetadata,onClick:s.recallAll})]}),a&&o.jsx(Tn,{children:o.jsx(YL,{imageDTO:e})}),o.jsx(Tn,{children:o.jsx(QL,{onClick:s.delete})})]})});JL.displayName="CurrentImageButtonsContent";const XL=l.memo(({closeButton:e})=>o.jsxs(j,{w:"full",gap:2,children:[o.jsx(j,{flex:1,justifyContent:"center",children:o.jsxs(j,{gap:2,marginInlineEnd:"auto",children:[o.jsx(KL,{}),o.jsx(qL,{})]})}),o.jsx(j,{flex:1,gap:2,justifyContent:"center",children:o.jsx(uX,{})}),o.jsx(j,{flex:1,justifyContent:"center",children:o.jsx(j,{gap:2,marginInlineStart:"auto",children:e})})]}));XL.displayName="ViewerToolbar";var hX=function(){},eT=typeof window<"u",pX=eT?l.useLayoutEffect:l.useEffect,tT={x:0,y:0,width:0,height:0,top:0,left:0,bottom:0,right:0};function fX(){var e=l.useState(null),t=e[0],n=e[1],s=l.useState(tT),r=s[0],a=s[1],i=l.useMemo(function(){return new window.ResizeObserver(function(c){if(c[0]){var d=c[0].contentRect,u=d.x,h=d.y,p=d.width,f=d.height,m=d.top,g=d.left,x=d.bottom,C=d.right;a({x:u,y:h,width:p,height:f,top:m,left:g,bottom:x,right:C})}})},[]);return pX(function(){if(t)return i.observe(t),function(){i.disconnect()}},[t]),[n,r]}const nT=eT&&typeof window.ResizeObserver<"u"?fX:function(){return[hX,tT]},mX={focusOnMount:!0},em=l.memo(({closeButton:e})=>{wt("ImageViewer");const t=w(EO),[n,s]=nT(),r=l.useRef(null);return Oa("viewer",r,mX),o.jsxs(j,{ref:r,tabIndex:-1,layerStyle:"first",p:2,borderRadius:"base",position:"absolute",flexDirection:"column",top:0,right:0,bottom:0,left:0,rowGap:4,alignItems:"center",justifyContent:"center",children:[t&&o.jsx(HE,{}),!t&&o.jsx(XL,{closeButton:e}),o.jsxs(xe,{ref:n,w:"full",h:"full",children:[!t&&o.jsx(yJ,{}),t&&o.jsx(UL,{containerDims:s})]}),o.jsx(ZL,{}),o.jsx(xe,{position:"absolute",top:14,insetInlineEnd:2,children:o.jsx(tq,{})})]})});em.displayName="ImageViewer";const sT=l.memo(()=>jt().isOpen?o.jsx(em,{closeButton:o.jsx(T1,{})}):null);sT.displayName="GatedImageViewer";const T1=l.memo(()=>{const{t:e}=S(),t=jt();return wt("ImageViewerCloseButton"),lo("esc",t.close),o.jsx(Q,{tooltip:e("gallery.closeViewer"),"aria-label":e("gallery.closeViewer"),icon:o.jsx(sn,{}),variant:"ghost",onClick:t.close})});T1.displayName="ImageViewerCloseButton";const gX=l.memo(()=>jt().isOpen?o.jsx(T1,{}):null);gX.displayName="GatedImageViewerCloseButton";const FC=()=>o.jsx(Jo,{children:o.jsxs(Un,{children:[o.jsx(iA,{}),o.jsx(dA,{})]})}),oT=l.memo(()=>{const e=l.useRef(null),t=w(qh),n=w(LO),s=l.useCallback(()=>o.jsx(FC,{}),[]);return Oa("canvas",e),o.jsxs(j,{tabIndex:-1,ref:e,borderRadius:"base",position:"relative",flexDirection:"column",height:"full",width:"full",gap:2,alignItems:"center",justifyContent:"center",children:[o.jsx(Jo,{children:o.jsx(FE,{})}),o.jsx(Up,{renderMenu:s,withLongPress:!1,children:r=>o.jsxs(j,{ref:r,position:"relative",w:"full",h:"full",bg:t?"base.850":"base.900",borderRadius:"base",children:[o.jsx(BA,{}),o.jsxs(Jo,{children:[n&&o.jsx(j,{position:"absolute",top:1,insetInlineStart:1,pointerEvents:"none",children:o.jsx(LA,{})}),o.jsxs(j,{flexDir:"column",position:"absolute",top:1,insetInlineEnd:1,pointerEvents:"none",gap:2,children:[o.jsx(nA,{}),o.jsx(QM,{}),o.jsx(XZ,{})]}),o.jsx(j,{position:"absolute",top:1,insetInlineEnd:1,children:o.jsxs(Ta,{children:[o.jsx(Pa,{as:Q,icon:o.jsx(wG,{}),colorScheme:"base"}),o.jsx(FC,{})]})})]})]})}),o.jsx(j,{position:"absolute",bottom:4,gap:2,align:"center",justify:"center",children:o.jsx(Jo,{children:o.jsx($A,{children:o.jsx(qA,{})})})}),o.jsx(j,{position:"absolute",bottom:4,children:o.jsxs(Jo,{children:[o.jsx(MA,{}),o.jsx(AQ,{})]})}),o.jsx(uA,{}),o.jsx(sT,{})]})});oT.displayName="CanvasMainPanelContent";const rT=l.memo(()=>{const{t:e}=S(),t=Zx(),n=qx(),s=Kx(),r=Qx(),a=Yx(),i=cS(),c=w(Ia);return o.jsx(j,{w:"full",h:"full",justifyContent:"center",gap:4,children:o.jsxs(j,{position:"relative",flexDir:"column",gap:4,top:"20%",children:[o.jsxs(j,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[o.jsx(Ct,{size:"xs",children:e("controlLayers.global")}),o.jsx(me,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:o.jsx(Bt,{}),onClick:a,isDisabled:c,children:e("controlLayers.globalReferenceImage")})]}),o.jsxs(j,{flexDir:"column",gap:2,children:[o.jsx(Ct,{size:"xs",children:e("controlLayers.regional")}),o.jsx(me,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:o.jsx(Bt,{}),onClick:t,children:e("controlLayers.inpaintMask")}),o.jsx(me,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:o.jsx(Bt,{}),onClick:n,isDisabled:c,children:e("controlLayers.regionalGuidance")}),o.jsx(me,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:o.jsx(Bt,{}),onClick:i,isDisabled:c,children:e("controlLayers.regionalReferenceImage")})]}),o.jsxs(j,{flexDir:"column",justifyContent:"flex-start",gap:2,children:[o.jsx(Ct,{size:"xs",children:e("controlLayers.layer_other")}),o.jsx(me,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:o.jsx(Bt,{}),onClick:r,children:e("controlLayers.controlLayer")}),o.jsx(me,{size:"sm",variant:"ghost",justifyContent:"flex-start",leftIcon:o.jsx(Bt,{}),onClick:s,children:e("controlLayers.rasterLayer")})]})]})})});rT.displayName="CanvasAddEntityButtons";const aT=l.memo(({type:e})=>{const{t}=S(),n=Ht(),s=Zx(),r=qx(),a=Kx(),i=Qx(),c=Yx(),d=l.useCallback(()=>{switch(e){case"inpaint_mask":s();break;case"regional_guidance":r();break;case"raster_layer":a();break;case"control_layer":i();break;case"reference_image":c();break}},[i,c,s,a,r,e]),u=l.useMemo(()=>{switch(e){case"inpaint_mask":return t("controlLayers.addInpaintMask");case"regional_guidance":return t("controlLayers.addRegionalGuidance");case"raster_layer":return t("controlLayers.addRasterLayer");case"control_layer":return t("controlLayers.addControlLayer");case"reference_image":return t("controlLayers.addGlobalReferenceImage")}},[e,t]);return o.jsx(Q,{size:"sm","aria-label":u,tooltip:u,variant:"link",icon:o.jsx(xl,{}),onClick:d,alignSelf:"stretch",isDisabled:n})});aT.displayName="CanvasEntityAddOfTypeButton";const iT=e=>{const t=l.useMemo(()=>pe(Je,s=>{switch(e){case"control_layer":return s.controlLayers.entities.length;case"raster_layer":return s.rasterLayers.entities.length;case"inpaint_mask":return s.inpaintMasks.entities.length;case"regional_guidance":return s.regionalGuidance.entities.length;case"reference_image":return s.referenceImages.entities.length;default:return 0}}),[e]);return w(t)},eg=Do("canvas"),lT=l.memo(({type:e})=>{const{t}=S(),n=E(),s=At(),r=Ht(),a=iT(e),i=l.useCallback(async()=>{if(e==="raster_layer"){const c=s.stage.getVisibleRect("raster_layer"),d=await ss(()=>s.compositor.rasterizeAndUploadCompositeRasterLayer(c,{is_intermediate:!0}));d.isOk()?(n(Op({isSelected:!0,overrides:{objects:[Nr(d.value)],position:{x:Math.floor(c.x),y:Math.floor(c.y)}},isMergingVisible:!0})),he({title:t("controlLayers.mergeVisibleOk")})):(eg.error({error:ya(d.error)},"Failed to merge visible"),he({title:t("controlLayers.mergeVisibleError"),status:"error"}))}else if(e==="inpaint_mask"){const c=s.stage.getVisibleRect("inpaint_mask"),d=await ss(()=>s.compositor.rasterizeAndUploadCompositeInpaintMask(c,!1));d.isOk()?(n(TO({isSelected:!0,overrides:{objects:[Nr(d.value)],position:{x:Math.floor(c.x),y:Math.floor(c.y)}},isMergingVisible:!0})),he({title:t("controlLayers.mergeVisibleOk")})):(eg.error({error:ya(d.error)},"Failed to merge visible"),he({title:t("controlLayers.mergeVisibleError"),status:"error"}))}else eg.error({type:e},"Unsupported type for merge visible")},[s.compositor,s.stage,n,t,e]);return o.jsx(Q,{size:"sm","aria-label":t("controlLayers.mergeVisible"),tooltip:t("controlLayers.mergeVisible"),variant:"link",icon:o.jsx(fG,{}),onClick:i,alignSelf:"stretch",isDisabled:a<=1||r})});lT.displayName="CanvasEntityMergeVisibleButton";const xX=(e,t=!1)=>{const{t:n}=S();return l.useMemo(()=>{switch(e){case"control_layer":return n(t?"controlLayers.controlLayer_withCount_other":"controlLayers.controlLayer");case"raster_layer":return n(t?"controlLayers.rasterLayer_withCount_other":"controlLayers.rasterLayer");case"inpaint_mask":return n(t?"controlLayers.inpaintMask_withCount_other":"controlLayers.inpaintMask");case"regional_guidance":return n(t?"controlLayers.regionalGuidance_withCount_other":"controlLayers.regionalGuidance");case"reference_image":return n(t?"controlLayers.globalReferenceImage_withCount_other":"controlLayers.globalReferenceImage");default:return""}},[e,t,n])},cT=l.memo(({type:e})=>{const{t}=S(),n=E(),s=u1(e),r=xX(e,!0),a=l.useCallback(i=>{i.stopPropagation(),n(PO({type:e}))},[n,e]);return o.jsx(Q,{size:"sm","aria-label":t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:r}),tooltip:t(s?"controlLayers.hidingType":"controlLayers.showingType",{type:r}),variant:"link",icon:s?o.jsx(GW,{}):o.jsx(yu,{}),onClick:a,alignSelf:"stretch"})});cT.displayName="CanvasEntityTypeIsHiddenToggle";const bX=e=>{const{t}=S(),n=u1(e),s=iT(e);return l.useMemo(()=>{const a=n?"hidden":"visible";switch(e){case"control_layer":return t("controlLayers.controlLayers_withCount",{count:s,context:a});case"raster_layer":return t("controlLayers.rasterLayers_withCount",{count:s,context:a});case"inpaint_mask":return t("controlLayers.inpaintMasks_withCount",{count:s,context:a});case"regional_guidance":return t("controlLayers.regionalGuidance_withCount",{count:s,context:a});case"reference_image":return t("controlLayers.globalReferenceImages_withCount",{count:s,context:a});default:return""}},[e,t,s,n])},_c=l.memo(({isSelected:e,type:t,children:n})=>{const s=bX(t),r=Jd(!0),a=l.useMemo(()=>t==="raster_layer"||t==="inpaint_mask",[t]),i=l.useMemo(()=>t!=="reference_image",[t]);return o.jsxs(j,{flexDir:"column",w:"full",children:[o.jsxs(j,{w:"full",children:[o.jsxs(j,{flexGrow:1,as:me,onClick:r.toggle,justifyContent:"space-between",alignItems:"center",gap:3,variant:"unstyled",p:0,h:8,children:[o.jsx(it,{boxSize:4,as:Fo,transform:r.isTrue?void 0:"rotate(-90deg)",fill:e?"base.200":"base.500",transitionProperty:"common",transitionDuration:"fast"}),o.jsx(O,{fontWeight:"semibold",color:e?"base.200":"base.500",userSelect:"none",transitionProperty:"common",transitionDuration:"fast",children:s}),o.jsx(dt,{})]}),a&&o.jsx(lT,{type:t}),i&&o.jsx(cT,{type:t}),o.jsx(aT,{type:t})]}),o.jsx(Mi,{in:r.isTrue,children:o.jsx(j,{flexDir:"column",gap:2,pt:2,children:n})})]})});_c.displayName="CanvasEntityGroupList";const dT=e=>{const t=l.useMemo(()=>pe(un,s=>(s==null?void 0:s.id)===e.id),[e.id]);return w(t)},yX=e=>{const t=l.useMemo(()=>pe(Je,s=>{const r=rc(s,e);return r&&(r.type==="inpaint_mask"||r.type==="regional_guidance")?Hr(r.fill.color):"base.400"}),[e]);return w(t)},Mc=l.memo(e=>{const t=E(),n=ut(),s=dT(n),r=yX(n),a=l.useCallback(()=>{s||t(kl({entityIdentifier:n}))},[t,n,s]);return o.jsx(j,{position:"relative",flexDir:"column",w:"full",bg:s?"base.800":"base.850",onClick:a,borderInlineStartWidth:5,borderColor:s?r:"base.800",borderRadius:"base",children:e.children})});Mc.displayName="CanvasEntityContainer";const vX=(e,{id:t,type:n})=>n==="raster_layer"?{index:e.rasterLayers.entities.findIndex(s=>s.id===t),count:e.rasterLayers.entities.length}:n==="control_layer"?{index:e.controlLayers.entities.findIndex(s=>s.id===t),count:e.controlLayers.entities.length}:n==="regional_guidance"?{index:e.regionalGuidance.entities.findIndex(s=>s.id===t),count:e.regionalGuidance.entities.length}:n==="inpaint_mask"?{index:e.inpaintMasks.entities.findIndex(s=>s.id===t),count:e.inpaintMasks.entities.length}:n==="reference_image"?{index:e.referenceImages.entities.findIndex(s=>s.id===t),count:e.referenceImages.entities.length}:{index:-1,count:0},Ac=l.memo(()=>{const{t:e}=S(),t=E(),n=ut(),s=Yr(n),r=l.useMemo(()=>pt(Je,h=>{const{index:p,count:f}=vX(h,n);return{canMoveForwardOne:p<f-1,canMoveBackwardOne:p>0,canMoveToFront:p<f-1,canMoveToBack:p>0}}),[n]),a=w(r),i=l.useCallback(()=>{t(RO({entityIdentifier:n}))},[t,n]),c=l.useCallback(()=>{t(DO({entityIdentifier:n}))},[t,n]),d=l.useCallback(()=>{t(OO({entityIdentifier:n}))},[t,n]),u=l.useCallback(()=>{t(NO({entityIdentifier:n}))},[t,n]);return o.jsxs(o.Fragment,{children:[o.jsx(so,{"aria-label":e("controlLayers.moveToFront"),tooltip:e("controlLayers.moveToFront"),onClick:c,isDisabled:!a.canMoveToFront||!s,icon:o.jsx(MW,{})}),o.jsx(so,{"aria-label":e("controlLayers.moveForward"),tooltip:e("controlLayers.moveForward"),onClick:i,isDisabled:!a.canMoveForwardOne||!s,icon:o.jsx(AI,{})}),o.jsx(so,{"aria-label":e("controlLayers.moveBackward"),tooltip:e("controlLayers.moveBackward"),onClick:d,isDisabled:!a.canMoveBackwardOne||!s,icon:o.jsx(kW,{})}),o.jsx(so,{"aria-label":e("controlLayers.moveToBack"),tooltip:e("controlLayers.moveToBack"),onClick:u,isDisabled:!a.canMoveToBack||!s,icon:o.jsx(_W,{})})]})});Ac.displayName="CanvasEntityMenuItemsArrange";const Ec=l.memo(()=>{const{t:e}=S(),t=E(),n=ut(),s=Yr(n),r=l.useCallback(()=>{t(dS({entityIdentifier:n}))},[t,n]);return o.jsx(so,{"aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),onClick:r,icon:o.jsx(QI,{}),isDisabled:!s})});Ec.displayName="CanvasEntityMenuItemsDuplicate";const uT=l.memo(()=>{const{t:e}=S(),t=E(),n=ut("control_layer"),s=Yr(n),r=l.useCallback(()=>{t(BO({entityIdentifier:n}))},[t,n]);return o.jsx(_e,{onClick:r,icon:o.jsx($I,{}),isDisabled:!s,children:e("controlLayers.convertToRasterLayer")})});uT.displayName="ControlLayerMenuItemsConvertControlToRaster";const hT=l.memo(()=>{const{t:e}=S(),t=E(),n=ut("control_layer"),s=Yr(n),r=l.useMemo(()=>pe(Je,c=>io(c,n).withTransparencyEffect),[n]),a=w(r),i=l.useCallback(()=>{t($O({entityIdentifier:n}))},[t,n]);return o.jsx(_e,{onClick:i,icon:o.jsx(VW,{}),isDisabled:!s,children:e(a?"controlLayers.disableTransparencyEffect":"controlLayers.enableTransparencyEffect")})});hT.displayName="ControlLayerMenuItemsTransparencyEffect";const pT=l.memo(()=>o.jsxs(o.Fragment,{children:[o.jsxs(Su,{children:[o.jsx(Ac,{}),o.jsx(Ec,{}),o.jsx(Pi,{asIcon:!0})]}),o.jsx(qn,{}),o.jsx(wc,{}),o.jsx(Mf,{}),o.jsx(uT,{}),o.jsx(hT,{}),o.jsx(qn,{}),o.jsx(Cc,{}),o.jsx(If,{}),o.jsx(Af,{})]}));pT.displayName="ControlLayerMenuItems";const fT=l.memo(()=>o.jsxs(o.Fragment,{children:[o.jsxs(Su,{children:[o.jsx(Ac,{}),o.jsx(Ec,{}),o.jsx(Pi,{asIcon:!0})]}),o.jsx(qn,{}),o.jsx(wc,{}),o.jsx(qn,{}),o.jsx(Cc,{})]}));fT.displayName="InpaintMaskMenuItems";const mT=l.memo(()=>o.jsxs(Su,{children:[o.jsx(Ac,{}),o.jsx(Ec,{}),o.jsx(Pi,{asIcon:!0})]}));mT.displayName="IPAdapterMenuItems";const gT=l.memo(()=>{const{t:e}=S(),t=E(),n=ut("raster_layer"),s=w(Ij),r=Yr(n),a=l.useCallback(()=>{t(FO({entityIdentifier:n,overrides:{controlAdapter:s}}))},[s,t,n]);return o.jsx(_e,{onClick:a,icon:o.jsx($I,{}),isDisabled:!r,children:e("controlLayers.convertToControlLayer")})});gT.displayName="RasterLayerMenuItemsConvertRasterToControl";const xT=l.memo(()=>o.jsxs(o.Fragment,{children:[o.jsxs(Su,{children:[o.jsx(Ac,{}),o.jsx(Ec,{}),o.jsx(Pi,{asIcon:!0})]}),o.jsx(qn,{}),o.jsx(wc,{}),o.jsx(Mf,{}),o.jsx(gT,{}),o.jsx(qn,{}),o.jsx(Cc,{}),o.jsx(If,{}),o.jsx(Af,{})]}));xT.displayName="RasterLayerMenuItems";const bT=l.memo(()=>{const e=ut("regional_guidance"),{t}=S(),n=Ht(),s=uS(e),r=hS(e),a=pS(e),i=l.useMemo(()=>fS(e),[e]),c=w(i);return o.jsxs(o.Fragment,{children:[o.jsx(_e,{onClick:r,isDisabled:!c.canAddPositivePrompt||n,children:t("controlLayers.addPositivePrompt")}),o.jsx(_e,{onClick:a,isDisabled:!c.canAddNegativePrompt||n,children:t("controlLayers.addNegativePrompt")}),o.jsx(_e,{onClick:s,isDisabled:n,children:t("controlLayers.addReferenceImage")})]})});bT.displayName="RegionalGuidanceMenuItemsExtra";const yT=l.memo(()=>{const e=ut("regional_guidance"),{t}=S(),n=E(),s=l.useMemo(()=>pe(Je,i=>io(i,e).autoNegative),[e]),r=w(s),a=l.useCallback(()=>{n(zO({entityIdentifier:e}))},[n,e]);return o.jsx(_e,{icon:o.jsx(cG,{}),onClick:a,children:t(r?"controlLayers.disableAutoNegative":"controlLayers.enableAutoNegative")})});yT.displayName="RegionalGuidanceMenuItemsAutoNegative";const vT=l.memo(()=>o.jsxs(o.Fragment,{children:[o.jsxs(j,{gap:2,children:[o.jsx(Ac,{}),o.jsx(Ec,{}),o.jsx(Pi,{asIcon:!0})]}),o.jsx(qn,{}),o.jsx(bT,{}),o.jsx(qn,{}),o.jsx(wc,{}),o.jsx(yT,{}),o.jsx(qn,{}),o.jsx(Cc,{})]}));vT.displayName="RegionalGuidanceMenuItems";const Lc=l.memo(({children:e,...t})=>{const n=ut(),s=l.useCallback(()=>{if(n.type==="regional_guidance")return o.jsx(Un,{children:o.jsx(vT,{})});if(n.type==="inpaint_mask")return o.jsx(Un,{children:o.jsx(fT,{})});if(n.type==="raster_layer")return o.jsx(Un,{children:o.jsx(xT,{})});if(n.type==="control_layer")return o.jsx(Un,{children:o.jsx(pT,{})});if(n.type==="reference_image")return o.jsx(Un,{children:o.jsx(mT,{})});Fe(!1,"Unhandled entity type")},[n]);return o.jsx(Up,{renderMenu:s,children:r=>o.jsx(j,{ref:r,gap:2,alignItems:"center",p:2,...t,children:e})})});Lc.displayName="CanvasEntityHeader";const CT=l.memo(()=>{const{t:e}=S(),t=ut(),n=E(),s=Ht(),r=l.useCallback(()=>{n(Bx({entityIdentifier:t}))},[n,t]);return o.jsx(Q,{size:"sm","aria-label":e("common.delete"),tooltip:e("common.delete"),variant:"link",alignSelf:"stretch",icon:o.jsx(bc,{}),onClick:r,colorScheme:"error",isDisabled:s})});CT.displayName="CanvasEntityDeleteButton";const CX=e=>{const t=l.useMemo(()=>pe(Je,s=>{const r=rc(s,e);return r?r.isEnabled:!1}),[e]);return w(t)},wT=l.memo(()=>{const{t:e}=S(),t=ut(),n=CX(t),s=Ht(),r=E(),a=l.useCallback(()=>{r(VO({entityIdentifier:t}))},[r,t]);return o.jsx(Q,{size:"sm","aria-label":e(n?"common.enabled":"common.disabled"),tooltip:e(n?"common.enabled":"common.disabled"),variant:"link",alignSelf:"stretch",icon:n?o.jsx(vG,{}):o.jsx(OW,{}),onClick:a,isDisabled:s})});wT.displayName="CanvasEntityEnabledToggle";const wX=e=>{const t=l.useMemo(()=>pe(Je,s=>{var r;return((r=s.bookmarkedEntityIdentifier)==null?void 0:r.id)===e.id}),[e]);return w(t)},jT=l.memo(()=>{const{t:e}=S(),t=ut(),n=wX(t),s=E(),r=l.useCallback(()=>{s(n?Gy({entityIdentifier:null}):Gy({entityIdentifier:t}))},[s,t,n]);return o.jsx(Q,{size:"sm","aria-label":e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),tooltip:e(n?"controlLayers.removeBookmark":"controlLayers.bookmark"),variant:"link",alignSelf:"stretch",icon:n?o.jsx(yG,{}):o.jsx(TW,{}),onClick:r})});jT.displayName="CanvasEntityIsBookmarkedForQuickSwitchToggle";const jX=e=>{const t=l.useMemo(()=>pe(Je,s=>{const r=rc(s,e);return r?r.isLocked:!1}),[e]);return w(t)},ST=l.memo(()=>{const{t:e}=S(),t=ut(),n=jX(t),s=Ht(),r=E(),a=l.useCallback(()=>{r(HO({entityIdentifier:t}))},[r,t]);return o.jsx(Q,{size:"sm","aria-label":e(n?"controlLayers.locked":"controlLayers.unlocked"),tooltip:e(n?"controlLayers.locked":"controlLayers.unlocked"),variant:"link",alignSelf:"stretch",icon:n?o.jsx(JI,{}):o.jsx(FI,{}),onClick:a,isDisabled:s})});ST.displayName="CanvasEntityIsLockedToggle";const Tc=l.memo(()=>{const e=ut();return o.jsxs(j,{alignSelf:"stretch",children:[o.jsx(jT,{}),e.type!=="reference_image"&&o.jsx(ST,{}),o.jsx(wT,{}),o.jsx(CT,{})]})});Tc.displayName="CanvasEntityHeaderCommonActions";const SX=Kd.canvas,kX=36,zC=`${kX}px`,Tu=l.memo(()=>{const e=ut(),t=KZ(e),n=l.useMemo(()=>pe(Je,u=>{const h=rc(u,e);return h&&(h.type==="inpaint_mask"||h.type==="regional_guidance")?Hr(h.fill.color):null}),[e]),s=WO(n),r=l.useRef(null),a=se(t.transformer.$pixelRect),i=se(t.transformer.$nodeRect),c=se(t.$canvasCache),d=l.useMemo(()=>Ai(()=>{if(!r.current)return;const u=r.current.getContext("2d");if(!u)return;const h=t.transformer.$pixelRect.get(),p=t.transformer.$nodeRect.get(),f=t.$canvasCache.get();if(!f||f.width===0||f.height===0){u.clearRect(0,0,r.current.width,r.current.height);return}u.clearRect(0,0,r.current.width,r.current.height),r.current.width=h.width,r.current.height=h.height;const m=h.x-p.x,g=h.y-p.y,x=h.width,C=h.height,y=0,v=0,I=h.width,k=h.height;u.drawImage(f,m,g,x,C,y,v,I,k),s&&(u.fillStyle=s,u.globalCompositeOperation="source-in",u.fillRect(0,0,h.width,h.height))},300),[t.$canvasCache,t.transformer.$nodeRect,t.transformer.$pixelRect,s]);return l.useEffect(d,[d,c,i,a]),o.jsxs(j,{position:"relative",alignItems:"center",justifyContent:"center",w:zC,h:zC,borderRadius:"sm",borderWidth:1,bg:"base.900",flexShrink:0,children:[o.jsx(xe,{position:"absolute",top:0,right:0,bottom:0,left:0,bgImage:Pf,bgSize:"5px"}),o.jsx(SX,{position:"relative",ref:r,objectFit:"contain",maxW:"full",maxH:"full"})]})});Tu.displayName="CanvasEntityPreviewImage";const tm=l.memo(({children:e})=>o.jsx(j,{flexDir:"column",gap:2,px:2,pb:2,children:e}));tm.displayName="CanvasEntitySettingsWrapper";const kT=l.memo(e=>{const t=ut(),n=dT(t),s=kf(t);return o.jsx(O,{size:"sm",fontWeight:"semibold",userSelect:"none",color:n?"base.100":"base.300",...e,children:s})});kT.displayName="CanvasEntityTitle";const Pc=l.memo(()=>{const e=E(),t=ut(),n=kf(t),s=Jd(!1),[r,a]=l.useState(n),i=l.useRef(null),c=l.useCallback(h=>{a(h.target.value)},[]),d=l.useCallback(()=>{const h=r.trim();h.length===0?e(Uy({entityIdentifier:t,name:null})):h!==n&&e(Uy({entityIdentifier:t,name:h})),s.setFalse()},[e,t,s,r,n]),u=l.useCallback(h=>{h.key==="Enter"?d():h.key==="Escape"&&(a(n),s.setFalse())},[s,d,n]);return l.useEffect(()=>{var h,p;s.isTrue&&((h=i.current)==null||h.focus(),(p=i.current)==null||p.select())},[s.isTrue]),s.isTrue?o.jsx(Vt,{ref:i,value:r,onChange:c,onBlur:d,onKeyDown:u,variant:"outline",_focusVisible:{borderWidth:1,borderColor:"invokeBlueAlpha.400",borderRadius:"base"}}):o.jsx(kT,{cursor:"text",onDoubleClick:s.setTrue})});Pc.displayName="CanvasEntityTitleEdit";const IT=l.memo(()=>{const e=ut("control_layer"),{t}=S(),n=w(s=>io(Je(s),e).withTransparencyEffect);return o.jsx(o.Fragment,{children:n&&o.jsx(Rn,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.transparency")})})});IT.displayName="ControlLayerBadges";const IX=e=>`${Math.round(e*100)}%`,_X=["Begin Step %","End Step %"],nm=l.memo(({beginEndStepPct:e,onChange:t})=>{const{t:n}=S(),s=l.useCallback(()=>{t([0,1])},[t]);return o.jsxs(V,{orientation:"horizontal",pe:2,children:[o.jsx(Be,{feature:"controlNetBeginEnd",children:o.jsx(U,{m:0,children:n("controlLayers.beginEndStepPercentShort")})}),o.jsx(GO,{"aria-label":_X,value:e,onChange:t,onReset:s,min:0,max:1,step:.05,fineStep:.01,minStepsBetweenThumbs:1,formatValue:IX,marks:!0,withThumbTooltip:!0})]})});nm.displayName="BeginEndStepPct";const MX=e=>e.toFixed(2),AX=[0,1,2],EX=pe(Gs,e=>e.sd.ca.weight),sm=l.memo(({weight:e,onChange:t})=>{const{t:n}=S(),s=w(EX);return o.jsxs(V,{orientation:"horizontal",children:[o.jsx(Be,{feature:"controlNetWeight",children:o.jsx(U,{m:0,children:n("controlLayers.weight")})}),o.jsx(qe,{value:e,onChange:t,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,marks:AX,formatValue:MX}),o.jsx(Ve,{value:e,onChange:t,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,maxW:20,defaultValue:s.initial})]})});sm.displayName="Weight";const _T=l.memo(({controlMode:e,onChange:t})=>{const{t:n}=S(),s=l.useMemo(()=>[{label:n("controlLayers.controlMode.balanced"),value:"balanced"},{label:n("controlLayers.controlMode.prompt"),value:"more_prompt"},{label:n("controlLayers.controlMode.control"),value:"more_control"},{label:n("controlLayers.controlMode.megaControl"),value:"unbalanced"}],[n]),r=l.useCallback(i=>{Fe(UO(i==null?void 0:i.value)),t(i.value)},[t]),a=l.useMemo(()=>s.filter(i=>i.value===e)[0],[s,e]);return e?o.jsxs(V,{children:[o.jsx(Be,{feature:"controlNetControlMode",children:o.jsx(U,{m:0,children:n("controlLayers.controlMode.controlMode")})}),o.jsx(Ne,{value:a,options:s,onChange:r,isClearable:!1,isSearchable:!1})]}):null});_T.displayName="ControlLayerControlAdapterControlMode";const LX=e=>e.base.toUpperCase(),TX=e=>`${e.base.toUpperCase()} / ${e.type.replaceAll("_"," ").toUpperCase()}`,PX=pe(sc,e=>{var t;return((t=e.model)==null?void 0:t.base)??"sdxl"}),vn=e=>{const{t}=S(),n=w(PX),{modelConfigs:s,selectedModel:r,getIsDisabled:a,onChange:i,isLoading:c,groupByType:d=!1}=e,u=l.useMemo(()=>{if(!s)return[];const g=ZO(s,d?TX:LX),x=qO(g,(C,y,v)=>(C.push({label:v,options:y.map(I=>({label:I.name,value:I.key,isDisabled:a?a(I):!1}))}),C),[]);return x.sort(C=>{var y,v;return(v=(y=C.label)==null?void 0:y.split("/")[0])!=null&&v.toLowerCase().includes(n)?-1:1}),x},[s,d,a,n]),h=l.useMemo(()=>u.flatMap(g=>g.options).find(g=>r?g.value===r.key:!1)??null,[u,r]),p=l.useCallback(g=>{if(!g){i(null);return}const x=s.find(C=>C.key===g.value);if(!x){i(null);return}i(x)},[s,i]),f=l.useMemo(()=>c?t("common.loading"):u.length===0?t("models.noModelsAvailable"):t("models.selectModel"),[c,u,t]),m=l.useCallback(()=>t("models.noMatchingModels"),[t]);return{options:u,value:h,onChange:p,placeholder:f,noOptionsMessage:m}},MT=l.memo(({modelKey:e,onChange:t})=>{const{t:n}=S(),s=w(nu),[r,{isLoading:a}]=PZ(),i=l.useMemo(()=>r.find(m=>m.key===e),[r,e]),c=l.useCallback(m=>{m&&t(m)},[t]),d=l.useCallback(m=>{const g=s===m.base;return!!!s||!g},[s]),{options:u,value:h,onChange:p,noOptionsMessage:f}=vn({modelConfigs:r,onChange:c,selectedModel:i,getIsDisabled:d,isLoading:a,groupByType:!0});return o.jsx(Ae,{label:i==null?void 0:i.description,children:o.jsx(V,{isInvalid:!h||s!==(i==null?void 0:i.base),w:"full",children:o.jsx(Ne,{options:u,placeholder:n("common.placeholderSelectAModel"),value:h,onChange:p,noOptionsMessage:f})})})});MT.displayName="ControlLayerControlAdapterModel";const RX=e=>{const t=l.useMemo(()=>XO(Je,s=>io(s,e).controlAdapter),[e]);return w(t)},AT=l.memo(()=>{var g;const{t:e}=S(),t=E(),n=ut("control_layer"),s=RX(n),r=_f(n),a=w(Ia),i=l.useCallback(x=>{t(KO({entityIdentifier:n,beginEndStepPct:x}))},[t,n]),c=l.useCallback(x=>{t(QO({entityIdentifier:n,controlMode:x}))},[t,n]),d=l.useCallback(x=>{t(YO({entityIdentifier:n,weight:x}))},[t,n]),u=l.useCallback(x=>{t(JO({entityIdentifier:n,modelConfig:x}))},[t,n]),h=iq(n),p=Ht(),f=l.useMemo(()=>({type:"REPLACE_LAYER_WITH_IMAGE",entityIdentifier:n}),[n]),m=v1({postUploadAction:f});return o.jsxs(j,{flexDir:"column",gap:3,position:"relative",w:"full",children:[o.jsxs(j,{w:"full",gap:2,children:[o.jsx(MT,{modelKey:((g=s.model)==null?void 0:g.key)??null,onChange:u}),o.jsx(Q,{onClick:r.start,isDisabled:r.isDisabled,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:o.jsx(af,{})}),o.jsx(Q,{onClick:h,isDisabled:p,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("controlLayers.pullBboxIntoLayer"),tooltip:e("controlLayers.pullBboxIntoLayer"),icon:o.jsx(fc,{})}),o.jsx(Q,{isDisabled:p,size:"sm",alignSelf:"stretch",variant:"link","aria-label":e("accessibility.uploadImage"),tooltip:e("accessibility.uploadImage"),icon:o.jsx(qI,{}),...m.getUploadButtonProps()}),o.jsx("input",{...m.getUploadInputProps()})]}),o.jsx(sm,{weight:s.weight,onChange:d}),o.jsx(nm,{beginEndStepPct:s.beginEndStepPct,onChange:i}),s.type==="controlnet"&&!a&&o.jsx(_T,{controlMode:s.controlMode,onChange:c})]})});AT.displayName="ControlLayerControlAdapter";const ET=l.memo(({id:e})=>{const{t}=S(),n=l.useMemo(()=>({id:e,type:"control_layer"}),[e]),s=l.useMemo(()=>({id:e,actionType:"REPLACE_LAYER_WITH_IMAGE",context:{entityIdentifier:n}}),[e,n]);return o.jsx(Ti.Provider,{value:n,children:o.jsx(JM,{children:o.jsxs(Mc,{children:[o.jsxs(Lc,{children:[o.jsx(Tu,{}),o.jsx(Pc,{}),o.jsx(dt,{}),o.jsx(IT,{}),o.jsx(Tc,{})]}),o.jsx(tm,{children:o.jsx(AT,{})}),o.jsx(tr,{data:s,dropLabel:t("controlLayers.replaceLayer")})]})})})});ET.displayName="ControlLayer";const DX=pt(Je,e=>e.controlLayers.entities.map(su).reverse()),OX=pe(un,e=>(e==null?void 0:e.type)==="control_layer"),LT=l.memo(()=>{const e=w(OX),t=w(DX);if(t.length===0)return null;if(t.length>0)return o.jsx(_c,{type:"control_layer",isSelected:e,children:t.map(n=>o.jsx(ET,{id:n},n))})});LT.displayName="ControlLayerEntityList";const TT=l.memo(({id:e})=>{const t=l.useMemo(()=>({id:e,type:"inpaint_mask"}),[e]);return o.jsx(Ti.Provider,{value:t,children:o.jsx(XM,{children:o.jsx(Mc,{children:o.jsxs(Lc,{children:[o.jsx(Tu,{}),o.jsx(Pc,{}),o.jsx(dt,{}),o.jsx(Tc,{})]})})})})});TT.displayName="InpaintMask";const NX=pt(Je,e=>e.inpaintMasks.entities.map(su).reverse()),BX=pe(un,e=>(e==null?void 0:e.type)==="inpaint_mask"),PT=l.memo(()=>{const e=w(BX),t=w(NX);if(t.length===0)return null;if(t.length>0)return o.jsx(_c,{type:"inpaint_mask",isSelected:e,children:t.map(n=>o.jsx(TT,{id:n},n))})});PT.displayName="InpaintMaskList";const P1=l.memo(({method:e,onChange:t})=>{const{t:n}=S(),s=l.useMemo(()=>[{label:n("controlLayers.ipAdapterMethod.full"),value:"full"},{label:n("controlLayers.ipAdapterMethod.style"),value:"style"},{label:n("controlLayers.ipAdapterMethod.composition"),value:"composition"}],[n]),r=l.useCallback(i=>{Fe(e3(i==null?void 0:i.value)),t(i.value)},[t]),a=l.useMemo(()=>s.find(i=>i.value===e),[s,e]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"ipAdapterMethod",children:o.jsx(U,{children:n("controlLayers.ipAdapterMethod.ipAdapterMethod")})}),o.jsx(Ne,{value:a,options:s,onChange:r})]})});P1.displayName="IPAdapterMethod";const $X=e=>l.useMemo(()=>Te(e),[e]),R1=l.memo(({image:e,onChangeImage:t,droppableData:n,postUploadAction:s})=>{const{t:r}=S(),a=se(On),i=$X("ip_adapter_image_preview"),{currentData:c,isError:d}=Gr((e==null?void 0:e.image_name)??Kn),u=l.useCallback(()=>{t(null)},[t]),h=l.useMemo(()=>{if(c)return{id:i,payloadType:"IMAGE_DTO",payload:{imageDTO:c}}},[c,i]);return l.useEffect(()=>{a&&d&&u()},[u,a,d]),o.jsxs(j,{position:"relative",w:"full",h:"full",alignItems:"center",borderColor:"error.500",borderStyle:"solid",borderWidth:c?0:1,borderRadius:"base",children:[o.jsx(Di,{draggableData:h,droppableData:n,imageDTO:c,postUploadAction:s}),c&&o.jsx(j,{position:"absolute",flexDir:"column",top:2,insetInlineEnd:2,gap:1,children:o.jsx(Ic,{onClick:u,icon:o.jsx(Kr,{size:16}),tooltip:r("common.reset")})})]})});R1.displayName="IPAdapterImagePreview";const VC=[{label:"ViT-H",value:"ViT-H"},{label:"ViT-G",value:"ViT-G"}],D1=l.memo(({modelKey:e,onChangeModel:t,clipVisionModel:n,onChangeCLIPVisionModel:s})=>{const{t:r}=S(),a=w(nu),[i,{isLoading:c}]=c1(),d=l.useMemo(()=>i.find(y=>y.key===e),[i,e]),u=l.useCallback(y=>{y&&t(y)},[t]),h=l.useCallback(y=>{Fe(t3(y==null?void 0:y.value)),s(y.value)},[s]),p=l.useCallback(y=>{const v=a===y.base;return!!!a||!v},[a]),{options:f,value:m,onChange:g,noOptionsMessage:x}=vn({modelConfigs:i,onChange:u,selectedModel:d,getIsDisabled:p,isLoading:c}),C=l.useMemo(()=>VC.find(y=>y.value===n),[n]);return o.jsxs(j,{gap:2,children:[o.jsx(Ae,{label:d==null?void 0:d.description,children:o.jsx(V,{isInvalid:!m||a!==(d==null?void 0:d.base),w:"full",children:o.jsx(Ne,{options:f,placeholder:r("common.placeholderSelectAModel"),value:m,onChange:g,noOptionsMessage:x})})}),(d==null?void 0:d.format)==="checkpoint"&&o.jsx(V,{isInvalid:!m||a!==(d==null?void 0:d.base),width:"max-content",minWidth:28,children:o.jsx(Ne,{options:VC,placeholder:r("common.placeholderSelectAModel"),value:C,onChange:h})})]})});D1.displayName="IPAdapterModel";const RT=l.memo(()=>{var x;const{t:e}=S(),t=E(),n=ut("reference_image"),s=l.useMemo(()=>pe(Je,C=>io(C,n).ipAdapter),[n]),r=w(s),a=l.useCallback(C=>{t(n3({entityIdentifier:n,beginEndStepPct:C}))},[t,n]),i=l.useCallback(C=>{t(s3({entityIdentifier:n,weight:C}))},[t,n]),c=l.useCallback(C=>{t(o3({entityIdentifier:n,method:C}))},[t,n]),d=l.useCallback(C=>{t(r3({entityIdentifier:n,modelConfig:C}))},[t,n]),u=l.useCallback(C=>{t(a3({entityIdentifier:n,clipVisionModel:C}))},[t,n]),h=l.useCallback(C=>{t(Mj({entityIdentifier:n,imageDTO:C}))},[t,n]),p=l.useMemo(()=>({actionType:"SET_IPA_IMAGE",context:{id:n.id},id:n.id}),[n.id]),f=l.useMemo(()=>({type:"SET_IPA_IMAGE",id:n.id}),[n.id]),m=lq(n),g=Ht();return o.jsx(tm,{children:o.jsxs(j,{flexDir:"column",gap:2,position:"relative",w:"full",children:[o.jsxs(j,{gap:2,alignItems:"center",w:"full",children:[o.jsx(xe,{minW:0,w:"full",transitionProperty:"common",transitionDuration:"0.1s",children:o.jsx(D1,{modelKey:((x=r.model)==null?void 0:x.key)??null,onChangeModel:d,clipVisionModel:r.clipVisionModel,onChangeCLIPVisionModel:u})}),o.jsx(Q,{onClick:m,isDisabled:g,variant:"ghost","aria-label":e("controlLayers.pullBboxIntoReferenceImage"),tooltip:e("controlLayers.pullBboxIntoReferenceImage"),icon:o.jsx(fc,{})})]}),o.jsxs(j,{gap:2,w:"full",alignItems:"center",children:[o.jsxs(j,{flexDir:"column",gap:2,w:"full",children:[o.jsx(P1,{method:r.method,onChange:c}),o.jsx(sm,{weight:r.weight,onChange:i}),o.jsx(nm,{beginEndStepPct:r.beginEndStepPct,onChange:a})]}),o.jsx(j,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",children:o.jsx(R1,{image:r.image??null,onChangeImage:h,droppableData:p,postUploadAction:f})})]})]})})});RT.displayName="IPAdapterSettings";const DT=l.memo(({id:e})=>{const t=l.useMemo(()=>({id:e,type:"reference_image"}),[e]);return o.jsx(Ti.Provider,{value:t,children:o.jsxs(Mc,{children:[o.jsxs(Lc,{ps:4,py:5,children:[o.jsx(Pc,{}),o.jsx(dt,{}),o.jsx(Tc,{})]}),o.jsx(RT,{})]})})});DT.displayName="IPAdapter";const FX=pt(Je,e=>e.referenceImages.entities.map(su).reverse()),zX=pe(un,e=>(e==null?void 0:e.type)==="reference_image"),OT=l.memo(()=>{const e=w(zX),t=w(FX);if(t.length===0)return null;if(t.length>0)return o.jsx(_c,{type:"reference_image",isSelected:e,children:t.map(n=>o.jsx(DT,{id:n},n))})});OT.displayName="IPAdapterList";const NT=l.memo(({id:e})=>{const{t}=S(),n=l.useMemo(()=>({id:e,type:"raster_layer"}),[e]),s=l.useMemo(()=>({id:e,actionType:"REPLACE_LAYER_WITH_IMAGE",context:{entityIdentifier:n}}),[e,n]);return o.jsx(Ti.Provider,{value:n,children:o.jsx(YM,{children:o.jsxs(Mc,{children:[o.jsxs(Lc,{children:[o.jsx(Tu,{}),o.jsx(Pc,{}),o.jsx(dt,{}),o.jsx(Tc,{})]}),o.jsx(tr,{data:s,dropLabel:t("controlLayers.replaceLayer")})]})})})});NT.displayName="RasterLayer";const VX=pt(Je,e=>e.rasterLayers.entities.map(su).reverse()),HX=pe(un,e=>(e==null?void 0:e.type)==="raster_layer"),BT=l.memo(()=>{const e=w(HX),t=w(VX);if(t.length===0)return null;if(t.length>0)return o.jsx(_c,{type:"raster_layer",isSelected:e,children:t.map(n=>o.jsx(NT,{id:n},n))})});BT.displayName="RasterLayerEntityList";const $T=l.memo(()=>{const e=ut("regional_guidance"),{t}=S(),n=l.useMemo(()=>pe(Je,r=>io(r,e).autoNegative),[e]),s=w(n);return o.jsx(o.Fragment,{children:s&&o.jsx(Rn,{color:"base.300",bg:"transparent",borderWidth:1,userSelect:"none",children:t("controlLayers.autoNegative")})})});$T.displayName="RegionalGuidanceBadges";const WX=()=>{const e=ut("regional_guidance"),{t}=S(),n=uS(e),s=hS(e),r=pS(e),a=l.useMemo(()=>fS(e),[e]),i=w(a);return o.jsxs(j,{w:"full",p:2,justifyContent:"space-between",children:[o.jsx(me,{size:"sm",variant:"ghost",leftIcon:o.jsx(Bt,{}),onClick:s,isDisabled:!i.canAddPositivePrompt,children:t("controlLayers.prompt")}),o.jsx(me,{size:"sm",variant:"ghost",leftIcon:o.jsx(Bt,{}),onClick:r,isDisabled:!i.canAddNegativePrompt,children:t("controlLayers.negativePrompt")}),o.jsx(me,{size:"sm",variant:"ghost",leftIcon:o.jsx(Bt,{}),onClick:n,children:t("controlLayers.referenceImage")})]})},FT=l.memo(({referenceImageId:e})=>{var y;const t=ut("regional_guidance"),{t:n}=S(),s=E(),r=l.useCallback(()=>{s(i3({entityIdentifier:t,referenceImageId:e}))},[s,t,e]),a=l.useMemo(()=>pe(Je,v=>{const I=l3(v,t,e);return Fe(I,`Regional Guidance IP Adapter with id ${e} not found`),I.ipAdapter}),[t,e]),i=w(a),c=l.useCallback(v=>{s(c3({entityIdentifier:t,referenceImageId:e,beginEndStepPct:v}))},[s,t,e]),d=l.useCallback(v=>{s(d3({entityIdentifier:t,referenceImageId:e,weight:v}))},[s,t,e]),u=l.useCallback(v=>{s(u3({entityIdentifier:t,referenceImageId:e,method:v}))},[s,t,e]),h=l.useCallback(v=>{s(h3({entityIdentifier:t,referenceImageId:e,modelConfig:v}))},[s,t,e]),p=l.useCallback(v=>{s(p3({entityIdentifier:t,referenceImageId:e,clipVisionModel:v}))},[s,t,e]),f=l.useCallback(v=>{s(Aj({entityIdentifier:t,referenceImageId:e,imageDTO:v}))},[s,t,e]),m=l.useMemo(()=>({actionType:"SET_RG_IP_ADAPTER_IMAGE",context:{id:t.id,referenceImageId:e},id:t.id}),[t.id,e]),g=l.useMemo(()=>({type:"SET_RG_IP_ADAPTER_IMAGE",id:t.id,referenceImageId:e}),[t.id,e]),x=cq(t,e),C=Ht();return o.jsxs(j,{flexDir:"column",gap:2,children:[o.jsxs(j,{alignItems:"center",gap:2,children:[o.jsx(O,{fontWeight:"semibold",color:"base.400",children:n("controlLayers.referenceImage")}),o.jsx(dt,{}),o.jsx(Q,{size:"sm",variant:"link",alignSelf:"stretch",icon:o.jsx(bc,{}),tooltip:n("controlLayers.deleteReferenceImage"),"aria-label":n("controlLayers.deleteReferenceImage"),onClick:r,colorScheme:"error"})]}),o.jsxs(j,{flexDir:"column",gap:2,position:"relative",w:"full",children:[o.jsxs(j,{gap:2,alignItems:"center",w:"full",children:[o.jsx(xe,{minW:0,w:"full",transitionProperty:"common",transitionDuration:"0.1s",children:o.jsx(D1,{modelKey:((y=i.model)==null?void 0:y.key)??null,onChangeModel:h,clipVisionModel:i.clipVisionModel,onChangeCLIPVisionModel:p})}),o.jsx(Q,{onClick:x,isDisabled:C,variant:"ghost","aria-label":n("controlLayers.pullBboxIntoReferenceImage"),tooltip:n("controlLayers.pullBboxIntoReferenceImage"),icon:o.jsx(fc,{})})]}),o.jsxs(j,{gap:2,w:"full",children:[o.jsxs(j,{flexDir:"column",gap:2,w:"full",children:[o.jsx(P1,{method:i.method,onChange:u}),o.jsx(sm,{weight:i.weight,onChange:d}),o.jsx(nm,{beginEndStepPct:i.beginEndStepPct,onChange:c})]}),o.jsx(j,{alignItems:"center",justifyContent:"center",h:32,w:32,aspectRatio:"1/1",children:o.jsx(R1,{image:i.image??null,onChangeImage:f,droppableData:m,postUploadAction:g})})]})]})]})});FT.displayName="RegionalGuidanceIPAdapterSettings";const zT=l.memo(()=>{const e=ut("regional_guidance"),t=l.useMemo(()=>pt(Je,s=>{const r=io(s,e).referenceImages.map(({id:a})=>a);return r.length===0?Ss:r}),[e]),n=w(t);return n.length===0?null:o.jsx(o.Fragment,{children:n.map((s,r)=>o.jsxs(l.Fragment,{children:[r>0&&o.jsx(zt,{}),o.jsx(FT,{referenceImageId:s})]},s))})});zT.displayName="RegionalGuidanceLayerIPAdapterList";const O1=l.memo(({onDelete:e})=>{const{t}=S();return o.jsx(Ae,{label:t("controlLayers.deletePrompt"),children:o.jsx(Q,{variant:"link","aria-label":t("controlLayers.deletePrompt"),icon:o.jsx(bc,{}),onClick:e,flexGrow:0,size:"sm",p:0,colorScheme:"error"})})});O1.displayName="RegionalGuidanceDeletePromptButton";const Ni=l.memo(e=>{const{onOpen:t,isOpen:n}=e,{t:s}=S();return o.jsx(Ae,{label:s("prompt.addPromptTrigger"),children:o.jsx(Q,{variant:"promptOverlay",isDisabled:n,"aria-label":s("prompt.addPromptTrigger"),icon:o.jsx(BW,{}),onClick:t})})});Ni.displayName="AddPromptTriggerButton";const GX=()=>ve("prompt.noMatchingTriggers"),VT=l.memo(({onSelect:e,onClose:t})=>{const{t:n}=S(),s=w(Zp),r=w(f3),{data:a,isLoading:i}=ou((s==null?void 0:s.key)??Kn),[c,{isLoading:d}]=wf(),[u,{isLoading:h}]=GM(),p=l.useCallback(m=>{if(!m){e("");return}e(m.value)},[e]),f=l.useMemo(()=>{var g;const m=[];if(u){const x=u.filter(C=>C.base===(a==null?void 0:a.base)).map(C=>({label:C.name,value:`<${C.name}>`}));x.length>0&&m.push({label:n("prompt.compatibleEmbeddings"),options:x})}if(c){const x=c.filter(C=>To(r,y=>y.model.key).includes(C.key)).map(C=>C.trigger_phrases?C.trigger_phrases.map(y=>({label:y,value:y})):[]).flatMap(C=>C);x.length>0&&m.push({label:n("modelManager.loraTriggerPhrases"),options:m3(x)})}return a&&dx(a)&&((g=a.trigger_phrases)!=null&&g.length)&&m.push({label:n("modelManager.mainModelTriggerPhrases"),options:a.trigger_phrases.map(x=>({label:x,value:x}))}),m},[u,c,a,n,r]);return o.jsx(V,{children:o.jsx(Ne,{placeholder:n(d||h||i?"common.loading":"prompt.addPromptTrigger"),defaultMenuIsOpen:!0,autoFocus:!0,value:null,options:f,noOptionsMessage:GX,onChange:p,onMenuClose:t,"data-testid":"add-prompt-trigger",sx:UX})})});VT.displayName="PromptTriggerSelect";const UX={w:"full"},Bi=l.memo(e=>{const{onSelect:t,isOpen:n,onClose:s,width:r,children:a}=e;return o.jsxs(Qn,{isOpen:n,onClose:s,placement:"bottom",openDelay:0,closeDelay:0,closeOnBlur:!0,returnFocusOnClose:!1,isLazy:!0,children:[o.jsx(tu,{children:a}),o.jsx(Yn,{p:0,insetBlockStart:-1,shadow:"dark-lg",borderColor:"invokeBlue.300",borderWidth:"2px",borderStyle:"solid",children:o.jsx(Jn,{p:0,width:`calc(${r}px - 0.25rem)`,children:o.jsx(VT,{onClose:s,onSelect:t})})})]})});Bi.displayName="PromptPopover";const Rc=({prompt:e,textareaRef:t,onChange:n})=>{const{isOpen:s,onClose:r,onOpen:a}=Is(),i=l.useCallback(f=>{n(f.target.value)},[n]),c=l.useCallback(f=>{if(!t.current)return;const m=t.current.selectionStart;if(Ut(m))return;let g=e.slice(0,m);g+=`${f}`;const x=g.length;g+=e.slice(m),Jx.flushSync(()=>{n(g)}),t.current.selectionStart=x,t.current.selectionEnd=x},[t,n,e]),d=l.useCallback(()=>{var f;(f=t.current)==null||f.focus()},[t]),u=l.useCallback(()=>{r(),d()},[d,r]),h=l.useCallback(f=>{c(f),u()},[u,c]),p=l.useCallback(f=>{f.key==="<"&&(a(),f.preventDefault())},[a]);return{onChange:i,isOpen:s,onClose:r,onOpen:a,onSelect:h,onKeyDown:p,onFocus:d}},ZX={outline:"none"},HT=l.memo(()=>{var g;const e=ut("regional_guidance"),t=l.useMemo(()=>pe(Je,x=>io(x,e).negativePrompt??""),[e]),n=w(t),s=E(),r=l.useRef(null),{t:a}=S(),i=l.useCallback(x=>{s(Zy({entityIdentifier:e,prompt:x}))},[s,e]),c=l.useCallback(()=>{s(Zy({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:d,isOpen:u,onClose:h,onOpen:p,onSelect:f,onKeyDown:m}=Rc({prompt:n,textareaRef:r,onChange:i});return o.jsx(Bi,{isOpen:u,onClose:h,onSelect:f,width:(g=r.current)==null?void 0:g.clientWidth,children:o.jsxs(xe,{pos:"relative",w:"full",children:[o.jsx(ls,{id:"prompt",name:"prompt",ref:r,value:n,placeholder:a("parameters.negativePromptPlaceholder"),onChange:d,onKeyDown:m,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,fontSize:"sm",zIndex:"0 !important",_focusVisible:ZX}),o.jsxs(j,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[o.jsx(O1,{onDelete:c}),o.jsx(Ni,{isOpen:u,onOpen:p})]})]})})});HT.displayName="RegionalGuidanceNegativePrompt";const qX={outline:"none"},WT=l.memo(()=>{var g;const e=ut("regional_guidance"),t=l.useMemo(()=>pe(Je,x=>io(x,e).positivePrompt??""),[e]),n=w(t),s=E(),r=l.useRef(null),{t:a}=S(),i=l.useCallback(x=>{s(qy({entityIdentifier:e,prompt:x}))},[s,e]),c=l.useCallback(()=>{s(qy({entityIdentifier:e,prompt:null}))},[s,e]),{onChange:d,isOpen:u,onClose:h,onOpen:p,onSelect:f,onKeyDown:m}=Rc({prompt:n,textareaRef:r,onChange:i});return o.jsx(Bi,{isOpen:u,onClose:h,onSelect:f,width:(g=r.current)==null?void 0:g.clientWidth,children:o.jsxs(xe,{pos:"relative",w:"full",children:[o.jsx(ls,{id:"prompt",name:"prompt",ref:r,value:n,placeholder:a("parameters.positivePromptPlaceholder"),onChange:d,onKeyDown:m,variant:"outline",paddingInlineStart:2,paddingInlineEnd:8,minH:28,zIndex:"0 !important",_focusVisible:qX}),o.jsxs(j,{flexDir:"column",gap:2,position:"absolute",insetBlockStart:2,insetInlineEnd:0,alignItems:"center",justifyContent:"center",children:[o.jsx(O1,{onDelete:c}),o.jsx(Ni,{isOpen:u,onOpen:p})]})]})})});WT.displayName="RegionalGuidancePositivePrompt";const GT=l.memo(()=>{const e=ut("regional_guidance"),t=l.useMemo(()=>pt(Je,s=>{const r=io(s,e);return{hasPositivePrompt:r.positivePrompt!==null,hasNegativePrompt:r.negativePrompt!==null,hasIPAdapters:r.referenceImages.length>0}}),[e]),n=w(t);return o.jsxs(tm,{children:[!n.hasPositivePrompt&&!n.hasNegativePrompt&&!n.hasIPAdapters&&o.jsx(WX,{}),n.hasPositivePrompt&&o.jsxs(o.Fragment,{children:[o.jsx(WT,{}),!n.hasNegativePrompt&&n.hasIPAdapters&&o.jsx(zt,{})]}),n.hasNegativePrompt&&o.jsxs(o.Fragment,{children:[o.jsx(HT,{}),n.hasIPAdapters&&o.jsx(zt,{})]}),n.hasIPAdapters&&o.jsx(zT,{})]})});GT.displayName="RegionalGuidanceSettings";const UT=l.memo(({id:e})=>{const t=l.useMemo(()=>({id:e,type:"regional_guidance"}),[e]);return o.jsx(Ti.Provider,{value:t,children:o.jsx(eA,{children:o.jsxs(Mc,{children:[o.jsxs(Lc,{children:[o.jsx(Tu,{}),o.jsx(Pc,{}),o.jsx(dt,{}),o.jsx($T,{}),o.jsx(Tc,{})]}),o.jsx(GT,{})]})})})});UT.displayName="RegionalGuidance";const KX=pt(Je,e=>e.regionalGuidance.entities.map(su).reverse()),QX=pe(un,e=>(e==null?void 0:e.type)==="regional_guidance"),ZT=l.memo(()=>{const e=w(QX),t=w(KX);if(t.length===0)return null;if(t.length>0)return o.jsx(_c,{type:"regional_guidance",isSelected:e,children:t.map(n=>o.jsx(UT,{id:n},n))})});ZT.displayName="RegionalGuidanceEntityList";const qT=l.memo(()=>o.jsx(Nn,{children:o.jsxs(j,{flexDir:"column",gap:2,"data-testid":"control-layers-layer-list",w:"full",h:"full",children:[o.jsx(OT,{}),o.jsx(PT,{}),o.jsx(ZT,{}),o.jsx(LT,{}),o.jsx(BT,{})]})}));qT.displayName="CanvasEntityList";const KT=l.memo(()=>{const{t:e}=S(),t=Ht(),n=Yx(),s=Zx(),r=qx(),a=cS(),i=Kx(),c=Qx(),d=w(Ia);return o.jsxs(Ta,{children:[o.jsx(Pa,{as:Q,size:"sm",variant:"link",alignSelf:"stretch",tooltip:e("controlLayers.addLayer"),"aria-label":e("controlLayers.addLayer"),icon:o.jsx(Bt,{}),"data-testid":"control-layers-add-layer-menu-button",isDisabled:t}),o.jsxs(Un,{children:[o.jsx(os,{title:e("controlLayers.global"),children:o.jsx(_e,{icon:o.jsx(Bt,{}),onClick:n,isDisabled:d,children:e("controlLayers.globalReferenceImage")})}),o.jsxs(os,{title:e("controlLayers.regional"),children:[o.jsx(_e,{icon:o.jsx(Bt,{}),onClick:s,children:e("controlLayers.inpaintMask")}),o.jsx(_e,{icon:o.jsx(Bt,{}),onClick:r,isDisabled:d,children:e("controlLayers.regionalGuidance")}),o.jsx(_e,{icon:o.jsx(Bt,{}),onClick:a,isDisabled:d,children:e("controlLayers.regionalReferenceImage")})]}),o.jsxs(os,{title:e("controlLayers.layer_other"),children:[o.jsx(_e,{icon:o.jsx(Bt,{}),onClick:c,children:e("controlLayers.controlLayer")}),o.jsx(_e,{icon:o.jsx(Bt,{}),onClick:i,children:e("controlLayers.rasterLayer")})]})]})]})});KT.displayName="EntityListGlobalActionBarAddLayerMenu";const QT=l.memo(()=>{const{t:e}=S(),t=E(),n=Ht(),s=w(un),r=l.useCallback(()=>{s&&t(dS({entityIdentifier:s}))},[t,s]);return o.jsx(Q,{onClick:r,isDisabled:!s||n,size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.duplicate"),tooltip:e("controlLayers.duplicate"),icon:o.jsx(QI,{})})});QT.displayName="EntityListSelectedEntityActionBarDuplicateButton";const tg={width:6,height:6,borderColor:"base.100"},YX={".react-colorful__hue-pointer":tg,".react-colorful__saturation-pointer":tg,".react-colorful__alpha-pointer":tg,gap:4,flexDir:"column"},JX={width:"100%"},ng="3.5rem",XX=e=>{const{color:t,onChange:n,withNumberInput:s=!1,withSwatches:r=!1}=e,{t:a}=S(),i=l.useCallback(u=>n({...t,r:u}),[t,n]),c=l.useCallback(u=>n({...t,g:u}),[t,n]),d=l.useCallback(u=>n({...t,b:u}),[t,n]);return o.jsxs(j,{sx:YX,children:[o.jsx(QK,{color:t,onChange:n,style:JX}),s&&o.jsxs(j,{gap:4,children:[o.jsxs(V,{gap:0,children:[o.jsx(U,{children:a("common.red")[0]}),o.jsx(Ve,{flexGrow:1,value:t.r,onChange:i,min:0,max:255,step:1,w:ng,defaultValue:90})]}),o.jsxs(V,{gap:0,children:[o.jsx(U,{children:a("common.green")[0]}),o.jsx(Ve,{flexGrow:1,value:t.g,onChange:c,min:0,max:255,step:1,w:ng,defaultValue:90})]}),o.jsxs(V,{gap:0,children:[o.jsx(U,{children:a("common.blue")[0]}),o.jsx(Ve,{flexGrow:1,value:t.b,onChange:d,min:0,max:255,step:1,w:ng,defaultValue:255})]})]}),r&&o.jsx(j,{gap:2,justifyContent:"space-between",children:VK.map((u,h)=>o.jsx(tee,{color:u,onChange:n},h))})]})},eee=l.memo(XX),tee=({color:e,onChange:t})=>{const n=l.useCallback(()=>{t(e)},[e,t]);return o.jsx(xe,{role:"button",onClick:n,h:8,w:8,bg:Hr(e),borderRadius:"base"})},YT=l.memo(({style:e,onChange:t})=>{const{t:n}=S(),s=l.useCallback(i=>{g3(i==null?void 0:i.value)&&t(i.value)},[t]),r=l.useMemo(()=>[{value:"solid",label:n("controlLayers.fill.solid")},{value:"diagonal",label:n("controlLayers.fill.diagonal")},{value:"crosshatch",label:n("controlLayers.fill.crosshatch")},{value:"grid",label:n("controlLayers.fill.grid")},{value:"horizontal",label:n("controlLayers.fill.horizontal")},{value:"vertical",label:n("controlLayers.fill.vertical")}],[n]),a=l.useMemo(()=>r.find(i=>i.value===e),[r,e]);return o.jsxs(V,{children:[o.jsx(U,{m:0,children:n("controlLayers.fill.fillStyle")}),o.jsx(Ne,{value:a,options:r,onChange:s,isSearchable:!1})]})});YT.displayName="MaskFillStyle";const JT=l.memo(()=>{const{t:e}=S(),t=E(),n=w(un),s=w(x3),r=l.useCallback(i=>{n&&Vg(n)&&t(b3({entityIdentifier:n,color:i}))},[t,n]),a=l.useCallback(i=>{n&&Vg(n)&&t(y3({entityIdentifier:n,style:i}))},[t,n]);return!n||!s?null:o.jsxs(Qn,{isLazy:!0,children:[o.jsx(ds,{children:o.jsx(j,{role:"button","aria-label":e("controlLayers.maskFill"),tabIndex:-1,w:8,h:8,children:o.jsx(Ae,{label:e("controlLayers.maskFill"),children:o.jsx(j,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:o.jsx(xe,{borderRadius:"full",borderColor:"base.600",w:6,h:6,borderWidth:2,bg:Hr(s.color)})})})})}),o.jsx(Yn,{children:o.jsx(Jn,{minH:64,children:o.jsxs(j,{flexDir:"column",gap:4,children:[o.jsx(eee,{color:s.color,onChange:r,withNumberInput:!0,withSwatches:!0}),o.jsx(YT,{style:s.style,onChange:a})]})})})]})});JT.displayName="EntityListSelectedEntityActionBarFill";const XT=l.memo(()=>{const{t:e}=S(),t=w(un),n=_f(t);return!t||!Uh(t)?null:o.jsx(Q,{onClick:n.start,isDisabled:n.isDisabled,size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.filter.filter"),tooltip:e("controlLayers.filter.filter"),icon:o.jsx(af,{})})});XT.displayName="EntityListSelectedEntityActionBarFilterButton";function nee(e){return isNaN(Number(e))?"":`${wb(Number(e),2).toLocaleString()}%`}function see(e){return e/100}function rl(e){return e*100}function oee(e){return String(e)}const N0=[rl(0),rl(.25),rl(.5),rl(.75),rl(1)],ree=rl(1),aee=N0.slice(1,N0.length-1),iee=pe(Je,e=>{const t=e.selectedEntityIdentifier;if(!t)return 1;const n=rc(e,t);return!n||!v3(n)?1:n.opacity}),eP=l.memo(()=>{const{t:e}=S(),t=E(),n=w(un),s=w(iee),[r,a]=l.useState(s*100),i=l.useCallback(h=>{if(!n)return;let p=h;$x.get()||(p=Qj(h,aee,2));const f=see(p);t(Ky({entityIdentifier:n,opacity:f}))},[t,n]),c=l.useCallback(()=>{if(n){if(isNaN(Number(r))){a(100);return}t(Ky({entityIdentifier:n,opacity:ir(r/100,0,1)}))}},[t,r,n]),d=l.useCallback((h,p)=>{a(p)},[]),u=l.useCallback(h=>{h.key==="Enter"&&c()},[c]);return l.useEffect(()=>{a((s??1)*100)},[s]),o.jsxs(Qn,{children:[o.jsxs(V,{w:"min-content",gap:2,isDisabled:n===null||n.type==="reference_image",children:[o.jsx(U,{m:0,children:e("controlLayers.opacity")}),o.jsx(tu,{children:o.jsxs(Vp,{display:"flex",alignItems:"center",min:0,max:100,step:1,value:r,onChange:d,onBlur:c,w:"76px",format:nee,defaultValue:1,onKeyDown:u,clampValueOnBlur:!1,variant:"outline",children:[o.jsx(Hp,{paddingInlineEnd:7,_focusVisible:{zIndex:0},title:""}),o.jsx(ds,{children:o.jsx(Q,{"aria-label":"open-slider",icon:o.jsx(Fo,{}),size:"sm",variant:"link",position:"absolute",insetInlineEnd:0,h:"full",isDisabled:n===null||n.type==="reference_image"})})]})})]}),o.jsxs(Yn,{w:200,pt:0,pb:2,px:4,children:[o.jsx(Zr,{}),o.jsx(Jn,{children:o.jsx(qe,{min:0,max:100,value:r,onChange:i,defaultValue:ree,marks:N0,formatValue:oee,alwaysShowMarks:!0,isDisabled:n===null||n.type==="reference_image"})})]})]})});eP.displayName="EntityListSelectedEntityActionBarOpacity";const tP=l.memo(()=>{const{t:e}=S(),t=w(un),n=p1(t);return!t||!Sl(t)?null:o.jsx(Q,{onClick:n.start,isDisabled:n.isDisabled,size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.transform.transform"),tooltip:e("controlLayers.transform.transform"),icon:o.jsx(vu,{})})});tP.displayName="EntityListSelectedEntityActionBarTransformButton";const nP=l.memo(()=>{const{t:e}=S(),t=Ht(),n=w(un),s=br(n),r=lA(),a=l.useCallback(()=>{r(s)},[r,s]);return!n||!Dg(n)?null:o.jsx(Q,{onClick:a,isDisabled:!n||t,size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("controlLayers.saveLayerToAssets"),tooltip:e("controlLayers.saveLayerToAssets"),icon:o.jsx($r,{})})});nP.displayName="EntityListSelectedEntityActionBarSaveToAssetsButton";const sP=l.memo(()=>o.jsxs(j,{w:"full",gap:2,alignItems:"center",ps:1,children:[o.jsx(eP,{}),o.jsx(dt,{}),o.jsx(JT,{}),o.jsxs(j,{h:"full",children:[o.jsx(XT,{}),o.jsx(tP,{}),o.jsx(nP,{}),o.jsx(QT,{}),o.jsx(KT,{})]})]}));sP.displayName="EntityListSelectedEntityActionBar";const oP=l.memo(()=>{const e=w(C3),t=l.useRef(null);return Oa("layers",t),o.jsxs(j,{ref:t,flexDir:"column",gap:2,w:"full",h:"full",children:[o.jsx(sP,{}),o.jsx(zt,{py:0}),!e&&o.jsx(rT,{}),e&&o.jsx(qT,{})]})});oP.displayName="CanvasLayersPanelContent";const rP=l.memo(()=>{const e=se(w3),t=se(Tx);return e&&t?o.jsx(j,{gap:2,alignItems:"center",justifyContent:"space-evenly",pe:2,w:"50%",children:o.jsx(O,{fontSize:"md",fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",w:"full",textAlign:"center",children:o.jsx(Xx,{href:t,children:e})})}):o.jsx(dt,{})});rP.displayName="GalleryHeader";const Rl=Symbol("NO_SIZE"),B0=e=>{const t=l.useRef(null),[n,s]=l.useState(1),[r,a]=l.useState(1),i=l.useCallback(()=>{if(!(t!=null&&t.current))return;const y=sg(e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection),v=sg(e.defaultSizePx??e.minSizePx,e.imperativePanelGroupRef,e.panelGroupDirection);if(y===Rl||v===Rl)return;s(y),v>y?a(v):a(y);const I=t.current.getSize();!t.current.isCollapsed()&&I<y&&y>0&&t.current.resize(y)},[e.defaultSizePx,e.imperativePanelGroupRef,e.minSizePx,e.panelGroupDirection]);l.useLayoutEffect(()=>{if(!e.imperativePanelGroupRef.current)return;const y=e.imperativePanelGroupRef.current.getId(),v=Yf(y),I=bi(y);if(!v)return;const k=new ResizeObserver(i);return k.observe(v),I.forEach(M=>k.observe(M)),i(),()=>{k.disconnect()}},[e.imperativePanelGroupRef,i]);const[c,d]=l.useState(()=>{var y;return!!((y=t.current)!=null&&y.isCollapsed())}),u=l.useCallback(()=>{var y;d(!0),(y=e.onCollapse)==null||y.call(e,!0)},[e]),h=l.useCallback(()=>{var y;d(!1),(y=e.onCollapse)==null||y.call(e,!1)},[e]),p=l.useCallback(()=>{var y,v,I;(y=t.current)!=null&&y.isCollapsed()?(v=t.current)==null||v.expand():(I=t.current)==null||I.collapse()},[]),f=l.useCallback(()=>{var y;(y=t.current)==null||y.expand()},[]),m=l.useCallback(()=>{var y;(y=t.current)==null||y.collapse()},[]),g=l.useCallback(y=>{var I;const v=sg(y,e.imperativePanelGroupRef,e.panelGroupDirection);v!==Rl&&((I=t.current)==null||I.resize(v))},[e]),x=l.useCallback(()=>{var y;(y=t.current)==null||y.resize(n)},[n]),C=l.useCallback(()=>{var y,v;if(Math.abs((((y=t.current)==null?void 0:y.getSize())??0)-r)<.01){m();return}(v=t.current)==null||v.resize(r)},[r,m]);return{isCollapsed:c,reset:x,toggle:p,expand:f,collapse:m,resize:g,panelProps:{id:e.id,defaultSize:r,onCollapse:u,onExpand:h,ref:t,minSize:n},resizeHandleProps:{onDoubleClick:C}}},sg=(e,t,n)=>{if(!t.current)return Rl;const s=t.current.getId(),r=Yf(s);if(!r)return Rl;let a=n==="horizontal"?r.offsetWidth:r.offsetHeight;return a?(bi(s).forEach(i=>{a-=n==="horizontal"?i.offsetWidth:i.offsetHeight}),Math.max(Math.min(e/a*100,100),1)):Rl},N1=pe(Gs,e=>e.allowPrivateBoards),lee=({isPrivateBoard:e})=>{const{t}=S(),n=E(),s=w(N1),[r,{isLoading:a}]=j3(),i=l.useMemo(()=>t(s?e?"boards.addPrivateBoard":"boards.addSharedBoard":"boards.addBoard"),[s,e,t]),c=l.useCallback(async()=>{try{const d=await r({board_name:t("boards.myBoard"),is_private:e}).unwrap();n(vd({boardId:d.board_id})),n(Kh(""))}catch{}},[t,r,e,n]);return o.jsx(Q,{icon:o.jsx(Bt,{}),isLoading:a,tooltip:i,"aria-label":i,onClick:c,size:"md","data-testid":"add-board-button",variant:"link",w:8,h:8})},cee=l.memo(lee),B1=l.memo(()=>{const{t:e}=S();return o.jsx(Rn,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:e("common.auto")})});B1.displayName="AutoAddBadge";const dee=({board:e,children:t})=>{const{t:n}=S(),s=E(),r=w(ic),a=l.useMemo(()=>pe(ao,y=>e.board_id===y),[e.board_id]),[i]=mS(),c=w(a),d=gu(e.board_id),u=dn("bulkDownload"),[h]=Lx(),p=l.useCallback(()=>{s(ru(e.board_id))},[e.board_id,s]),f=l.useCallback(()=>{h({image_names:[],board_id:e.board_id})},[e.board_id,h]),m=l.useCallback(async()=>{try{await i({board_id:e.board_id,changes:{archived:!0}}).unwrap()}catch{he({status:"error",title:"Unable to archive board"})}},[e.board_id,i]),g=l.useCallback(()=>{i({board_id:e.board_id,changes:{archived:!1}})},[e.board_id,i]),x=l.useCallback(()=>{Jc.set(e)},[e]),C=l.useCallback(()=>o.jsx(Un,{visibility:"visible",children:o.jsxs(os,{title:d,children:[!r&&o.jsx(_e,{icon:o.jsx(Bt,{}),isDisabled:c,onClick:p,children:n(c?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),u&&o.jsx(_e,{icon:o.jsx(RI,{}),onClickCapture:f,children:n("boards.downloadBoard")}),e.archived&&o.jsx(_e,{icon:o.jsx(MI,{}),onClick:g,children:n("boards.unarchiveBoard")}),!e.archived&&o.jsx(_e,{icon:o.jsx(bG,{}),onClick:m,children:n("boards.archiveBoard")}),o.jsx(_e,{color:"error.300",icon:o.jsx(Hs,{}),onClick:x,isDestructive:!0,children:n("boards.deleteBoard")})]})}),[d,r,c,p,n,u,f,e.archived,g,m,x]);return o.jsx(Up,{renderMenu:C,children:t})},uee=l.memo(dee),aP=l.memo(({board:e,isSelected:t})=>{const{t:n}=S(),s=Jd(!1),[r,a]=l.useState(!1),[i,c]=l.useState(e.board_name),d=l.useRef(null),[u,h]=mS(),p=l.useCallback(y=>{c(y.target.value)},[]),f=l.useCallback(()=>{s.setTrue(),a(!1)},[s]),m=l.useCallback(async()=>{const y=i.trim();if(s.setFalse(),y.length===0)c(e.board_name);else if(y!==e.board_name){c(y);const v=await ss(()=>u({board_id:e.board_id,changes:{board_name:y}}).unwrap());v.isErr()?(c(e.board_name),he({status:"error",title:n("boards.updateBoardError")})):c(v.value.board_name)}},[e.board_id,e.board_name,s,i,u,n]),g=l.useCallback(y=>{y.key==="Enter"?m():y.key==="Escape"&&(c(e.board_name),s.setFalse())},[e.board_name,s,m]),x=l.useCallback(()=>{a(!0)},[]),C=l.useCallback(()=>{a(!1)},[]);return l.useEffect(()=>{var y,v;s.isTrue&&((y=d.current)==null||y.focus(),(v=d.current)==null||v.select())},[s.isTrue]),s.isTrue?o.jsx(Vt,{ref:d,value:i,onChange:p,onBlur:m,onKeyDown:g,variant:"outline",isDisabled:h.isLoading,_focusVisible:{borderWidth:1,borderColor:"invokeBlueAlpha.400",borderRadius:"base"}}):o.jsxs(j,{alignItems:"center",gap:3,onMouseOver:x,onMouseOut:C,children:[o.jsx(O,{size:"sm",fontWeight:"semibold",userSelect:"none",color:t?"base.100":"base.300",onDoubleClick:f,cursor:"text",children:i}),r&&o.jsx(Q,{"aria-label":"edit name",icon:o.jsx(Cu,{}),size:"sm",variant:"ghost",onClick:f})]})});aP.displayName="CanvasEntityTitleEdit";const iP=({board:e})=>{const{t}=S(),{imagesTotal:n}=gS((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:a})=>({imagesTotal:(a==null?void 0:a.total)??0})}),{assetsTotal:s}=S3((e==null?void 0:e.board_id)||"none",{selectFromResult:({data:a})=>({assetsTotal:(a==null?void 0:a.total)??0})}),{currentData:r}=Gr((e==null?void 0:e.cover_image_name)??Kn);return o.jsxs(j,{flexDir:"column",alignItems:"center",gap:1,children:[r&&o.jsx(nn,{src:r.thumbnail_url,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),o.jsxs(j,{flexDir:"column",alignItems:"center",children:[o.jsxs(O,{noOfLines:1,children:[t("boards.imagesWithCount",{count:n}),", ",t("boards.assetsWithCount",{count:s})]}),(e==null?void 0:e.archived)&&o.jsxs(O,{children:["(",t("boards.archived"),")"]})]})]})},hee={bg:"base.850"},pee=({board:e,isSelected:t})=>{const n=E(),{t:s}=S(),r=w(ao),a=w(ic),i=w(Hd),c=l.useCallback(()=>{i!==e.board_id&&n(vd({boardId:e.board_id})),a&&r!==e.board_id&&n(ru(e.board_id))},[i,e.board_id,a,r,n]),d=l.useMemo(()=>({id:e.board_id,actionType:"ADD_TO_BOARD",context:{boardId:e.board_id}}),[e.board_id]);return o.jsxs(xe,{position:"relative",w:"full",h:12,children:[o.jsx(uee,{board:e,children:u=>o.jsx(Ae,{label:o.jsx(iP,{board:e}),openDelay:1e3,placement:"left",closeOnScroll:!0,p:2,children:o.jsxs(j,{ref:u,onClick:c,alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:t?"base.850":void 0,_hover:hee,w:"full",h:"full",children:[o.jsx(mee,{board:e}),o.jsx(j,{w:"full",children:o.jsx(aP,{board:e,isSelected:t})}),r===e.board_id&&o.jsx(B1,{}),e.archived&&o.jsx(it,{as:MI,fill:"base.300"}),o.jsx(O,{variant:"subtext",children:e.image_count})]})})}),o.jsx(tr,{data:d,dropLabel:s("gallery.move")})]})},fee=l.memo(pee),mee=({board:e})=>{const{currentData:t}=Gr(e.cover_image_name??Kn);return t?o.jsx(nn,{src:t.thumbnail_url,draggable:!1,objectFit:"cover",w:10,h:10,borderRadius:"base",borderBottomRadius:"lg"}):o.jsx(j,{w:10,h:10,justifyContent:"center",alignItems:"center",children:o.jsx(it,{boxSize:10,as:IG,opacity:.7,color:"base.500"})})},gee=pe(ao,e=>e==="none"),xee=({children:e})=>{const{t}=S(),n=E(),s=w(ic),r=w(gee),a=dn("bulkDownload"),[i]=Lx(),c=l.useCallback(()=>{n(ru("none"))},[n]),d=l.useCallback(()=>{i({image_names:[],board_id:"none"})},[i]),u=l.useCallback(()=>o.jsx(Un,{visibility:"visible",children:o.jsxs(os,{title:t("boards.uncategorized"),children:[!s&&o.jsx(_e,{icon:o.jsx(Bt,{}),isDisabled:r,onClick:c,children:t(r?"boards.selectedForAutoAdd":"boards.menuItemAutoAdd")}),a&&o.jsx(_e,{icon:o.jsx(RI,{}),onClickCapture:d,children:t("boards.downloadBoard")})]})}),[s,d,c,a,r,t]);return o.jsx(Up,{renderMenu:u,children:e})},bee=l.memo(xee),yee={bg:"base.850"},lP=l.memo(({isSelected:e})=>{const t=E(),{imagesTotal:n}=gS("none",{selectFromResult:({data:h})=>({imagesTotal:(h==null?void 0:h.total)??0})}),s=w(ao),r=w(ic),a=w(qp),i=gu("none"),c=l.useCallback(()=>{t(vd({boardId:"none"})),r&&t(ru("none"))},[t,r]),d=l.useMemo(()=>({id:"no_board",actionType:"REMOVE_FROM_BOARD"}),[]),{t:u}=S();return a.length?null:o.jsxs(xe,{position:"relative",w:"full",h:12,children:[o.jsx(bee,{children:h=>o.jsx(Ae,{label:o.jsx(iP,{board:null}),openDelay:1e3,placement:"left",closeOnScroll:!0,children:o.jsxs(j,{ref:h,onClick:c,w:"full",h:"full",alignItems:"center",borderRadius:"base",cursor:"pointer",py:1,ps:1,pe:4,gap:4,bg:e?"base.850":void 0,_hover:yee,children:[o.jsx(j,{w:"10",justifyContent:"space-around",children:o.jsx(it,{boxSize:8,opacity:1,stroke:"base.500",viewBox:"0 0 66 66",fill:"none",children:o.jsx("path",{d:"M43.9137 16H63.1211V3H3.12109V16H22.3285L43.9137 50H63.1211V63H3.12109V50H22.3285",strokeWidth:"5"})})}),o.jsx(O,{fontSize:"sm",color:e?"base.100":"base.300",fontWeight:"semibold",noOfLines:1,flexGrow:1,children:i}),s==="none"&&o.jsx(B1,{}),o.jsx(O,{variant:"subtext",children:n})]})})}),o.jsx(tr,{data:d,dropLabel:u("gallery.move")})]})});lP.displayName="HoverableBoard";const HC=l.memo(lP),WC=({isPrivate:e})=>{const{t}=S(),n=w(Hd),s=w(qp),r=w(k3),{data:a}=nc(r),i=w(N1),{isOpen:c,onToggle:d}=Is({defaultIsOpen:!0}),u=l.useMemo(()=>a?a.filter(f=>s.length?f.is_private===e&&f.board_name.toLowerCase().includes(s.toLowerCase()):f.is_private===e):Ss,[s,a,e]),h=l.useMemo(()=>{const f=[];return i&&e&&!s.length&&f.push(o.jsx(HC,{isSelected:n==="none"},"none")),!i&&!s.length&&f.push(o.jsx(HC,{isSelected:n==="none"},"none")),u.forEach(m=>{f.push(o.jsx(fee,{board:m,isSelected:n===m.board_id},m.board_id))}),f},[i,e,s.length,u,n]),p=l.useMemo(()=>t(i?e?"boards.private":"boards.shared":"boards.boards"),[e,i,t]);return o.jsxs(j,{direction:"column",children:[o.jsxs(j,{position:"sticky",w:"full",justifyContent:"space-between",alignItems:"center",ps:2,py:1,zIndex:1,top:0,bg:"base.900",children:[i?o.jsx(me,{variant:"unstyled",onClick:d,children:o.jsxs(j,{gap:"2",alignItems:"center",children:[o.jsx(it,{boxSize:4,as:Fo,transform:c?void 0:"rotate(-90deg)",fill:"base.500"}),o.jsx(O,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:p})]})}):o.jsx(O,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:p}),o.jsx(cee,{isPrivateBoard:e})]}),o.jsx(Mi,{in:c,children:o.jsx(j,{direction:"column",gap:1,children:h.length?h:o.jsx(O,{variant:"subtext",textAlign:"center",children:t("boards.noBoards",{boardType:s.length?"Matching":""})})})})]})},vee={height:"100%",width:"100%"},Cee=()=>{const e=w(N1);return o.jsx(xe,{position:"relative",w:"full",h:"full",children:o.jsx(xe,{position:"absolute",top:0,right:0,bottom:0,left:0,children:o.jsxs(Vr,{defer:!0,style:vee,options:zr.options,children:[e&&o.jsx(WC,{isPrivate:!0}),o.jsx(WC,{isPrivate:!1})]})})})},wee=l.memo(Cee),jee=()=>{const e=E(),t=w(qp),{t:n}=S(),s=l.useCallback(c=>{e(Kh(c))},[e]),r=l.useCallback(()=>{e(Kh(""))},[e]),a=l.useCallback(c=>{c.key==="Escape"&&r()},[r]),i=l.useCallback(c=>{s(c.target.value)},[s]);return o.jsxs(Ur,{children:[o.jsx(Vt,{placeholder:n("boards.searchBoard"),value:t,onKeyDown:a,onChange:i,"data-testid":"board-search-input"}),t&&t.length&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(Q,{onClick:r,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:o.jsx(sn,{})})})]})},See=l.memo(jee),kee=()=>{const e=E(),{t}=S(),n=w(ao),s=w(ic),{options:r,hasBoards:a}=nc({},{selectFromResult:({data:u})=>{const h=[{label:t("common.none"),value:"none"}].concat((u??[]).map(({board_id:p,board_name:f})=>({label:f,value:p})));return{options:h,hasBoards:h.length>1}}}),i=l.useCallback(u=>{u&&e(ru(u.value))},[e]),c=l.useMemo(()=>r.find(u=>u.value===n),[r,n]),d=l.useCallback(()=>t("boards.noMatching"),[t]);return o.jsxs(V,{isDisabled:!a||s,children:[o.jsx(U,{children:t("boards.autoAddBoard")}),o.jsx(Ne,{value:c,options:r,onChange:i,placeholder:t("boards.selectBoard"),noOptionsMessage:d})]})},Iee=l.memo(kee),_ee=()=>{const e=E(),{t}=S(),n=w(ic),s=l.useCallback(r=>e(I3(r.target.checked)),[e]);return o.jsxs(V,{children:[o.jsx(U,{flexGrow:1,children:t("gallery.autoAssignBoardOnClick")}),o.jsx(kn,{isChecked:n,onChange:s})]})},Mee=l.memo(_ee),Aee=pe(ks,e=>e.shouldShowArchivedBoards),Eee=()=>{const e=E(),{t}=S(),n=w(Aee),s=l.useCallback(r=>{e(_3(r.target.checked))},[e]);return o.jsxs(V,{children:[o.jsx(U,{flexGrow:1,children:t("gallery.showArchivedBoards")}),o.jsx(kn,{isChecked:n,onChange:s})]})},Lee=l.memo(Eee),Tee=ze.enum(["created_at","board_name"]),Pee=e=>Tee.safeParse(e).success,Ree=ze.enum(["ASC","DESC"]),Dee=e=>Ree.safeParse(e).success,Oee=()=>{const{t:e}=S(),t=w(M3),n=w(A3),s=l.useMemo(()=>[{value:"created_at",label:e("workflows.created")},{value:"board_name",label:e("workflows.name")}],[e]),r=l.useMemo(()=>[{value:"ASC",label:e("workflows.ascending")},{value:"DESC",label:e("workflows.descending")}],[e]),a=E(),i=l.useCallback(h=>{!Pee(h==null?void 0:h.value)||h.value===t||a(E3(h.value))},[t,a]),c=l.useMemo(()=>s.find(h=>h.value===t)||s[0],[t,s]),d=l.useCallback(h=>{!Dee(h==null?void 0:h.value)||h.value===n||a(L3(h.value))},[n,a]),u=l.useMemo(()=>r.find(h=>h.value===n),[n,r]);return o.jsxs(j,{flexDir:"column",gap:4,children:[o.jsxs(V,{orientation:"horizontal",gap:1,children:[o.jsx(U,{children:e("common.orderBy")}),o.jsx(Ne,{isSearchable:!1,value:c,options:s,onChange:i})]}),o.jsxs(V,{orientation:"horizontal",gap:1,children:[o.jsx(U,{children:e("common.direction")}),o.jsx(Ne,{isSearchable:!1,value:u,options:r,onChange:d})]})]})},Nee=()=>{const{t:e}=S();return o.jsxs(Qn,{isLazy:!0,children:[o.jsx(ds,{children:o.jsx(Q,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.boardsSettings"),icon:o.jsx(xc,{}),tooltip:e("gallery.boardsSettings")})}),o.jsx(Yn,{children:o.jsx(Jn,{children:o.jsxs(j,{direction:"column",gap:2,children:[o.jsx(Mee,{}),o.jsx(Lee,{}),o.jsx(Iee,{}),o.jsx(xe,{py:2,children:o.jsx(zt,{})}),o.jsx(Oee,{})]})})})]})},Bee=l.memo(Nee),$ee=()=>{wt("gallery-search-state");const e=E(),t=w(T3),[n,s]=l.useState(t),r=l.useMemo(()=>Ai(c=>{e(Qy(c))},1e3),[e]),a=l.useCallback(c=>{s(c),r(c)},[r]),i=l.useCallback(()=>{r.cancel(),s(""),e(Qy(""))},[r,e]);return[n,a,i]},Fee=pe(ks,e=>e.alwaysShowImageSizeBadge),zee=()=>{const e=E(),{t}=S(),n=w(Fee),s=l.useCallback(r=>e(P3(r.target.checked)),[e]);return o.jsxs(V,{children:[o.jsx(U,{flexGrow:1,children:t("gallery.alwaysShowImageSizeBadge")}),o.jsx(kn,{isChecked:n,onChange:s})]})},Vee=l.memo(zee),Hee=pe(ks,e=>e.shouldAutoSwitch),Wee=()=>{const e=E(),{t}=S(),n=w(Hee),s=l.useCallback(r=>{e(R3(r.target.checked))},[e]);return o.jsxs(V,{children:[o.jsx(U,{flexGrow:1,children:t("gallery.autoSwitchNewImages")}),o.jsx(kn,{isChecked:n,onChange:s})]})},Gee=l.memo(Wee),Uee=()=>{const e=E(),{t}=S(),n=w(xS),s=l.useCallback(r=>{e(D3(r))},[e]);return o.jsxs(V,{children:[o.jsx(U,{children:t("gallery.galleryImageSize")}),o.jsx(qe,{value:n,onChange:s,min:45,max:256,defaultValue:90})]})},Zee=l.memo(Uee),qee=pe(ks,e=>e.starredFirst),Kee=()=>{const e=E(),{t}=S(),n=w(qee),s=l.useCallback(r=>{e(O3(r.target.checked))},[e]);return o.jsxs(V,{w:"full",children:[o.jsx(U,{flexGrow:1,m:0,children:t("gallery.showStarredImagesFirst")}),o.jsx(ot,{size:"sm",isChecked:n,onChange:s})]})},Qee=l.memo(Kee),Yee=pe(ks,e=>e.orderDir),Jee=()=>{const e=E(),{t}=S(),n=w(Yee),s=l.useMemo(()=>[{value:"DESC",label:t("gallery.newestFirst")},{value:"ASC",label:t("gallery.oldestFirst")}],[t]),r=l.useCallback(i=>{Fe((i==null?void 0:i.value)==="ASC"||(i==null?void 0:i.value)==="DESC"),e(N3(i.value))},[e]),a=l.useMemo(()=>s.find(i=>i.value===n),[n,s]);return o.jsxs(V,{children:[o.jsx(U,{flexGrow:1,m:0,children:t("gallery.sortDirection")}),o.jsx(Ne,{isSearchable:!1,value:a,options:s,onChange:r})]})},Xee=l.memo(Jee),ete=()=>{const{t:e}=S();return o.jsxs(Qn,{isLazy:!0,children:[o.jsx(ds,{children:o.jsx(Q,{size:"sm",variant:"link",alignSelf:"stretch","aria-label":e("gallery.imagesSettings"),icon:o.jsx(xc,{}),tooltip:e("gallery.imagesSettings")})}),o.jsx(Yn,{children:o.jsx(Jn,{children:o.jsxs(j,{direction:"column",gap:2,children:[o.jsx(Zee,{}),o.jsx(Gee,{}),o.jsx(Vee,{}),o.jsx(zt,{pt:2}),o.jsx(Qee,{}),o.jsx(Xee,{})]})})})]})},tte=l.memo(ete),nte={postUploadAction:{type:"TOAST"},allowMultiple:!0},ste=()=>{const e=v1(nte),t=w(Np);return o.jsxs(o.Fragment,{children:[o.jsx(Q,{size:"sm",alignSelf:"stretch",variant:"link","aria-label":t===void 0||t>1?ve("accessibility.uploadImages"):ve("accessibility.uploadImage"),tooltip:t===void 0||t>1?ve("accessibility.uploadImages"):ve("accessibility.uploadImage"),icon:o.jsx(qI,{}),...e.getUploadButtonProps()}),o.jsx("input",{...e.getUploadInputProps()})]})},cP=l.memo(()=>{const e=E(),{selection:t}=w(a=>a.gallery),{imageDTOs:n}=k1(),s=js("gallery"),r=l.useCallback(()=>{e(Wx([...t,...n]))},[e,t,n]);return Ie({id:"selectAllOnPage",category:"gallery",callback:r,options:{preventDefault:!0,enabled:s},dependencies:[r,s]}),t.length<=1?null:o.jsx(dP,{selection:t})});cP.displayName="GallerySelectionCountTag";const dP=l.memo(({selection:e})=>{const{t}=S(),n=E(),s=js("gallery"),r=l.useCallback(()=>{const a=e[0];a&&n(Wx([a]))},[n,e]);return Ie({id:"clearSelection",category:"gallery",callback:r,options:{enabled:e.length>0&&s},dependencies:[r,e,s]}),o.jsxs(eb,{position:"absolute",bg:"invokeBlue.800",color:"base.50",py:2,px:4,userSelect:"none",shadow:"dark-lg",fontWeight:"semibold",border:1,borderStyle:"solid",borderColor:"whiteAlpha.300",children:[o.jsxs(bS,{children:[e.length," ",t("common.selected")]}),o.jsx(tb,{onClick:r})]})});dP.displayName="GallerySelectionCountTagContent";const ote=()=>{wt("useGalleryHotkeys");const{goNext:e,goPrev:t,isNextEnabled:n,isPrevEnabled:s}=Zf(),r=E(),a=w(_=>_.gallery.selection),i=w(ac),c=_i(i),d=w(Wp),u=w(bn),h=js("workflows"),p=js("gallery"),f=js("viewer"),m=l.useMemo(()=>u!=="canvas"?!0:d==="gallery",[u,d]),{handleLeftImage:g,handleRightImage:x,handleUpImage:C,handleDownImage:y,isOnFirstRow:v,isOnLastRow:I,isOnFirstImageOfView:k,isOnLastImageOfView:M}=fL();Ie({id:"galleryNavLeft",category:"gallery",callback:()=>{if(k&&s&&!c.isFetching){t("arrow");return}g(!1)},options:{preventDefault:!0,enabled:p||f},dependencies:[g,k,t,s,c.isFetching,p,f]}),Ie({id:"galleryNavRight",category:"gallery",callback:()=>{if(M&&n&&!c.isFetching){e("arrow");return}M||x(!1)},options:{preventDefault:!0,enabled:p||f},dependencies:[M,e,n,c.isFetching,x,p,f]}),Ie({id:"galleryNavUp",category:"gallery",callback:()=>{if(v&&s&&!c.isFetching){t("arrow");return}C(!1)},options:{preventDefault:!0,enabled:p},dependencies:[C,v,t,s,c.isFetching,p]}),Ie({id:"galleryNavDown",category:"gallery",callback:()=>{if(I&&n&&!c.isFetching){e("arrow");return}y(!1)},options:{preventDefault:!0,enabled:p},dependencies:[I,e,n,c.isFetching,y,p]}),Ie({id:"galleryNavLeftAlt",category:"gallery",callback:()=>{if(k&&s&&!c.isFetching){t("alt+arrow");return}g(!0)},options:{preventDefault:!0,enabled:p||f},dependencies:[g,k,t,s,c.isFetching,p,f]}),Ie({id:"galleryNavRightAlt",category:"gallery",callback:()=>{if(M&&n&&!c.isFetching){e("alt+arrow");return}M||x(!0)},options:{preventDefault:!0,enabled:p||f},dependencies:[M,e,n,c.isFetching,x,p,f]}),Ie({id:"galleryNavUpAlt",category:"gallery",callback:()=>{if(v&&s&&!c.isFetching){t("alt+arrow");return}C(!0)},options:{preventDefault:!0,enabled:p},dependencies:[C,v,t,s,c.isFetching,p]}),Ie({id:"galleryNavDownAlt",category:"gallery",callback:()=>{if(I&&n&&!c.isFetching){e("alt+arrow");return}y(!0)},options:{preventDefault:!0,enabled:p},dependencies:[I,e,n,c.isFetching,y,p]}),Ie({id:"deleteSelection",category:"gallery",callback:()=>{a.length&&r($d(a))},options:{enabled:(p||f)&&m&&!h},dependencies:[h,m,a,h]})},rte=()=>{ote();const{t:e}=S(),t=w(ac),{imageDTOs:n,isLoading:s,isError:r}=_i(t,{selectFromResult:({data:a,isLoading:i,isSuccess:c,isError:d})=>({imageDTOs:(a==null?void 0:a.items)??Ss,isLoading:i,isSuccess:c,isError:d})});return r?o.jsx(xe,{w:"full",h:"full",children:o.jsx(Mt,{label:e("gallery.unableToLoad"),icon:KI})}):s?o.jsx(j,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:o.jsx(Mt,{label:e("gallery.loading"),icon:fi})}):n.length===0?o.jsx(j,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:o.jsx(Mt,{label:e("gallery.noImagesInGallery"),icon:fi})}):o.jsx(ite,{})},ate=l.memo(rte),ite=()=>{const e=E(),t=w(xS),n=w(ac),{imageDTOs:s}=_i(n,{selectFromResult:({data:c})=>({imageDTOs:(c==null?void 0:c.items)??Ss})}),[r,a]=l.useState(null),i=l.useMemo(()=>Ai(()=>{if(!r)return;const c=document.querySelector(`.${I1}`);if(!c)return;const d=document.querySelector(`.${R0}`);if(!d)return;const u=c.getBoundingClientRect(),h=r.getBoundingClientRect(),p=window.getComputedStyle(d),f=parseFloat(p.gap);if(!u.width||!u.height||!h.width||!h.height)return;let m=0,g=0;for(;g+u.height<=h.height+1;)m++,g+=u.height,g+f<=h.height&&(g+=f);let x=0;for(g=0;g+u.width<=h.width+1;)x++,g+=u.width,g+f<=h.width&&(g+=f);const C=Math.max(x,x*m);n===Kn||n.limit===C||e(B3(C))},300),[r,e,n]);return l.useEffect(()=>{i()},[i,t,s]),l.useEffect(()=>{if(!r)return;const c=new ResizeObserver(i);return c.observe(r),i(),()=>{c.disconnect()}},[i,r,e]),o.jsxs(xe,{position:"relative",w:"full",h:"full",mt:2,children:[o.jsx(xe,{ref:a,position:"absolute",top:0,right:0,bottom:0,left:0,w:"full",h:"full",overflow:"hidden",children:o.jsx(va,{className:R0,gridTemplateColumns:`repeat(auto-fill, minmax(${t}px, 1fr))`,gap:1,children:s.map((c,d)=>o.jsx(iL,{imageDTO:c,index:d},c.image_name))})}),o.jsx(cP,{})]})},uP=l.memo(()=>{const{t:e}=S(),{goToPage:t,currentPage:n,pages:s}=Zf(),[r,a]=l.useState(n),{isOpen:i,onToggle:c,onClose:d}=Is(),u=l.useRef(null),h=l.useCallback(()=>{a(n),setTimeout(()=>{var g;const m=(g=u.current)==null?void 0:g.querySelector("input");m==null||m.focus(),m==null||m.select()},0)},[n]),p=l.useCallback(m=>{a(m-1)},[]),f=l.useCallback(()=>{t(r),d()},[r,t,d]);return lo("enter",()=>{f()},{enabled:i,enableOnFormTags:["input"]},[i,f]),lo("esc",()=>{a(n),d()},{enabled:i,enableOnFormTags:["input"]},[i,d]),l.useEffect(()=>{a(n)},[n]),o.jsxs(Qn,{isOpen:i,onClose:d,onOpen:h,isLazy:!0,lazyBehavior:"unmount",children:[o.jsx(ds,{children:o.jsx(me,{"aria-label":e("gallery.jump"),size:"sm",onClick:c,variant:"outline",children:e("gallery.jump")})}),o.jsxs(Yn,{children:[o.jsx(Zr,{}),o.jsx(Jn,{children:o.jsxs(j,{gap:2,alignItems:"center",children:[o.jsx(V,{children:o.jsx(Ve,{ref:u,size:"sm",maxW:"60px",value:r+1,min:1,max:s,step:1,onChange:p})}),o.jsx(me,{h:"full",size:"sm",onClick:f,children:e("gallery.go")})]})})]})]})});uP.displayName="JumpTo";const hP=l.memo(()=>{const{goPrev:e,goNext:t,isPrevEnabled:n,isNextEnabled:s,pageButtons:r,goToPage:a,currentPage:i,total:c}=Zf(),d=l.useCallback(()=>{e()},[e]),u=l.useCallback(()=>{t()},[t]);return c?o.jsxs(j,{justifyContent:"center",alignItems:"center",w:"full",gap:1,pt:2,children:[o.jsx(Q,{size:"sm","aria-label":"prev",icon:o.jsx(Tb,{}),onClick:d,isDisabled:!n,variant:"ghost"}),o.jsx(dt,{}),r.map((h,p)=>o.jsx(pP,{page:h,currentPage:i,goToPage:a},`${h}_${p}`)),o.jsx(dt,{}),o.jsx(Q,{size:"sm","aria-label":"next",icon:o.jsx(Pb,{}),onClick:u,isDisabled:!s,variant:"ghost"}),o.jsx(uP,{})]}):null});hP.displayName="GalleryPagination";const pP=l.memo(({page:e,currentPage:t,goToPage:n})=>e===nd?o.jsx(me,{size:"sm",variant:"link",isDisabled:!0,children:"..."}):o.jsx(me,{size:"sm",onClick:n.bind(null,e-1),variant:t===e-1?"solid":"outline",children:e}));pP.displayName="PageButton";const lte=({searchTerm:e,onChangeSearchTerm:t,onResetSearchTerm:n})=>{const{t:s}=S(),r=w(ac),{isPending:a}=_i(r,{selectFromResult:({isLoading:d,isFetching:u})=>({isPending:d||u})}),i=l.useCallback(d=>{t(d.target.value)},[t]),c=l.useCallback(d=>{d.key==="Escape"&&n()},[n]);return o.jsxs(Ur,{children:[o.jsx(Vt,{placeholder:s("gallery.searchImages"),value:e,onChange:i,"data-testid":"image-search-input",onKeyDown:c}),a&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(pr,{size:"sm",opacity:.5})}),!a&&e.length&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(Q,{onClick:n,size:"sm",variant:"link","aria-label":s("boards.clearSearch"),icon:o.jsx(sn,{})})})]})},GC={fontWeight:"semibold",fontSize:"sm",color:"base.300"},UC={borderColor:"base.800",borderBottomColor:"base.900",color:"invokeBlue.300"},cte={flexShrink:0,minHeight:0,width:"100%"},dte=pe(ks,e=>e.galleryView),ute=pe(ks,e=>e.searchTerm),hte=()=>{const{t:e}=S(),t=E(),n=w(dte),s=w(ute),r=Is({defaultIsOpen:s.length>0}),[a,i,c]=$ee(),d=l.useCallback(()=>{t(Hg("images"))},[t]),u=l.useCallback(()=>{t(Hg("assets"))},[t]),h=l.useCallback(()=>{r.onToggle(),c()},[c,r]),p=w(Hd),f=gu(p);return o.jsxs(j,{flexDirection:"column",alignItems:"center",justifyContent:"space-between",h:"full",w:"full",pt:1,minH:0,children:[o.jsx(ki,{index:n==="images"?0:1,variant:"enclosed",display:"flex",flexDir:"column",w:"full",children:o.jsxs(Ii,{gap:2,fontSize:"sm",borderColor:"base.800",alignItems:"center",w:"full",children:[o.jsx(O,{fontSize:"sm",fontWeight:"semibold",noOfLines:1,px:"2",wordBreak:"break-all",children:f}),o.jsx(dt,{}),o.jsx(Ae,{label:e("gallery.imagesTab"),children:o.jsx(rn,{sx:GC,_selected:UC,onClick:d,"data-testid":"images-tab",children:e("parameters.images")})}),o.jsx(Ae,{label:e("gallery.assetsTab"),children:o.jsx(rn,{sx:GC,_selected:UC,onClick:u,"data-testid":"assets-tab",children:e("gallery.assets")})}),o.jsxs(j,{h:"full",justifyContent:"flex-end",children:[o.jsx(ste,{}),o.jsx(tte,{}),o.jsx(Q,{size:"sm",variant:"link",alignSelf:"stretch",onClick:h,tooltip:r.isOpen?`${e("gallery.exitSearch")}`:`${e("gallery.displaySearch")}`,"aria-label":e("gallery.displaySearch"),icon:o.jsx(zI,{})})]})]})}),o.jsx(Mi,{in:r.isOpen,style:cte,children:o.jsx(xe,{w:"full",pt:2,children:o.jsx(lte,{searchTerm:a,onChangeSearchTerm:i,onResetSearchTerm:c})})}),o.jsx(ate,{}),o.jsx(hP,{})]})},pte={flexShrink:0,minHeight:0},fte=()=>{const{t:e}=S(),t=w(qp),n=E(),s=Is({defaultIsOpen:!!t.length}),r=l.useRef(null),a=l.useRef(null);Oa("gallery",a);const i=l.useMemo(()=>({id:"boards-list-panel",minSizePx:128,defaultSizePx:256,imperativePanelGroupRef:r,panelGroupDirection:"vertical"}),[]),c=B0(i),d=l.useCallback(()=>{t.length&&n(Kh("")),s.onToggle(),c.expand()},[t.length,s,c,n]);return o.jsxs(j,{ref:a,position:"relative",flexDirection:"column",h:"full",w:"full",tabIndex:-1,children:[o.jsxs(j,{alignItems:"center",w:"full",children:[o.jsx(j,{w:"25%",children:o.jsx(me,{size:"sm",variant:"ghost",onClick:c.toggle,rightIcon:c.isCollapsed?o.jsx(Fo,{}):o.jsx(LI,{}),children:c.isCollapsed?e("boards.viewBoards"):e("boards.hideBoards")})}),o.jsx(rP,{}),o.jsxs(j,{h:"full",w:"25%",justifyContent:"flex-end",children:[o.jsx(Bee,{}),o.jsx(Q,{size:"sm",variant:"link",alignSelf:"stretch",onClick:d,tooltip:s.isOpen?`${e("gallery.exitBoardSearch")}`:`${e("gallery.displayBoardSearch")}`,"aria-label":e("gallery.displayBoardSearch"),icon:o.jsx(zI,{}),colorScheme:s.isOpen?"invokeBlue":"base"})]})]}),o.jsxs(Lu,{ref:r,direction:"vertical",autoSaveId:"boards-list-panel",children:[o.jsx(or,{collapsible:!0,...c.panelProps,children:o.jsxs(j,{flexDir:"column",w:"full",h:"full",children:[o.jsx(Mi,{in:s.isOpen,style:pte,children:o.jsx(xe,{w:"full",pt:2,children:o.jsx(See,{})})}),o.jsx(zt,{pt:2}),o.jsx(wee,{})]})}),o.jsx(Md,{id:"gallery-panel-handle",...c.resizeHandleProps}),o.jsx(or,{id:"gallery-wrapper-panel",minSize:20,children:o.jsx(hte,{})})]})]})},fP=l.memo(fte),mP=l.memo(()=>{const{t:e}=S(),t=w(Wp),n=jt(),s=E(),r=l.useMemo(()=>t==="gallery"?1:0,[t]),a=l.useCallback(()=>{t!=="gallery"&&s(Ao("gallery")),n.toggle()},[n,t,s]),i=l.useCallback(c=>{s(c===0?Ao("layers"):Ao("gallery"))},[s]);return Ie({id:"toggleViewer",category:"viewer",callback:n.toggle,dependencies:[n]}),o.jsxs(ki,{index:r,onChange:i,w:"full",h:"full",display:"flex",flexDir:"column",children:[o.jsxs(Ii,{alignItems:"center",children:[o.jsx(gP,{}),o.jsx(dt,{}),o.jsx(me,{size:"sm",variant:"ghost",onClick:a,children:n.isOpen?e("gallery.closeViewer"):e("gallery.openViewer")})]}),o.jsxs(oc,{w:"full",h:"full",children:[o.jsx(mn,{w:"full",h:"full",p:0,pt:3,children:o.jsx(Jo,{children:o.jsx(oP,{})})}),o.jsx(mn,{w:"full",h:"full",p:0,pt:3,children:o.jsx(fP,{})})]})]})});mP.displayName="CanvasRightPanel";const gP=l.memo(()=>{const{t:e}=S(),t=w(Wp),n=w($3),s=l.useRef(null),r=yS(),a=E(),[i,c]=l.useState(null),d=l.useCallback(()=>{c("layers"),s.current=window.setTimeout(()=>{r.active&&a(Ao("layers"))},300)},[r.active,a]),u=l.useCallback(()=>{c("gallery"),s.current=window.setTimeout(()=>{r.active&&a(Ao("gallery"))},300)},[r.active,a]),h=l.useCallback(()=>{c(null),s.current&&clearTimeout(s.current)},[]),p=l.useMemo(()=>n===0?e("controlLayers.layer_other"):`${e("controlLayers.layer_other")} (${n})`,[n,e]);return o.jsxs(o.Fragment,{children:[o.jsxs(rn,{position:"relative",onMouseOver:d,onMouseOut:h,w:32,children:[o.jsx(xe,{as:"span",w:"full",children:p}),r.active&&t!=="layers"&&o.jsx(w0,{isOver:i==="layers",withBackdrop:!1})]}),o.jsxs(rn,{position:"relative",onMouseOver:u,onMouseOut:h,w:32,children:[o.jsx(xe,{as:"span",w:"full",children:e("gallery.gallery")}),r.active&&t!=="gallery"&&o.jsx(w0,{isOver:i==="gallery",withBackdrop:!1})]})]})});gP.displayName="PanelTabs";const mte=pt(bt,e=>Kp(e)),gte=()=>{const{t:e}=S(),t=w(mte);return t?o.jsx(Wr,{data:t.data,label:"Node Data"}):o.jsx(Mt,{label:e("nodes.noNodeSelected"),icon:null})},xte=l.memo(gte),om=e=>{const t=l.useMemo(()=>pt(bt,s=>au(s,e)),[e]);return w(t)},bte=({nodeId:e})=>{const t=E(),n=om(e),{t:s}=S(),r=l.useCallback(a=>{t(F3({nodeId:e,notes:a.target.value}))},[t,e]);return Wg(n)?o.jsxs(V,{orientation:"vertical",h:"full",children:[o.jsx(U,{children:s("nodes.notes")}),o.jsx(ls,{value:n==null?void 0:n.notes,onChange:r,rows:10,resize:"none"})]}):null},yte=l.memo(bte),ea=e=>{const t=se(yn),n=l.useMemo(()=>pe(bt,a=>vS(a,e)),[e]),s=w(n);return l.useMemo(()=>{const a=t[s];return Fe(a,`Template for node type ${s} not found`),a},[s,t])},xP=e=>{const t=om(e),n=ea(e);return l.useMemo(()=>CS(t,n),[t,n])},bP=e=>{const t=l.useMemo(()=>pe(bt,s=>{const r=s.nodes.find(a=>a.id===e);return r==null?void 0:r.data.label}),[e]);return w(t)},yP=e=>{const t=se(yn),n=l.useMemo(()=>pe(bt,r=>{const a=r.nodes.find(c=>c.id===e);if(!Br(a))return null;const i=t[a.data.type];return(i==null?void 0:i.title)??null}),[e,t]);return w(n)},vte=({nodeId:e,title:t})=>{const n=E(),s=bP(e),r=yP(e),{t:a}=S(),[i,c]=l.useState(""),d=l.useCallback(h=>{n(wS({nodeId:e,label:h})),c(s||t||r||a("nodes.problemSettingTitle"))},[n,e,t,r,s,a]),u=l.useCallback(h=>{c(h)},[]);return l.useEffect(()=>{c(s||t||r||a("nodes.problemSettingTitle"))},[s,r,t,a]),o.jsx(j,{w:"full",alignItems:"center",justifyContent:"center",children:o.jsxs(nb,{as:j,value:i,onChange:u,onSubmit:d,w:"full",fontWeight:"semibold",children:[o.jsx(sb,{noOfLines:1}),o.jsx(ob,{className:"nodrag"})]})})},Cte=l.memo(vte),wte=()=>{const e=se(yn),t=l.useMemo(()=>pt(bt,r=>{const a=Kp(r),i=a?e[a.data.type]:void 0;if(!(!Br(a)||!i))return{nodeId:a.data.id,nodeVersion:a.data.version,templateTitle:i.title}}),[e]),n=w(t),{t:s}=S();return n?o.jsx(vP,{nodeId:n.nodeId,nodeVersion:n.nodeVersion,templateTitle:n.templateTitle}):o.jsx(Mt,{label:s("nodes.noNodeSelected"),icon:null})},jte=l.memo(wte),vP=l.memo(e=>{const{t}=S(),n=xP(e.nodeId);return o.jsx(xe,{position:"relative",w:"full",h:"full",children:o.jsx(Nn,{children:o.jsxs(j,{flexDir:"column",position:"relative",w:"full",h:"full",p:1,gap:2,children:[o.jsx(Cte,{nodeId:e.nodeId}),o.jsxs(z3,{children:[o.jsxs(V,{children:[o.jsx(U,{children:t("nodes.nodeType")}),o.jsx(O,{fontSize:"sm",fontWeight:"semibold",children:e.templateTitle})]}),o.jsxs(V,{isInvalid:n,children:[o.jsx(U,{children:t("nodes.nodeVersion")}),o.jsx(O,{fontSize:"sm",fontWeight:"semibold",children:e.nodeVersion})]})]}),o.jsx(yte,{nodeId:e.nodeId})]})})})});vP.displayName="Content";const Ste=({output:e})=>{const{image:t}=e,{data:n}=Gr(t.image_name);return o.jsx(Di,{imageDTO:n})},kte=l.memo(Ste),Ite=()=>{const e=se(yn),t=l.useMemo(()=>pt(bt,a=>{const i=Kp(a),c=i?e[i.data.type]:void 0;if(!(!Br(i)||!c))return{nodeId:i.id,outputType:c.outputType}}),[e]),n=w(t),s=rb(n==null?void 0:n.nodeId),{t:r}=S();return!n||!s?o.jsx(Mt,{label:r("nodes.noNodeSelected"),icon:null}):s.outputs.length===0?o.jsx(Mt,{label:r("nodes.noOutputRecorded"),icon:null}):o.jsx(xe,{position:"relative",w:"full",h:"full",children:o.jsx(Nn,{children:o.jsx(j,{position:"relative",flexDir:"column",alignItems:"flex-start",p:1,gap:2,h:"full",w:"full",children:n.outputType==="image_output"?s.outputs.map((a,i)=>o.jsx(kte,{output:a},Mte(a,i))):o.jsx(Wr,{data:s.outputs,label:r("nodes.nodeOutputs")})})})})},_te=l.memo(Ite),Mte=(e,t)=>`${e.type}-${t}`,Ate=()=>{const e=se(yn),t=l.useMemo(()=>pt(bt,r=>{const a=Kp(r);return a?e[a.data.type]:void 0}),[e]),n=w(t),{t:s}=S();return n?o.jsx(Wr,{data:n,label:s("nodes.nodeTemplate")}):o.jsx(Mt,{label:s("nodes.noNodeSelected"),icon:null})},Ete=l.memo(Ate),Lte=()=>{const{t:e}=S();return o.jsx(j,{layerStyle:"first",flexDir:"column",w:"full",h:"full",borderRadius:"base",p:2,gap:2,children:o.jsxs(ki,{variant:"line",display:"flex",flexDir:"column",w:"full",h:"full",children:[o.jsxs(Ii,{children:[o.jsx(rn,{children:e("common.details")}),o.jsx(rn,{children:e("common.outputs")}),o.jsx(rn,{children:e("common.data")}),o.jsx(rn,{children:e("common.template")})]}),o.jsxs(oc,{children:[o.jsx(mn,{children:o.jsx(jte,{})}),o.jsx(mn,{children:o.jsx(_te,{})}),o.jsx(mn,{children:o.jsx(xte,{})}),o.jsx(mn,{children:o.jsx(Ete,{})})]})]})})},Tte=l.memo(Lte),Pte=()=>{const{t:e}=S(),t=E(),n=mu(),s=w(V3),r=l.useCallback(()=>{t(Ul("edit"))},[t]),a=l.useCallback(()=>{t(Ul("edit"))},[t]);return o.jsx(j,{w:"full",userSelect:"none",justifyContent:"center",children:o.jsxs(j,{alignItems:"center",justifyContent:"center",borderRadius:"base",flexDir:"column",gap:5,maxW:"230px",pt:24,children:[o.jsx(nn,{src:H3,alt:"invoke-ai-logo",opacity:.2,mixBlendMode:"overlay",w:16,h:16,minW:16,minH:16,userSelect:"none"}),s?o.jsxs(o.Fragment,{children:[o.jsxs(j,{gap:2,children:[o.jsx(me,{size:"sm",onClick:a,children:e("nodes.newWorkflow")}),o.jsx(me,{size:"sm",colorScheme:"invokeBlue",onClick:n.open,children:e("nodes.loadWorkflow")})]}),o.jsx(O,{textAlign:"center",fontSize:"md",children:o.jsx(Cs,{i18nKey:"nodes.workflowHelpText",size:"sm",components:Rte})})]}):o.jsxs(o.Fragment,{children:[o.jsx(O,{textAlign:"center",fontSize:"md",children:e("nodes.noFieldsViewMode")}),o.jsx(me,{size:"sm",colorScheme:"invokeBlue",onClick:r,children:e("nodes.edit")})]})]})})},Rte={LinkComponent:o.jsx(Xx,{fontSize:"md",fontWeight:"semibold",href:"https://support.invoke.ai/support/solutions/articles/151000159663-example-workflows",target:"_blank"})},CP=(e,t)=>{const n=l.useMemo(()=>pt(bt,r=>jS(r,e,t)),[t,e]);return w(n)},wP=(e,t,n)=>{const s=se(yn),r=l.useMemo(()=>pe(bt,c=>vS(c,e)),[e]),a=w(r);return l.useMemo(()=>{const c=s[a];if(Fe(c,`Template for node type ${a} not found`),n==="inputs"){const d=c.inputs[t];return Fe(d,`Field template for field ${t} not found`),d}else{const d=c.outputs[t];return Fe(d,`Field template for field ${t} not found`),d}},[t,n,a,s])},jP=e=>{const{t}=S();return l.useMemo(()=>{if(!e)return"";const{name:s}=e;return nl(e)?t("nodes.collectionFieldType",{name:s}):ca(e)?t("nodes.collectionOrScalarFieldType",{name:s}):t("nodes.singleFieldType",{name:s})},[e,t])},Dte=({nodeId:e,fieldName:t,kind:n})=>{const s=CP(e,t),r=wP(e,t,n),a=W3(r),i=jP(r==null?void 0:r.type),{t:c}=S(),d=l.useMemo(()=>G3(s)?s.label&&(r!=null&&r.title)?`${s.label} (${r.title})`:s.label&&!r?s.label:!s.label&&r?r.title:c("nodes.unknownField"):(r==null?void 0:r.title)||c("nodes.unknownField"),[s,r,c]);return o.jsxs(j,{flexDir:"column",children:[o.jsx(O,{fontWeight:"semibold",children:d}),r&&o.jsx(O,{opacity:.7,fontStyle:"oblique 5deg",children:r.description}),i&&o.jsxs(O,{children:[c("parameters.type"),": ",i]}),a&&o.jsxs(O,{children:[c("common.input"),": ",U3(r.input)]})]})},rm=l.memo(Dte),Ote=e=>{const{nodeId:t,field:n}=e,s=E(),{data:r,isLoading:a}=$p(),i=l.useCallback(m=>{m&&s(Z3({nodeId:t,fieldName:n.name,value:m}))},[s,n.name,t]),c=l.useMemo(()=>r?Yd.selectAll(r):Ss,[r]),{options:d,value:u,onChange:h,placeholder:p,noOptionsMessage:f}=vn({modelConfigs:c,onChange:i,isLoading:a,selectedModel:n.value,groupByType:!0});return o.jsx(j,{w:"full",alignItems:"center",gap:2,children:o.jsx(V,{className:"nowheel nodrag",isDisabled:!d.length,isInvalid:!u,children:o.jsx(Ne,{value:u,placeholder:p,options:d,onChange:h,noOptionsMessage:f})})})},Nte=l.memo(Ote),SP=(e,t)=>{const n=ea(e);return l.useMemo(()=>{const r=n.inputs[t];return Fe(r,`Field template for field ${t} not found`),r},[t,n.inputs])},Bte=e=>{const{nodeId:t,field:n}=e,s=E(),{t:r}=S(),{options:a,hasBoards:i}=nc({include_archived:!0},{selectFromResult:({data:h})=>{const p=[{label:"None",value:"none"}].concat((h??[]).map(({board_id:f,board_name:m})=>({label:m,value:f})));return{options:p,hasBoards:p.length>1}}}),c=l.useCallback(h=>{h&&s(q3({nodeId:t,fieldName:n.name,value:h.value!=="none"?{board_id:h.value}:void 0}))},[s,n.name,t]),d=l.useMemo(()=>a.find(h=>{var p;return h.value===((p=n.value)==null?void 0:p.board_id)}),[a,n.value]),u=l.useCallback(()=>r("boards.noMatching"),[r]);return o.jsx(V,{className:"nowheel nodrag",isDisabled:!i,children:o.jsx(Ne,{value:d,options:a,onChange:c,placeholder:r("boards.selectBoard"),noOptionsMessage:u})})},$te=l.memo(Bte),Fte=e=>{const{nodeId:t,field:n}=e,s=E(),r=l.useCallback(a=>{s(K3({nodeId:t,fieldName:n.name,value:a.target.checked}))},[s,n.name,t]);return o.jsx(ot,{className:"nodrag",onChange:r,isChecked:n.value})},zte=l.memo(Fte),Vte=e=>{const{nodeId:t,field:n}=e,{t:s}=S(),r=w(g=>g.config.disabledTabs),a=E(),[i,{isLoading:c}]=l1(),d=l.useCallback(g=>{g&&a(Q3({nodeId:t,fieldName:n.name,value:g}))},[a,n.name,t]),{options:u,value:h,onChange:p,placeholder:f,noOptionsMessage:m}=vn({modelConfigs:i,onChange:d,isLoading:c,selectedModel:n.value});return o.jsx(j,{w:"full",alignItems:"center",gap:2,children:o.jsx(Ae,{label:!r.includes("models")&&s("modelManager.starterModelsInModelManager"),children:o.jsx(V,{className:"nowheel nodrag",isDisabled:!u.length,isInvalid:!h,children:o.jsx(Ne,{value:h,placeholder:f,options:u,onChange:p,noOptionsMessage:m})})})})},Hte=l.memo(Vte),Or=e=>`var(--invoke-colors-${e.split(".").join("-")})`,Wte={r:0,g:0,b:0,a:255},Gte=e=>{const{nodeId:t,field:n}=e,s=E(),r=l.useMemo(()=>{if(!n.value)return Wte;const{r:i,g:c,b:d,a:u}=n.value;return{r:i,g:c,b:d,a:u/255}},[n.value]),a=l.useCallback(i=>{typeof i=="string"&&(i=Zq(i,1));const{r:c,g:d,b:u,a:h}=i,p=Math.round(h*255);s(Y3({nodeId:t,fieldName:n.name,value:{r:c,g:d,b:u,a:p}}))},[s,n.name,t]);return o.jsxs(xe,{sx:{display:"flex",flexDirection:"column",gap:2},children:[o.jsx(XK,{style:{background:Or("base.700"),color:Or("base.100"),fontSize:12,paddingInlineStart:10,borderRadius:4,paddingBlock:4,outline:"none"},className:"nodrag",color:Uq(r,!0),onChange:a,prefixed:!0,alpha:!0}),o.jsx(CE,{className:"nodrag",color:r,onChange:a,style:{width:"100%"}})]})},Ute=l.memo(Gte),Zte=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=a1(),i=l.useCallback(f=>{f&&s(J3({nodeId:t,fieldName:n.name,value:f}))},[s,n.name,t]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=vn({modelConfigs:r,onChange:i,selectedModel:n.value,isLoading:a});return o.jsx(Ae,{label:d==null?void 0:d.description,children:o.jsx(V,{className:"nowheel nodrag",isInvalid:!d,children:o.jsx(Ne,{value:d,placeholder:h,options:c,onChange:u,noOptionsMessage:p})})})},qte=l.memo(Zte),Kte=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,r=E(),a=l.useCallback(i=>{r(X3({nodeId:t,fieldName:n.name,value:i.target.value}))},[r,n.name,t]);return o.jsx(eN,{className:"nowheel nodrag",onChange:a,value:n.value,children:s.options.map(i=>o.jsx("option",{value:i,children:s.ui_choice_labels?s.ui_choice_labels[i]:i},i))})},Qte=l.memo(Kte),Yte=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=LZ(),i=l.useCallback(f=>{f&&s(ab({nodeId:t,fieldName:n.name,value:f}))},[s,n.name,t]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=vn({modelConfigs:r,onChange:i,isLoading:a,selectedModel:n.value});return o.jsx(j,{w:"full",alignItems:"center",gap:2,children:o.jsx(V,{className:"nowheel nodrag",isDisabled:!c.length,isInvalid:!d,children:o.jsx(Ne,{value:d,placeholder:h,options:c,onChange:u,noOptionsMessage:p})})})},Jte=l.memo(Yte),Xte=e=>{const{nodeId:t,field:n}=e,{t:s}=S(),r=w(g=>g.config.disabledTabs),a=E(),[i,{isLoading:c}]=UM(),d=l.useCallback(g=>{g&&a(tN({nodeId:t,fieldName:n.name,value:g}))},[a,n.name,t]),{options:u,value:h,onChange:p,placeholder:f,noOptionsMessage:m}=vn({modelConfigs:i,onChange:d,isLoading:c,selectedModel:n.value});return o.jsx(j,{w:"full",alignItems:"center",gap:2,children:o.jsx(Ae,{label:!r.includes("models")&&s("modelManager.starterModelsInModelManager"),children:o.jsx(V,{className:"nowheel nodrag",isDisabled:!u.length,isInvalid:!h,children:o.jsx(Ne,{value:h,placeholder:f,options:u,onChange:p,noOptionsMessage:m})})})})},ene=l.memo(Xte),tne=e=>{var f;const{nodeId:t,field:n,fieldTemplate:s}=e,r=E(),a=se(On),{currentData:i,isError:c}=Gr(((f=n.value)==null?void 0:f.image_name)??Kn),d=l.useCallback(()=>{r(nN({nodeId:t,fieldName:n.name,value:void 0}))},[r,n.name,t]),u=l.useMemo(()=>{if(i)return{id:`node-${t}-${n.name}`,payloadType:"IMAGE_DTO",payload:{imageDTO:i}}},[n.name,i,t]),h=l.useMemo(()=>({id:`node-${t}-${n.name}`,actionType:"SET_NODES_IMAGE",context:{nodeId:t,fieldName:n.name}}),[n.name,t]),p=l.useMemo(()=>({type:"SET_NODES_IMAGE",nodeId:t,fieldName:n.name}),[t,n.name]);return l.useEffect(()=>{a&&c&&d()},[d,a,c]),o.jsx(j,{className:"nodrag",w:"full",h:"full",alignItems:"center",justifyContent:"center",borderColor:"error.500",borderStyle:"solid",borderWidth:s.required&&!n.value?1:0,borderRadius:"base",children:o.jsx(Di,{imageDTO:i,droppableData:h,draggableData:u,postUploadAction:p,useThumbailFallback:!0,uploadElement:o.jsx(kP,{}),minSize:8,children:o.jsx(Ic,{onClick:d,icon:i?o.jsx(Kr,{}):void 0,tooltip:"Reset Image"})})})},nne=l.memo(tne),kP=l.memo(()=>{const{t:e}=S();return o.jsx(j,{h:16,w:"full",alignItems:"center",justifyContent:"center",children:o.jsx(O,{fontSize:16,fontWeight:"semibold",children:e("gallery.dropOrUpload")})})});kP.displayName="UploadElement";const sne=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=c1(),i=l.useCallback(h=>{h&&s(sN({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:c,value:d,onChange:u}=vn({modelConfigs:r,onChange:i,selectedModel:n.value,isLoading:a});return o.jsx(Ae,{label:d==null?void 0:d.description,children:o.jsx(V,{className:"nowheel nodrag",isInvalid:!d,children:o.jsx(Ne,{value:d,placeholder:"Pick one",options:c,onChange:u})})})},one=l.memo(sne),rne=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=wf(),i=l.useCallback(f=>{f&&s(oN({nodeId:t,fieldName:n.name,value:f}))},[s,n.name,t]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=vn({modelConfigs:r,onChange:i,selectedModel:n.value,isLoading:a});return o.jsx(V,{className:"nowheel nodrag",isInvalid:!d,isDisabled:!c.length,children:o.jsx(Ne,{value:d,placeholder:h,noOptionsMessage:p,options:c,onChange:u})})},ane=l.memo(rne),ine=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=EZ(),i=l.useCallback(f=>{f&&s(ab({nodeId:t,fieldName:n.name,value:f}))},[s,n.name,t]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=vn({modelConfigs:r,onChange:i,isLoading:a,selectedModel:n.value});return o.jsx(j,{w:"full",alignItems:"center",gap:2,children:o.jsx(V,{className:"nowheel nodrag",isDisabled:!c.length,isInvalid:!d,children:o.jsx(Ne,{value:d,placeholder:h,options:c,onChange:u,noOptionsMessage:p})})})},lne=l.memo(ine),cne=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,r=E(),a=l.useMemo(()=>s.type.name==="IntegerField",[s.type]),i=l.useCallback(p=>{r(rN({nodeId:t,fieldName:n.name,value:a?Math.floor(Number(p)):Number(p)}))},[r,n.name,a,t]),c=l.useMemo(()=>{let p=-Qh;return Ut(s.minimum)||(p=s.minimum),Ut(s.exclusiveMinimum)||(p=s.exclusiveMinimum+.01),p},[s.exclusiveMinimum,s.minimum]),d=l.useMemo(()=>{let p=Qh;return Ut(s.maximum)||(p=s.maximum),Ut(s.exclusiveMaximum)||(p=s.exclusiveMaximum-.01),p},[s.exclusiveMaximum,s.maximum]),u=l.useMemo(()=>Ut(s.multipleOf)?a?1:.1:s.multipleOf,[s.multipleOf,a]),h=l.useMemo(()=>Ut(s.multipleOf)?a?1:.01:s.multipleOf,[s.multipleOf,a]);return o.jsx(Ve,{defaultValue:s.default,onChange:i,value:n.value,min:c,max:d,step:u,fineStep:h,className:"nodrag"})},dne=l.memo(cne),une=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=Cf(),i=l.useCallback(f=>{f&&s(aN({nodeId:t,fieldName:n.name,value:f}))},[s,n.name,t]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=vn({modelConfigs:r,onChange:i,isLoading:a,selectedModel:n.value});return o.jsx(j,{w:"full",alignItems:"center",gap:2,children:o.jsx(V,{className:"nowheel nodrag",isDisabled:!c.length,isInvalid:!d,children:o.jsx(Ne,{value:d,placeholder:h,options:c,onChange:u,noOptionsMessage:p})})})},hne=l.memo(une),pne=e=>{const{nodeId:t,field:n}=e,s=E(),r=l.useCallback(i=>{Xl(i==null?void 0:i.value)&&s(iN({nodeId:t,fieldName:n.name,value:i.value}))},[s,n.name,t]),a=l.useMemo(()=>_a.find(i=>i.value===(n==null?void 0:n.value)),[n==null?void 0:n.value]);return o.jsx(V,{className:"nowheel nodrag",children:o.jsx(Ne,{value:a,options:_a,onChange:r})})},fne=l.memo(pne),mne=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=TZ(),i=l.useCallback(f=>{f&&s(ab({nodeId:t,fieldName:n.name,value:f}))},[s,n.name,t]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=vn({modelConfigs:r,onChange:i,isLoading:a,selectedModel:n.value});return o.jsx(j,{w:"full",alignItems:"center",gap:2,children:o.jsx(V,{className:"nowheel nodrag",isDisabled:!c.length,isInvalid:!d,children:o.jsx(Ne,{value:d,placeholder:h,options:c,onChange:u,noOptionsMessage:p})})})},gne=l.memo(mne),xne=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=_u(),i=l.useCallback(h=>{h&&s(lN({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:c,value:d,onChange:u}=vn({modelConfigs:r,onChange:i,selectedModel:n.value,isLoading:a});return o.jsx(Ae,{label:d==null?void 0:d.description,children:o.jsx(V,{className:"nowheel nodrag",isInvalid:!d,children:o.jsx(Ne,{value:d,placeholder:"Pick one",options:c,onChange:u})})})},bne=l.memo(xne),yne=e=>{const{nodeId:t,field:n,fieldTemplate:s}=e,r=E(),a=l.useCallback(i=>{r(cN({nodeId:t,fieldName:n.name,value:i.target.value}))},[r,n.name,t]);return s.ui_component==="textarea"?o.jsx(ls,{className:"nodrag",onChange:a,value:n.value,rows:5,resize:"none"}):o.jsx(Vt,{className:"nodrag",onChange:a,value:n.value})},vne=l.memo(yne),Cne=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=WM(),i=l.useCallback(h=>{h&&s(dN({nodeId:t,fieldName:n.name,value:h}))},[s,n.name,t]),{options:c,value:d,onChange:u}=vn({modelConfigs:r,onChange:i,selectedModel:n.value,isLoading:a});return o.jsx(Ae,{label:d==null?void 0:d.description,children:o.jsx(V,{className:"nowheel nodrag",isInvalid:!d,children:o.jsx(Ne,{value:d,placeholder:"Pick one",options:c,onChange:u})})})},wne=l.memo(Cne),jne=e=>{const{nodeId:t,field:n}=e,{t:s}=S(),r=w(ib),a=E(),[i,{isLoading:c}]=i1(),d=l.useCallback(g=>{g&&a(uN({nodeId:t,fieldName:n.name,value:g}))},[a,n.name,t]),{options:u,value:h,onChange:p,placeholder:f,noOptionsMessage:m}=vn({modelConfigs:i,onChange:d,isLoading:c,selectedModel:n.value});return o.jsx(j,{w:"full",alignItems:"center",gap:2,children:o.jsx(Ae,{label:!r&&s("modelManager.starterModelsInModelManager"),children:o.jsx(V,{className:"nowheel nodrag",isDisabled:!u.length,isInvalid:!h,children:o.jsx(Ne,{value:h,placeholder:f,options:u,onChange:p,noOptionsMessage:m})})})})},Sne=l.memo(jne),kne=e=>{const{nodeId:t,field:n}=e,s=E(),[r,{isLoading:a}]=jf(),i=l.useCallback(f=>{f&&s(hN({nodeId:t,fieldName:n.name,value:f}))},[s,n.name,t]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=vn({modelConfigs:r,onChange:i,selectedModel:n.value,isLoading:a});return o.jsx(j,{w:"full",alignItems:"center",gap:2,children:o.jsx(V,{className:"nowheel nodrag",isDisabled:!c.length,isInvalid:!d,children:o.jsx(Ne,{value:d,placeholder:h,options:c,onChange:u,noOptionsMessage:p})})})},Ine=l.memo(kne),_ne=({nodeId:e,fieldName:t})=>{const n=CP(e,t),s=SP(e,t);if(pN(n)&&fN(s))return o.jsx(vne,{nodeId:e,field:n,fieldTemplate:s});if(mN(n)&&gN(s))return o.jsx(zte,{nodeId:e,field:n,fieldTemplate:s});if(xN(n)&&bN(s)||yN(n)&&vN(s))return o.jsx(dne,{nodeId:e,field:n,fieldTemplate:s});if(CN(n)&&wN(s))return o.jsx(Qte,{nodeId:e,field:n,fieldTemplate:s});if(jN(n)&&SN(s))return o.jsx(nne,{nodeId:e,field:n,fieldTemplate:s});if(kN(n)&&IN(s))return o.jsx($te,{nodeId:e,field:n,fieldTemplate:s});if(_N(n)&&MN(s))return o.jsx(lne,{nodeId:e,field:n,fieldTemplate:s});if(AN(n)&&EN(s))return o.jsx(Nte,{nodeId:e,field:n,fieldTemplate:s});if(LN(n)&&TN(s))return o.jsx(hne,{nodeId:e,field:n,fieldTemplate:s});if(PN(n)&&RN(s))return o.jsx(Ine,{nodeId:e,field:n,fieldTemplate:s});if(DN(n)&&ON(s))return o.jsx(Sne,{nodeId:e,field:n,fieldTemplate:s});if(NN(n)&&BN(s))return o.jsx(Hte,{nodeId:e,field:n,fieldTemplate:s});if($N(n)&&FN(s))return o.jsx(ene,{nodeId:e,field:n,fieldTemplate:s});if(zN(n)&&VN(s))return o.jsx(ane,{nodeId:e,field:n,fieldTemplate:s});if(HN(n)&&WN(s))return o.jsx(qte,{nodeId:e,field:n,fieldTemplate:s});if(GN(n)&&UN(s))return o.jsx(one,{nodeId:e,field:n,fieldTemplate:s});if(ZN(n)&&qN(s))return o.jsx(wne,{nodeId:e,field:n,fieldTemplate:s});if(KN(n)&&QN(s))return o.jsx(bne,{nodeId:e,field:n,fieldTemplate:s});if(YN(n)&&JN(s))return o.jsx(Ute,{nodeId:e,field:n,fieldTemplate:s});if(XN(n)&&eB(s))return o.jsx(Jte,{nodeId:e,field:n,fieldTemplate:s});if(tB(n)&&nB(s))return o.jsx(gne,{nodeId:e,field:n,fieldTemplate:s});if(sB(n)&&oB(s))return o.jsx(fne,{nodeId:e,field:n,fieldTemplate:s});if(s)return null},$1=l.memo(_ne),Dl=l.memo(({nodeId:e,fieldName:t,children:n})=>{const{t:s}=S(),r=se(yn),a=l.useMemo(()=>pe(bt,u=>{const h=rB(u,e),p=h.data.inputs[t],f=r[h.data.type],m=f==null?void 0:f.inputs[t];return{name:(p==null?void 0:p.label)||(m==null?void 0:m.title)||t,hasInstance:!!p,hasTemplate:!!m}}),[t,e,r]),{hasInstance:i,hasTemplate:c,name:d}=w(a);return!c||!i?o.jsx(j,{position:"relative",minH:8,py:.5,alignItems:"center",w:"full",h:"full",children:o.jsx(V,{isInvalid:!0,alignItems:"stretch",justifyContent:"center",flexDir:"column",gap:2,h:"full",w:"full",children:o.jsx(U,{display:"flex",mb:0,px:1,py:2,gap:2,children:s("nodes.unknownInput",{name:d})})})}):n});Dl.displayName="InvocationInputFieldCheck";const IP=(e,t)=>{const n=l.useMemo(()=>pe(bt,r=>{var a;return((a=jS(r,e,t))==null?void 0:a.label)??null}),[t,e]);return w(n)},_P=(e,t)=>{const n=l.useMemo(()=>pt(bt,r=>{var i;const a=r.nodes.find(c=>c.id===e);if(Br(a))return(i=a==null?void 0:a.data.inputs[t])==null?void 0:i.value}),[t,e]);return w(n)},MP=(e,t)=>{const n=E(),s=l.useMemo(()=>pe(qr,d=>{var u;return(u=d.originalExposedFieldValues.find(h=>h.nodeId===e&&h.fieldName===t))==null?void 0:u.value}),[e,t]),r=w(s),a=_P(e,t),i=l.useMemo(()=>!hl(a,r),[a,r]),c=l.useCallback(()=>{n(aB({nodeId:e,fieldName:t,value:r}))},[n,t,e,r]);return{originalValue:r,isValueChanged:i,onReset:c}},AP=(e,t,n)=>{const s=wP(e,t,n);return l.useMemo(()=>s.title,[s])},Mne=({nodeId:e,fieldName:t})=>{const n=IP(e,t),s=AP(e,t,"inputs"),{isValueChanged:r,onReset:a}=MP(e,t);return o.jsxs(j,{layerStyle:"second",position:"relative",borderRadius:"base",w:"full",p:4,gap:"2",flexDir:"column",children:[o.jsxs(j,{alignItems:"center",children:[o.jsx(U,{fontSize:"sm",children:n||s}),o.jsx(dt,{}),r&&o.jsx(Q,{"aria-label":ve("nodes.resetToDefaultValue"),tooltip:ve("nodes.resetToDefaultValue"),variant:"ghost",size:"sm",onClick:a,icon:o.jsx(Kr,{})}),o.jsx(Ae,{label:o.jsx(rm,{nodeId:e,fieldName:t,kind:"inputs"}),openDelay:iu,placement:"top",children:o.jsx(j,{h:"24px",alignItems:"center",children:o.jsx(it,{fontSize:"md",color:"base.300",as:Li})})})]}),o.jsx($1,{nodeId:e,fieldName:t})]})},Ane=({nodeId:e,fieldName:t})=>o.jsx(Dl,{nodeId:e,fieldName:t,children:o.jsx(Mne,{nodeId:e,fieldName:t})}),Ene=l.memo(Ane),Lne=pt(qr,e=>({fields:e.exposedFields,name:e.name})),Tne=()=>{const{isLoading:e}=Qp(),{fields:t}=w(Lne);return o.jsx(xe,{position:"relative",w:"full",h:"full",children:o.jsx(Nn,{children:o.jsx(j,{position:"relative",flexDir:"column",alignItems:"flex-start",p:1,gap:2,w:"full",h:"full",children:e?o.jsx(Mt,{label:ve("nodes.loadingNodes"),icon:null}):t.length?t.map(({nodeId:n,fieldName:s})=>o.jsx(Ene,{nodeId:n,fieldName:s},`${n}.${s}`)):o.jsx(Pte,{})})})})},Pne=pt(qr,e=>{const{author:t,name:n,description:s,tags:r,version:a,contact:i,notes:c}=e;return{name:n,author:t,description:s,tags:r,version:a,contact:i,notes:c}}),Rne=()=>{const{author:e,name:t,description:n,tags:s,version:r,contact:a,notes:i}=w(Pne),c=E(),d=l.useCallback(C=>{c(SS(C.target.value))},[c]),u=l.useCallback(C=>{c(iB(C.target.value))},[c]),h=l.useCallback(C=>{c(lB(C.target.value))},[c]),p=l.useCallback(C=>{c(cB(C.target.value))},[c]),f=l.useCallback(C=>{c(dB(C.target.value))},[c]),m=l.useCallback(C=>{c(uB(C.target.value))},[c]),g=l.useCallback(C=>{c(hB(C.target.value))},[c]),{t:x}=S();return o.jsx(Nn,{children:o.jsx(j,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:o.jsxs(is,{orientation:"vertical",formControlProps:One,children:[o.jsxs(j,{gap:2,w:"full",children:[o.jsxs(V,{children:[o.jsx(U,{children:x("nodes.workflowName")}),o.jsx(Vt,{value:t,onChange:d})]}),o.jsxs(V,{children:[o.jsx(U,{children:x("nodes.workflowVersion")}),o.jsx(Vt,{value:r,onChange:p})]})]}),o.jsxs(j,{gap:2,w:"full",children:[o.jsxs(V,{children:[o.jsx(U,{children:x("nodes.workflowAuthor")}),o.jsx(Vt,{value:e,onChange:u})]}),o.jsxs(V,{children:[o.jsx(U,{children:x("nodes.workflowContact")}),o.jsx(Vt,{value:a,onChange:h})]})]}),o.jsxs(V,{children:[o.jsx(U,{children:x("nodes.workflowTags")}),o.jsx(Vt,{value:s,onChange:m})]}),o.jsxs(V,{children:[o.jsx(U,{children:x("nodes.workflowDescription")}),o.jsx(ls,{onChange:f,value:n,fontSize:"sm",resize:"none",rows:3})]}),o.jsxs(V,{children:[o.jsx(U,{children:x("nodes.workflowNotes")}),o.jsx(ls,{onChange:g,value:i,fontSize:"sm",resize:"none",rows:10})]})]})})})},Dne=l.memo(Rne),One={flexShrink:0},Fa=Ge(null),Nne=Ai(e=>{Fa.set(pB(e))},300),Bne=pe(bt,qr,(e,t)=>({nodes:e.nodes,edges:e.edges,workflow:t})),$ne=()=>{const e=w(Bne);l.useEffect(()=>{Nne(e)},[e])},Fne=()=>{const e=se(Fa),{t}=S();return o.jsx(j,{flexDir:"column",alignItems:"flex-start",gap:2,h:"full",children:o.jsx(Wr,{data:e??{},label:t("nodes.workflow")})})},zne=l.memo(Fne);function F1(e,t,n){const s=e.slice();return s.splice(n<0?s.length+n:n,0,s.splice(t,1)[0]),s}function Vne(e,t){return e.reduce((n,s,r)=>{const a=t.get(s);return a&&(n[r]=a),n},Array(e.length))}function dh(e){return e!==null&&e>=0}function Hne(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Wne(e){return typeof e=="boolean"?{draggable:e,droppable:e}:e}const EP=e=>{let{rects:t,activeIndex:n,overIndex:s,index:r}=e;const a=F1(t,s,n),i=t[r],c=a[r];return!c||!i?null:{x:c.left-i.left,y:c.top-i.top,scaleX:c.width/i.width,scaleY:c.height/i.height}},uh={scaleX:1,scaleY:1},Gne=e=>{var t;let{activeIndex:n,activeNodeRect:s,index:r,rects:a,overIndex:i}=e;const c=(t=a[n])!=null?t:s;if(!c)return null;if(r===n){const u=a[i];return u?{x:0,y:n<i?u.top+u.height-(c.top+c.height):u.top-c.top,...uh}:null}const d=Une(a,r,n);return r>n&&r<=i?{x:0,y:-c.height-d,...uh}:r<n&&r>=i?{x:0,y:c.height+d,...uh}:{x:0,y:0,...uh}};function Une(e,t,n){const s=e[t],r=e[t-1],a=e[t+1];return s?n<t?r?s.top-(r.top+r.height):a?a.top-(s.top+s.height):0:a?a.top-(s.top+s.height):r?s.top-(r.top+r.height):0:0}const LP="Sortable",TP=te.createContext({activeIndex:-1,containerId:LP,disableTransforms:!1,items:[],overIndex:-1,useDragOverlay:!1,sortedRects:[],strategy:EP,disabled:{draggable:!1,droppable:!1}});function Zne(e){let{children:t,id:n,items:s,strategy:r=EP,disabled:a=!1}=e;const{active:i,dragOverlay:c,droppableRects:d,over:u,measureDroppableContainers:h}=yS(),p=fB(LP,n),f=c.rect!==null,m=l.useMemo(()=>s.map(_=>typeof _=="object"&&"id"in _?_.id:_),[s]),g=i!=null,x=i?m.indexOf(i.id):-1,C=u?m.indexOf(u.id):-1,y=l.useRef(m),v=!Hne(m,y.current),I=C!==-1&&x===-1||v,k=Wne(a);kS(()=>{v&&g&&h(m)},[v,m,g,h]),l.useEffect(()=>{y.current=m},[m]);const M=l.useMemo(()=>({activeIndex:x,containerId:p,disabled:k,disableTransforms:I,items:m,overIndex:C,useDragOverlay:f,sortedRects:Vne(m,d),strategy:r}),[x,p,k.draggable,k.droppable,I,m,C,d,f,r]);return te.createElement(TP.Provider,{value:M},t)}const qne=e=>{let{id:t,items:n,activeIndex:s,overIndex:r}=e;return F1(n,s,r).indexOf(t)},Kne=e=>{let{containerId:t,isSorting:n,wasDragging:s,index:r,items:a,newIndex:i,previousItems:c,previousContainerId:d,transition:u}=e;return!u||!s||c!==a&&r===i?!1:n?!0:i!==r&&t===d},Qne={duration:200,easing:"ease"},PP="transform",Yne=lb.Transition.toString({property:PP,duration:0,easing:"linear"}),Jne={roleDescription:"sortable"};function Xne(e){let{disabled:t,index:n,node:s,rect:r}=e;const[a,i]=l.useState(null),c=l.useRef(n);return kS(()=>{if(!t&&n!==c.current&&s.current){const d=r.current;if(d){const u=xB(s.current,{ignoreTransform:!0}),h={x:d.left-u.left,y:d.top-u.top,scaleX:d.width/u.width,scaleY:d.height/u.height};(h.x||h.y)&&i(h)}}n!==c.current&&(c.current=n)},[t,n,s,r]),l.useEffect(()=>{a&&i(null)},[a]),a}function ese(e){let{animateLayoutChanges:t=Kne,attributes:n,disabled:s,data:r,getNewIndex:a=qne,id:i,strategy:c,resizeObserverConfig:d,transition:u=Qne}=e;const{items:h,containerId:p,activeIndex:f,disabled:m,disableTransforms:g,sortedRects:x,overIndex:C,useDragOverlay:y,strategy:v}=l.useContext(TP),I=tse(s,m),k=h.indexOf(i),M=l.useMemo(()=>({sortable:{containerId:p,index:k,items:h},...r}),[p,r,k,h]),_=l.useMemo(()=>h.slice(h.indexOf(i)),[h,i]),{rect:A,node:D,isOver:N,setNodeRef:P}=Ej({id:i,data:M,disabled:I.droppable,resizeObserverConfig:{updateMeasurementsFor:_,...d}}),{active:z,activatorEvent:W,activeNodeRect:X,attributes:ee,setNodeRef:G,listeners:re,isDragging:le,over:Ce,setActivatorNodeRef:be,transform:ye}=Lj({id:i,data:M,attributes:{...Jne,...n},disabled:I.draggable}),ne=mB(P,G),R=!!z,F=R&&!g&&dh(f)&&dh(C),Z=!y&&le,B=Z&&F?ye:null,$=F?B??(c??v)({rects:x,activeNodeRect:X,activeIndex:f,overIndex:C,index:k}):null,Y=dh(f)&&dh(C)?a({id:i,items:h,activeIndex:f,overIndex:C}):k,ae=z==null?void 0:z.id,ue=l.useRef({activeId:ae,items:h,newIndex:Y,containerId:p}),Re=h!==ue.current.items,we=t({active:z,containerId:p,isDragging:le,isSorting:R,id:i,index:k,items:h,newIndex:ue.current.newIndex,previousItems:ue.current.items,previousContainerId:ue.current.containerId,transition:u,wasDragging:ue.current.activeId!=null}),De=Xne({disabled:!we,index:k,node:D,rect:A});return l.useEffect(()=>{R&&ue.current.newIndex!==Y&&(ue.current.newIndex=Y),p!==ue.current.containerId&&(ue.current.containerId=p),h!==ue.current.items&&(ue.current.items=h)},[R,Y,p,h]),l.useEffect(()=>{if(ae===ue.current.activeId)return;if(ae&&!ue.current.activeId){ue.current.activeId=ae;return}const ht=setTimeout(()=>{ue.current.activeId=ae},50);return()=>clearTimeout(ht)},[ae]),{active:z,activeIndex:f,attributes:ee,data:M,rect:A,index:k,newIndex:Y,items:h,isOver:N,isSorting:R,isDragging:le,listeners:re,node:D,overIndex:C,over:Ce,setNodeRef:ne,setActivatorNodeRef:be,setDroppableNodeRef:P,setDraggableNodeRef:G,transform:De??$,transition:Me()};function Me(){if(De||Re&&ue.current.newIndex===k)return Yne;if(!(Z&&!gB(W)||!u)&&(R||we))return lb.Transition.toString({...u,property:PP})}}function tse(e,t){var n,s;return typeof e=="boolean"?{draggable:e,droppable:!1}:{draggable:(n=e==null?void 0:e.draggable)!=null?n:t.draggable,droppable:(s=e==null?void 0:e.droppable)!=null?s:t.droppable}}Ku.Down,Ku.Right,Ku.Up,Ku.Left;const nse=e=>o.jsx(bB,{onDragEnd:e.onDragEnd,children:o.jsx(Zne,{items:e.items,strategy:Gne,children:e.children})}),sse=l.memo(nse),ose=({isSelected:e,isHovered:t})=>{const n=l.useMemo(()=>{if(e&&t)return"nodeHoveredSelected";if(e)return"nodeSelected";if(t)return"nodeHovered"},[t,e]);return o.jsx(xe,{className:"selection-box",position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",opacity:e||t?1:.5,transitionProperty:"common",transitionDuration:"0.1s",pointerEvents:"none",shadow:n})},RP=l.memo(ose),Oh=Ge(null),DP=e=>{const[t,n]=l.useState(!1);l.useEffect(()=>Oh.subscribe(i=>{n(i===e)}),[t,e]);const s=l.useCallback(()=>{Oh.set(e)},[e]),r=l.useCallback(()=>{Oh.set(null)},[]);return{isMouseOverNode:t,handleMouseOver:s,handleMouseOut:r}},rse=IS((e,t)=>{const{nodeId:n,fieldName:s,kind:r,isMissingInput:a=!1,withTooltip:i=!1,shouldDim:c=!1}=e,d=IP(n,s),u=AP(n,s,r),{t:h}=S(),p=E(),[f,m]=l.useState(d||u||h("nodes.unknownField")),g=l.useCallback(C=>{const v=C.trim()||u||h("nodes.unknownField");m(v),p(yB({nodeId:n,fieldName:s,label:v}))},[u,p,n,s,h]),x=l.useCallback(C=>{m(C)},[]);return l.useEffect(()=>{m(d||u||h("nodes.unknownField"))},[d,u,h]),o.jsxs(nb,{value:f,onChange:x,onSubmit:g,as:j,ref:t,position:"relative",overflow:"hidden",alignItems:"center",justifyContent:"flex-start",gap:1,w:"full",children:[o.jsx(Ae,{label:i?o.jsx(rm,{nodeId:n,fieldName:s,kind:"inputs"}):void 0,openDelay:iu,children:o.jsx(sb,{fontWeight:"semibold",sx:ise,noOfLines:1,color:a?"error.300":"base.300",opacity:c?.5:1})}),o.jsx(ob,{className:"nodrag",sx:ase}),o.jsx(OP,{})]})}),ase={p:0,w:"full",fontWeight:"semibold",color:"base.100",_focusVisible:{p:0,textAlign:"left",boxShadow:"none"}},ise={p:0,textAlign:"left",_hover:{fontWeight:"semibold !important"}},$0=l.memo(rse),OP=l.memo(()=>{const{isEditing:e,getEditButtonProps:t}=_S(),n=l.useCallback(s=>{const{onClick:r}=t();r&&(r(s),s.preventDefault())},[t]);return e?null:o.jsx(j,{onClick:n,position:"absolute",w:"min-content",h:"full",top:0,insetInlineStart:0,cursor:"text"})});OP.displayName="EditableControls";const lse=({nodeId:e,fieldName:t})=>{const n=E(),{isValueChanged:s,onReset:r}=MP(e,t),{isMouseOverNode:a,handleMouseOut:i,handleMouseOver:c}=DP(e),{t:d}=S(),u=l.useCallback(()=>{n(MS({nodeId:e,fieldName:t}))},[n,t,e]),{attributes:h,listeners:p,setNodeRef:f,transform:m,transition:g}=ese({id:`${e}.${t}`}),x={transform:lb.Translate.toString(m),transition:g};return o.jsxs(j,{onMouseEnter:c,onMouseLeave:i,layerStyle:"second",alignItems:"center",position:"relative",borderRadius:"base",w:"full",p:4,paddingLeft:0,ref:f,style:x,children:[o.jsx(Q,{"aria-label":d("nodes.reorderLinearView"),variant:"ghost",icon:o.jsx(zW,{}),...p,...h,mx:2,height:"full"}),o.jsxs(j,{flexDir:"column",w:"full",children:[o.jsxs(j,{alignItems:"center",children:[o.jsx($0,{nodeId:e,fieldName:t,kind:"inputs"}),o.jsx(dt,{}),s&&o.jsx(Q,{"aria-label":d("nodes.resetToDefaultValue"),tooltip:d("nodes.resetToDefaultValue"),variant:"ghost",size:"sm",onClick:r,icon:o.jsx(Kr,{})}),o.jsx(Ae,{label:o.jsx(rm,{nodeId:e,fieldName:t,kind:"inputs"}),openDelay:iu,placement:"top",children:o.jsx(j,{h:"full",alignItems:"center",children:o.jsx(it,{fontSize:"sm",color:"base.300",as:Li})})}),o.jsx(Q,{"aria-label":d("nodes.removeLinearView"),tooltip:d("nodes.removeLinearView"),variant:"ghost",size:"sm",onClick:u,icon:o.jsx(Hs,{})})]}),o.jsx($1,{nodeId:e,fieldName:t}),o.jsx(RP,{isSelected:!1,isHovered:a})]})]})},cse=({nodeId:e,fieldName:t})=>o.jsx(Dl,{nodeId:e,fieldName:t,children:o.jsx(lse,{nodeId:e,fieldName:t})}),dse=l.memo(cse),use=pt(qr,e=>e.exposedFields),hse=()=>{const e=w(use),{isLoading:t}=Qp(),{t:n}=S(),s=E(),r=l.useCallback(i=>{const{active:c,over:d}=i,u=e.map(h=>`${h.nodeId}.${h.fieldName}`);if(d&&c.id!==d.id){const h=u.indexOf(c.id),p=u.indexOf(d.id),f=F1(u,h,p).map(m=>e.find(g=>`${g.nodeId}.${g.fieldName}`===m)).filter(m=>m);s(vB(f))}},[s,e]),a=l.useMemo(()=>e.map(i=>`${i.nodeId}.${i.fieldName}`),[e]);return o.jsx(xe,{position:"relative",w:"full",h:"full",children:o.jsx(Nn,{children:o.jsx(sse,{onDragEnd:r,items:a,children:o.jsx(j,{position:"relative",flexDir:"column",alignItems:"flex-start",p:1,gap:2,h:"full",w:"full",children:t?o.jsx(Mt,{label:n("nodes.loadingNodes"),icon:null}):e.length?e.map(({nodeId:i,fieldName:c})=>o.jsx(dse,{nodeId:i,fieldName:c},`${i}.${c}`)):o.jsx(Mt,{label:n("nodes.noFieldsLinearview"),icon:null})})})})})},pse=l.memo(hse),fse=()=>{const{t:e}=S();return o.jsx(j,{layerStyle:"first",flexDir:"column",w:"full",h:"full",borderRadius:"base",p:2,gap:2,children:o.jsxs(ki,{variant:"line",display:"flex",w:"full",h:"full",flexDir:"column",children:[o.jsxs(Ii,{children:[o.jsx(rn,{children:e("common.linear")}),o.jsx(rn,{children:e("common.details")}),o.jsx(rn,{children:"JSON"})]}),o.jsxs(oc,{children:[o.jsx(mn,{children:o.jsx(pse,{})}),o.jsx(mn,{children:o.jsx(Dne,{})}),o.jsx(mn,{children:o.jsx(zne,{})})]})]})})},mse=l.memo(fse),gse=tc("workflowLibrary/workflowDownloaded"),xse=tc("workflowLibrary/workflowLoadedFromFile"),bse=tc("workflowLibrary/newWorkflowSaved"),yse=tc("workflowLibrary/workflowUpdated"),NP=({resetRef:e,onSuccess:t})=>{const n=E(),s=eI("workflows"),{t:r}=S();return l.useCallback(i=>{var d;if(!i)return;const c=new FileReader;c.onload=()=>{const u=c.result;try{n(Dp({data:{workflow:String(u),graph:null},asCopy:!0})),n(xse()),t&&t()}catch{s.error(r("nodes.unableToLoadWorkflow")),he({id:"UNABLE_TO_LOAD_WORKFLOW",title:r("nodes.unableToLoadWorkflow"),status:"error"}),c.abort()}},c.readAsText(i),(d=e.current)==null||d.call(e)},[n,s,e,r,t])},vse=e=>`${e.trim()} (copy)`,og=Ge(!1),hh=Ge(""),rg=Ge(!1),Cse=pe(qr,({name:e,id:t})=>t?e.length?vse(e):"":e),Dc=()=>{const e=w(Cse),t=se(og),n=l.useCallback(()=>{hh.set(e),og.set(!0)},[e]),s=l.useCallback(()=>{og.set(!1),hh.set(""),rg.set(!1)},[]),r=se(hh),a=l.useCallback(d=>hh.set(d),[]),i=se(rg),c=l.useCallback(d=>{rg.set(d)},[]);return{workflowName:r,setWorkflowName:a,shouldSaveToProject:i,setShouldSaveToProject:c,isOpen:t,onOpen:n,onClose:s}},wse=()=>{const{t:e}=S(),t=l.useRef(null),n=mu(),s=Dc(),r=NP({resetRef:t,onSuccess:()=>{n.close(),s.onOpen()}}),a=l.useCallback(d=>{d[0]&&r(d[0])},[r]),{getInputProps:i,getRootProps:c}=Na({accept:{"application/json":[".json"]},onDropAccepted:a,noDrag:!0,multiple:!1});return o.jsxs(o.Fragment,{children:[o.jsx(Q,{"aria-label":e("workflows.uploadAndSaveWorkflow"),tooltip:e("workflows.uploadAndSaveWorkflow"),icon:o.jsx(gc,{}),...c(),pointerEvents:"auto",variant:"ghost"}),o.jsx("input",{...i()})]})},jse=l.memo(wse),Sse=e=>{const t=E(),n=l.useMemo(()=>pe(qr,a=>a.categorySections[e]??!0),[e]),s=w(n),r=l.useCallback(()=>{t(CB({id:e,isOpen:!s}))},[e,t,s]);return{isOpen:s,onToggle:r}};var kse=/d{1,4}|D{3,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|W{1,2}|[LlopSZN]|"[^"]*"|'[^']*'/g,Ise=/\b(?:[A-Z]{1,3}[A-Z][TC])(?:[-+]\d{4})?|((?:Australian )?(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time)\b/g,_se=/[^-+\dA-Z]/g;function pd(e,t,n,s){if(arguments.length===1&&typeof e=="string"&&!/\d/.test(e)&&(t=e,e=void 0),e=e||e===0?e:new Date,e instanceof Date||(e=new Date(e)),isNaN(e))throw TypeError("Invalid date");t=String(ui[t]||t||ui.default);var r=t.slice(0,4);(r==="UTC:"||r==="GMT:")&&(t=t.slice(4),n=!0,r==="GMT:"&&(s=!0));var a=function(){return n?"getUTC":"get"},i=function(){return e[a()+"Date"]()},c=function(){return e[a()+"Day"]()},d=function(){return e[a()+"Month"]()},u=function(){return e[a()+"FullYear"]()},h=function(){return e[a()+"Hours"]()},p=function(){return e[a()+"Minutes"]()},f=function(){return e[a()+"Seconds"]()},m=function(){return e[a()+"Milliseconds"]()},g=function(){return n?0:e.getTimezoneOffset()},x=function(){return Mse(e)},C=function(){return Ase(e)},y={d:function(){return i()},dd:function(){return As(i())},ddd:function(){return hs.dayNames[c()]},DDD:function(){return ZC({y:u(),m:d(),d:i(),_:a(),dayName:hs.dayNames[c()],short:!0})},dddd:function(){return hs.dayNames[c()+7]},DDDD:function(){return ZC({y:u(),m:d(),d:i(),_:a(),dayName:hs.dayNames[c()+7]})},m:function(){return d()+1},mm:function(){return As(d()+1)},mmm:function(){return hs.monthNames[d()]},mmmm:function(){return hs.monthNames[d()+12]},yy:function(){return String(u()).slice(2)},yyyy:function(){return As(u(),4)},h:function(){return h()%12||12},hh:function(){return As(h()%12||12)},H:function(){return h()},HH:function(){return As(h())},M:function(){return p()},MM:function(){return As(p())},s:function(){return f()},ss:function(){return As(f())},l:function(){return As(m(),3)},L:function(){return As(Math.floor(m()/10))},t:function(){return h()<12?hs.timeNames[0]:hs.timeNames[1]},tt:function(){return h()<12?hs.timeNames[2]:hs.timeNames[3]},T:function(){return h()<12?hs.timeNames[4]:hs.timeNames[5]},TT:function(){return h()<12?hs.timeNames[6]:hs.timeNames[7]},Z:function(){return s?"GMT":n?"UTC":Ese(e)},o:function(){return(g()>0?"-":"+")+As(Math.floor(Math.abs(g())/60)*100+Math.abs(g())%60,4)},p:function(){return(g()>0?"-":"+")+As(Math.floor(Math.abs(g())/60),2)+":"+As(Math.floor(Math.abs(g())%60),2)},S:function(){return["th","st","nd","rd"][i()%10>3?0:(i()%100-i()%10!=10)*i()%10]},W:function(){return x()},WW:function(){return As(x())},N:function(){return C()}};return t.replace(kse,function(v){return v in y?y[v]():v.slice(1,v.length-1)})}var ui={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",paddedShortDate:"mm/dd/yyyy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:sso",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'",expiresHeaderFormat:"ddd, dd mmm yyyy HH:MM:ss Z"},hs={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"],timeNames:["a","p","am","pm","A","P","AM","PM"]},As=function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:2;return String(t).padStart(n,"0")},ZC=function(t){var n=t.y,s=t.m,r=t.d,a=t._,i=t.dayName,c=t.short,d=c===void 0?!1:c,u=new Date,h=new Date;h.setDate(h[a+"Date"]()-1);var p=new Date;p.setDate(p[a+"Date"]()+1);var f=function(){return u[a+"Date"]()},m=function(){return u[a+"Month"]()},g=function(){return u[a+"FullYear"]()},x=function(){return h[a+"Date"]()},C=function(){return h[a+"Month"]()},y=function(){return h[a+"FullYear"]()},v=function(){return p[a+"Date"]()},I=function(){return p[a+"Month"]()},k=function(){return p[a+"FullYear"]()};return g()===n&&m()===s&&f()===r?d?"Tdy":"Today":y()===n&&C()===s&&x()===r?d?"Ysd":"Yesterday":k()===n&&I()===s&&v()===r?d?"Tmw":"Tomorrow":i},Mse=function(t){var n=new Date(t.getFullYear(),t.getMonth(),t.getDate());n.setDate(n.getDate()-(n.getDay()+6)%7+3);var s=new Date(n.getFullYear(),0,4);s.setDate(s.getDate()-(s.getDay()+6)%7+3);var r=n.getTimezoneOffset()-s.getTimezoneOffset();n.setHours(n.getHours()-r);var a=(n-s)/(864e5*7);return 1+Math.floor(a)},Ase=function(t){var n=t.getDay();return n===0&&(n=7),n},Ese=function(t){return(String(t).match(Ise)||[""]).pop().replace(_se,"").replace(/GMT\+0000/g,"UTC")};const z1=Ge(null),Lse=()=>z1.set(null),Tse=()=>l.useCallback(t=>{z1.set(t)},[]),Pse=()=>{wt("DeleteWorkflowDialog");const{t:e}=S(),t=se(z1),[n]=GV(),s=l.useCallback(async()=>{if(t)try{await n(t.workflow_id).unwrap(),he({id:"WORKFLOW_DELETED",title:e("toast.workflowDeleted")})}catch{he({id:`AUTH_ERROR_TOAST_${pi.endpoints.deleteWorkflow.name}`,title:e("toast.problemDeletingWorkflow"),status:"error"})}},[n,e,t]);return o.jsx(No,{isOpen:t!==null,onClose:Lse,title:e("workflows.deleteWorkflow"),acceptCallback:s,acceptButtonText:e("common.delete"),cancelButtonText:e("common.cancel"),useInert:!1,children:o.jsx(O,{children:e("workflows.deleteWorkflow2")})})},BP=()=>{const e=E();return l.useCallback(()=>{const n=Fa.get();if(!n)return;const s=new Blob([JSON.stringify(n,null,2)]),r=document.createElement("a");r.href=URL.createObjectURL(s),r.download=`${n.name||"My Workflow"}.json`,document.body.appendChild(r),r.click(),r.remove(),e(gse())},[e])},Rse=({workflow:e})=>{const{t}=S();return o.jsxs(j,{flexDir:"column",gap:1,children:[o.jsx(O,{children:e.description}),e.category!=="default"&&o.jsxs(j,{flexDir:"column",children:[o.jsxs(O,{children:[t("workflows.opened"),": ",pd(e.opened_at,ui.shortDate)]}),o.jsxs(O,{children:[t("common.updated"),": ",pd(e.updated_at,ui.shortDate)]}),o.jsxs(O,{children:[t("common.created"),": ",pd(e.created_at,ui.shortDate)]})]})]})},Dse=({workflow:e})=>{const{t}=S(),n=E(),s=se(Tx),r=mu(),[a,i]=l.useState(!1),c=l.useCallback(()=>{i(!0)},[]),d=l.useCallback(()=>{i(!1)},[]),u=w(wB),h=BP(),p=BZ(),f=Tse(),{getAndLoadWorkflow:m}=Xk({onSuccess:r.close}),g=l.useMemo(()=>u===e.workflow_id,[u,e.workflow_id]),x=l.useCallback(k=>{k.stopPropagation(),m(e.workflow_id),r.close()},[m,e.workflow_id,r]),C=l.useCallback(async k=>{k.stopPropagation(),i(!1),await m(e.workflow_id),n(Ul("edit")),r.close()},[m,e.workflow_id,n,r]),y=l.useCallback(k=>{k.stopPropagation(),i(!1),f(e)},[f,e]),v=l.useCallback(k=>{k.stopPropagation(),i(!1),p(e)},[p,e]),I=l.useCallback(k=>{k.stopPropagation(),i(!1),h()},[h]);return o.jsxs(j,{gap:4,onClick:x,cursor:"pointer",_hover:{backgroundColor:"base.750"},p:2,ps:3,borderRadius:"base",w:"full",onMouseOver:c,onMouseOut:d,alignItems:"center",children:[o.jsx(Ae,{label:o.jsx(Rse,{workflow:e}),children:o.jsxs(j,{flexDir:"column",gap:1,children:[o.jsxs(j,{gap:4,alignItems:"center",children:[o.jsx(O,{noOfLines:2,children:e.name}),g&&o.jsx(Rn,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:t("workflows.opened")})]}),e.category!=="default"&&o.jsxs(O,{fontSize:"xs",variant:"subtext",flexShrink:0,noOfLines:1,children:[t("common.updated"),": ",pd(e.updated_at,ui.shortDate)," ",pd(e.updated_at,ui.shortTime)]})]})}),o.jsx(dt,{}),o.jsxs(j,{alignItems:"center",gap:1,opacity:a?1:0,children:[o.jsx(Ae,{label:t("workflows.edit"),isOpen:a?void 0:!1,children:o.jsx(Q,{size:"sm",variant:"ghost","aria-label":t("workflows.edit"),onClick:C,icon:o.jsx(Cu,{})})}),o.jsx(Ae,{label:t("workflows.download"),isOpen:a?void 0:!1,children:o.jsx(Q,{size:"sm",variant:"ghost","aria-label":t("workflows.download"),onClick:I,icon:o.jsx(mc,{})})}),!!s&&e.workflow_id&&e.category!=="user"&&o.jsx(Ae,{label:t("workflows.copyShareLink"),isOpen:a?void 0:!1,children:o.jsx(Q,{size:"sm",variant:"ghost","aria-label":t("workflows.copyShareLink"),onClick:v,icon:o.jsx(ZI,{})})}),e.category!=="default"&&o.jsx(Ae,{label:t("workflows.delete"),isOpen:a?void 0:!1,children:o.jsx(Q,{size:"sm",variant:"ghost","aria-label":t("workflows.delete"),onClick:y,colorScheme:"error",icon:o.jsx(Ob,{})})})]})]})},Ose=({category:e})=>{const t=w(AS),n=w(ES),s=w(LS),{t:r}=S(),a=l.useMemo(()=>e!=="default"?{order_by:n,direction:s,category:e}:{order_by:"name",direction:"ASC",category:e},[e,s,n]),{data:i,isLoading:c}=ZV(a,{selectFromResult:({data:h,isLoading:p})=>({data:(h==null?void 0:h.items.filter(m=>m.name.toLowerCase().includes(t.toLowerCase())))||Ss,isLoading:p})}),{isOpen:d,onToggle:u}=Sse(e);return o.jsxs(j,{flexDir:"column",children:[o.jsx(me,{variant:"unstyled",onClick:u,children:o.jsxs(j,{gap:2,alignItems:"center",children:[o.jsx(it,{boxSize:4,as:Fo,transform:d?void 0:"rotate(-90deg)",fill:"base.500"}),o.jsx(O,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:r(`workflows.${e}Workflows`)})]})}),o.jsx(Mi,{in:d,children:c?o.jsx(j,{alignItems:"center",justifyContent:"center",p:20,children:o.jsx(pr,{})}):i.length?i.map(h=>o.jsx(Dse,{workflow:h},h.workflow_id)):o.jsx(Mt,{fontSize:"sm",py:4,label:r(t?"nodes.noMatchingWorkflows":"nodes.noWorkflows"),icon:null})})]})},Nse=()=>{const e=E(),t=w(AS),{t:n}=S(),s=l.useCallback(c=>{e(Yy(c))},[e]),r=l.useCallback(()=>{e(Yy(""))},[e]),a=l.useCallback(c=>{c.key==="Escape"&&r()},[r]),i=l.useCallback(c=>{s(c.target.value)},[s]);return o.jsxs(Ur,{children:[o.jsx(Vt,{placeholder:n("stylePresets.searchByName"),value:t,onKeyDown:a,onChange:i}),t&&t.length&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(Q,{onClick:r,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:o.jsx(sn,{})})})]})},Bse=l.memo(Nse),$se=ze.enum(["opened_at","created_at","updated_at","name"]),Fse=e=>$se.safeParse(e).success,zse=ze.enum(["ASC","DESC"]),Vse=e=>zse.safeParse(e).success,Hse=()=>{const e=se(jB),{t}=S(),n=w(ES),s=w(LS),r=l.useMemo(()=>[{value:"opened_at",label:t("workflows.opened")},{value:"created_at",label:t("workflows.created")},{value:"updated_at",label:t("workflows.updated")},{value:"name",label:t("workflows.name")}],[t]),a=l.useMemo(()=>[{value:"ASC",label:t("workflows.ascending")},{value:"DESC",label:t("workflows.descending")}],[t]),i=E(),c=l.useMemo(()=>e?r.filter(f=>f.value!=="opened_at"):r,[e,r]),d=l.useCallback(f=>{!Fse(f==null?void 0:f.value)||f.value===n||i(SB(f.value))},[n,i]),u=l.useMemo(()=>c.find(f=>f.value===n)||c[0],[n,c]),h=l.useCallback(f=>{!Vse(f==null?void 0:f.value)||f.value===s||i(kB(f.value))},[s,i]),p=l.useMemo(()=>a.find(f=>f.value===s),[s,a]);return o.jsxs(Qn,{placement:"bottom",children:[o.jsx(ds,{children:o.jsx(Q,{tooltip:`Sorting by ${u==null?void 0:u.label} ${p==null?void 0:p.label}`,"aria-label":"Sort Workflow Library",icon:s==="ASC"?o.jsx(hG,{}):o.jsx(pG,{}),variant:"ghost"})}),o.jsx(Yn,{children:o.jsx(Jn,{children:o.jsxs(j,{flexDir:"column",gap:4,children:[o.jsxs(V,{orientation:"horizontal",gap:1,children:[o.jsx(U,{children:t("common.orderBy")}),o.jsx(Ne,{value:u,options:c,onChange:d})]}),o.jsxs(V,{orientation:"horizontal",gap:1,children:[o.jsx(U,{children:t("common.direction")}),o.jsx(Ne,{value:p,options:a,onChange:h})]})]})})})]})},Wse=()=>{const e=se(TS);return o.jsxs(j,{flexDir:"column",gap:2,padding:3,layerStyle:"second",borderRadius:"base",children:[o.jsxs(j,{alignItems:"center",gap:2,w:"full",justifyContent:"space-between",children:[o.jsx(Bse,{}),o.jsx(Hse,{}),o.jsx(jse,{})]}),e.map(t=>o.jsx(Ose,{category:t},t))]})},Gse=()=>{const e=E(),t=w(lu),{t:n}=S(),s=l.useCallback(a=>{a.stopPropagation(),e(Ul("edit"))},[e]),r=l.useCallback(a=>{a.stopPropagation(),e(Ul("view"))},[e]);return o.jsxs(j,{justifyContent:"flex-end",children:[t==="view"&&o.jsx(Q,{"aria-label":n("nodes.editMode"),tooltip:n("nodes.editMode"),onClick:s,icon:o.jsx(Cu,{}),variant:"outline",size:"sm"}),t==="edit"&&o.jsx(Q,{"aria-label":n("nodes.viewMode"),tooltip:n("nodes.viewMode"),onClick:r,icon:o.jsx(yu,{}),variant:"outline",size:"sm"})]})},[$P]=qw(!1),V1=()=>{const{t:e}=S(),t=E(),n=$P(),s=w(cu),r=l.useCallback(()=>{t(PS()),t(Ul("edit")),he({id:"NEW_WORKFLOW_CREATED",title:e("workflows.newWorkflowCreated"),status:"success"}),n.close()},[n,t,e]),a=l.useCallback(()=>{if(!s){r();return}n.open()},[n,r,s]);return{createImmediate:r,createWithDialog:a}},FP=l.memo(()=>{wt("NewWorkflowConfirmationAlertDialog");const{t:e}=S(),t=$P(),n=V1();return o.jsx(No,{isOpen:t.isOpen,onClose:t.close,title:e("nodes.newWorkflow"),acceptCallback:n.createImmediate,useInert:!1,children:o.jsxs(j,{flexDir:"column",gap:2,children:[o.jsx(O,{children:e("nodes.newWorkflowDesc")}),o.jsx(O,{variant:"subtext",children:e("nodes.newWorkflowDesc2")})]})})});FP.displayName="NewWorkflowConfirmationAlertDialog";const am=e=>!!e.id,H1=()=>{const{t:e}=S(),t=E(),[n,s]=UV(),[r,a]=Jk(),i=Vd(),c=l.useRef();return{saveWorkflow:l.useCallback(async()=>{const u=Fa.get();if(u){c.current=i({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{if(am(u))await n(u).unwrap(),t(yse());else{const h=await r(u).unwrap();t(RS(h.workflow.id))}t(DS()),i.update(c.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{!i.isActive(`auth-error-toast-${pi.endpoints.createWorkflow.name}`)&&!i.isActive(`auth-error-toast-${pi.endpoints.updateWorkflow.name}`)?i.update(c.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0}):i.close(c.current)}}},[n,t,i,e,r]),isLoading:s.isLoading||a.isLoading,isError:s.isError||a.isError}},Use=()=>{const{t:e}=S(),{onOpen:t}=Dc(),{saveWorkflow:n}=H1(),s=l.useCallback(r=>{r.stopPropagation();const a=Fa.get();a&&(am(a)?n():t())},[t,n]);return o.jsx(Q,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:o.jsx($r,{}),onClick:s,pointerEvents:"auto",variant:"outline",size:"sm"})},Zse=l.memo(Use),qse=()=>{const e=w(cb),t=w(IB),n=w(lu),s=V1(),{t:r}=S(),a=l.useCallback(i=>{i.stopPropagation(),s.createWithDialog()},[s]);return o.jsxs(j,{w:"full",alignItems:"center",gap:2,minW:0,children:[e?o.jsx(Ae,{label:t,children:o.jsx(O,{colorScheme:"invokeBlue",fontWeight:"semibold",fontSize:"md",justifySelf:"flex-start",children:e})}):o.jsx(O,{fontSize:"sm",fontWeight:"semibold",color:"base.300",children:r("workflows.chooseWorkflowFromLibrary")}),o.jsx(dt,{}),n==="edit"&&o.jsx(Zse,{}),o.jsx(Gse,{}),o.jsx(Q,{onClick:a,variant:"outline",size:"sm","aria-label":r("nodes.newWorkflow"),tooltip:r("nodes.newWorkflow"),icon:o.jsx(DI,{})})]})},Kse={bg:"base.750"},Qse=()=>{const e=mu(),{t}=S();return o.jsxs(j,{onClick:e.toggle,backgroundColor:"base.800",justifyContent:"space-between",alignItems:"center",py:2,px:3,borderRadius:"base",gap:2,role:"button",_hover:Kse,transitionProperty:"background-color",transitionDuration:"normal",w:"full",cursor:"pointer",children:[o.jsx(qse,{}),o.jsx(Q,{"aria-label":t("stylePresets.viewList"),variant:"ghost",icon:o.jsx(Fo,{}),size:"sm"})]})},Yse={height:"100%",width:"100%"},qC={height:"100%",width:"100%"},Jse=()=>{const e=w(lu),t=l.useRef(null),n=mu(),s=l.useCallback(()=>{t.current&&t.current.setLayout([50,50])},[]);return o.jsxs(j,{w:"full",h:"full",gap:2,flexDir:"column",children:[o.jsx(Qse,{}),o.jsx(j,{w:"full",h:"full",position:"relative",children:o.jsxs(xe,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[n.isOpen&&o.jsx(Vr,{defer:!0,style:qC,options:zr.options,children:o.jsx(j,{gap:2,flexDirection:"column",h:"full",w:"full",children:o.jsx(Wse,{})})}),o.jsxs(Vr,{defer:!0,style:qC,options:zr.options,children:[e==="view"&&o.jsx(Tne,{}),e==="edit"&&o.jsxs(Lu,{ref:t,id:"workflow-panel-group",autoSaveId:"workflow-panel-group",direction:"vertical",style:Yse,children:[o.jsx(or,{id:"workflow",collapsible:!0,minSize:25,children:o.jsx(mse,{})}),o.jsx(Md,{onDoubleClick:s}),o.jsx(or,{id:"inspector",collapsible:!0,minSize:25,children:o.jsx(Tte,{})})]})]})]})})]})},Xse=l.memo(Jse),zP=l.memo(e=>{const{t}=S(),n=pc(),s=Ab(),r=Da();return o.jsx(Q,{size:"lg",isDisabled:r?n.isDisabled:s.isDisabled,isLoading:r?n.isLoading:s.isLoading,"aria-label":t(r?"queue.clear":"queue.cancel"),tooltip:t(r?"queue.clearTooltip":"queue.cancelTooltip"),icon:r?o.jsx(Hs,{}):o.jsx(sn,{}),colorScheme:"error",onClick:r?n.openDialog:s.cancelQueueItem,"data-testid":t(r?"queue.clear":"queue.cancel")})});zP.displayName="ClearQueueIconButton";const VP=l.memo(({targetRef:e})=>{const[t,n]=l.useState(null),s=se(Gg),{queueSize:r}=Oo(void 0,{selectFromResult:a=>({queueSize:a.data?a.data.queue.pending+a.data.queue.in_progress:0})});return l.useEffect(()=>{if(!e.current)return;const a=e.current,i=a.parentElement;if(!i)return;const c=()=>{if(!Gg.get())return;const{x:u,y:h}=a.getBoundingClientRect();n({x:`${u-7}px`,y:`${h-5}px`})},d=new ResizeObserver(c);return d.observe(i),c(),()=>{d.disconnect()}},[e]),r===0||!t||!s?null:o.jsx(Zd,{children:o.jsx(Rn,{pos:"absolute",insetInlineStart:t.x,insetBlockStart:t.y,colorScheme:"invokeYellow",zIndex:"docked",shadow:"dark-lg",userSelect:"none",children:r})})});VP.displayName="QueueCountBadge";const HP=()=>{const{t:e}=S(),t=se(On),{data:n}=Oo(),[s,{isLoading:r}]=iS({fixedCacheKey:"pauseProcessor"}),a=l.useMemo(()=>!!(n!=null&&n.processor.is_started),[n==null?void 0:n.processor.is_started]),i=l.useCallback(async()=>{if(a)try{await s().unwrap(),he({id:"PAUSE_SUCCEEDED",title:e("queue.pauseSucceeded"),status:"success"})}catch{he({id:"PAUSE_FAILED",title:e("queue.pauseFailed"),status:"error"})}},[a,s,e]),c=l.useMemo(()=>!t||!a,[t,a]);return{pauseProcessor:i,isLoading:r,isStarted:a,isDisabled:c}},WP=()=>{const e=se(On),{data:t}=Oo(),{t:n}=S(),[s,{isLoading:r}]=aS({fixedCacheKey:"resumeProcessor"}),a=l.useMemo(()=>!!(t!=null&&t.processor.is_started),[t==null?void 0:t.processor.is_started]),i=l.useCallback(async()=>{if(!a)try{await s().unwrap(),he({id:"PROCESSOR_RESUMED",title:n("queue.resumeSucceeded"),status:"success"})}catch{he({id:"PROCESSOR_RESUME_FAILED",title:n("queue.resumeFailed"),status:"error"})}},[a,s,n]),c=l.useMemo(()=>!e||a,[e,a]);return{resumeProcessor:i,isLoading:r,isStarted:a,isDisabled:c}},GP=l.memo(()=>{const e=l.useRef(null),t=E(),{t:n}=S(),s=dn("pauseQueue"),r=dn("resumeQueue"),{newGallerySessionWithDialog:a}=vI(),{newCanvasSessionWithDialog:i}=CI(),c=pc(),{resumeProcessor:d,isLoading:u,isDisabled:h}=WP(),{pauseProcessor:p,isLoading:f,isDisabled:m}=HP(),g=l.useCallback(()=>{t(Tt("queue"))},[t]);return o.jsxs(o.Fragment,{children:[o.jsxs(Ta,{placement:"bottom-end",children:[o.jsx(Pa,{ref:e,as:Q,size:"lg","aria-label":"Queue Actions Menu",icon:o.jsx(sG,{})}),o.jsxs(Un,{children:[o.jsxs(os,{title:n("common.new"),children:[o.jsx(_e,{icon:o.jsx(fi,{}),onClick:a,children:n("controlLayers.newGallerySession")}),o.jsx(_e,{icon:o.jsx(rf,{}),onClick:i,children:n("controlLayers.newCanvasSession")})]}),o.jsxs(os,{title:n("queue.queue"),children:[o.jsx(_e,{isDestructive:!0,icon:o.jsx(sn,{}),onClick:c.openDialog,isLoading:c.isLoading,isDisabled:c.isDisabled,children:n("queue.cancelTooltip")}),o.jsx(_e,{isDestructive:!0,icon:o.jsx(Hs,{}),onClick:c.openDialog,isLoading:c.isLoading,isDisabled:c.isDisabled,children:n("queue.clearTooltip")}),r&&o.jsx(_e,{icon:o.jsx(e_,{}),onClick:d,isLoading:u,isDisabled:h,children:n("queue.resumeTooltip")}),s&&o.jsx(_e,{icon:o.jsx(XI,{}),onClick:p,isLoading:f,isDisabled:m,children:n("queue.pauseTooltip")}),o.jsx(_e,{icon:o.jsx(GI,{}),onClick:g,children:n("queue.openQueue")})]})]})]}),o.jsx(VP,{targetRef:e})]})});GP.displayName="QueueActionsMenuButton";const eoe=e=>({bg:"base.700",w:"72px",cursor:"pointer","&[data-checked]":{".thumb":{left:`calc(100% - ${e})`,transform:"translateX(-100%)",bg:"invokeGreen.300"},".unchecked-icon":{color:"base.50",opacity:.4},".checked-icon":{color:"base.900",opacity:1}},"&[data-disabled]":{bg:"base.700",".thumb":{bg:"base.500"},".unchecked-icon":{color:"base.800"},".checked-icon":{color:"base.800"}},".thumb":{transition:"left 0.1s ease-in-out, transform 0.1s ease-in-out",left:e,transform:"translateX(0)",bg:"invokeBlue.400",shadow:"md"},".unchecked-icon":{color:"base.900",opacity:1},".checked-icon":{color:"base.50",opacity:.4}}),UP=l.memo(()=>{const{t:e}=S(),t=E(),n=w(OS),s=w(Pn),r=Yp("space",1),a=l.useMemo(()=>eoe(r),[r]),i=l.useCallback(h=>{t(jh(h.target.checked))},[t]),{getCheckboxProps:c,getInputProps:d,htmlProps:u}=_B({onChange:i,isChecked:n,isDisabled:s});return o.jsxs(Qn,{trigger:"hover",children:[o.jsx(ds,{children:o.jsx(Kd.label,{...u,children:o.jsxs(j,{position:"relative",borderRadius:"base",alignItems:"center",justifyContent:"space-between",h:"full",p:r,gap:r,sx:a,...c(),children:[o.jsx("input",{...d(),hidden:!0}),o.jsx(xe,{className:"thumb",position:"absolute",borderRadius:"base",w:10,top:r,bottom:r}),o.jsx(j,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:o.jsx(it,{className:"unchecked-icon",w:6,h:6,as:fi,"aria-label":e("controlLayers.sendToGallery")})}),o.jsx(j,{w:10,h:"full",alignItems:"center",justifyContent:"center",pos:"relative",children:o.jsx(it,{className:"checked-icon",w:6,h:6,as:rf,"aria-label":e("controlLayers.sendToCanvas")})})]})})}),o.jsx(Zd,{children:o.jsxs(Yn,{maxW:296,p:2,bg:"base.200",color:"base.800",children:[o.jsx(Zr,{bg:"base.200",left:n?"18px !important":"-18px !important",transitionProperty:"all",transitionDuration:"0.2s"}),o.jsx(Jn,{children:o.jsx(ZP,{sendToCanvas:n,isStaging:s})})]})})]})});UP.displayName="CanvasSendToToggle";const ZP=l.memo(({sendToCanvas:e,isStaging:t})=>{const{t:n}=S();return t?o.jsxs(j,{flexDir:"column",children:[o.jsx(O,{fontWeight:"semibold",children:n("controlLayers.sendingToCanvas")}),o.jsx(O,{fontWeight:"normal",children:o.jsx(Cs,{i18nKey:"controlLayers.viewProgressOnCanvas",components:{Btn:o.jsx(toe,{})}})})]}):o.jsxs(j,{flexDir:"column",children:[o.jsx(O,{fontWeight:"semibold",children:n(e?"controlLayers.sendToCanvas":"controlLayers.sendToGallery")}),o.jsx(O,{fontWeight:"normal",children:n(e?"controlLayers.sendToCanvasDesc":"controlLayers.sendToGalleryDesc")})]})});ZP.displayName="TooltipContent";const toe=e=>{const t=E(),n=jt(),s=l.useCallback(()=>{t(Tt("canvas")),t(Ao("layers")),n.close()},[t,n]);return o.jsx(me,{onClick:s,size:"sm",variant:"link",color:"base.800",_hover:{color:"base.900",textDecoration:"underline"},children:e.children})},noe=()=>{const{t:e}=S(),t=h1(),{data:n}=Oo(),s=se(On),r=se(Tr),a=l.useMemo(()=>r?(r.percentage??0)*100:0,[r]),i=l.useMemo(()=>t==="canvas"?"invokeGreen":t==="gallery"?"invokeBlue":"base",[t]);return o.jsx(Cj,{value:a,"aria-label":e("accessibility.invokeProgressBar"),isIndeterminate:s&&!!(n!=null&&n.queue.in_progress)&&!r,h:2,w:"full",colorScheme:i})},soe=l.memo(noe),qP=l.memo(()=>{const e=w(NS),t=w(MB),n=E(),s=l.useCallback(r=>{n(AB(r))},[n]);return o.jsx(Be,{feature:"paramIterations",children:o.jsx(Ve,{step:t.coarseStep,fineStep:t.fineStep,min:1,max:999,onChange:s,value:e,defaultValue:1,pos:"absolute",insetInlineEnd:0,h:"full",ps:0,w:"72px",flexShrink:0,variant:"iterations"})})});qP.displayName="QueueIterationsNumberInput";const ooe=pe(sc,nj,(e,t)=>oj(e.positivePrompt)?t.prompts.length:1),KP=({prepend:e,children:t,...n})=>o.jsx(Ae,{label:o.jsx(QP,{prepend:e}),maxW:512,...n,children:t}),QP=l.memo(({prepend:e=!1})=>{const{t}=S(),{isReady:n,reasons:s}=xI(),r=w(OS),a=w(Bp),i=w(ooe),c=w(NS),d=w(ao),u=gu(d),[h,{isLoading:p}]=Sx({fixedCacheKey:"enqueueBatch"}),f=l.useMemo(()=>{const C=Math.min(i*c,1e4),y=t("queue.prompts",{count:i}),v=t("queue.iterations",{count:c}),I=t("queue.generations",{count:C});return`${i} ${y}  ${c} ${v} -> ${C} ${I}`.toLowerCase()},[c,i,t]),m=l.useMemo(()=>t(p?"queue.enqueueing":a?"dynamicPrompts.loading":n?e?"queue.queueFront":"queue.queueBack":"queue.notReady"),[p,a,n,e,t]),g=l.useMemo(()=>t(r?"controlLayers.stagingOnCanvas":"parameters.invoke.addingImagesTo"),[r,t]),x=l.useMemo(()=>r?t("queue.canvas"):u||t("boards.uncategorized"),[u,r,t]);return o.jsxs(j,{flexDir:"column",gap:1,children:[o.jsx(O,{fontWeight:"semibold",children:m}),o.jsx(O,{children:f}),s.length>0&&o.jsxs(o.Fragment,{children:[o.jsx(zt,{opacity:.2,borderColor:"base.900"}),o.jsx(Si,{children:s.map((C,y)=>o.jsx(Qt,{children:o.jsxs("span",{children:[C.prefix&&o.jsxs(O,{as:"span",fontWeight:"semibold",children:[C.prefix,":"," "]}),o.jsx(O,{as:"span",children:C.content})]})},`${C.content}.${y}`))})]}),o.jsx(zt,{opacity:.2,borderColor:"base.900"}),o.jsxs(O,{fontStyle:"oblique 10deg",children:[g," ",o.jsx(O,{as:"span",fontWeight:"semibold",children:x})]})]})});QP.displayName="QueueButtonTooltipContent";const KC="Invoke",YP=l.memo(()=>{const e=Eb(),t=Da(),n=w(Bp);return o.jsxs(j,{pos:"relative",w:"200px",children:[o.jsx(qP,{}),o.jsx(KP,{prepend:t,children:o.jsxs(me,{onClick:t?e.queueFront:e.queueBack,isLoading:e.isLoading||n,loadingText:KC,isDisabled:e.isDisabled,rightIcon:t?o.jsx(YI,{}):o.jsx(cf,{}),variant:"solid",colorScheme:"invokeYellow",size:"lg",w:"calc(100% - 60px)",flexShrink:0,justifyContent:"space-between",spinnerPlacement:"end",children:[o.jsx("span",{children:KC}),o.jsx(dt,{})]})})]})});YP.displayName="InvokeQueueBackButton";const roe=()=>{const e=w(bn);return o.jsxs(j,{w:"full",position:"relative",borderRadius:"base",gap:2,flexDir:"column",children:[o.jsxs(j,{gap:2,children:[o.jsx(YP,{}),o.jsx(dt,{}),e==="canvas"&&o.jsx(Jo,{children:o.jsx(UP,{})}),o.jsx(GP,{}),o.jsx(zP,{})]}),o.jsx(soe,{})]})},aoe=l.memo(roe),ioe=e=>{const{t}=S();return o.jsx(j,{pos:"absolute",transform:"translate(0, -50%)",minW:8,top:"50%",insetInlineEnd:2,children:o.jsx(Ae,{label:t("accessibility.toggleRightPanel"),placement:"start",children:o.jsx(Q,{"aria-label":t("accessibility.toggleRightPanel"),onClick:e.panelApi.toggle,icon:o.jsx(JW,{}),h:48})})})},loe=l.memo(ioe),JP=l.memo(()=>{const{t:e}=S(),t=Ri("bbox"),n=Jr("bbox"),s=jt();return Ie({id:"selectBboxTool",category:"canvas",callback:t,options:{enabled:!n&&!s.isOpen},dependencies:[t,n,s.isOpen]}),o.jsx(Ae,{label:`${e("controlLayers.tool.bbox")} (C)`,placement:"end",children:o.jsx(Q,{"aria-label":`${e("controlLayers.tool.bbox")} (C)`,icon:o.jsx(fc,{}),colorScheme:n?"invokeBlue":"base",variant:"solid",onClick:t})})});JP.displayName="ToolBboxButton";const XP=l.memo(()=>{const{t:e}=S(),t=Jr("brush"),n=Ri("brush"),s=jt();return Ie({id:"selectBrushTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),o.jsx(Ae,{label:`${e("controlLayers.tool.brush")} (B)`,placement:"end",children:o.jsx(Q,{"aria-label":`${e("controlLayers.tool.brush")} (B)`,icon:o.jsx(rf,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});XP.displayName="ToolBrushButton";const eR=l.memo(()=>{const{t:e}=S(),t=Jr("colorPicker"),n=Ri("colorPicker"),s=jt();return Ie({id:"selectColorPickerTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),o.jsx(Ae,{label:`${e("controlLayers.tool.colorPicker")} (I)`,placement:"end",children:o.jsx(Q,{"aria-label":`${e("controlLayers.tool.colorPicker")} (I)`,icon:o.jsx(ZW,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});eR.displayName="ToolColorPickerButton";const tR=l.memo(()=>{const{t:e}=S(),t=Jr("move"),n=Ri("move"),s=jt();return Ie({id:"selectMoveTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),o.jsx(Ae,{label:`${e("controlLayers.tool.move")} (V)`,placement:"end",children:o.jsx(Q,{"aria-label":`${e("controlLayers.tool.move")} (V)`,icon:o.jsx(FW,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});tR.displayName="ToolMoveButton";const nR=l.memo(()=>{const{t:e}=S(),t=Jr("rect"),n=Ri("rect"),s=jt();return Ie({id:"selectRectTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),o.jsx(Ae,{label:`${e("controlLayers.tool.rectangle")} (U)`,placement:"end",children:o.jsx(Q,{"aria-label":`${e("controlLayers.tool.rectangle")} (U)`,icon:o.jsx(aG,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});nR.displayName="ToolRectButton";const sR=l.memo(()=>{const{t:e}=S(),t=Jr("eraser"),n=Ri("eraser"),s=jt();return Ie({id:"selectEraserTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[t,n,s.isOpen]}),o.jsx(Ae,{label:`${e("controlLayers.tool.eraser")} (E)`,placement:"end",children:o.jsx(Q,{"aria-label":`${e("controlLayers.tool.eraser")} (E)`,icon:o.jsx(HW,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});sR.displayName="ToolEraserButton";const oR=l.memo(()=>{const{t:e}=S(),t=Jr("view"),n=Ri("view"),s=jt();return Ie({id:"selectViewTool",category:"canvas",callback:n,options:{enabled:!t&&!s.isOpen},dependencies:[n,t,s.isOpen]}),o.jsx(Ae,{label:`${e("controlLayers.tool.view")} (H)`,placement:"end",children:o.jsx(Q,{"aria-label":`${e("controlLayers.tool.view")} (H)`,icon:o.jsx(QW,{}),colorScheme:t?"invokeBlue":"base",variant:"solid",onClick:n})})});oR.displayName="ToolViewButton";const coe=()=>o.jsx(o.Fragment,{children:o.jsxs(Tn,{isAttached:!0,orientation:"vertical",children:[o.jsx(XP,{}),o.jsx(sR,{}),o.jsx(nR,{}),o.jsx(tR,{}),o.jsx(oR,{}),o.jsx(JP,{}),o.jsx(eR,{})]})}),doe=e=>{const{t}=S(),n=Eb(),s=Da(),r=w(bn),a=jt(),i=pc(),{data:c}=Oo(),d=Ab(),u=l.useMemo(()=>{const h=((c==null?void 0:c.queue.in_progress)??0)>0;return!n.isDisabled&&h?o.jsx(it,{boxSize:6,as:NW,animation:Jp}):s?o.jsx(YI,{}):o.jsx(cf,{})},[n.isDisabled,c==null?void 0:c.queue.in_progress,s]);return o.jsxs(j,{pos:"absolute",transform:"translate(0, -50%)",top:"50%",insetInlineStart:2,direction:"column",gap:2,children:[r==="canvas"&&!a.isOpen&&o.jsx(Jo,{children:o.jsx(coe,{})}),o.jsxs(Tn,{orientation:"vertical",h:48,children:[o.jsx(Ae,{label:t("accessibility.toggleLeftPanel"),placement:"end",children:o.jsx(Q,{"aria-label":t("accessibility.toggleLeftPanel"),onClick:e.panelApi.toggle,icon:o.jsx(uG,{}),flexGrow:1})}),o.jsx(KP,{prepend:s,placement:"end",children:o.jsx(Q,{"aria-label":t("queue.queueBack"),onClick:s?n.queueFront:n.queueBack,isLoading:n.isLoading,isDisabled:n.isDisabled,icon:u,colorScheme:"invokeYellow",flexGrow:1})}),o.jsx(Ae,{label:t("queue.cancelTooltip"),placement:"end",children:o.jsx(Q,{isDisabled:d.isDisabled,isLoading:d.isLoading,"aria-label":t("queue.cancelTooltip"),icon:o.jsx(sn,{}),onClick:d.cancelQueueItem,colorScheme:"error",flexGrow:1})}),o.jsx(Ae,{label:t("queue.clearTooltip"),placement:"end",children:o.jsx(Q,{isDisabled:i.isDisabled,isLoading:i.isLoading,"aria-label":t("queue.clearTooltip"),icon:o.jsx(Hs,{}),colorScheme:"error",onClick:i.openDialog,"data-testid":t("queue.clear"),flexGrow:1})})]})]})},uoe=l.memo(doe),Pu=({label:e})=>o.jsx(O,{variant:"subtext",fontWeight:"semibold",pos:"absolute",top:1,left:2,children:e}),Ru=l.memo(e=>o.jsx(j,{pos:"absolute",insetBlockStart:0,insetInlineEnd:0,flexDir:"column",p:2,gap:2,alignItems:"center",justifyContent:"center",children:e.children}));Ru.displayName="PromptOverlayButtonWrapper";const hoe=(e,t)=>{if(!t||!t.length)return["",e,""];if(!t.includes(ai))return["",`${e} `,t];const[n,...s]=t.split(ai);return[n||"",e,s.join(ai)||""]},rR=({presetPrompt:e,prompt:t,label:n})=>{const s=E(),{t:r}=S(),a=l.useMemo(()=>hoe(t,e),[e,t]),i=l.useCallback(()=>{s(Sh(!1))},[s]);return o.jsx(xe,{position:"absolute",top:0,bottom:0,left:0,right:0,layerStyle:"second",borderRadius:"base",children:o.jsxs(j,{flexDir:"column",onClick:i,justifyContent:"space-between",h:"full",borderWidth:1,borderTopWidth:24,borderColor:"transparent",paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3,children:[o.jsx(Pu,{label:n}),o.jsx(j,{overflow:"scroll",children:o.jsx(O,{w:"full",lineHeight:"short",children:a.map((c,d)=>o.jsx(O,{as:"span",color:d===1?"white":"base.200",fontWeight:d===1?"semibold":"normal",children:c},d))})}),o.jsx(Ae,{label:r("stylePresets.viewModeTooltip"),children:o.jsx(j,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,alignItems:"center",justifyContent:"center",p:2,bg:"base.900",opacity:.8,backgroundClip:"border-box",borderBottomStartRadius:"base",children:o.jsx(it,{as:yu,color:"base.500",boxSize:4})})})]})})},aR=l.memo(()=>{var g;const e=E(),t=w(EB),n=w(db),s=w(Bd),{activeStylePreset:r}=du(void 0,{selectFromResult:({data:x})=>{let C=null;return x&&(C=x.find(y=>y.id===s)),{activeStylePreset:C}}}),a=l.useRef(null),{t:i}=S(),c=l.useCallback(x=>{e(gx(x))},[e]),{onChange:d,isOpen:u,onClose:h,onOpen:p,onSelect:f,onKeyDown:m}=Rc({prompt:t,textareaRef:a,onChange:c});return o.jsx(Bi,{isOpen:u,onClose:h,onSelect:f,width:(g=a.current)==null?void 0:g.clientWidth,children:o.jsxs(xe,{pos:"relative",w:"full",children:[o.jsx(ls,{id:"negativePrompt",name:"negativePrompt",ref:a,value:t,onChange:d,onKeyDown:m,fontSize:"sm",variant:"darkFilled",minH:28,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),o.jsx(Ru,{children:o.jsx(Ni,{isOpen:u,onOpen:p})}),o.jsx(Pu,{label:i("parameters.negativePromptPlaceholder")}),n&&o.jsx(rR,{prompt:t,presetPrompt:(r==null?void 0:r.preset_data.negative_prompt)||"",label:`${i("parameters.negativePromptPlaceholder")} (${i("stylePresets.preview")})`})]})})});aR.displayName="ParamNegativePrompt";const poe={svg:{animation:Jp}},iR=l.memo(()=>{const{t:e}=S(),t=w(Bp),n=w(pj),{isOpen:s,onOpen:r}=kI();return o.jsx(Ae,{label:e(t?"dynamicPrompts.loading":"dynamicPrompts.showDynamicPrompts"),children:o.jsx(Q,{size:"sm",variant:"promptOverlay",isDisabled:s,"aria-label":e("dynamicPrompts.showDynamicPrompts"),icon:o.jsx(PW,{}),onClick:r,sx:t?poe:void 0,colorScheme:n&&!t?"error":"base"})})});iR.displayName="ShowDynamicPromptsPreviewButton";const lR=l.memo(()=>{const e=w(LB),t=E(),{t:n}=S(),s=l.useCallback(()=>{t(Rg(!e))},[t,e]),r=l.useMemo(()=>n(e?"sdxl.concatPromptStyle":"sdxl.freePromptStyle"),[e,n]);return o.jsx(Ae,{label:r,children:o.jsx(Q,{"aria-label":r,onClick:s,icon:e?o.jsx(tG,{size:14}):o.jsx(nG,{size:14}),variant:"promptOverlay",fontSize:12,px:.5})})});lR.displayName="SDXLConcatButton";const cR=l.memo(()=>{var y;const e=E(),t=w(TB),n=w(nu),s=w(db),r=w(Bd),{activeStylePreset:a}=du(void 0,{selectFromResult:({data:v})=>{let I=null;return v&&(I=v.find(k=>k.id===r)),{activeStylePreset:I}}}),i=l.useRef(null),{t:c}=S(),d=l.useCallback(v=>{e(mx(v))},[e]),{onChange:u,isOpen:h,onClose:p,onOpen:f,onSelect:m,onKeyDown:g,onFocus:x}=Rc({prompt:t,textareaRef:i,onChange:d}),C=l.useCallback(v=>{x(),v.preventDefault()},[x]);return Ie({id:"focusPrompt",category:"app",callback:C,options:{preventDefault:!0,enableOnFormTags:["INPUT","SELECT","TEXTAREA"]},dependencies:[C]}),o.jsx(Bi,{isOpen:h,onClose:p,onSelect:m,width:(y=i.current)==null?void 0:y.clientWidth,children:o.jsxs(xe,{pos:"relative",children:[o.jsx(ls,{id:"prompt",name:"prompt",ref:i,value:t,onChange:u,minH:40,onKeyDown:g,variant:"darkFilled",borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),o.jsxs(Ru,{children:[o.jsx(Ni,{isOpen:h,onOpen:f}),n==="sdxl"&&o.jsx(lR,{}),o.jsx(iR,{})]}),o.jsx(Pu,{label:c("parameters.positivePromptPlaceholder")}),s&&o.jsx(rR,{prompt:t,presetPrompt:(a==null?void 0:a.preset_data.positive_prompt)||"",label:`${c("parameters.positivePromptPlaceholder")} (${c("stylePresets.preview")})`})]})})});cR.displayName="ParamPositivePrompt";const dR=l.memo(()=>{var p;const e=E(),t=w(PB),n=l.useRef(null),{t:s}=S(),r=l.useCallback(f=>{e(Mw(f))},[e]),{onChange:a,isOpen:i,onClose:c,onOpen:d,onSelect:u,onKeyDown:h}=Rc({prompt:t,textareaRef:n,onChange:r});return o.jsx(Bi,{isOpen:i,onClose:c,onSelect:u,width:(p=n.current)==null?void 0:p.clientWidth,children:o.jsxs(xe,{pos:"relative",children:[o.jsx(ls,{id:"prompt",name:"prompt",ref:n,value:t,onChange:a,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),o.jsx(Ru,{children:o.jsx(Ni,{isOpen:i,onOpen:d})}),o.jsx(Pu,{label:s("sdxl.negStylePrompt")})]})})});dR.displayName="ParamSDXLNegativeStylePrompt";const uR=l.memo(()=>{var p;const e=E(),t=w(RB),n=l.useRef(null),{t:s}=S(),r=l.useCallback(f=>{e(_w(f))},[e]),{onChange:a,isOpen:i,onClose:c,onOpen:d,onSelect:u,onKeyDown:h}=Rc({prompt:t,textareaRef:n,onChange:r});return o.jsx(Bi,{isOpen:i,onClose:c,onSelect:u,width:(p=n.current)==null?void 0:p.clientWidth,children:o.jsxs(xe,{pos:"relative",children:[o.jsx(ls,{id:"prompt",name:"prompt",ref:n,value:t,onChange:a,onKeyDown:h,fontSize:"sm",variant:"darkFilled",minH:24,borderTopWidth:24,paddingInlineEnd:10,paddingInlineStart:3,paddingTop:0,paddingBottom:3}),o.jsx(Ru,{children:o.jsx(Ni,{isOpen:i,onOpen:d})}),o.jsx(Pu,{label:s("sdxl.posStylePrompt")})]})})});uR.displayName="ParamSDXLPositiveStylePrompt";const foe=DB(e=>{var s;const t=((s=e.model)==null?void 0:s.base)==="sdxl",n=e.shouldConcatPrompts;return t&&!n}),W1=l.memo(()=>{const e=w(foe),t=w(Ia);return o.jsxs(j,{flexDir:"column",gap:2,children:[o.jsx(cR,{}),e&&o.jsx(uR,{}),!t&&o.jsx(aR,{}),e&&o.jsx(dR,{})]})});W1.displayName="Prompts";const moe=()=>{const e=w(OB),t=w(BS),n=E(),{t:s}=S(),r=l.useCallback(a=>n(Lw(a)),[n]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"paramCFGRescaleMultiplier",children:o.jsx(U,{children:s("parameters.cfgRescaleMultiplier")})}),o.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r,marks:!0}),o.jsx(Ve,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:r})]})},goe=l.memo(moe),xoe=()=>{const e=E(),{t}=S(),n=w(NB),[s,{isLoading:r}]=l1(),a=l.useCallback(h=>{h&&e(BB(Dn.parse(h)))},[e]),{options:i,value:c,onChange:d,noOptionsMessage:u}=jc({modelConfigs:s,onChange:a,selectedModel:n,isLoading:r});return o.jsxs(V,{isDisabled:!i.length,isInvalid:!i.length,minW:0,flexGrow:1,children:[o.jsx(U,{m:0,children:t("modelManager.clipEmbed")}),o.jsx(Ne,{value:c,options:i,onChange:d,noOptionsMessage:u})]})},boe=l.memo(xoe),yoe=()=>{const e=w($B),t=w(FB),n=w(Zp),s=E(),{t:r}=S(),a=l.useCallback(d=>{s(zB(d))},[s]),i=l.useMemo(()=>n?Qu[n.base].maxClip:Qu["sd-1"].maxClip,[n]),c=l.useMemo(()=>n?Qu[n.base].markers:Qu["sd-1"].markers,[n]);return(n==null?void 0:n.base)==="sdxl"?null:o.jsxs(V,{children:[o.jsx(Be,{feature:"clipSkip",children:o.jsx(U,{children:r("parameters.clipSkip")})}),o.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:i,step:t.coarseStep,fineStep:t.fineStep,onChange:a,marks:c}),o.jsx(Ve,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:i,step:t.coarseStep,fineStep:t.fineStep,onChange:a})]})},voe=l.memo(yoe),Coe=()=>{const e=E(),{t}=S(),n=w(VB),[s,{isLoading:r}]=i1(),a=l.useCallback(h=>{h&&e(Ww(Dn.parse(h)))},[e]),{options:i,value:c,onChange:d,noOptionsMessage:u}=jc({modelConfigs:s,onChange:a,selectedModel:n,isLoading:r});return o.jsxs(V,{isDisabled:!i.length,isInvalid:!i.length,minW:0,flexGrow:1,children:[o.jsx(U,{m:0,children:t("modelManager.t5Encoder")}),o.jsx(Ne,{value:c,options:i,onChange:d,noOptionsMessage:u})]})},woe=l.memo(Coe),joe=()=>{const{t:e}=S(),t=w(HB),n=E(),s=l.useCallback(r=>{n(WB(r.target.checked))},[n]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"seamlessTilingXAxis",children:o.jsx(U,{children:e("parameters.seamlessXAxis")})}),o.jsx(ot,{isChecked:t,onChange:s})]})},Soe=l.memo(joe),koe=()=>{const{t:e}=S(),t=w(GB),n=E(),s=l.useCallback(r=>{n(UB(r.target.checked))},[n]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"seamlessTilingYAxis",children:o.jsx(U,{children:e("parameters.seamlessYAxis")})}),o.jsx(ot,{isChecked:t,onChange:s})]})},Ioe=l.memo(koe),G1=l.memo(()=>{const e=w(ZB),t=w(ub),{t:n}=S(),s=E(),r=l.useCallback(a=>s(xx(a)),[s]);return o.jsxs(V,{flexGrow:1,children:[o.jsx(Be,{feature:"paramSeed",children:o.jsx(U,{children:n("parameters.seed")})}),o.jsx(Ve,{step:1,min:$S,max:Qh,isDisabled:t,onChange:r,value:e,flexGrow:1,defaultValue:0})]})});G1.displayName="ParamSeedNumberInput";const U1=l.memo(()=>{const e=E(),{t}=S(),n=w(ub),s=l.useCallback(r=>e(qB(r.target.checked)),[e]);return o.jsxs(V,{w:"min-content",children:[o.jsx(U,{m:0,children:t("common.random")}),o.jsx(ot,{isChecked:n,onChange:s})]})});U1.displayName="ParamSeedRandomize";const _oe=(e,t)=>Math.floor(Math.random()*(t-e+1)+e),Z1=l.memo(()=>{const e=E(),t=w(ub),{t:n}=S(),s=l.useCallback(()=>e(xx(_oe($S,Qh))),[e]);return o.jsx(me,{size:"sm",isDisabled:t,onClick:s,leftIcon:o.jsx(dG,{}),flexShrink:0,children:n("parameters.shuffle")})});Z1.displayName="ParamSeedShuffle";const Moe=()=>{const e=E(),{t}=S(),n=w(KB),[s,{isLoading:r}]=UM(),a=l.useCallback(h=>{h&&e(QB(Dn.parse(h)))},[e]),{options:i,value:c,onChange:d,noOptionsMessage:u}=vn({modelConfigs:s,onChange:a,selectedModel:n,isLoading:r});return o.jsxs(V,{isDisabled:!i.length,isInvalid:!i.length,minW:0,flexGrow:1,children:[o.jsx(Be,{feature:"paramVAE",children:o.jsx(U,{m:0,children:t("modelManager.vae")})}),o.jsx(Ne,{value:c,options:i,onChange:d,noOptionsMessage:u})]})},Aoe=l.memo(Moe),Eoe=()=>{const e=E(),{t}=S(),n=w(nu),s=w(YB),[r,{isLoading:a}]=jf(),i=l.useCallback(f=>{const m=n===f.base;return!!!n||!m},[n]),c=l.useCallback(f=>{e(Pg(f?Dn.parse(f):null))},[e]),{options:d,value:u,onChange:h,noOptionsMessage:p}=vn({modelConfigs:r,onChange:c,selectedModel:s,isLoading:a,getIsDisabled:i});return o.jsxs(V,{isDisabled:!d.length,isInvalid:!d.length,minW:0,flexGrow:1,children:[o.jsx(Be,{feature:"paramVAE",children:o.jsx(U,{m:0,children:t("modelManager.vae")})}),o.jsx(Ne,{isClearable:!0,value:u,placeholder:u?u.value:t("models.defaultVAE"),options:d,onChange:h,noOptionsMessage:p})]})},Loe=l.memo(Eoe),QC=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],Toe=()=>{const{t:e}=S(),t=E(),n=w(JB),s=l.useCallback(a=>{FS(a==null?void 0:a.value)&&t(XB(a.value))},[t]),r=l.useMemo(()=>QC.find(a=>a.value===n),[n]);return o.jsxs(V,{flexGrow:0,children:[o.jsx(Be,{feature:"paramVAEPrecision",children:o.jsx(U,{m:0,children:e("modelManager.vaePrecision")})}),o.jsx(Ne,{value:r,options:QC,onChange:s})]})},Poe=l.memo(Toe),Oc=e=>{const t=E(),n=l.useMemo(()=>pe(zS,a=>a.accordions[e.id]??e.defaultIsOpen),[e]),s=w(n),r=l.useCallback(()=>{t(e$({id:e.id,isOpen:!s}))},[e.id,t,s]);return{isOpen:s,onToggle:r}},Roe={minW:"9.2rem"},Doe={flexGrow:1},q1=l.memo(()=>{const e=w(t$),{currentData:t}=ou(e??Kn),n=w(bn),s=w(Ia),r=l.useMemo(()=>pt([sc,Ia],(u,h)=>{const p=[];if(h){if(t){let f=t.name;u.vaePrecision==="fp16"&&(f+=` ${u.vaePrecision}`),p.push(f)}}else{if(t){let f=t.name;u.vaePrecision==="fp16"&&(f+=` ${u.vaePrecision}`),p.push(f)}else u.vaePrecision==="fp16"&&p.push(`VAE ${u.vaePrecision}`);u.clipSkip&&p.push(`Skip ${u.clipSkip}`),u.cfgRescaleMultiplier&&p.push(`Rescale ${u.cfgRescaleMultiplier}`),(u.seamlessXAxis||u.seamlessYAxis)&&p.push("seamless"),n==="upscaling"&&!u.shouldRandomizeSeed&&p.push("Manual Seed")}return p}),[t,n]),a=w(r),{t:i}=S(),{isOpen:c,onToggle:d}=Oc({id:`'advanced-settings-${n}`,defaultIsOpen:!1});return o.jsx(lc,{label:i("accordions.advanced.title"),badges:a,isOpen:c,onToggle:d,children:o.jsxs(j,{gap:4,alignItems:"center",p:4,flexDir:"column","data-testid":"advanced-settings-accordion",children:[o.jsxs(j,{gap:4,w:"full",children:[s?o.jsx(Aoe,{}):o.jsx(Loe,{}),!s&&o.jsx(Poe,{})]}),n==="upscaling"?o.jsxs(j,{gap:4,alignItems:"center",children:[o.jsx(G1,{}),o.jsx(Z1,{}),o.jsx(U1,{})]}):o.jsxs(o.Fragment,{children:[!s&&o.jsxs(o.Fragment,{children:[o.jsxs(is,{formLabelProps:Roe,children:[o.jsx(voe,{}),o.jsx(goe,{})]}),o.jsx(j,{gap:4,w:"full",children:o.jsxs(is,{formLabelProps:Doe,children:[o.jsx(Soe,{}),o.jsx(Ioe,{})]})})]}),s&&o.jsxs(is,{children:[o.jsx(woe,{}),o.jsx(boe,{})]})]})]})})});q1.displayName="AdvancedSettingsAccordion";const Ooe=()=>{const e=E(),t=w(n$),n=w(s$),{t:s}=S(),r=l.useCallback(a=>{e(o$(a))},[e]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"compositingCoherenceEdgeSize",children:o.jsx(U,{children:s("parameters.coherenceEdgeSize")})}),o.jsx(qe,{min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:r,marks:!0}),o.jsx(Ve,{min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,value:t,defaultValue:n.initial,onChange:r})]})},Noe=l.memo(Ooe),Boe=()=>{const e=E(),t=w(r$),{t:n}=S(),s=l.useCallback(r=>{e(a$(r))},[e]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"compositingCoherenceMinDenoise",children:o.jsx(U,{children:n("parameters.coherenceMinDenoise")})}),o.jsx(qe,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s}),o.jsx(Ve,{min:0,max:1,step:.01,value:t,defaultValue:0,onChange:s})]})},$oe=l.memo(Boe),Foe=()=>{const e=E(),t=w(i$),{t:n}=S(),s=l.useMemo(()=>[{label:n("parameters.gaussianBlur"),value:"Gaussian Blur"},{label:n("parameters.boxBlur"),value:"Box Blur"},{label:n("parameters.staged"),value:"Staged"}],[n]),r=l.useCallback(i=>{l$(i==null?void 0:i.value)&&e(c$(i.value))},[e]),a=l.useMemo(()=>s.find(i=>i.value===t),[t,s]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"compositingCoherenceMode",children:o.jsx(U,{children:n("parameters.coherenceMode")})}),o.jsx(Ne,{options:s,value:a,onChange:r})]})},zoe=l.memo(Foe),Voe=()=>{const{t:e}=S(),t=E(),n=w(d$),s=w(u$),r=l.useCallback(a=>{t(h$(a))},[t]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"compositingMaskBlur",children:o.jsx(U,{children:e("parameters.maskBlur")})}),o.jsx(qe,{value:n,onChange:r,min:s.sliderMin,max:s.sliderMax,defaultValue:s.initial,step:s.coarseStep,fineStep:s.fineStep,marks:!0}),o.jsx(Ve,{value:n,onChange:r,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},Hoe=l.memo(Voe),Woe=()=>{const{t:e}=S(),t=E(),n=w(uu),{data:s}=VS(),r=l.useMemo(()=>s?s.infill_methods.map(c=>({label:c,value:c})):[],[s]),a=l.useCallback(c=>{!c||!r.find(d=>d.value===c.value)||t(p$(c.value))},[t,r]),i=l.useMemo(()=>r.find(c=>c.value===n),[r,n]);return o.jsxs(V,{isDisabled:r.length===0,children:[o.jsx(Be,{feature:"infillMethod",children:o.jsx(U,{children:e("parameters.infillMethod")})}),o.jsx(Ne,{value:i,options:r,onChange:a})]})},Goe=l.memo(Woe),Uoe=()=>{const e=E(),t=w(f$),n=w(uu),{t:s}=S(),r=l.useCallback(a=>{e(m$(a))},[e]);return o.jsx(j,{flexDir:"column",gap:4,children:o.jsxs(V,{isDisabled:n!=="color",children:[o.jsx(U,{children:s("parameters.infillColorValue")}),o.jsx(xe,{w:"full",pt:2,pb:2,children:o.jsx(wE,{color:t,onChange:r})})]})})},Zoe=l.memo(Uoe),qoe=()=>{const e=E(),t=w(uu),n=w(g$),s=w(x$),{t:r}=S(),a=l.useCallback(i=>{e(b$(i))},[e]);return o.jsxs(V,{isDisabled:t!=="patchmatch",children:[o.jsx(Be,{feature:"patchmatchDownScaleSize",children:o.jsx(U,{children:r("parameters.patchmatchDownScaleSize")})}),o.jsx(qe,{value:n,onChange:a,marks:!0,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep}),o.jsx(Ve,{value:n,onChange:a,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep})]})},Koe=l.memo(qoe),Qoe=()=>{const e=E(),t=w(y$),n=w(v$),s=w(uu),{t:r}=S(),a=l.useCallback(i=>{e(C$(i))},[e]);return o.jsxs(V,{isDisabled:s!=="tile",children:[o.jsx(U,{children:r("parameters.tileSize")}),o.jsx(qe,{value:t,onChange:a,defaultValue:n.initial,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,marks:!0}),o.jsx(Ve,{value:t,onChange:a,defaultValue:n.initial,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep})]})},Yoe=l.memo(Qoe),Joe=()=>{const e=w(uu);return e==="tile"?o.jsx(Yoe,{}):e==="patchmatch"?o.jsx(Koe,{}):e==="color"?o.jsx(Zoe,{}):null},Xoe=l.memo(Joe),YC={minW:"4.5rem"},hR=l.memo(()=>{const{t:e}=S(),{isOpen:t,onToggle:n}=Oc({id:"compositing-settings",defaultIsOpen:!1});return o.jsx(lc,{isOpen:t,onToggle:n,label:e("accordions.compositing.title"),children:o.jsxs(ki,{variant:"collapse",children:[o.jsxs(Ii,{children:[o.jsx(rn,{children:e("accordions.compositing.coherenceTab")}),o.jsx(rn,{children:e("accordions.compositing.infillTab")})]}),o.jsxs(oc,{children:[o.jsx(mn,{children:o.jsx(j,{gap:4,p:4,flexDir:"column",children:o.jsxs(is,{formLabelProps:YC,children:[o.jsx(zoe,{}),o.jsx(Noe,{}),o.jsx($oe,{}),o.jsx(Hoe,{})]})})}),o.jsx(mn,{children:o.jsx(j,{gap:4,p:4,flexDir:"column",children:o.jsxs(is,{formLabelProps:YC,children:[o.jsx(Goe,{}),o.jsx(Xoe,{})]})})})]})]})})});hR.displayName="CompositingSettingsAccordion";const ere=[-1,0,1,2],pR=l.memo(e=>{const{lora:t}=e,n=E(),{data:s}=ou(t.model.key),r=l.useCallback(c=>{n(w$({id:t.id,weight:c}))},[n,t.id]),a=l.useCallback(()=>{n(j$({id:t.id,isEnabled:!t.isEnabled}))},[n,t.id,t.isEnabled]),i=l.useCallback(()=>{n(S$({id:t.id}))},[n,t.id]);return o.jsxs(k$,{variant:"lora",children:[o.jsx(I$,{children:o.jsxs(j,{alignItems:"center",justifyContent:"space-between",width:"100%",gap:2,children:[o.jsx(O,{noOfLines:1,wordBreak:"break-all",color:t.isEnabled?"base.200":"base.500",children:(s==null?void 0:s.name)??t.model.key.substring(0,8)}),o.jsxs(j,{alignItems:"center",gap:2,children:[o.jsx(ot,{size:"sm",onChange:a,isChecked:t.isEnabled}),o.jsx(Q,{"aria-label":"Remove LoRA",variant:"ghost",size:"sm",onClick:i,icon:o.jsx(Hs,{})})]})]})}),o.jsx(Be,{feature:"loraWeight",children:o.jsxs(_$,{children:[o.jsx(qe,{value:t.weight,onChange:r,min:-1,max:2,step:.01,marks:ere,defaultValue:.75,isDisabled:!t.isEnabled}),o.jsx(Ve,{value:t.weight,onChange:r,min:-10,max:10,step:.01,w:20,flexShrink:0,defaultValue:.75,isDisabled:!t.isEnabled})]})})]})});pR.displayName="LoRACard";const tre=pt(hb,e=>e.loras),fR=l.memo(()=>{const e=w(tre);return e.length?o.jsx(j,{flexWrap:"wrap",gap:2,children:e.map(t=>o.jsx(pR,{lora:t},t.id))}):null});fR.displayName="LoRAList";const nre=pe(hb,e=>e.loras),sre=()=>{const e=E(),[t,{isLoading:n}]=wf(),{t:s}=S(),r=w(nre),a=w(nu),i=f=>{const m=a===f.base,g=!!r.find(C=>C.model.key===f.key);return!!!a||!m||g},c=l.useCallback(f=>{f&&e(M$({model:f}))},[e]),{options:d,onChange:u}=vn({modelConfigs:t,getIsDisabled:i,onChange:c}),h=l.useMemo(()=>n?s("common.loading"):d.length===0?s("models.noLoRAsInstalled"):s("models.addLora"),[n,d.length,s]),p=l.useCallback(()=>s("models.noMatchingLoRAs"),[s]);return o.jsxs(V,{isDisabled:!d.length,children:[o.jsx(Be,{feature:"lora",children:o.jsxs(U,{children:[s("models.concepts")," "]})}),o.jsx(Ne,{placeholder:h,value:null,options:d,noOptionsMessage:p,onChange:u,"data-testid":"add-lora",sx:rre})]})},ore=l.memo(sre),rre={w:"full"},are=()=>{const e=w(A$),t=w(pb),n=E(),{t:s}=S(),r=l.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),a=l.useCallback(i=>n(Aw(i)),[n]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"paramCFGScale",children:o.jsx(U,{children:s("parameters.cfgScale")})}),o.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:a,marks:r}),o.jsx(Ve,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:a})]})},ire=l.memo(are),lre=()=>{const e=w(E$),t=w(HS),n=E(),{t:s}=S(),r=l.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax-(t.sliderMax-t.sliderMin)/2),t.sliderMax],[t.sliderMax,t.sliderMin]),a=l.useCallback(i=>n(Ew(i)),[n]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"paramGuidance",children:o.jsx(U,{children:s("parameters.guidance")})}),o.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:a,marks:r}),o.jsx(Ve,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:a})]})},cre=l.memo(lre),dre=()=>{const e=E(),{t}=S(),n=w(L$),s=l.useCallback(a=>{Xl(a==null?void 0:a.value)&&e(Tw(a.value))},[e]),r=l.useMemo(()=>_a.find(a=>a.value===n),[n]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"paramScheduler",children:o.jsx(U,{children:t("parameters.scheduler")})}),o.jsx(Ne,{value:r,options:_a,onChange:s})]})},ure=l.memo(dre),hre=()=>{const e=w(T$),t=w(fb),n=E(),{t:s}=S(),r=l.useMemo(()=>[t.sliderMin,Math.floor(t.sliderMax/2),t.sliderMax],[t.sliderMax,t.sliderMin]),a=l.useCallback(i=>{n(Dw(i))},[n]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"paramSteps",children:o.jsx(U,{children:s("parameters.steps")})}),o.jsx(qe,{value:e,defaultValue:t.initial,min:t.sliderMin,max:t.sliderMax,step:t.coarseStep,fineStep:t.fineStep,onChange:a,marks:r}),o.jsx(Ve,{value:e,defaultValue:t.initial,min:t.numberInputMin,max:t.numberInputMax,step:t.coarseStep,fineStep:t.fineStep,onChange:a})]})},pre=l.memo(hre),mR=l.memo(e=>{const{t}=S(),n=E(),s=w(ib),r=l.useCallback(()=>{n(Tt("models"))},[n]);return s?null:o.jsx(Q,{icon:o.jsx(xc,{}),tooltip:`${t("common.goTo")} ${t("ui.tabs.modelsTab")}`,"aria-label":`${t("common.goTo")} ${t("ui.tabs.modelsTab")}`,onClick:r,size:"sm",variant:"ghost",...e})});mR.displayName="NavigateToModelManagerButton";function fre(e){return oe({tag:"svg",attr:{viewBox:"0 0 24 24"},child:[{tag:"path",attr:{fill:"none",d:"M0 0h24v24H0z"},child:[]},{tag:"path",attr:{d:"M12.5 6.9c1.78 0 2.44.85 2.5 2.1h2.21c-.07-1.72-1.12-3.3-3.21-3.81V3h-3v2.16c-.53.12-1.03.3-1.48.54l1.47 1.47c.41-.17.91-.27 1.51-.27zM5.33 4.06 4.06 5.33 7.5 8.77c0 2.08 1.56 3.21 3.91 3.91l3.51 3.51c-.34.48-1.05.91-2.42.91-2.06 0-2.87-.92-2.98-2.1h-2.2c.12 2.19 1.76 3.42 3.68 3.83V21h3v-2.15c.96-.18 1.82-.55 2.45-1.12l2.22 2.22 1.27-1.27L5.33 4.06z"},child:[]}]})(e)}const mre=()=>{const e=E(),{t}=S(),n=w(bn),s=w(WS),[r,{isLoading:a}]=vf(),i=l.useMemo(()=>{if(!r||s===null)return null;const C=r.find(y=>y.key===s);return C||null},[r,s]),c=l.useMemo(()=>{var C;if(!(!r.length||!i))return(C=r.find(y=>y.key===(i==null?void 0:i.key)))==null?void 0:C.description},[r,i]),d=l.useCallback(C=>{if(C)try{e(Hw(Dn.parse(C)))}catch{}},[e]),u=l.useCallback(C=>n==="upscaling"&&C.base==="flux",[n]),{options:h,value:p,onChange:f,placeholder:m,noOptionsMessage:g}=vn({modelConfigs:r,selectedModel:i,onChange:d,isLoading:a,getIsDisabled:u}),x=l.useMemo(()=>i&&P$(i)&&i.config_path==="flux-dev",[i]);return o.jsxs(V,{isDisabled:!r.length,isInvalid:!p||!r.length,children:[o.jsxs(j,{alignItems:"center",children:[o.jsx(Be,{feature:"paramModel",children:o.jsx(U,{children:t("modelManager.model")})}),x?o.jsx(Be,{feature:"fluxDevLicense",hideDisable:!0,children:o.jsx(j,{justifyContent:"flex-start",children:o.jsx(it,{as:fre})})}):o.jsx(dt,{})]}),o.jsx(Ae,{label:c,children:o.jsx(xe,{w:"full",minW:0,children:o.jsx(Ne,{value:p,placeholder:m,options:h,onChange:f,noOptionsMessage:g,isInvalid:p==null?void 0:p.isDisabled})})})]})},gre=l.memo(mre),xre=()=>{const e=w(Zp),{t}=S(),n=E(),s=l.useCallback(()=>{n(R$())},[n]);return o.jsx(Q,{icon:o.jsx(cf,{}),tooltip:t("modelManager.useDefaultSettings"),"aria-label":t("modelManager.useDefaultSettings"),isDisabled:!e,onClick:s,size:"sm",variant:"ghost"})},K1=e=>{const t=E(),n=l.useMemo(()=>pe(zS,a=>a.expanders[e.id]??e.defaultIsOpen),[e]),s=w(n),r=l.useCallback(()=>{t(D$({id:e.id,isOpen:!s}))},[t,e.id,s]);return{isOpen:s,onToggle:r}},bre=()=>{const e=w(WS),{currentData:t}=ou(e??Kn);return t},yre={minW:"4rem"},Q1=l.memo(()=>{const{t:e}=S(),t=bre(),n=w(bn),s=w(Ia),r=l.useMemo(()=>pt(hb,p=>{const f=p.loras.filter(x=>x.isEnabled).length,m=f?[`${f} ${e("models.concepts")}`]:Ss,g=t?[t.name,t.base]:Ss;return{loraTabBadges:m,accordionBadges:g}}),[t,e]),{loraTabBadges:a,accordionBadges:i}=w(r),{isOpen:c,onToggle:d}=K1({id:"generation-settings-advanced",defaultIsOpen:!1}),{isOpen:u,onToggle:h}=Oc({id:`generation-settings-${n}`,defaultIsOpen:n!=="upscaling"});return o.jsx(lc,{label:e("accordions.generation.title"),badges:[...i,...a],isOpen:u,onToggle:h,children:o.jsxs(xe,{px:4,pt:4,"data-testid":"generation-accordion",children:[o.jsxs(j,{gap:4,flexDir:"column",children:[o.jsxs(j,{gap:4,alignItems:"center",children:[o.jsx(gre,{}),o.jsxs(j,{children:[o.jsx(xre,{}),o.jsx(mR,{})]})]}),o.jsxs(j,{gap:4,flexDir:"column",children:[o.jsx(ore,{}),o.jsx(fR,{})]})]}),o.jsx(mb,{label:e("accordions.advanced.options"),isOpen:c,onToggle:d,children:o.jsx(j,{gap:4,flexDir:"column",pb:4,children:o.jsxs(is,{formLabelProps:yre,children:[!s&&o.jsx(ure,{}),o.jsx(pre,{}),s?o.jsx(cre,{}):o.jsx(ire,{})]})})})]})})});Q1.displayName="GenerationSettingsAccordion";const gR=l.memo(()=>{const e=w(O$),t=E(),n=l.useCallback(r=>{t(N$(r.target.checked))},[t]),{t:s}=S();return o.jsxs(V,{w:"min-content",children:[o.jsx(Be,{feature:"optimizedDenoising",children:o.jsxs(U,{m:0,children:[s("parameters.optimizedImageToImage")," (",s("settings.beta"),")"]})}),o.jsx(ot,{isChecked:e,onChange:n})]})});gR.displayName="ParamOptimizedDenoisingToggle";const vre=pe(Je,e=>e.bbox.scaleMethod==="manual"),Cre=pe(Je,e=>e.bbox.scaledSize.height),wre=pe(Gs,e=>e.sd.scaledBoundingBoxHeight),jre=()=>{const{t:e}=S(),t=E(),n=w(Pn),s=w(hu),r=w(vre),a=w(Cre),i=w(wre),c=w(Xd),d=l.useCallback(u=>{t(B$(u))},[t]);return o.jsxs(V,{isDisabled:!r||n,children:[o.jsx(U,{children:e("parameters.scaledHeight")}),o.jsx(qe,{min:i.sliderMin,max:i.sliderMax,step:i.coarseStep,fineStep:c,value:a,onChange:d,marks:!0,defaultValue:s}),o.jsx(Ve,{min:i.numberInputMin,max:i.numberInputMax,step:i.coarseStep,fineStep:c,value:a,onChange:d,defaultValue:s})]})},Sre=l.memo(jre),kre=pe(Je,e=>e.bbox.scaleMethod==="manual"),Ire=pe(Je,e=>e.bbox.scaledSize.width),_re=pe(Gs,e=>e.sd.scaledBoundingBoxWidth),Mre=()=>{const{t:e}=S(),t=E(),n=w(Pn),s=w(hu),r=w(kre),a=w(Ire),i=w(_re),c=w(Xd),d=l.useCallback(u=>{t($$(u))},[t]);return o.jsxs(V,{isDisabled:!r||n,children:[o.jsx(U,{children:e("parameters.scaledWidth")}),o.jsx(qe,{min:i.sliderMin,max:i.sliderMax,step:i.coarseStep,fineStep:c,value:a,onChange:d,defaultValue:s,marks:!0}),o.jsx(Ve,{min:i.numberInputMin,max:i.numberInputMax,step:i.coarseStep,fineStep:c,value:a,onChange:d,defaultValue:s})]})},Are=l.memo(Mre),Ere=pe(Je,e=>e.bbox.scaleMethod),Lre=()=>{const e=E(),{t}=S(),n=w(Ere),s=w(Pn),r=l.useMemo(()=>[{label:t("modelManager.none"),value:"none"},{label:t("common.auto"),value:"auto"},{label:t("modelManager.manual"),value:"manual"}],[t]),a=l.useCallback(c=>{F$(c==null?void 0:c.value)&&e(z$(c.value))},[e]),i=l.useMemo(()=>r.find(c=>c.value===n),[n,r]);return o.jsxs(V,{isDisabled:s,children:[o.jsx(Be,{feature:"scaleBeforeProcessing",children:o.jsx(U,{children:t("parameters.scaleBeforeProcessing")})}),o.jsx(Ne,{value:i,options:r,onChange:a})]})},Tre=l.memo(Lre),xR=l.memo(()=>{const{t:e}=S(),t=E(),n=w(V$),s=w(Pn),r=l.useCallback(i=>{!i||!H$(i.value)||t(W$({id:i.value}))},[t]),a=l.useMemo(()=>Jy.filter(i=>i.value===n)[0],[n]);return o.jsxs(V,{isDisabled:s,children:[o.jsx(Be,{feature:"paramAspect",children:o.jsx(U,{children:e("parameters.aspect")})}),o.jsx(Ne,{value:a,onChange:r,options:Jy,sx:Pre})]})});xR.displayName="BboxAspectRatioSelect";const Pre={minW:24},bR=l.memo(()=>{const{t:e}=S(),t=E(),n=w(hu),s=w(GS),r=w(US),a=w(Pn),i=w(Xd),c=l.useCallback(u=>{t(Rw({height:u}))},[t]),d=l.useMemo(()=>[r.sliderMin,n,r.sliderMax],[r.sliderMin,r.sliderMax,n]);return o.jsxs(V,{isDisabled:a,children:[o.jsx(Be,{feature:"paramHeight",children:o.jsx(U,{children:e("parameters.height")})}),o.jsx(qe,{value:s,defaultValue:n,onChange:c,min:r.sliderMin,max:r.sliderMax,step:r.coarseStep,fineStep:i,marks:d}),o.jsx(Ve,{value:s,defaultValue:n,onChange:c,min:r.numberInputMin,max:r.numberInputMax,step:r.coarseStep,fineStep:i})]})});bR.displayName="BboxHeight";const Rre=pe(Je,e=>e.bbox.aspectRatio.isLocked),yR=l.memo(()=>{const{t:e}=S(),t=E(),n=w(Rre),s=w(Pn),r=l.useCallback(()=>{t(G$())},[t]);return o.jsx(Q,{tooltip:e("parameters.lockAspectRatio"),"aria-label":e("parameters.lockAspectRatio"),onClick:r,variant:n?"outline":"ghost",size:"sm",icon:n?o.jsx(JI,{}):o.jsx(FI,{}),isDisabled:s})});yR.displayName="BboxLockAspectRatioButton";const vR=l.memo(()=>{const e=w(ZS),t=w(GS),n=w(U$),[s,r]=nT(),a=l.useMemo(()=>{if(!r)return{width:0,height:0};let i=e,c=t;return e>t?(i=r.width,c=i/n):(c=r.height,i=c*n),{width:i,height:c}},[r,e,t,n]);return o.jsx(j,{w:"full",h:"full",alignItems:"center",justifyContent:"center",ref:s,children:o.jsx(j,{position:"relative",borderRadius:"base",borderColor:"base.600",borderWidth:"3px",width:`${a.width}px`,height:`${a.height}px`,alignItems:"center",justifyContent:"center",children:o.jsxs(va,{borderRadius:"base",position:"absolute",top:0,right:0,bottom:0,left:0,gridTemplateColumns:"1fr 1fr 1fr",gridTemplateRows:"1fr 1fr 1fr",gap:"1px",bg:"base.700",children:[o.jsx(ln,{bg:"base.800"}),o.jsx(ln,{bg:"base.800"}),o.jsx(ln,{bg:"base.800"}),o.jsx(ln,{bg:"base.800"}),o.jsx(ln,{bg:"base.800"}),o.jsx(ln,{bg:"base.800"}),o.jsx(ln,{bg:"base.800"}),o.jsx(ln,{bg:"base.800"}),o.jsx(ln,{bg:"base.800"})]})})})});vR.displayName="BboxPreview";const Dre=pe(Je,e=>e.bbox.rect.width),Ore=pe(Je,e=>e.bbox.rect.height),CR=l.memo(()=>{const{t:e}=S(),t=E(),n=w(Pn),s=w(Dre),r=w(Ore),a=w(hu),i=l.useMemo(()=>Z$(s,r,a),[r,s,a]),c=l.useMemo(()=>q$(s,r,a),[r,s,a]),d=l.useCallback(()=>{t(K$())},[t]),u=l.useMemo(()=>e(i?"parameters.setToOptimalSizeTooSmall":c?"parameters.setToOptimalSizeTooLarge":"parameters.setToOptimalSize"),[c,i,e]);return o.jsx(Q,{tooltip:u,"aria-label":e("parameters.setToOptimalSize"),onClick:d,variant:"ghost",size:"sm",icon:o.jsx(cf,{}),colorScheme:i||c?"warning":"base",isDisabled:n})});CR.displayName="BboxSetOptimalSizeButton";const wR=l.memo(()=>{const{t:e}=S(),t=E(),n=w(Pn),s=l.useCallback(()=>{t(Q$())},[t]);return o.jsx(Q,{tooltip:e("parameters.swapDimensions"),"aria-label":e("parameters.swapDimensions"),onClick:s,variant:"ghost",size:"sm",icon:o.jsx(LW,{}),isDisabled:n})});wR.displayName="BboxSwapDimensionsButton";const jR=l.memo(()=>{const{t:e}=S(),t=E(),n=w(ZS),s=w(hu),r=w(qS),a=w(Pn),i=w(Xd),c=l.useCallback(u=>{t(Pw({width:u}))},[t]),d=l.useMemo(()=>[r.sliderMin,s,r.sliderMax],[r.sliderMax,r.sliderMin,s]);return o.jsxs(V,{isDisabled:a,children:[o.jsx(Be,{feature:"paramWidth",children:o.jsx(U,{children:e("parameters.width")})}),o.jsx(qe,{value:n,onChange:c,defaultValue:s,min:r.sliderMin,max:r.sliderMax,step:r.coarseStep,fineStep:i,marks:d}),o.jsx(Ve,{value:n,onChange:c,defaultValue:s,min:r.numberInputMin,max:r.numberInputMax,step:r.coarseStep,fineStep:i})]})});jR.displayName="BboxWidth";const SR=l.memo(()=>o.jsxs(j,{gap:4,alignItems:"center",children:[o.jsx(j,{gap:4,flexDirection:"column",width:"full",children:o.jsxs(is,{formLabelProps:Nre,children:[o.jsxs(j,{gap:4,children:[o.jsx(xR,{}),o.jsx(wR,{}),o.jsx(yR,{}),o.jsx(CR,{})]}),o.jsx(jR,{}),o.jsx(bR,{})]})}),o.jsx(j,{w:"108px",h:"108px",flexShrink:0,flexGrow:0,alignItems:"center",justifyContent:"center",children:o.jsx(vR,{})})]}));SR.displayName="BboxSettings";const Nre={minW:10},Bre=[0,.5,1],kR=l.memo(()=>{const e=w(Y$),t=E(),n=l.useCallback(a=>{t(Ow(a))},[t]),s=w(J$),{t:r}=S();return o.jsxs(V,{children:[o.jsx(Be,{feature:"paramDenoisingStrength",children:o.jsx(U,{children:`${r("parameters.denoisingStrength")}`})}),o.jsx(qe,{step:s.coarseStep,fineStep:s.fineStep,min:s.sliderMin,max:s.sliderMax,defaultValue:s.initial,onChange:n,value:e,marks:Bre}),o.jsx(Ve,{step:s.coarseStep,fineStep:s.fineStep,min:s.numberInputMin,max:s.numberInputMax,defaultValue:s.initial,onChange:n,value:e})]})});kR.displayName="ParamDenoisingStrength";const $re=pt([Je,sc],(e,t)=>{const{shouldRandomizeSeed:n}=t,s=[],{aspectRatio:r}=e.bbox,{width:a,height:i}=e.bbox.rect;if(s.push(`${a}${i}`),s.push(r.id),r.isLocked&&s.push("locked"),n||s.push("Manual Seed"),s.length===0)return Ss}),Fre={minW:"4.5rem"},IR=l.memo(()=>{const{t:e}=S(),t=w($re),n=w(Dj),{isOpen:s,onToggle:r}=Oc({id:"image-settings",defaultIsOpen:!0}),{isOpen:a,onToggle:i}=K1({id:"image-settings-advanced",defaultIsOpen:!1}),c=w(Ia);return o.jsx(lc,{label:e("accordions.image.title"),badges:t,isOpen:s,onToggle:r,children:o.jsxs(j,{px:4,pt:4,w:"full",h:"full",flexDir:"column","data-testid":"image-settings-accordion",children:[o.jsx(SR,{}),o.jsxs(j,{py:3,gap:4,alignItems:"center",children:[o.jsx(G1,{}),o.jsx(Z1,{}),o.jsx(U1,{})]}),o.jsx(kR,{}),o.jsx(mb,{label:e("accordions.advanced.options"),isOpen:a,onToggle:i,children:o.jsxs(j,{gap:4,pb:4,flexDir:"column",children:[c&&o.jsx(gR,{}),o.jsx(Tre,{}),n!=="none"&&o.jsxs(is,{formLabelProps:Fre,children:[o.jsx(Are,{}),o.jsx(Sre,{})]})]})})]})})});IR.displayName="ImageSettingsAccordion";const zre=()=>{const{t:e}=S(),t=E(),n=w(X$),s=w(pb),r=l.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),a=l.useCallback(i=>t(Bw(i)),[t]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"refinerCfgScale",children:o.jsx(U,{children:e("sdxl.cfgScale")})}),o.jsx(qe,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:r}),o.jsx(Ve,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a})]})},Vre=l.memo(zre),Hre=e=>e.base==="sdxl-refiner",Wre=()=>{const e=E(),t=w(eF),{t:n}=S(),[s,{isLoading:r}]=Cf(),a=l.useCallback(f=>{if(!f){e(Tg(null));return}e(Tg(Dn.parse(f)))},[e]),{options:i,value:c,onChange:d,placeholder:u,noOptionsMessage:h}=jc({modelConfigs:s,onChange:a,selectedModel:t,isLoading:r,optionsFilter:Hre}),p=l.useCallback(()=>{a(null)},[a]);return o.jsxs(V,{isDisabled:!i.length,isInvalid:!i.length,w:"full",children:[o.jsx(Be,{feature:"refinerModel",children:o.jsx(U,{children:n("sdxl.refinermodel")})}),o.jsxs(j,{w:"full",minW:0,gap:2,alignItems:"center",children:[o.jsx(Ne,{value:c,placeholder:u,options:i,onChange:d,noOptionsMessage:h}),o.jsx(Q,{size:"sm",variant:"ghost",icon:o.jsx(sn,{}),"aria-label":n("common.reset"),onClick:p,isDisabled:!c})]})]})},Gre=l.memo(Wre),Ure=()=>{const e=w(tF),t=E(),{t:n}=S(),s=l.useCallback(r=>t(zw(r)),[t]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"refinerNegativeAestheticScore",children:o.jsx(U,{children:n("sdxl.negAestheticScore")})}),o.jsx(qe,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5,marks:!0}),o.jsx(Ve,{min:1,max:10,step:.5,fineStep:.1,onChange:s,value:e,defaultValue:2.5})]})},Zre=l.memo(Ure),qre=()=>{const e=w(nF),t=E(),{t:n}=S(),s=l.useCallback(r=>t(Fw(r)),[t]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"refinerPositiveAestheticScore",children:o.jsx(U,{children:n("sdxl.posAestheticScore")})}),o.jsx(qe,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6,marks:!0}),o.jsx(Ve,{step:.5,min:1,max:10,fineStep:.1,onChange:s,value:e,defaultValue:6})]})},Kre=l.memo(qre),Qre=()=>{const e=E(),{t}=S(),n=w(sF),s=l.useCallback(a=>{Xl(a==null?void 0:a.value)&&e($w(a.value))},[e]),r=l.useMemo(()=>_a.find(a=>a.value===n),[n]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"refinerScheduler",children:o.jsx(U,{children:t("sdxl.scheduler")})}),o.jsx(Ne,{value:r,options:_a,onChange:s})]})},Yre=l.memo(Qre),Jre=()=>{const e=w(oF),t=E(),n=l.useCallback(r=>t(Vw(r)),[t]),{t:s}=S();return o.jsxs(V,{children:[o.jsx(Be,{feature:"refinerStart",children:o.jsx(U,{children:s("sdxl.refinerStart")})}),o.jsx(qe,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e,marks:!0}),o.jsx(Ve,{step:.01,min:0,max:1,onChange:n,defaultValue:.8,value:e})]})},Xre=l.memo(Jre),eae=()=>{const{t:e}=S(),t=E(),n=w(rF),s=w(fb),r=l.useMemo(()=>[s.sliderMin,Math.floor(s.sliderMax/2),s.sliderMax],[s.sliderMax,s.sliderMin]),a=l.useCallback(i=>{t(Nw(i))},[t]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"refinerSteps",children:o.jsx(U,{children:e("sdxl.steps")})}),o.jsx(qe,{value:n,defaultValue:s.initial,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a,marks:r}),o.jsx(Ve,{value:n,defaultValue:s.initial,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:a})]})},tae=l.memo(eae),nae=()=>{const[e]=Cf();return!!e.length},sae={minW:"9.2rem"},oae={minW:"5rem"},rae=pt(sc,e=>e.refinerModel?["Enabled"]:void 0),_R=l.memo(()=>{const{t:e}=S(),t=nae(),n=w(rae),{isOpen:s,onToggle:r}=Oc({id:"refiner-settings",defaultIsOpen:!1});return o.jsx(lc,{label:e("sdxl.refiner"),badges:n,isOpen:s,onToggle:r,children:t?o.jsx(AR,{}):o.jsx(MR,{})})});_R.displayName="RefinerSettingsAccordion";const MR=l.memo(()=>{const{t:e}=S();return o.jsx(j,{justifyContent:"center",p:4,children:o.jsx(O,{fontSize:"sm",color:"base.500",children:e("models.noRefinerModelsInstalled")})})});MR.displayName="RefinerSettingsAccordionNoRefiner";const AR=l.memo(()=>{const e=w(aF);return o.jsx(is,{isDisabled:!e,children:o.jsxs(j,{p:4,gap:4,flexDir:"column",minW:0,children:[o.jsx(Gre,{}),o.jsxs(is,{formLabelProps:oae,isDisabled:!e,children:[o.jsx(Yre,{}),o.jsx(tae,{}),o.jsx(Vre,{}),o.jsx(Xre,{})]}),o.jsxs(is,{formLabelProps:sae,isDisabled:!e,children:[o.jsx(Kre,{}),o.jsx(Zre,{})]})]})})});AR.displayName="RefinerSettingsAccordionContent";const aae={svg:{animation:Jp}},iae=()=>{const[e,{isLoading:t}]=iF(),{t:n}=S(),{presetCount:s}=du(void 0,{selectFromResult:({data:a})=>({presetCount:((a==null?void 0:a.filter(c=>c.type!=="default"))??Ss).length})}),r=l.useCallback(async()=>{let a;try{const i=await e().unwrap();a=new Blob([i],{type:"text/csv"})}catch{he({status:"error",title:n("stylePresets.exportFailed")});return}if(a){const i=window.URL.createObjectURL(a),c=document.createElement("a");c.href=i,c.download="data.csv",document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(i),he({status:"success",title:n("stylePresets.exportDownloaded")})}},[e,n]);return o.jsx(Q,{onClick:r,icon:t?o.jsx(n_,{}):o.jsx(mc,{}),tooltip:n("stylePresets.exportPromptTemplates"),"aria-label":n("stylePresets.exportPromptTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?aae:void 0,isDisabled:t||s===0})},lae={svg:{animation:Jp}},cae=()=>{const[e,{isLoading:t}]=lF(),{t:n}=S(),s=l.useCallback(i=>{const c=i[0];c&&e(c).unwrap().then(()=>{he({status:"success",title:n("toast.importSuccessful")})}).catch(d=>{he({status:"error",title:n("toast.importFailed"),description:d?`${d.data.detail}`:void 0})})},[e,n]),{getInputProps:r,getRootProps:a}=Na({accept:{"text/csv":[".csv"],"application/json":[".json"]},onDropAccepted:s,noDrag:!0,multiple:!1});return o.jsxs(o.Fragment,{children:[o.jsx(Q,{icon:t?o.jsx(n_,{}):o.jsx(gc,{}),tooltip:o.jsx(dae,{}),"aria-label":n("stylePresets.importTemplates"),size:"md",variant:"link",w:8,h:8,sx:t?lae:void 0,isDisabled:t,...a()}),o.jsx("input",{...r()})]})},dae=()=>{const{t:e}=S();return o.jsxs(j,{flexDir:"column",children:[o.jsx(O,{pb:1,fontWeight:"semibold",children:e("stylePresets.importTemplates")}),o.jsx(O,{children:e("stylePresets.acceptedColumnsKeys")}),o.jsxs(Si,{children:[o.jsx(Qt,{children:e("stylePresets.nameColumn")}),o.jsx(Qt,{children:e("stylePresets.positivePromptColumn")}),o.jsx(Qt,{children:e("stylePresets.negativePromptColumn")})]})]})},uae=()=>{const e=l.useCallback(()=>{Ma.set({prefilledFormData:null,updatingStylePresetId:null,isModalOpen:!0})},[]),{t}=S();return o.jsx(Q,{icon:o.jsx(Bt,{}),tooltip:t("stylePresets.createPromptTemplate"),"aria-label":t("stylePresets.createPromptTemplate"),onClick:e,size:"md",variant:"ghost",w:8,h:8})},Nc=l.memo,Yi="40px",hae="24px",pae=({presetImageUrl:e,imageWidth:t})=>o.jsx(Ae,{label:e&&o.jsx(nn,{src:e,draggable:!1,objectFit:"cover",maxW:150,aspectRatio:"1/1",borderRadius:"base",borderBottomRadius:"lg"}),p:2,children:o.jsx(nn,{src:e||"",fallbackStrategy:"beforeLoadOrError",fallback:o.jsx(j,{height:t||Yi,minWidth:t||Yi,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:o.jsx(it,{color:"base.500",as:t_,boxSize:t?t/2:hae})}),objectFit:"cover",objectPosition:"50% 50%",height:t||Yi,width:t||Yi,minHeight:t||Yi,minWidth:t||Yi,borderRadius:"base"})}),ER=Nc(pae),fae=({preset:e})=>{const t=E(),n=w(Bd),{t:s}=S(),r=zZ(),a=l.useCallback(u=>{u.stopPropagation();const{name:h,preset_data:p}=e,{positive_prompt:f,negative_prompt:m}=p;Ma.set({prefilledFormData:{name:h,positivePrompt:f||"",negativePrompt:m||"",imageUrl:e.image,type:e.type},updatingStylePresetId:e.id,isModalOpen:!0})},[e]),i=l.useCallback(()=>{t(bd(e.id)),Wl.set(!1)},[t,e.id]),c=l.useCallback(u=>{u.stopPropagation(),r(e)},[r,e]),d=l.useCallback(u=>{u.stopPropagation();const{name:h,preset_data:p}=e,{positive_prompt:f,negative_prompt:m}=p;Ma.set({prefilledFormData:{name:`${h} (${s("common.copy")})`,positivePrompt:f||"",negativePrompt:m||"",imageUrl:e.image,type:"user"},updatingStylePresetId:null,isModalOpen:!0})},[e,s]);return o.jsxs(j,{gap:4,onClick:i,cursor:"pointer",_hover:{backgroundColor:"base.750"},py:3,px:2,borderRadius:"base",alignItems:"flex-start",w:"full",children:[o.jsx(ER,{presetImageUrl:e.image}),o.jsxs(j,{flexDir:"column",w:"full",children:[o.jsxs(j,{w:"full",justifyContent:"space-between",alignItems:"flex-start",children:[o.jsxs(j,{alignItems:"center",gap:2,children:[o.jsx(O,{fontSize:"md",noOfLines:2,children:e.name}),n===e.id&&o.jsx(Rn,{color:"invokeBlue.400",borderColor:"invokeBlue.700",borderWidth:1,bg:"transparent",flexShrink:0,children:s("stylePresets.active")})]}),o.jsxs(j,{alignItems:"center",gap:1,children:[o.jsx(Q,{size:"sm",variant:"ghost","aria-label":s("stylePresets.copyTemplate"),onClick:d,icon:o.jsx(gr,{})}),e.type!=="default"&&o.jsxs(o.Fragment,{children:[o.jsx(Q,{size:"sm",variant:"ghost","aria-label":s("stylePresets.editTemplate"),onClick:a,icon:o.jsx(Cu,{})}),o.jsx(Q,{size:"sm",variant:"ghost","aria-label":s("stylePresets.deleteTemplate"),onClick:c,colorScheme:"error",icon:o.jsx(Ob,{})})]})]})]}),o.jsxs(j,{flexDir:"column",gap:1,children:[o.jsxs(O,{fontSize:"xs",children:[o.jsxs(O,{as:"span",fontWeight:"semibold",children:[s("stylePresets.positivePrompt"),":"]})," ",e.preset_data.positive_prompt]}),o.jsxs(O,{fontSize:"xs",children:[o.jsxs(O,{as:"span",fontWeight:"semibold",children:[s("stylePresets.negativePrompt"),":"]})," ",e.preset_data.negative_prompt]})]})]})]})},ag=({title:e,data:t})=>{const{t:n}=S(),{onToggle:s,isOpen:r}=Is({defaultIsOpen:!0}),a=w(gb);return o.jsxs(j,{flexDir:"column",children:[o.jsx(me,{variant:"unstyled",onClick:s,children:o.jsxs(j,{gap:2,alignItems:"center",children:[o.jsx(it,{boxSize:4,as:Fo,transform:r?void 0:"rotate(-90deg)",fill:"base.500"}),o.jsx(O,{fontSize:"sm",fontWeight:"semibold",userSelect:"none",color:"base.500",children:e})]})}),o.jsx(Mi,{in:r,children:t.length?t.map(i=>o.jsx(fae,{preset:i},i.id)):o.jsx(Mt,{fontSize:"sm",py:4,label:n(a?"stylePresets.noMatchingTemplates":"stylePresets.noTemplates"),icon:null})})]})},mae=()=>{const e=E(),t=w(gb),{t:n}=S(),s=l.useCallback(c=>{e(Xy(c))},[e]),r=l.useCallback(()=>{e(Xy(""))},[e]),a=l.useCallback(c=>{c.key==="Escape"&&r()},[r]),i=l.useCallback(c=>{s(c.target.value)},[s]);return o.jsxs(Ur,{children:[o.jsx(Vt,{placeholder:n("stylePresets.searchByName"),value:t,onKeyDown:a,onChange:i}),t&&t.length&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(Q,{onClick:r,size:"sm",variant:"link","aria-label":n("boards.clearSearch"),icon:o.jsx(sn,{})})})]})},gae=l.memo(mae),LR=()=>{const e=w(gb),t=w(jj),{data:n}=du(void 0,{selectFromResult:({data:r})=>({data:((r==null?void 0:r.filter(c=>c.name.toLowerCase().includes(e.toLowerCase())))||Ss).reduce((c,d)=>(d.type==="default"?c.defaultPresets.push(d):d.type==="project"?c.sharedPresets.push(d):c.presets.push(d),c),{defaultPresets:[],sharedPresets:[],presets:[]})})}),{t:s}=S();return o.jsxs(j,{flexDir:"column",gap:2,padding:3,layerStyle:"second",borderRadius:"base",children:[o.jsxs(j,{alignItems:"center",gap:2,w:"full",justifyContent:"space-between",children:[o.jsx(gae,{}),o.jsx(uae,{}),o.jsx(cae,{}),o.jsx(iae,{})]}),o.jsx(ag,{title:s("stylePresets.myTemplates"),data:n.presets}),t&&o.jsx(ag,{title:s("stylePresets.sharedTemplates"),data:n.sharedPresets}),o.jsx(ag,{title:s("stylePresets.defaultTemplates"),data:n.defaultPresets})]})},xae=()=>{const e=w(db),t=w(Bd),{activeStylePreset:n}=du(void 0,{selectFromResult:({data:h})=>{let p=null;return h&&(p=h.find(f=>f.id===t)),{activeStylePreset:p}}}),s=E(),{t:r}=S(),{presetModifiedPositivePrompt:a,presetModifiedNegativePrompt:i}=cF(),c=l.useCallback(h=>{h.stopPropagation(),s(Sh(!1)),s(bd(null))},[s]),d=l.useCallback(h=>{h.stopPropagation(),s(mx(a)),s(gx(i)),s(Sh(!1)),s(bd(null))},[s,a,i]),u=l.useCallback(h=>{h.stopPropagation(),s(Sh(!e))},[s,e]);return n?o.jsxs(j,{w:"full",alignItems:"center",gap:2,minW:0,children:[o.jsx(ER,{imageWidth:25,presetImageUrl:n.image}),o.jsx(Rn,{colorScheme:"invokeBlue",variant:"subtle",justifySelf:"flex-start",children:n.name}),o.jsx(dt,{}),o.jsx(Ae,{label:r("stylePresets.toggleViewMode"),children:o.jsx(Q,{onClick:u,variant:"outline",size:"sm","aria-label":r("stylePresets.toggleViewMode"),colorScheme:e?"invokeBlue":"base",icon:o.jsx(yu,{})})}),o.jsx(Ae,{label:r("stylePresets.flatten"),children:o.jsx(Q,{onClick:d,variant:"outline",size:"sm","aria-label":r("stylePresets.flatten"),icon:o.jsx(mG,{})})}),o.jsx(Ae,{label:r("stylePresets.clearTemplateSelection"),children:o.jsx(Q,{onClick:c,variant:"outline",size:"sm","aria-label":r("stylePresets.clearTemplateSelection"),icon:o.jsx(sn,{})})})]}):o.jsx(j,{h:25,alignItems:"center",children:o.jsx(O,{fontSize:"sm",fontWeight:"semibold",color:"base.300",children:r("stylePresets.choosePromptTemplate")})})},bae={bg:"base.750"},TR=()=>{const e=se(Wl),{t}=S(),n=l.useCallback(()=>{Wl.set(!e)},[e]);return o.jsxs(j,{onClick:n,backgroundColor:"base.800",justifyContent:"space-between",alignItems:"center",py:2,px:3,borderRadius:"base",gap:2,role:"button",_hover:bae,transitionProperty:"background-color",transitionDuration:"normal",w:"full",children:[o.jsx(xae,{}),o.jsx(Q,{"aria-label":t("stylePresets.viewList"),variant:"ghost",icon:o.jsx(Fo,{}),size:"sm"})]})},JC={height:"100%",width:"100%"},yae=()=>{const e=w(dF),t=se(Wl);return o.jsxs(j,{w:"full",h:"full",flexDir:"column",gap:2,children:[o.jsx(TR,{}),o.jsx(j,{w:"full",h:"full",position:"relative",children:o.jsxs(xe,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[t&&o.jsx(Vr,{defer:!0,style:JC,options:zr.options,children:o.jsx(j,{gap:2,flexDirection:"column",h:"full",w:"full",children:o.jsx(LR,{})})}),o.jsx(Vr,{defer:!0,style:JC,options:zr.options,children:o.jsxs(j,{gap:2,flexDirection:"column",h:"full",w:"full",children:[o.jsx(W1,{}),o.jsx(IR,{}),o.jsx(Q1,{}),o.jsx(hR,{}),e&&o.jsx(_R,{}),o.jsx(q1,{})]})})]})})]})},vae=l.memo(yae),PR=l.memo(e=>o.jsx(j,{ps:2,pb:4,position:"sticky",zIndex:1,top:0,bg:"base.800",sx:e.sx,children:o.jsx(Ct,{size:"sm",children:e.title})}));PR.displayName="StickyScrollableHeading";const RR=l.memo(e=>o.jsx(j,{p:4,borderRadius:"base",bg:"base.750",flexDir:"column",gap:4,sx:e.sx,children:e.children}));RR.displayName="StickyScrollableContent";const _r=l.memo(e=>o.jsxs(j,{flexDir:"column",children:[o.jsx(PR,{title:e.title,sx:e.headingSx}),o.jsx(RR,{sx:e.contentSx,children:e.children})]},e.title));_r.displayName="StickyScrollable";const Cae={diffusers:"diffusers",lycoris:"lycoris",checkpoint:"checkpoint",invokeai:"internal",embedding_file:"embedding",embedding_folder:"embedding",t5_encoder:"t5_encoder",bnb_quantized_int8b:"bnb_quantized_int8b",bnb_quantized_nf4b:"quantized",gguf_quantized:"gguf"},wae={diffusers:"base",lycoris:"base",checkpoint:"orange",invokeai:"base",embedding_file:"base",embedding_folder:"base",t5_encoder:"base",bnb_quantized_int8b:"base",bnb_quantized_nf4b:"base",gguf_quantized:"base"},jae=({format:e})=>o.jsx(Rn,{flexGrow:0,colorScheme:wae[e],variant:"subtle",children:Cae[e]}),Sae=l.memo(jae),Mr="40px",kae="24px",Iae=({image_url:e})=>e?o.jsx(nn,{src:e,objectFit:"cover",objectPosition:"50% 50%",height:Mr,width:Mr,minHeight:Mr,minWidth:Mr,borderRadius:"base"}):o.jsx(j,{height:Mr,minWidth:Mr,bg:"base.650",borderRadius:"base",alignItems:"center",justifyContent:"center",children:o.jsx(it,{color:"base.500",as:t_,boxSize:kae})}),_ae=Nc(Iae),Mae={_hover:{bg:"base.700"},"&[aria-selected='true']":{bg:"base.700"}},Aae=({model:e})=>{const{t}=S(),n=E(),s=l.useMemo(()=>pe(uF,f=>f.selectedModelKey===e.key),[e.key]),r=w(s),[a]=hF(),{isOpen:i,onOpen:c,onClose:d}=Is(),u=l.useCallback(()=>{n(Ug(e.key))},[e.key,n]),h=l.useCallback(f=>{f.stopPropagation(),c()},[c]),p=l.useCallback(()=>{a({key:e.key}).unwrap().then(f=>{he({id:"MODEL_DELETED",title:`${t("modelManager.modelDeleted")}: ${e.name}`,status:"success"})}).catch(f=>{f&&he({id:"MODEL_DELETE_FAILED",title:`${t("modelManager.modelDeleteFailed")}: ${e.name}`,status:"error"})}),n(Ug(null))},[a,e,n,t]);return o.jsxs(j,{sx:Mae,"aria-selected":r,justifyContent:"flex-start",p:2,borderRadius:"base",w:"full",alignItems:"center",gap:2,cursor:"pointer",onClick:u,children:[o.jsxs(j,{gap:2,w:"full",h:"full",minW:0,children:[o.jsx(_ae,{image_url:e.cover_image}),o.jsxs(j,{gap:1,alignItems:"flex-start",flexDir:"column",w:"full",minW:0,children:[o.jsxs(j,{gap:2,w:"full",alignItems:"flex-start",children:[o.jsx(O,{fontWeight:"semibold",noOfLines:1,wordBreak:"break-all",children:e.name}),o.jsx(dt,{})]}),o.jsx(O,{variant:"subtext",noOfLines:1,children:e.description||"No Description"})]}),o.jsxs(j,{h:Mr,flexDir:"column",alignItems:"flex-end",justifyContent:"space-between",gap:2,children:[o.jsx(mM,{base:e.base}),o.jsx(Sae,{format:e.format})]})]}),o.jsx(Q,{onClick:h,icon:o.jsx(Hs,{size:16}),"aria-label":t("modelManager.deleteConfig"),colorScheme:"error",h:Mr,w:Mr}),o.jsx(No,{isOpen:i,onClose:d,title:t("modelManager.deleteModel"),acceptCallback:p,acceptButtonText:t("modelManager.delete"),useInert:!1,children:o.jsxs(j,{rowGap:4,flexDirection:"column",children:[o.jsx(O,{fontWeight:"bold",children:t("modelManager.deleteMsg1")}),o.jsx(O,{children:t("modelManager.deleteMsg2")})]})})]})},Eae=l.memo(Aae),Es=l.memo(e=>{const{title:t,modelList:n}=e;return o.jsx(_r,{title:t,contentSx:{gap:1,p:2},children:n.map(s=>o.jsx(Eae,{model:s},s.key))})});Es.displayName="ModelListWrapper";const Lae=()=>{const e=w(KS),t=w(QS),{t:n}=S(),[s,{isLoading:r}]=vf(),a=l.useMemo(()=>Js(s,t,e),[s,t,e]),[i,{isLoading:c}]=Cf(),d=l.useMemo(()=>Js(i,t,e),[i,t,e]),[u,{isLoading:h}]=wf(),p=l.useMemo(()=>Js(u,t,e),[u,t,e]),[f,{isLoading:m}]=GM(),g=l.useMemo(()=>Js(f,t,e),[f,t,e]),[x,{isLoading:C}]=a1(),y=l.useMemo(()=>Js(x,t,e),[x,t,e]),[v,{isLoading:I}]=WM(),k=l.useMemo(()=>Js(v,t,e),[v,t,e]),[M,{isLoading:_}]=c1(),A=l.useMemo(()=>Js(M,t,e),[M,t,e]),[D,{isLoading:N}]=RZ(),P=l.useMemo(()=>Js(D,t,e),[D,t,e]),[z,{isLoading:W}]=jf(),X=l.useMemo(()=>Js(z,t,e),[z,t,e]),[ee,{isLoading:G}]=i1(),re=l.useMemo(()=>Js(ee,t,e),[ee,t,e]),[le,{isLoading:Ce}]=l1(),be=l.useMemo(()=>Js(le,t,e),[le,t,e]),[ye,{isLoading:ne}]=_u(),R=l.useMemo(()=>Js(ye,t,e),[ye,t,e]),F=l.useMemo(()=>a.length+d.length+p.length+g.length+y.length+k.length+A.length+P.length+X.length+R.length+ee.length+le.length,[y.length,g.length,A.length,P.length,p.length,a.length,d.length,k.length,X.length,R.length,ee.length,le.length]);return o.jsx(Nn,{children:o.jsxs(j,{flexDirection:"column",w:"full",h:"full",gap:4,children:[r&&o.jsx(fs,{loadingMessage:"Loading Main Models..."}),!r&&a.length>0&&o.jsx(Es,{title:n("modelManager.main"),modelList:a},"main"),c&&o.jsx(fs,{loadingMessage:"Loading Refiner Models..."}),!c&&d.length>0&&o.jsx(Es,{title:n("sdxl.refiner"),modelList:d},"refiner"),h&&o.jsx(fs,{loadingMessage:"Loading LoRAs..."}),!h&&p.length>0&&o.jsx(Es,{title:n("modelManager.loraModels"),modelList:p},"loras"),m&&o.jsx(fs,{loadingMessage:"Loading Textual Inversions..."}),!m&&g.length>0&&o.jsx(Es,{title:n("modelManager.textualInversions"),modelList:g},"textual-inversions"),W&&o.jsx(fs,{loadingMessage:"Loading VAEs..."}),!W&&X.length>0&&o.jsx(Es,{title:"VAE",modelList:X},"vae"),C&&o.jsx(fs,{loadingMessage:"Loading ControlNets..."}),!C&&y.length>0&&o.jsx(Es,{title:"ControlNet",modelList:y},"controlnets"),_&&o.jsx(fs,{loadingMessage:"Loading IP Adapters..."}),!_&&A.length>0&&o.jsx(Es,{title:n("common.ipAdapter"),modelList:A},"ip-adapters"),N&&o.jsx(fs,{loadingMessage:"Loading CLIP Vision Models..."}),!N&&P.length>0&&o.jsx(Es,{title:"CLIP Vision",modelList:P},"clip-vision"),I&&o.jsx(fs,{loadingMessage:"Loading T2I Adapters..."}),!I&&k.length>0&&o.jsx(Es,{title:n("common.t2iAdapter"),modelList:k},"t2i-adapters"),G&&o.jsx(fs,{loadingMessage:"Loading T5 Encoder Models..."}),!G&&re.length>0&&o.jsx(Es,{title:n("modelManager.t5Encoder"),modelList:re},"t5-encoder"),Ce&&o.jsx(fs,{loadingMessage:"Loading Clip Embed Models..."}),!Ce&&be.length>0&&o.jsx(Es,{title:n("modelManager.clipEmbed"),modelList:be},"clip-embed"),ne&&o.jsx(fs,{loadingMessage:"Loading Image-to-Image Models..."}),!ne&&R.length>0&&o.jsx(Es,{title:n("modelManager.spandrelImageToImage"),modelList:R},"spandrel-image-to-image"),F===0&&o.jsx(j,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:o.jsx(O,{children:n("modelManager.noMatchingModels")})})]})})},Tae=l.memo(Lae),Js=(e,t,n)=>e.filter(s=>{const r=s.name.toLowerCase().includes(t.toLowerCase()),a=Pae(s,n);return r&&a}),Pae=(e,t)=>t==="refiner"?e.base==="sdxl-refiner":t==="main"&&e.base==="sdxl-refiner"?!1:t?e.type===t:!0,DR=l.memo(()=>{const{t:e}=S(),t=E(),n=l.useMemo(()=>({main:e("modelManager.main"),refiner:e("sdxl.refiner"),lora:"LoRA",embedding:e("modelManager.textualInversions"),controlnet:"ControlNet",vae:"VAE",t2i_adapter:e("common.t2iAdapter"),t5_encoder:e("modelManager.t5Encoder"),clip_embed:e("modelManager.clipEmbed"),ip_adapter:e("common.ipAdapter"),clip_vision:"CLIP Vision",spandrel_image_to_image:e("modelManager.spandrelImageToImage")}),[e]),s=w(KS),r=l.useCallback(i=>{t(ev(i))},[t]),a=l.useCallback(()=>{t(ev(null))},[t]);return o.jsxs(Ta,{children:[o.jsx(Pa,{as:me,size:"sm",leftIcon:o.jsx(KW,{}),children:s?n[s]:e("modelManager.allModels")}),o.jsxs(Un,{children:[o.jsx(_e,{onClick:a,children:e("modelManager.allModels")}),jb(n).map(i=>o.jsx(_e,{bg:s===i?"base.700":"transparent",onClick:r.bind(null,i),children:n[i]},i))]})]})});DR.displayName="ModelTypeFilter";const OR=l.memo(()=>{const e=E(),t=w(QS),n=l.useCallback(r=>{e(tv(r.target.value))},[e]),s=l.useCallback(()=>{e(tv(""))},[e]);return o.jsxs(j,{gap:2,alignItems:"center",justifyContent:"space-between",children:[o.jsx(DR,{}),o.jsx(dt,{}),o.jsxs(Ur,{maxW:"400px",children:[o.jsx(Vt,{placeholder:ve("modelManager.search"),value:t||"","data-testid":"board-search-input",onChange:n}),!!(t!=null&&t.length)&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(Q,{size:"sm",variant:"link","aria-label":ve("boards.clearSearch"),icon:o.jsx(sn,{}),onClick:s})})]})]})});OR.displayName="ModelListNavigation";const NR=l.memo(()=>{const{t:e}=S(),t=E(),n=l.useCallback(()=>{t(Ug(null))},[t]),s=w(pu);return o.jsxs(j,{flexDir:"column",layerStyle:"first",p:4,gap:4,borderRadius:"base",w:"50%",h:"full",children:[o.jsxs(j,{w:"full",gap:4,justifyContent:"space-between",alignItems:"center",children:[o.jsx(Ct,{fontSize:"xl",py:1,children:e("common.modelManager")}),!!s&&o.jsx(me,{size:"sm",colorScheme:"invokeYellow",leftIcon:o.jsx(Bt,{}),onClick:n,children:e("modelManager.addModels")})]}),o.jsxs(j,{flexDir:"column",layerStyle:"second",p:4,gap:4,borderRadius:"base",w:"full",h:"full",children:[o.jsx(OR,{}),o.jsx(Tae,{})]})]})});NR.displayName="ModelManager";const Rae=({model_key:e,model_image:t})=>{const[n,s]=l.useState(t||null),{t:r}=S(),[a]=pF(),[i]=fF(),c=l.useCallback(p=>{const f=p[0];!f||!e||a({key:e,image:f}).unwrap().then(()=>{s(URL.createObjectURL(f)),he({id:"MODEL_IMAGE_UPDATED",title:r("modelManager.modelImageUpdated"),status:"success"})}).catch(()=>{he({id:"MODEL_IMAGE_UPDATE_FAILED",title:r("modelManager.modelImageUpdateFailed"),status:"error"})})},[e,r,a]),d=l.useCallback(()=>{e&&(s(null),i(e).unwrap().then(()=>{he({id:"MODEL_IMAGE_DELETED",title:r("modelManager.modelImageDeleted"),status:"success"})}).catch(()=>{he({id:"MODEL_IMAGE_DELETE_FAILED",title:r("modelManager.modelImageDeleteFailed"),status:"error"})}))},[e,r,i]),{getInputProps:u,getRootProps:h}=Na({accept:{"image/png":[".png"],"image/jpeg":[".jpg",".jpeg",".png"]},onDropAccepted:c,noDrag:!0,multiple:!1});return n?o.jsxs(xe,{position:"relative",flexShrink:0,children:[o.jsx(nn,{src:n,objectFit:"cover",objectPosition:"50% 50%",height:108,width:108,minWidth:108,borderRadius:"base"}),o.jsx(Q,{position:"absolute",insetInlineEnd:0,insetBlockStart:0,onClick:d,"aria-label":r("modelManager.deleteModelImage"),tooltip:r("modelManager.deleteModelImage"),icon:o.jsx(Kr,{}),size:"md",variant:"ghost"})]}):o.jsxs(o.Fragment,{children:[o.jsx(Ae,{label:r("modelManager.uploadImage"),children:o.jsx(j,{as:me,w:108,h:108,opacity:.3,borderRadius:"base",alignItems:"center",justifyContent:"center",flexShrink:0,...h(),children:o.jsx(it,{as:gc,w:16,h:16})})}),o.jsx("input",{...u()})]})},Dae=Nc(Rae),Y1=l.memo(({modelConfig:e,children:t})=>{const{t:n}=S();return o.jsxs(j,{alignItems:"flex-start",gap:4,children:[o.jsx(Dae,{model_key:e.key,model_image:e.cover_image}),o.jsxs(j,{flexDir:"column",gap:1,flexGrow:1,minW:0,children:[o.jsxs(j,{gap:2,children:[o.jsx(Ct,{as:"h2",fontSize:"lg",noOfLines:1,wordBreak:"break-all",children:e.name}),o.jsx(dt,{}),t]}),e.source&&o.jsxs(O,{variant:"subtext",noOfLines:1,wordBreak:"break-all",children:[n("modelManager.source"),": ",e.source]}),o.jsx(O,{noOfLines:3,children:e.description})]})]})});Y1.displayName="ModelHeader";const XC=[{value:"sd-1",label:Yu["sd-1"]},{value:"sd-2",label:Yu["sd-2"]},{value:"sdxl",label:Yu.sdxl},{value:"sdxl-refiner",label:Yu["sdxl-refiner"]}],Oae=({control:e})=>{const{field:t}=Bn({control:e,name:"base"}),n=l.useMemo(()=>XC.find(r=>r.value===t.value),[t.value]),s=l.useCallback(r=>{t.onChange(r==null?void 0:r.value)},[t]);return o.jsx(Ne,{value:n,options:XC,onChange:s})},Nae=Nc(Oae),e2=[{value:"normal",label:"Normal"},{value:"inpaint",label:"Inpaint"},{value:"depth",label:"Depth"}],Bae=({control:e})=>{const{field:t}=Bn({control:e,name:"variant"}),n=l.useMemo(()=>e2.find(r=>r.value===t.value),[t.value]),s=l.useCallback(r=>{t.onChange(r==null?void 0:r.value)},[t]);return o.jsx(Ne,{value:n,options:e2,onChange:s})},$ae=Nc(Bae),t2=[{value:"none",label:"-"},{value:"epsilon",label:"epsilon"},{value:"v_prediction",label:"v_prediction"},{value:"sample",label:"sample"}],Fae=({control:e})=>{const{field:t}=Bn({control:e,name:"prediction_type"}),n=l.useMemo(()=>t2.find(r=>r.value===t.value),[t.value]),s=l.useCallback(r=>{(r==null?void 0:r.value)==="none"?t.onChange(void 0):t.onChange(r==null?void 0:r.value)},[t]);return o.jsx(Ne,{value:n,options:t2,onChange:s})},zae=Nc(Fae),n2={validate:e=>e&&e.trim().length>3||"Must be at least 3 characters"},BR=l.memo(({modelConfig:e})=>{var d,u;const{t}=S(),[n,{isLoading:s}]=Xp(),r=E(),a=Iu({defaultValues:e,mode:"onChange"}),i=l.useCallback(h=>{const p={key:e.key,body:h};n(p).unwrap().then(f=>{a.reset(f,{keepDefaultValues:!0}),r(Zg("view")),he({id:"MODEL_UPDATED",title:t("modelManager.modelUpdated"),status:"success"})}).catch(f=>{a.reset(),he({id:"MODEL_UPDATE_FAILED",title:t("modelManager.modelUpdateFailed"),status:"error"})})},[r,e.key,a,t,n]),c=l.useCallback(()=>{r(Zg("view"))},[r]);return o.jsxs(j,{flexDir:"column",gap:4,children:[o.jsxs(Y1,{modelConfig:e,children:[o.jsx(me,{flexShrink:0,size:"sm",onClick:c,leftIcon:o.jsx(sn,{}),children:t("common.cancel")}),o.jsx(me,{flexShrink:0,size:"sm",colorScheme:"invokeYellow",leftIcon:o.jsx(Ei,{}),onClick:a.handleSubmit(i),isLoading:s,isDisabled:!!Object.keys(a.formState.errors).length,children:t("common.save")})]}),o.jsx(j,{flexDir:"column",h:"full",children:o.jsxs("form",{children:[o.jsx(j,{w:"full",justifyContent:"space-between",gap:4,alignItems:"center",children:o.jsxs(V,{flexDir:"column",alignItems:"flex-start",gap:1,isInvalid:!!a.formState.errors.name,children:[o.jsx(U,{children:t("modelManager.modelName")}),o.jsx(Vt,{...a.register("name",n2),size:"md"}),((d=a.formState.errors.name)==null?void 0:d.message)&&o.jsx(Fp,{children:(u=a.formState.errors.name)==null?void 0:u.message})]})}),o.jsxs(j,{flexDir:"column",gap:3,mt:"4",children:[o.jsx(j,{gap:"4",alignItems:"center",children:o.jsxs(V,{flexDir:"column",alignItems:"flex-start",gap:1,children:[o.jsx(U,{children:t("modelManager.description")}),o.jsx(ls,{...a.register("description"),minH:32})]})}),e.type!=="clip_vision"&&o.jsx(Ct,{as:"h3",fontSize:"md",mt:"4",children:t("modelManager.modelSettings")}),o.jsxs(ef,{columns:2,gap:4,children:[e.type!=="clip_vision"&&o.jsxs(V,{flexDir:"column",alignItems:"flex-start",gap:1,children:[o.jsx(U,{children:t("modelManager.baseModel")}),o.jsx(Nae,{control:a.control})]}),e.type==="main"&&o.jsxs(V,{flexDir:"column",alignItems:"flex-start",gap:1,children:[o.jsx(U,{children:t("modelManager.variant")}),o.jsx($ae,{control:a.control})]}),e.type==="main"&&e.format==="checkpoint"&&o.jsxs(o.Fragment,{children:[o.jsxs(V,{flexDir:"column",alignItems:"flex-start",gap:1,children:[o.jsx(U,{children:t("modelManager.pathToConfig")}),o.jsx(Vt,{...a.register("config_path",n2)})]}),o.jsxs(V,{flexDir:"column",alignItems:"flex-start",gap:1,children:[o.jsx(U,{children:t("modelManager.predictionType")}),o.jsx(zae,{control:a.control})]}),o.jsxs(V,{flexDir:"column",alignItems:"flex-start",gap:1,children:[o.jsx(U,{children:t("modelManager.upcastAttention")}),o.jsx(kn,{...a.register("upcast_attention")})]})]})]})]})]})})]})});BR.displayName="ModelEdit";const Vae=e=>l.useMemo(()=>{var n,s;return{preprocessor:{isEnabled:!Ut((n=e==null?void 0:e.default_settings)==null?void 0:n.preprocessor),value:((s=e==null?void 0:e.default_settings)==null?void 0:s.preprocessor)||"none"}}},[e==null?void 0:e.default_settings]),zo=Gp(e=>{const{field:t}=Bn(e),n=l.useMemo(()=>!!t.value.isEnabled,[t.value]),s=l.useCallback(r=>{const a={...t.value,isEnabled:r.target.checked};t.onChange(a)},[t]);return o.jsx(ot,{size:"sm",isChecked:n,onChange:s})});zo.displayName="SettingToggle";const s2=[{label:"Canny",value:"canny_image_processor"},{label:"MLSD",value:"mlsd_image_processor"},{label:"Depth Anything",value:"depth_anything_image_processor"},{label:"Normal BAE",value:"normalbae_image_processor"},{label:"Pidi",value:"pidi_image_processor"},{label:"Lineart",value:"lineart_image_processor"},{label:"Lineart Anime",value:"lineart_anime_image_processor"},{label:"HED",value:"hed_image_processor"},{label:"Content Shuffle",value:"content_shuffle_image_processor"},{label:"DW OpenPose",value:"dw_openpose_image_processor"},{label:"MediaPipe Face",value:"mediapipe_face_processor"},{label:"ZoeDepth",value:"zoe_depth_image_processor"},{label:"Color Map",value:"color_map_image_processor"},{label:"None",value:"none"}],$R=l.memo(e=>{const{t}=S(),{field:n}=Bn(e),s=l.useCallback(i=>{if(!i)return;const c={...n.value,value:i.value};n.onChange(c)},[n]),r=l.useMemo(()=>s2.find(i=>i.value===n.value.value),[n]),a=l.useMemo(()=>!n.value.isEnabled,[n.value]);return o.jsxs(V,{flexDir:"column",gap:2,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"controlNetProcessor",children:o.jsx(U,{children:t("controlLayers.filter.filter")})}),o.jsx(zo,{control:e.control,name:"preprocessor"})]}),o.jsx(Ne,{isDisabled:a,value:r,options:s2,onChange:s})]})});$R.displayName="DefaultPreprocessor";const FR=l.memo(({modelConfig:e})=>{const{t}=S(),n=Vae(e),[s,{isLoading:r}]=Xp(),{handleSubmit:a,control:i,formState:c,reset:d}=Iu({defaultValues:n}),u=l.useCallback(h=>{const p={preprocessor:h.preprocessor.isEnabled?h.preprocessor.value:null};s({key:e.key,body:{default_settings:p}}).unwrap().then(f=>{he({id:"DEFAULT_SETTINGS_SAVED",title:t("modelManager.defaultSettingsSaved"),status:"success"}),d(h)}).catch(f=>{f&&he({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${f.data.detail} `,status:"error"})})},[s,e.key,t,d]);return o.jsxs(o.Fragment,{children:[o.jsxs(j,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[o.jsx(Ct,{fontSize:"md",children:t("modelManager.defaultSettings")}),o.jsx(me,{size:"sm",leftIcon:o.jsx(Ei,{}),colorScheme:"invokeYellow",isDisabled:!c.isDirty,onClick:a(u),isLoading:r,children:t("common.save")})]}),o.jsx(ef,{columns:2,gap:8,children:o.jsx($R,{control:i,name:"preprocessor"})})]})});FR.displayName="ControlNetOrT2IAdapterDefaultSettings";const zR=l.memo(({modelConfig:e})=>{const{t}=S(),[n,{isLoading:s}]=mF(),{isOpen:r,onOpen:a,onClose:i}=Is(),c=l.useCallback(()=>{if(!e||s)return;const d=`CONVERTING_MODEL_${e.key}`;he({id:d,title:`${t("modelManager.convertingModelBegin")}: ${e.name}`,status:"info"}),n(e.key).unwrap().then(()=>{he({id:d,title:`${t("modelManager.modelConverted")}: ${e.name}`,status:"success"})}).catch(()=>{he({id:d,title:`${t("modelManager.modelConversionFailed")}: ${e.name}`,status:"error"})})},[e,s,t,n]);return o.jsxs(o.Fragment,{children:[o.jsxs(me,{onClick:a,size:"sm","aria-label":t("modelManager.convertToDiffusers"),className:" modal-close-btn",isLoading:s,flexShrink:0,children:[" ",t("modelManager.convert")]}),o.jsx(No,{title:`${t("modelManager.convert")} ${e.name}`,acceptCallback:c,acceptButtonText:`${t("modelManager.convert")}`,isOpen:r,onClose:i,useInert:!1,children:o.jsxs(j,{flexDirection:"column",rowGap:4,children:[o.jsx(O,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText1")}),o.jsxs(Si,{children:[o.jsx(Qt,{children:o.jsx(O,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText2")})}),o.jsx(Qt,{children:o.jsx(O,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText3")})}),o.jsx(Qt,{children:o.jsx(O,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText4")})}),o.jsx(Qt,{children:o.jsx(O,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText5")})})]}),o.jsx(zt,{}),o.jsx(O,{fontSize:"md",children:t("modelManager.convertToDiffusersHelpText6")})]})})]})});zR.displayName="ModelConvertButton";const VR=l.memo(()=>{const{t:e}=S(),t=E(),n=l.useCallback(()=>{t(Zg("edit"))},[t]);return o.jsx(me,{size:"sm",leftIcon:o.jsx(Cu,{}),colorScheme:"invokeYellow",onClick:n,flexShrink:0,children:e("modelManager.edit")})});VR.displayName="ModelEditButton";const HR=l.memo(({modelConfig:e})=>{const{t}=S(),[n,s]=l.useState(""),[r,{isLoading:a}]=Xp(),i=l.useCallback(f=>{s(f.target.value)},[]),c=l.useMemo(()=>(e==null?void 0:e.trigger_phrases)||[],[e]),d=l.useMemo(()=>{const f=[];return n.length&&c.includes(n)&&f.push("Phrase is already in list"),f},[n,c]),u=l.useCallback(async()=>{!n.length||c.includes(n)||(s(""),await r({key:e.key,body:{trigger_phrases:[...c,n]}}).unwrap())},[n,c,r,e.key]),h=l.useCallback(async f=>{const m=c.filter(g=>g!==f);await r({key:e.key,body:{trigger_phrases:m}}).unwrap()},[c,r,e]),p=l.useCallback(f=>{f.preventDefault(),u()},[u]);return o.jsxs(j,{flexDir:"column",w:"full",gap:"5",children:[o.jsx("form",{onSubmit:p,children:o.jsxs(V,{w:"full",isInvalid:!!d.length,orientation:"vertical",children:[o.jsx(U,{children:t("modelManager.triggerPhrases")}),o.jsxs(j,{flexDir:"column",w:"full",children:[o.jsxs(j,{gap:"3",alignItems:"center",w:"full",children:[o.jsx(Vt,{value:n,onChange:i,placeholder:t("modelManager.typePhraseHere")}),o.jsx(me,{leftIcon:o.jsx(Bt,{}),size:"sm",onClick:u,isDisabled:!n||!!d.length,isLoading:a,children:t("common.add")})]}),d.map(f=>o.jsx(Fp,{children:f},f))]})]})}),o.jsx(j,{gap:"4",flexWrap:"wrap",children:c.map((f,m)=>o.jsxs(eb,{size:"md",py:2,px:4,bg:"base.700",children:[o.jsx(bS,{children:f}),o.jsx(tb,{onClick:h.bind(null,f),isDisabled:a})]},m))})]})});HR.displayName="TriggerPhrases";const Hae=pt(Gs,e=>{const{steps:t,guidance:n,scheduler:s,cfgRescaleMultiplier:r,vaePrecision:a,width:i,height:c}=e.sd,{guidance:d}=e.flux;return{initialSteps:t.initial,initialCfg:n.initial,initialScheduler:s,initialCfgRescaleMultiplier:r.initial,initialVaePrecision:a,initialWidth:i.initial,initialHeight:c.initial,initialGuidance:d.initial}}),Wae=e=>{const{initialSteps:t,initialCfg:n,initialScheduler:s,initialCfgRescaleMultiplier:r,initialVaePrecision:a,initialWidth:i,initialHeight:c,initialGuidance:d}=w(Hae);return l.useMemo(()=>{var h,p,f,m,g,x,C,y,v,I,k,M,_,A,D,N,P,z;return{vae:{isEnabled:!Ut((h=e==null?void 0:e.default_settings)==null?void 0:h.vae),value:((p=e==null?void 0:e.default_settings)==null?void 0:p.vae)||"default"},vaePrecision:{isEnabled:!Ut((f=e==null?void 0:e.default_settings)==null?void 0:f.vae_precision),value:((m=e==null?void 0:e.default_settings)==null?void 0:m.vae_precision)||a||"fp32"},scheduler:{isEnabled:!Ut((g=e==null?void 0:e.default_settings)==null?void 0:g.scheduler),value:((x=e==null?void 0:e.default_settings)==null?void 0:x.scheduler)||s||"dpmpp_3m_k"},steps:{isEnabled:!Ut((C=e==null?void 0:e.default_settings)==null?void 0:C.steps),value:((y=e==null?void 0:e.default_settings)==null?void 0:y.steps)||t},cfgScale:{isEnabled:!Ut((v=e==null?void 0:e.default_settings)==null?void 0:v.cfg_scale),value:((I=e==null?void 0:e.default_settings)==null?void 0:I.cfg_scale)||n},cfgRescaleMultiplier:{isEnabled:!Ut((k=e==null?void 0:e.default_settings)==null?void 0:k.cfg_rescale_multiplier),value:((M=e==null?void 0:e.default_settings)==null?void 0:M.cfg_rescale_multiplier)||r},width:{isEnabled:!Ut((_=e==null?void 0:e.default_settings)==null?void 0:_.width),value:((A=e==null?void 0:e.default_settings)==null?void 0:A.width)||i},height:{isEnabled:!Ut((D=e==null?void 0:e.default_settings)==null?void 0:D.height),value:((N=e==null?void 0:e.default_settings)==null?void 0:N.height)||c},guidance:{isEnabled:!Ut((P=e==null?void 0:e.default_settings)==null?void 0:P.guidance),value:((z=e==null?void 0:e.default_settings)==null?void 0:z.guidance)||d}}},[e,a,s,t,n,r,i,c,d])},WR=l.memo(({control:e,optimalDimension:t})=>{const{field:n}=Bn({control:e,name:"height"}),s=w(US),{t:r}=S(),a=l.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),i=l.useCallback(u=>{const h={...n.value,value:u};n.onChange(h)},[n]),c=l.useMemo(()=>n.value.value,[n.value]),d=l.useMemo(()=>!n.value.isEnabled,[n.value]);return o.jsxs(V,{flexDir:"column",gap:2,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"paramHeight",children:o.jsx(U,{children:r("parameters.height")})}),o.jsx(zo,{control:e,name:"height"})]}),o.jsxs(j,{w:"full",gap:4,children:[o.jsx(qe,{value:c,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:i,marks:a,isDisabled:d}),o.jsx(Ve,{value:c,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:i,isDisabled:d})]})]})});WR.displayName="DefaultHeight";const GR=l.memo(({control:e,optimalDimension:t})=>{const{field:n}=Bn({control:e,name:"width"}),s=w(qS),{t:r}=S(),a=l.useMemo(()=>[s.sliderMin,t,s.sliderMax],[s.sliderMin,t,s.sliderMax]),i=l.useCallback(u=>{const h={...n.value,value:u};n.onChange(h)},[n]),c=l.useMemo(()=>n.value.value,[n.value]),d=l.useMemo(()=>!n.value.isEnabled,[n.value]);return o.jsxs(V,{flexDir:"column",gap:2,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"paramWidth",children:o.jsx(U,{children:r("parameters.width")})}),o.jsx(zo,{control:e,name:"width"})]}),o.jsxs(j,{w:"full",gap:4,children:[o.jsx(qe,{value:c,min:s.sliderMin,max:s.sliderMax,step:s.coarseStep,fineStep:s.fineStep,onChange:i,marks:a,isDisabled:d}),o.jsx(Ve,{value:c,min:s.numberInputMin,max:s.numberInputMax,step:s.coarseStep,fineStep:s.fineStep,onChange:i,isDisabled:d})]})]})});GR.displayName="DefaultWidth";const UR=l.memo(e=>{const{field:t}=Bn(e),n=w(BS),{t:s}=S(),r=l.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),a=l.useCallback(d=>{const u={...t.value,value:d};t.onChange(u)},[t]),i=l.useMemo(()=>t.value.value,[t.value]),c=l.useMemo(()=>!t.value.isEnabled,[t.value]);return o.jsxs(V,{flexDir:"column",gap:2,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"paramCFGRescaleMultiplier",children:o.jsx(U,{children:s("parameters.cfgRescaleMultiplier")})}),o.jsx(zo,{control:e.control,name:"cfgRescaleMultiplier"})]}),o.jsxs(j,{w:"full",gap:4,children:[o.jsx(qe,{value:i,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:a,marks:r,isDisabled:c}),o.jsx(Ve,{value:i,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:a,isDisabled:c})]})]})});UR.displayName="DefaultCfgRescaleMultiplier";const ZR=l.memo(e=>{const{field:t}=Bn(e),n=w(pb),{t:s}=S(),r=l.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),a=l.useCallback(d=>{const u={...t.value,value:d};t.onChange(u)},[t]),i=l.useMemo(()=>t.value.value,[t.value]),c=l.useMemo(()=>!t.value.isEnabled,[t.value]);return o.jsxs(V,{flexDir:"column",gap:2,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"paramCFGScale",children:o.jsx(U,{children:s("parameters.cfgScale")})}),o.jsx(zo,{control:e.control,name:"cfgScale"})]}),o.jsxs(j,{w:"full",gap:4,children:[o.jsx(qe,{value:i,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:a,marks:r,isDisabled:c}),o.jsx(Ve,{value:i,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:a,isDisabled:c})]})]})});ZR.displayName="DefaultCfgScale";const qR=l.memo(e=>{const{field:t}=Bn(e),n=w(HS),{t:s}=S(),r=l.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax-(n.sliderMax-n.sliderMin)/2),n.sliderMax],[n.sliderMax,n.sliderMin]),a=l.useCallback(d=>{const u={...t.value,value:d};t.onChange(u)},[t]),i=l.useMemo(()=>t.value.value,[t.value]),c=l.useMemo(()=>!t.value.isEnabled,[t.value]);return o.jsxs(V,{flexDir:"column",gap:2,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"paramGuidance",children:o.jsx(U,{children:s("parameters.guidance")})}),o.jsx(zo,{control:e.control,name:"guidance"})]}),o.jsxs(j,{w:"full",gap:4,children:[o.jsx(qe,{value:i,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:a,marks:r,isDisabled:c}),o.jsx(Ve,{value:i,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:a,isDisabled:c})]})]})});qR.displayName="DefaultGuidance";const KR=l.memo(e=>{const{t}=S(),{field:n}=Bn(e),s=l.useCallback(i=>{if(!Xl(i==null?void 0:i.value))return;const c={...n.value,value:i.value};n.onChange(c)},[n]),r=l.useMemo(()=>_a.find(i=>i.value===n.value.value),[n]),a=l.useMemo(()=>!n.value.isEnabled,[n.value]);return o.jsxs(V,{flexDir:"column",gap:2,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"paramScheduler",children:o.jsx(U,{children:t("parameters.scheduler")})}),o.jsx(zo,{control:e.control,name:"scheduler"})]}),o.jsx(Ne,{isDisabled:a,value:r,options:_a,onChange:s})]})});KR.displayName="DefaultScheduler";const QR=l.memo(e=>{const{field:t}=Bn(e),n=w(fb),{t:s}=S(),r=l.useMemo(()=>[n.sliderMin,Math.floor(n.sliderMax/2),n.sliderMax],[n.sliderMax,n.sliderMin]),a=l.useCallback(d=>{const u={...t.value,value:d};t.onChange(u)},[t]),i=l.useMemo(()=>t.value.value,[t.value]),c=l.useMemo(()=>!t.value.isEnabled,[t.value]);return o.jsxs(V,{flexDir:"column",gap:2,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"paramSteps",children:o.jsx(U,{children:s("parameters.steps")})}),o.jsx(zo,{control:e.control,name:"steps"})]}),o.jsxs(j,{w:"full",gap:4,children:[o.jsx(qe,{value:i,min:n.sliderMin,max:n.sliderMax,step:n.coarseStep,fineStep:n.fineStep,onChange:a,marks:r,isDisabled:c}),o.jsx(Ve,{value:i,min:n.numberInputMin,max:n.numberInputMax,step:n.coarseStep,fineStep:n.fineStep,onChange:a,isDisabled:c})]})]})});QR.displayName="DefaultSteps";const YR=l.memo(e=>{const{t}=S(),{field:n}=Bn(e),s=w(pu),{data:r}=ou(s??Kn),[a]=jf(),i=l.useMemo(()=>{const h=a.filter(f=>f.base===(r==null?void 0:r.base)).map(f=>({label:f.name,value:f.key}));return[{label:"Default VAE",value:"default"},...h]},[r==null?void 0:r.base,a]),c=l.useCallback(h=>{const p=h!=null&&h.value?h.value:"default",f={...n.value,value:p};n.onChange(f)},[n]),d=l.useMemo(()=>i.find(h=>h.value===n.value.value),[i,n.value]),u=l.useMemo(()=>!n.value.isEnabled,[n.value]);return o.jsxs(V,{flexDir:"column",gap:2,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"paramVAE",children:o.jsx(U,{children:t("modelManager.vae")})}),o.jsx(zo,{control:e.control,name:"vae"})]}),o.jsx(Ne,{isDisabled:u,value:d,options:i,onChange:c})]})});YR.displayName="DefaultVae";const o2=[{label:"FP16",value:"fp16"},{label:"FP32",value:"fp32"}],JR=l.memo(e=>{const{t}=S(),{field:n}=Bn(e),s=l.useCallback(i=>{if(!FS(i==null?void 0:i.value))return;const c={...n.value,value:i.value};n.onChange(c)},[n]),r=l.useMemo(()=>o2.find(i=>i.value===n.value.value),[n]),a=l.useMemo(()=>!n.value.isEnabled,[n.value]);return o.jsxs(V,{flexDir:"column",gap:1,alignItems:"flex-start",children:[o.jsxs(j,{justifyContent:"space-between",w:"full",children:[o.jsx(Be,{feature:"paramVAEPrecision",children:o.jsx(U,{children:t("modelManager.vaePrecision")})}),o.jsx(zo,{control:e.control,name:"vaePrecision"})]}),o.jsx(Ne,{isDisabled:a,value:r,options:o2,onChange:s})]})});JR.displayName="DefaultVaePrecision";const XR=l.memo(({modelConfig:e})=>{const t=w(pu),{t:n}=S(),s=l.useMemo(()=>e.base==="flux",[e]),r=Wae(e),a=l.useMemo(()=>{const m=e==null?void 0:e.base;return gF(m??null)},[e]),[i,{isLoading:c}]=Xp(),{handleSubmit:d,control:u,formState:h,reset:p}=Iu({defaultValues:r}),f=l.useCallback(m=>{if(!t)return;const g={vae:m.vae.isEnabled?m.vae.value:null,vae_precision:m.vaePrecision.isEnabled?m.vaePrecision.value:null,cfg_scale:m.cfgScale.isEnabled?m.cfgScale.value:null,cfg_rescale_multiplier:m.cfgRescaleMultiplier.isEnabled?m.cfgRescaleMultiplier.value:null,steps:m.steps.isEnabled?m.steps.value:null,scheduler:m.scheduler.isEnabled?m.scheduler.value:null,width:m.width.isEnabled?m.width.value:null,height:m.height.isEnabled?m.height.value:null,guidance:m.guidance.isEnabled?m.guidance.value:null};i({key:t,body:{default_settings:g}}).unwrap().then(x=>{he({id:"DEFAULT_SETTINGS_SAVED",title:n("modelManager.defaultSettingsSaved"),status:"success"}),p(m)}).catch(x=>{x&&he({id:"DEFAULT_SETTINGS_SAVE_FAILED",title:`${x.data.detail} `,status:"error"})})},[t,p,i,n]);return o.jsxs(o.Fragment,{children:[o.jsxs(j,{gap:"4",justifyContent:"space-between",w:"full",pb:4,children:[o.jsx(Ct,{fontSize:"md",children:n("modelManager.defaultSettings")}),o.jsx(me,{size:"sm",leftIcon:o.jsx(Ei,{}),colorScheme:"invokeYellow",isDisabled:!h.isDirty,onClick:d(f),isLoading:c,children:n("common.save")})]}),o.jsxs(ef,{columns:2,gap:8,children:[o.jsx(YR,{control:u,name:"vae"}),!s&&o.jsx(JR,{control:u,name:"vaePrecision"}),!s&&o.jsx(KR,{control:u,name:"scheduler"}),o.jsx(QR,{control:u,name:"steps"}),s&&o.jsx(qR,{control:u,name:"guidance"}),!s&&o.jsx(ZR,{control:u,name:"cfgScale"}),!s&&o.jsx(UR,{control:u,name:"cfgRescaleMultiplier"}),o.jsx(GR,{control:u,optimalDimension:a}),o.jsx(WR,{control:u,optimalDimension:a})]})]})});XR.displayName="MainModelDefaultSettings";const mo=l.memo(({label:e,value:t})=>o.jsxs(V,{flexDir:"column",alignItems:"flex-start",gap:0,children:[o.jsx(U,{children:e}),o.jsx(O,{fontSize:"md",noOfLines:1,wordBreak:"break-all",children:t||"-"})]}));mo.displayName="ModelAttrView";const e4=l.memo(({modelConfig:e})=>{const{t}=S(),n=l.useMemo(()=>e.type==="main"&&e.base!=="sdxl-refiner"||e.type==="controlnet"||e.type==="t2i_adapter"||e.type==="main"||e.type==="lora",[e.base,e.type]);return o.jsxs(j,{flexDir:"column",gap:4,children:[o.jsxs(Y1,{modelConfig:e,children:[e.format==="checkpoint"&&e.type==="main"&&o.jsx(zR,{modelConfig:e}),o.jsx(VR,{})]}),o.jsxs(j,{flexDir:"column",h:"full",gap:4,children:[o.jsx(xe,{layerStyle:"second",borderRadius:"base",p:4,children:o.jsxs(ef,{columns:2,gap:4,children:[o.jsx(mo,{label:t("modelManager.baseModel"),value:e.base}),o.jsx(mo,{label:t("modelManager.modelType"),value:e.type}),o.jsx(mo,{label:t("common.format"),value:e.format}),o.jsx(mo,{label:t("modelManager.path"),value:e.path}),e.type==="main"&&o.jsx(mo,{label:t("modelManager.variant"),value:e.variant}),e.type==="main"&&e.format==="diffusers"&&e.repo_variant&&o.jsx(mo,{label:t("modelManager.repoVariant"),value:e.repo_variant}),e.type==="main"&&e.format==="checkpoint"&&o.jsxs(o.Fragment,{children:[o.jsx(mo,{label:t("modelManager.pathToConfig"),value:e.config_path}),o.jsx(mo,{label:t("modelManager.predictionType"),value:e.prediction_type}),o.jsx(mo,{label:t("modelManager.upcastAttention"),value:`${e.upcast_attention}`})]}),e.type==="ip_adapter"&&e.format==="invokeai"&&o.jsx(mo,{label:t("modelManager.imageEncoderModelId"),value:e.image_encoder_model_id})]})}),n&&o.jsxs(xe,{layerStyle:"second",borderRadius:"base",p:4,children:[e.type==="main"&&e.base!=="sdxl-refiner"&&o.jsx(XR,{modelConfig:e}),(e.type==="controlnet"||e.type==="t2i_adapter")&&o.jsx(FR,{modelConfig:e}),(e.type==="main"||e.type==="lora")&&o.jsx(HR,{modelConfig:e})]})]})]})});e4.displayName="ModelView";const t4=l.memo(()=>{const{t:e}=S(),t=w(xF),n=w(pu),{data:s,isLoading:r}=$p(),a=l.useMemo(()=>{if(!s||n===null)return null;const i=Yd.selectById(s,n);return i||null},[s,n]);return r?o.jsx($b,{label:e("common.loading")}):a?t==="view"?o.jsx(e4,{modelConfig:a}):o.jsx(BR,{modelConfig:a}):o.jsx(Mt,{label:e("common.somethingWentWrong"),icon:WW})});t4.displayName="Model";const n4=l.memo(()=>{const e=w(pu);return o.jsx(xe,{layerStyle:"first",p:4,borderRadius:"base",w:"50%",h:"full",children:e?o.jsx(t4,{},e):o.jsx(HM,{})})});n4.displayName="ModelPane";const Gae=()=>o.jsxs(j,{layerStyle:"body",w:"full",h:"full",gap:"2",children:[o.jsx(NR,{}),o.jsx(n4,{})]}),Uae=l.memo(Gae),Zae=()=>{const{t:e}=S(),{data:t}=fu(),n=se(On),[s,{isLoading:r}]=bF({fixedCacheKey:"clearInvocationCache"}),a=l.useMemo(()=>!(t!=null&&t.size)||!n,[t==null?void 0:t.size,n]);return{clearInvocationCache:l.useCallback(async()=>{if(!a)try{await s().unwrap(),he({id:"INVOCATION_CACHE_CLEAR_SUCCEEDED",title:e("invocationCache.clearSucceeded"),status:"success"})}catch{he({id:"INVOCATION_CACHE_CLEAR_FAILED",title:e("invocationCache.clearFailed"),status:"error"})}},[a,s,e]),isLoading:r,cacheStatus:t,isDisabled:a}},qae=()=>{const{t:e}=S(),{clearInvocationCache:t,isDisabled:n,isLoading:s}=Zae();return o.jsx(me,{isDisabled:n,isLoading:s,onClick:t,children:e("invocationCache.clear")})},Kae=l.memo(qae),Qae=({children:e,...t})=>o.jsx(yF,{alignItems:"center",justifyContent:"center",w:"full",h:"full",layerStyle:"first",borderRadius:"base",py:2,px:3,gap:6,flexWrap:"nowrap",...t,children:e}),s4=l.memo(Qae),Yae={'&[aria-disabled="true"]':{color:"base.500"}},Jae=({label:e,value:t,isDisabled:n=!1,...s})=>o.jsxs(vF,{flexGrow:1,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap","aria-disabled":n,sx:Yae,...s,children:[o.jsx(CF,{textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",children:e}),o.jsx(wF,{children:t})]}),Zo=l.memo(Jae),Xae=()=>{const{t:e}=S(),{data:t}=fu(),n=se(On),[s,{isLoading:r}]=jF({fixedCacheKey:"disableInvocationCache"}),a=l.useMemo(()=>!(t!=null&&t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{disableInvocationCache:l.useCallback(async()=>{if(!a)try{await s().unwrap(),he({id:"INVOCATION_CACHE_DISABLE_SUCCEEDED",title:e("invocationCache.disableSucceeded"),status:"success"})}catch{he({id:"INVOCATION_CACHE_DISABLE_FAILED",title:e("invocationCache.disableFailed"),status:"error"})}},[a,s,e]),isLoading:r,cacheStatus:t,isDisabled:a}},eie=()=>{const{t:e}=S(),{data:t}=fu(),n=se(On),[s,{isLoading:r}]=SF({fixedCacheKey:"enableInvocationCache"}),a=l.useMemo(()=>(t==null?void 0:t.enabled)||!n||(t==null?void 0:t.max_size)===0,[t==null?void 0:t.enabled,t==null?void 0:t.max_size,n]);return{enableInvocationCache:l.useCallback(async()=>{if(!a)try{await s().unwrap(),he({id:"INVOCATION_CACHE_ENABLE_SUCCEEDED",title:e("invocationCache.enableSucceeded"),status:"success"})}catch{he({id:"INVOCATION_CACHE_ENABLE_FAILED",title:e("invocationCache.enableFailed"),status:"error"})}},[a,s,e]),isLoading:r,cacheStatus:t,isDisabled:a}},tie=()=>{const{t:e}=S(),{data:t}=fu(),{enableInvocationCache:n,isDisabled:s,isLoading:r}=eie(),{disableInvocationCache:a,isDisabled:i,isLoading:c}=Xae();return t!=null&&t.enabled?o.jsx(me,{isDisabled:i,isLoading:c,onClick:a,children:e("invocationCache.disable")}):o.jsx(me,{isDisabled:s,isLoading:r,onClick:n,children:e("invocationCache.enable")})},nie=l.memo(tie),sie=()=>{const{t:e}=S(),{data:t}=fu(void 0);return o.jsxs(s4,{children:[o.jsx(Zo,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.cacheSize"),value:(t==null?void 0:t.size)??0}),o.jsx(Zo,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.hits"),value:(t==null?void 0:t.hits)??0}),o.jsx(Zo,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.misses"),value:(t==null?void 0:t.misses)??0}),o.jsx(Zo,{isDisabled:!(t!=null&&t.enabled),label:e("invocationCache.maxCacheSize"),value:(t==null?void 0:t.max_size)??0}),o.jsxs(Tn,{w:24,orientation:"vertical",size:"sm",children:[o.jsx(Kae,{}),o.jsx(nie,{})]})]})},oie=l.memo(sie),im=0,za=1,Bc=2,o4=4;function r4(e,t){return n=>e(t(n))}function rie(e,t){return t(e)}function a4(e,t){return n=>e(t,n)}function r2(e,t){return()=>e(t)}function lm(e,t){return t(e),e}function Jt(...e){return e}function aie(e){e()}function a2(e){return()=>e}function iie(...e){return()=>{e.map(aie)}}function J1(e){return e!==void 0}function $c(){}function _t(e,t){return e(za,t)}function lt(e,t){e(im,t)}function X1(e){e(Bc)}function Zn(e){return e(o4)}function $e(e,t){return _t(e,a4(t,im))}function cr(e,t){const n=e(za,s=>{n(),t(s)});return n}function mt(){const e=[];return(t,n)=>{switch(t){case Bc:e.splice(0,e.length);return;case za:return e.push(n),()=>{const s=e.indexOf(n);s>-1&&e.splice(s,1)};case im:e.slice().forEach(s=>{s(n)});return;default:throw new Error(`unrecognized action ${t}`)}}}function ke(e){let t=e;const n=mt();return(s,r)=>{switch(s){case za:r(t);break;case im:t=r;break;case o4:return t}return n(s,r)}}function lie(e){let t,n;const s=()=>t&&t();return function(r,a){switch(r){case za:return a?n===a?void 0:(s(),n=a,t=_t(e,a),t):(s(),$c);case Bc:s(),n=null;return;default:throw new Error(`unrecognized action ${r}`)}}}function zs(e){return lm(mt(),t=>$e(e,t))}function as(e,t){return lm(ke(t),n=>$e(e,n))}function cie(...e){return t=>e.reduceRight(rie,t)}function fe(e,...t){const n=cie(...t);return(s,r)=>{switch(s){case za:return _t(e,n(r));case Bc:X1(e);return}}}function i4(e,t){return e===t}function Yt(e=i4){let t;return n=>s=>{e(t,s)||(t=s,n(s))}}function Ye(e){return t=>n=>{e(n)&&t(n)}}function Pe(e){return t=>r4(t,e)}function qo(e){return t=>()=>t(e)}function nr(e,t){return n=>s=>n(t=e(t,s))}function Jl(e){return t=>n=>{e>0?e--:t(n)}}function ba(e){let t=null,n;return s=>r=>{t=r,!n&&(n=setTimeout(()=>{n=void 0,s(t)},e))}}function i2(e){let t,n;return s=>r=>{t=r,n&&clearTimeout(n),n=setTimeout(()=>{s(t)},e)}}function ct(...e){const t=new Array(e.length);let n=0,s=null;const r=Math.pow(2,e.length)-1;return e.forEach((a,i)=>{const c=Math.pow(2,i);_t(a,d=>{const u=n;n=n|c,t[i]=d,u!==r&&n===r&&s&&(s(),s=null)})}),a=>i=>{const c=()=>a([i].concat(t));n===r?c():s=c}}function l2(...e){return function(t,n){switch(t){case za:return iie(...e.map(s=>_t(s,n)));case Bc:return;default:throw new Error(`unrecognized action ${t}`)}}}function Qe(e,t=i4){return fe(e,Yt(t))}function En(...e){const t=mt(),n=new Array(e.length);let s=0;const r=Math.pow(2,e.length)-1;return e.forEach((a,i)=>{const c=Math.pow(2,i);_t(a,d=>{n[i]=d,s=s|c,s===r&&lt(t,n)})}),function(a,i){switch(a){case za:return s===r&&i(n),_t(t,i);case Bc:return X1(t);default:throw new Error(`unrecognized action ${a}`)}}}function Et(e,t=[],{singleton:n}={singleton:!0}){return{id:die(),constructor:e,dependencies:t,singleton:n}}const die=()=>Symbol();function uie(e){const t=new Map,n=({id:s,constructor:r,dependencies:a,singleton:i})=>{if(i&&t.has(s))return t.get(s);const c=r(a.map(d=>n(d)));return i&&t.set(s,c),c};return n(e)}function hie(e,t){const n={},s={};let r=0;const a=e.length;for(;r<a;)s[e[r]]=1,r+=1;for(const i in t)s.hasOwnProperty(i)||(n[i]=t[i]);return n}const ph=typeof document<"u"?te.useLayoutEffect:te.useEffect;function l4(e,t,n){const s=Object.keys(t.required||{}),r=Object.keys(t.optional||{}),a=Object.keys(t.methods||{}),i=Object.keys(t.events||{}),c=te.createContext({});function d(y,v){y.propsReady&&lt(y.propsReady,!1);for(const I of s){const k=y[t.required[I]];lt(k,v[I])}for(const I of r)if(I in v){const k=y[t.optional[I]];lt(k,v[I])}y.propsReady&&lt(y.propsReady,!0)}function u(y){return a.reduce((v,I)=>(v[I]=k=>{const M=y[t.methods[I]];lt(M,k)},v),{})}function h(y){return i.reduce((v,I)=>(v[I]=lie(y[t.events[I]]),v),{})}const p=te.forwardRef((y,v)=>{const{children:I,...k}=y,[M]=te.useState(()=>lm(uie(e),D=>d(D,k))),[_]=te.useState(r2(h,M));ph(()=>{for(const D of i)D in k&&_t(_[D],k[D]);return()=>{Object.values(_).map(X1)}},[k,_,M]),ph(()=>{d(M,k)}),te.useImperativeHandle(v,a2(u(M)));const A=n;return o.jsx(c.Provider,{value:M,children:n?o.jsx(A,{...hie([...s,...r,...i],k),children:I}):I})}),f=y=>te.useCallback(a4(lt,te.useContext(c)[y]),[y]),m=y=>{const I=te.useContext(c)[y],k=te.useCallback(M=>_t(I,M),[I]);return te.useSyncExternalStore(k,()=>Zn(I),()=>Zn(I))},g=y=>{const I=te.useContext(c)[y],[k,M]=te.useState(r2(Zn,I));return ph(()=>_t(I,_=>{_!==k&&M(a2(_))}),[I,k]),k},x=te.version.startsWith("18")?m:g;return{Component:p,usePublisher:f,useEmitterValue:x,useEmitter:(y,v)=>{const k=te.useContext(c)[y];ph(()=>_t(k,v),[v,k])}}}const c4=typeof document<"u"?te.useLayoutEffect:te.useEffect;var Vs=(e=>(e[e.DEBUG=0]="DEBUG",e[e.INFO=1]="INFO",e[e.WARN=2]="WARN",e[e.ERROR=3]="ERROR",e))(Vs||{});const pie={0:"debug",1:"log",2:"warn",3:"error"},fie=()=>typeof globalThis>"u"?window:globalThis,Va=Et(()=>{const e=ke(3);return{log:ke((n,s,r=1)=>{var a;const i=(a=fie().VIRTUOSO_LOG_LEVEL)!=null?a:Zn(e);r>=i&&console[pie[r]]("%creact-virtuoso: %c%s %o","color: #0253b3; font-weight: bold","color: initial",n,s)}),logLevel:e}},[],{singleton:!0});function ey(e,t,n){const s=te.useRef(null);let r=a=>{};if(typeof ResizeObserver<"u"){const a=te.useMemo(()=>new ResizeObserver(i=>{const c=()=>{const d=i[0].target;d.offsetParent!==null&&e(d)};n?c():requestAnimationFrame(c)}),[e]);r=i=>{i&&t?(a.observe(i),s.current=i):(s.current&&a.unobserve(s.current),s.current=null)}}return{ref:s,callbackRef:r}}function $i(e,t,n){return ey(e,t,n).callbackRef}function mie(e,t,n,s,r,a,i,c,d){const u=te.useCallback(h=>{const p=gie(h.children,t,c?"offsetWidth":"offsetHeight",r);let f=h.parentElement;for(;!f.dataset.virtuosoScroller;)f=f.parentElement;const m=f.lastElementChild.dataset.viewportType==="window",g=i?c?i.scrollLeft:i.scrollTop:m?c?window.pageXOffset||document.documentElement.scrollLeft:window.pageYOffset||document.documentElement.scrollTop:c?f.scrollLeft:f.scrollTop,x=i?c?i.scrollWidth:i.scrollHeight:m?c?document.documentElement.scrollWidth:document.documentElement.scrollHeight:c?f.scrollWidth:f.scrollHeight,C=i?c?i.offsetWidth:i.offsetHeight:m?c?window.innerWidth:window.innerHeight:c?f.offsetWidth:f.offsetHeight;s({scrollTop:Math.max(g,0),scrollHeight:x,viewportHeight:C}),a==null||a(c?c2("column-gap",getComputedStyle(h).columnGap,r):c2("row-gap",getComputedStyle(h).rowGap,r)),p!==null&&e(p)},[e,t,r,a,i,s]);return ey(u,n,d)}function gie(e,t,n,s){const r=e.length;if(r===0)return null;const a=[];for(let i=0;i<r;i++){const c=e.item(i);if(!c||c.dataset.index===void 0)continue;const d=parseInt(c.dataset.index),u=parseFloat(c.dataset.knownSize),h=t(c,n);if(h===0&&s("Zero-sized element, this should not happen",{child:c},Vs.ERROR),h===u)continue;const p=a[a.length-1];a.length===0||p.size!==h||p.endIndex!==d-1?a.push({startIndex:d,endIndex:d,size:h}):a[a.length-1].endIndex++}return a}function c2(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Vs.WARN),t==="normal"?0:parseInt(t??"0",10)}function Aa(e,t){return Math.round(e.getBoundingClientRect()[t])}function d4(e,t){return Math.abs(e-t)<1.01}function u4(e,t,n,s=$c,r,a){const i=te.useRef(null),c=te.useRef(null),d=te.useRef(null),u=te.useCallback(f=>{const m=f.target,g=m===window||m===document,x=a?g?window.pageXOffset||document.documentElement.scrollLeft:m.scrollLeft:g?window.pageYOffset||document.documentElement.scrollTop:m.scrollTop,C=a?g?document.documentElement.scrollWidth:m.scrollWidth:g?document.documentElement.scrollHeight:m.scrollHeight,y=a?g?window.innerWidth:m.offsetWidth:g?window.innerHeight:m.offsetHeight,v=()=>{e({scrollTop:Math.max(x,0),scrollHeight:C,viewportHeight:y})};f.suppressFlushSync?v():YS.flushSync(v),c.current!==null&&(x===c.current||x<=0||x===C-y)&&(c.current=null,t(!0),d.current&&(clearTimeout(d.current),d.current=null))},[e,t]);te.useEffect(()=>{const f=r||i.current;return s(r||i.current),u({target:f,suppressFlushSync:!0}),f.addEventListener("scroll",u,{passive:!0}),()=>{s(null),f.removeEventListener("scroll",u)}},[i,u,n,s,r]);function h(f){const m=i.current;if(!m||(a?"offsetWidth"in m&&m.offsetWidth===0:"offsetHeight"in m&&m.offsetHeight===0))return;const g=f.behavior==="smooth";let x,C,y;m===window?(C=Math.max(Aa(document.documentElement,a?"width":"height"),a?document.documentElement.scrollWidth:document.documentElement.scrollHeight),x=a?window.innerWidth:window.innerHeight,y=a?document.documentElement.scrollLeft:document.documentElement.scrollTop):(C=m[a?"scrollWidth":"scrollHeight"],x=Aa(m,a?"width":"height"),y=m[a?"scrollLeft":"scrollTop"]);const v=C-x;if(f.top=Math.ceil(Math.max(Math.min(v,f.top),0)),d4(x,C)||f.top===y){e({scrollTop:y,scrollHeight:C,viewportHeight:x}),g&&t(!0);return}g?(c.current=f.top,d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{d.current=null,c.current=null,t(!0)},1e3)):c.current=null,a&&(f={left:f.top,behavior:f.behavior}),m.scrollTo(f)}function p(f){a&&(f={left:f.top,behavior:f.behavior}),i.current.scrollBy(f)}return{scrollerRef:i,scrollByCallback:p,scrollToCallback:h}}const us=Et(()=>{const e=mt(),t=mt(),n=ke(0),s=mt(),r=ke(0),a=mt(),i=mt(),c=ke(0),d=ke(0),u=ke(0),h=ke(0),p=mt(),f=mt(),m=ke(!1),g=ke(!1),x=ke(!1);return $e(fe(e,Pe(({scrollTop:C})=>C)),t),$e(fe(e,Pe(({scrollHeight:C})=>C)),i),$e(t,r),{scrollContainerState:e,scrollTop:t,viewportHeight:a,headerHeight:c,fixedHeaderHeight:d,fixedFooterHeight:u,footerHeight:h,scrollHeight:i,smoothScrollTargetReached:s,horizontalDirection:g,skipAnimationFrameInResizeObserver:x,scrollTo:p,scrollBy:f,statefulScrollTop:r,deviation:n,scrollingInProgress:m}},[],{singleton:!0}),Ad={lvl:0};function h4(e,t,n,s=Ad,r=Ad){return{k:e,v:t,lvl:n,l:s,r}}function $t(e){return e===Ad}function Ol(){return Ad}function F0(e,t){if($t(e))return Ad;const{k:n,l:s,r}=e;if(t===n){if($t(s))return r;if($t(r))return s;{const[a,i]=p4(s);return Nh(Sn(e,{k:a,v:i,l:f4(s)}))}}else return t<n?Nh(Sn(e,{l:F0(s,t)})):Nh(Sn(e,{r:F0(r,t)}))}function Ed(e,t){if(!$t(e))return t===e.k?e.v:t<e.k?Ed(e.l,t):Ed(e.r,t)}function Ro(e,t,n="k"){if($t(e))return[-1/0,void 0];if(Number(e[n])===t)return[e.k,e.v];if(Number(e[n])<t){const s=Ro(e.r,t,n);return s[0]===-1/0?[e.k,e.v]:s}return Ro(e.l,t,n)}function $s(e,t,n){return $t(e)?h4(t,n,1):t===e.k?Sn(e,{k:t,v:n}):t<e.k?d2(Sn(e,{l:$s(e.l,t,n)})):d2(Sn(e,{r:$s(e.r,t,n)}))}function z0(e,t,n){if($t(e))return[];const{k:s,v:r,l:a,r:i}=e;let c=[];return s>t&&(c=c.concat(z0(a,t,n))),s>=t&&s<=n&&c.push({k:s,v:r}),s<=n&&(c=c.concat(z0(i,t,n))),c}function si(e){return $t(e)?[]:[...si(e.l),{k:e.k,v:e.v},...si(e.r)]}function p4(e){return $t(e.r)?[e.k,e.v]:p4(e.r)}function f4(e){return $t(e.r)?e.l:Nh(Sn(e,{r:f4(e.r)}))}function Sn(e,t){return h4(t.k!==void 0?t.k:e.k,t.v!==void 0?t.v:e.v,t.lvl!==void 0?t.lvl:e.lvl,t.l!==void 0?t.l:e.l,t.r!==void 0?t.r:e.r)}function ig(e){return $t(e)||e.lvl>e.r.lvl}function d2(e){return V0(g4(e))}function Nh(e){const{l:t,r:n,lvl:s}=e;if(n.lvl>=s-1&&t.lvl>=s-1)return e;if(s>n.lvl+1){if(ig(t))return g4(Sn(e,{lvl:s-1}));if(!$t(t)&&!$t(t.r))return Sn(t.r,{l:Sn(t,{r:t.r.l}),r:Sn(e,{l:t.r.r,lvl:s-1}),lvl:s});throw new Error("Unexpected empty nodes")}else{if(ig(e))return V0(Sn(e,{lvl:s-1}));if(!$t(n)&&!$t(n.l)){const r=n.l,a=ig(r)?n.lvl-1:n.lvl;return Sn(r,{l:Sn(e,{r:r.l,lvl:s-1}),r:V0(Sn(n,{l:r.r,lvl:a})),lvl:r.lvl+1})}else throw new Error("Unexpected empty nodes")}}function cm(e,t,n){if($t(e))return[];const s=Ro(e,t)[0];return xie(z0(e,s,n))}function m4(e,t){const n=e.length;if(n===0)return[];let{index:s,value:r}=t(e[0]);const a=[];for(let i=1;i<n;i++){const{index:c,value:d}=t(e[i]);a.push({start:s,end:c-1,value:r}),s=c,r=d}return a.push({start:s,end:1/0,value:r}),a}function xie(e){return m4(e,({k:t,v:n})=>({index:t,value:n}))}function V0(e){const{r:t,lvl:n}=e;return!$t(t)&&!$t(t.r)&&t.lvl===n&&t.r.lvl===n?Sn(t,{l:Sn(e,{r:t.l}),lvl:n+1}):e}function g4(e){const{l:t}=e;return!$t(t)&&t.lvl===e.lvl?Sn(t,{r:Sn(e,{l:t.r})}):e}function _p(e,t,n,s=0){let r=e.length-1;for(;s<=r;){const a=Math.floor((s+r)/2),i=e[a],c=n(i,t);if(c===0)return a;if(c===-1){if(r-s<2)return a-1;r=a-1}else{if(r===s)return a;s=a+1}}throw new Error(`Failed binary finding record in array - ${e.join(",")}, searched for ${t}`)}function x4(e,t,n){return e[_p(e,t,n)]}function bie(e,t,n,s){const r=_p(e,t,s),a=_p(e,n,s,r);return e.slice(r,a+1)}const ty=Et(()=>({recalcInProgress:ke(!1)}),[],{singleton:!0});function yie(e){const{size:t,startIndex:n,endIndex:s}=e;return r=>r.start===n&&(r.end===s||r.end===1/0)&&r.value===t}function u2(e,t){let n=0,s=0;for(;n<e;)n+=t[s+1]-t[s]-1,s++;return s-(n===e?0:1)}function vie(e,t){let n=$t(e)?0:1/0;for(const s of t){const{size:r,startIndex:a,endIndex:i}=s;if(n=Math.min(n,a),$t(e)){e=$s(e,0,r);continue}const c=cm(e,a-1,i+1);if(c.some(yie(s)))continue;let d=!1,u=!1;for(const{start:h,end:p,value:f}of c)d?(i>=h||r===f)&&(e=F0(e,h)):(u=f!==r,d=!0),p>i&&i>=h&&f!==r&&(e=$s(e,i+1,f));u&&(e=$s(e,a,r))}return[e,n]}function Cie(){return{offsetTree:[],sizeTree:Ol(),groupOffsetTree:Ol(),lastIndex:0,lastOffset:0,lastSize:0,groupIndices:[]}}function ny({index:e},t){return t===e?0:t<e?-1:1}function wie({offset:e},t){return t===e?0:t<e?-1:1}function jie(e){return{index:e.index,value:e}}function Sie(e,t,n,s=0){return s>0&&(t=Math.max(t,x4(e,s,ny).offset)),m4(bie(e,t,n,wie),jie)}function H0(e,t,n,s){let r=e,a=0,i=0,c=0,d=0;if(t!==0){d=_p(r,t-1,ny),c=r[d].offset;const h=Ro(n,t-1);a=h[0],i=h[1],r.length&&r[d].size===Ro(n,t)[1]&&(d-=1),r=r.slice(0,d+1)}else r=[];for(const{start:u,value:h}of cm(n,t,1/0)){const p=u-a,f=p*i+c+p*s;r.push({offset:f,size:h,index:u}),a=u,c=f,i=h}return{offsetTree:r,lastIndex:a,lastOffset:c,lastSize:i}}function kie(e,[t,n,s,r]){t.length>0&&s("received item sizes",t,Vs.DEBUG);const a=e.sizeTree;let i=a,c=0;if(n.length>0&&$t(a)&&t.length===2){const f=t[0].size,m=t[1].size;i=n.reduce((g,x)=>$s($s(g,x,f),x+1,m),i)}else[i,c]=vie(i,t);if(i===a)return e;const{offsetTree:d,lastIndex:u,lastSize:h,lastOffset:p}=H0(e.offsetTree,c,i,r);return{sizeTree:i,offsetTree:d,lastIndex:u,lastOffset:p,lastSize:h,groupOffsetTree:n.reduce((f,m)=>$s(f,m,Ld(m,d,r)),Ol()),groupIndices:n}}function Ld(e,t,n){if(t.length===0)return 0;const{offset:s,index:r,size:a}=x4(t,e,ny),i=e-r,c=a*i+(i-1)*n+s;return c>0?c+n:c}function Iie(e){return typeof e.groupIndex<"u"}function b4(e,t,n){if(Iie(e))return t.groupIndices[e.groupIndex]+1;{const s=e.index==="LAST"?n:e.index;let r=y4(s,t);return r=Math.max(0,r,Math.min(n,r)),r}}function y4(e,t){if(!dm(t))return e;let n=0;for(;t.groupIndices[n]<=e+n;)n++;return e+n}function dm(e){return!$t(e.groupOffsetTree)}function _ie(e){return si(e).map(({k:t,v:n},s,r)=>{const a=r[s+1],i=a?a.k-1:1/0;return{startIndex:t,endIndex:i,size:n}})}const Mie={offsetHeight:"height",offsetWidth:"width"},yr=Et(([{log:e},{recalcInProgress:t}])=>{const n=mt(),s=mt(),r=as(s,0),a=mt(),i=mt(),c=ke(0),d=ke([]),u=ke(void 0),h=ke(void 0),p=ke((M,_)=>Aa(M,Mie[_])),f=ke(void 0),m=ke(0),g=Cie(),x=as(fe(n,ct(d,e,m),nr(kie,g),Yt()),g),C=as(fe(d,Yt(),nr((M,_)=>({prev:M.current,current:_}),{prev:[],current:[]}),Pe(({prev:M})=>M)),[]);$e(fe(d,Ye(M=>M.length>0),ct(x,m),Pe(([M,_,A])=>{const D=M.reduce((N,P,z)=>$s(N,P,Ld(P,_.offsetTree,A)||z),Ol());return{..._,groupIndices:M,groupOffsetTree:D}})),x),$e(fe(s,ct(x),Ye(([M,{lastIndex:_}])=>M<_),Pe(([M,{lastIndex:_,lastSize:A}])=>[{startIndex:M,endIndex:_,size:A}])),n),$e(u,h);const y=as(fe(u,Pe(M=>M===void 0)),!0);$e(fe(h,Ye(M=>M!==void 0&&$t(Zn(x).sizeTree)),Pe(M=>[{startIndex:0,endIndex:0,size:M}])),n);const v=zs(fe(n,ct(x),nr(({sizes:M},[_,A])=>({changed:A!==M,sizes:A}),{changed:!1,sizes:g}),Pe(M=>M.changed)));_t(fe(c,nr((M,_)=>({diff:M.prev-_,prev:_}),{diff:0,prev:0}),Pe(M=>M.diff)),M=>{const{groupIndices:_}=Zn(x);if(M>0)lt(t,!0),lt(a,M+u2(M,_));else if(M<0){const A=Zn(C);A.length>0&&(M-=u2(-M,A)),lt(i,M)}}),_t(fe(c,ct(e)),([M,_])=>{M<0&&_("`firstItemIndex` prop should not be set to less than zero. If you don't know the total count, just use a very high value",{firstItemIndex:c},Vs.ERROR)});const I=zs(a);$e(fe(a,ct(x),Pe(([M,_])=>{const A=_.groupIndices.length>0,D=[],N=_.lastSize;if(A){const P=Ed(_.sizeTree,0);let z=0,W=0;for(;z<M;){const G=_.groupIndices[W],re=_.groupIndices.length===W+1?1/0:_.groupIndices[W+1]-G-1;D.push({startIndex:G,endIndex:G,size:P}),D.push({startIndex:G+1,endIndex:G+1+re-1,size:N}),W++,z+=re+1}const X=si(_.sizeTree);return z!==M&&X.shift(),X.reduce((G,{k:re,v:le})=>{let Ce=G.ranges;return G.prevSize!==0&&(Ce=[...G.ranges,{startIndex:G.prevIndex,endIndex:re+M-1,size:G.prevSize}]),{ranges:Ce,prevIndex:re+M,prevSize:le}},{ranges:D,prevIndex:M,prevSize:0}).ranges}return si(_.sizeTree).reduce((P,{k:z,v:W})=>({ranges:[...P.ranges,{startIndex:P.prevIndex,endIndex:z+M-1,size:P.prevSize}],prevIndex:z+M,prevSize:W}),{ranges:[],prevIndex:0,prevSize:N}).ranges})),n);const k=zs(fe(i,ct(x,m),Pe(([M,{offsetTree:_},A])=>{const D=-M;return Ld(D,_,A)})));return $e(fe(i,ct(x,m),Pe(([M,_,A])=>{if(_.groupIndices.length>0){if($t(_.sizeTree))return _;let N=Ol();const P=Zn(C);let z=0,W=0,X=0;for(;z<-M;){X=P[W];const G=P[W+1]-X-1;W++,z+=G+1}if(N=si(_.sizeTree).reduce((G,{k:re,v:le})=>$s(G,Math.max(0,re+M),le),N),z!==-M){const G=Ed(_.sizeTree,X);N=$s(N,0,G);const re=Ro(_.sizeTree,-M+1)[1];N=$s(N,1,re)}return{..._,sizeTree:N,...H0(_.offsetTree,0,N,A)}}else{const N=si(_.sizeTree).reduce((P,{k:z,v:W})=>$s(P,Math.max(0,z+M),W),Ol());return{..._,sizeTree:N,...H0(_.offsetTree,0,N,A)}}})),x),{data:f,totalCount:s,sizeRanges:n,groupIndices:d,defaultItemSize:h,fixedItemSize:u,unshiftWith:a,shiftWith:i,shiftWithOffset:k,beforeUnshiftWith:I,firstItemIndex:c,gap:m,sizes:x,listRefresh:v,statefulTotalCount:r,trackItemSizes:y,itemSize:p}},Jt(Va,ty),{singleton:!0}),Aie=typeof document<"u"&&"scrollBehavior"in document.documentElement.style;function v4(e){const t=typeof e=="number"?{index:e}:e;return t.align||(t.align="start"),(!t.behavior||!Aie)&&(t.behavior="auto"),t.offset||(t.offset=0),t}const Du=Et(([{sizes:e,totalCount:t,listRefresh:n,gap:s},{scrollingInProgress:r,viewportHeight:a,scrollTo:i,smoothScrollTargetReached:c,headerHeight:d,footerHeight:u,fixedHeaderHeight:h,fixedFooterHeight:p},{log:f}])=>{const m=mt(),g=mt(),x=ke(0);let C=null,y=null,v=null;function I(){C&&(C(),C=null),v&&(v(),v=null),y&&(clearTimeout(y),y=null),lt(r,!1)}return $e(fe(m,ct(e,a,t,x,d,u,f),ct(s,h,p),Pe(([[k,M,_,A,D,N,P,z],W,X,ee])=>{const G=v4(k),{align:re,behavior:le,offset:Ce}=G,be=A-1,ye=b4(G,M,be);let ne=Ld(ye,M.offsetTree,W)+N;re==="end"?(ne+=X+Ro(M.sizeTree,ye)[1]-_+ee,ye===be&&(ne+=P)):re==="center"?ne+=(X+Ro(M.sizeTree,ye)[1]-_+ee)/2:ne-=D,Ce&&(ne+=Ce);const R=F=>{I(),F?(z("retrying to scroll to",{location:k},Vs.DEBUG),lt(m,k)):(lt(g,!0),z("list did not change, scroll successful",{},Vs.DEBUG))};if(I(),le==="smooth"){let F=!1;v=_t(n,Z=>{F=F||Z}),C=cr(c,()=>{R(F)})}else C=cr(fe(n,Eie(150)),R);return y=setTimeout(()=>{I()},1200),lt(r,!0),z("scrolling from index to",{index:ye,top:ne,behavior:le},Vs.DEBUG),{top:ne,behavior:le}})),i),{scrollToIndex:m,scrollTargetReached:g,topListHeight:x}},Jt(yr,us,Va),{singleton:!0});function Eie(e){return t=>{const n=setTimeout(()=>{t(!1)},e);return s=>{s&&(t(!0),clearTimeout(n))}}}const Td="up",fd="down",Lie="none",Tie={atBottom:!1,notAtBottomBecause:"NOT_SHOWING_LAST_ITEM",state:{offsetBottom:0,scrollTop:0,viewportHeight:0,scrollHeight:0}},Pie=0,Ou=Et(([{scrollContainerState:e,scrollTop:t,viewportHeight:n,headerHeight:s,footerHeight:r,scrollBy:a}])=>{const i=ke(!1),c=ke(!0),d=mt(),u=mt(),h=ke(4),p=ke(Pie),f=as(fe(l2(fe(Qe(t),Jl(1),qo(!0)),fe(Qe(t),Jl(1),qo(!1),i2(100))),Yt()),!1),m=as(fe(l2(fe(a,qo(!0)),fe(a,qo(!1),i2(200))),Yt()),!1);$e(fe(En(Qe(t),Qe(p)),Pe(([v,I])=>v<=I),Yt()),c),$e(fe(c,ba(50)),u);const g=zs(fe(En(e,Qe(n),Qe(s),Qe(r),Qe(h)),nr((v,[{scrollTop:I,scrollHeight:k},M,_,A,D])=>{const N=I+M-k>-D,P={viewportHeight:M,scrollTop:I,scrollHeight:k};if(N){let W,X;return I>v.state.scrollTop?(W="SCROLLED_DOWN",X=v.state.scrollTop-I):(W="SIZE_DECREASED",X=v.state.scrollTop-I||v.scrollTopDelta),{atBottom:!0,state:P,atBottomBecause:W,scrollTopDelta:X}}let z;return P.scrollHeight>v.state.scrollHeight?z="SIZE_INCREASED":M<v.state.viewportHeight?z="VIEWPORT_HEIGHT_DECREASING":I<v.state.scrollTop?z="SCROLLING_UPWARDS":z="NOT_FULLY_SCROLLED_TO_LAST_ITEM_BOTTOM",{atBottom:!1,notAtBottomBecause:z,state:P}},Tie),Yt((v,I)=>v&&v.atBottom===I.atBottom))),x=as(fe(e,nr((v,{scrollTop:I,scrollHeight:k,viewportHeight:M})=>{if(d4(v.scrollHeight,k))return{scrollTop:I,scrollHeight:k,jump:0,changed:!1};{const _=k-(I+M)<1;return v.scrollTop!==I&&_?{scrollHeight:k,scrollTop:I,jump:v.scrollTop-I,changed:!0}:{scrollHeight:k,scrollTop:I,jump:0,changed:!0}}},{scrollHeight:0,jump:0,scrollTop:0,changed:!1}),Ye(v=>v.changed),Pe(v=>v.jump)),0);$e(fe(g,Pe(v=>v.atBottom)),i),$e(fe(i,ba(50)),d);const C=ke(fd);$e(fe(e,Pe(({scrollTop:v})=>v),Yt(),nr((v,I)=>Zn(m)?{direction:v.direction,prevScrollTop:I}:{direction:I<v.prevScrollTop?Td:fd,prevScrollTop:I},{direction:fd,prevScrollTop:0}),Pe(v=>v.direction)),C),$e(fe(e,ba(50),qo(Lie)),C);const y=ke(0);return $e(fe(f,Ye(v=>!v),qo(0)),y),$e(fe(t,ba(100),ct(f),Ye(([v,I])=>!!I),nr(([v,I],[k])=>[I,k],[0,0]),Pe(([v,I])=>I-v)),y),{isScrolling:f,isAtTop:c,isAtBottom:i,atBottomState:g,atTopStateChange:u,atBottomStateChange:d,scrollDirection:C,atBottomThreshold:h,atTopThreshold:p,scrollVelocity:y,lastJumpDueToItemResize:x}},Jt(us)),Ha=Et(([{log:e}])=>{const t=ke(!1),n=zs(fe(t,Ye(s=>s),Yt()));return _t(t,s=>{s&&Zn(e)("props updated",{},Vs.DEBUG)}),{propsReady:t,didMount:n}},Jt(Va),{singleton:!0});function sy(e,t){e==0?t():requestAnimationFrame(()=>sy(e-1,t))}function oy(e,t){const n=t-1;return typeof e=="number"?e:e.index==="LAST"?n:e.index}const Nu=Et(([{sizes:e,listRefresh:t,defaultItemSize:n},{scrollTop:s},{scrollToIndex:r,scrollTargetReached:a},{didMount:i}])=>{const c=ke(!0),d=ke(0),u=ke(!0);return $e(fe(i,ct(d),Ye(([h,p])=>!!p),qo(!1)),c),$e(fe(i,ct(d),Ye(([h,p])=>!!p),qo(!1)),u),_t(fe(En(t,i),ct(c,e,n,u),Ye(([[,h],p,{sizeTree:f},m,g])=>h&&(!$t(f)||J1(m))&&!p&&!g),ct(d)),([,h])=>{cr(a,()=>{lt(u,!0)}),sy(4,()=>{cr(s,()=>{lt(c,!0)}),lt(r,h)})}),{scrolledToInitialItem:c,initialTopMostItemIndex:d,initialItemFinalLocationReached:u}},Jt(yr,us,Du,Ha),{singleton:!0});function h2(e){return e?e==="smooth"?"smooth":"auto":!1}const Rie=(e,t)=>typeof e=="function"?h2(e(t)):t&&h2(e),Die=Et(([{totalCount:e,listRefresh:t},{isAtBottom:n,atBottomState:s},{scrollToIndex:r},{scrolledToInitialItem:a},{propsReady:i,didMount:c},{log:d},{scrollingInProgress:u}])=>{const h=ke(!1),p=mt();let f=null;function m(x){lt(r,{index:"LAST",align:"end",behavior:x})}_t(fe(En(fe(Qe(e),Jl(1)),c),ct(Qe(h),n,a,u),Pe(([[x,C],y,v,I,k])=>{let M=C&&I,_="auto";return M&&(_=Rie(y,v||k),M=M&&!!_),{totalCount:x,shouldFollow:M,followOutputBehavior:_}}),Ye(({shouldFollow:x})=>x)),({totalCount:x,followOutputBehavior:C})=>{f&&(f(),f=null),f=cr(t,()=>{Zn(d)("following output to ",{totalCount:x},Vs.DEBUG),m(C),f=null})});function g(x){const C=cr(s,y=>{x&&!y.atBottom&&y.notAtBottomBecause==="SIZE_INCREASED"&&!f&&(Zn(d)("scrolling to bottom due to increased size",{},Vs.DEBUG),m("auto"))});setTimeout(C,100)}return _t(fe(En(Qe(h),e,i),Ye(([x,,C])=>x&&C),nr(({value:x},[,C])=>({refreshed:x===C,value:C}),{refreshed:!1,value:0}),Ye(({refreshed:x})=>x),ct(h,e)),([,x])=>{Zn(a)&&g(x!==!1)}),_t(p,()=>{g(Zn(h)!==!1)}),_t(En(Qe(h),s),([x,C])=>{x&&!C.atBottom&&C.notAtBottomBecause==="VIEWPORT_HEIGHT_DECREASING"&&m("auto")}),{followOutput:h,autoscrollToBottom:p}},Jt(yr,Ou,Du,Nu,Ha,Va,us));function Oie(e){return e.reduce((t,n)=>(t.groupIndices.push(t.totalCount),t.totalCount+=n+1,t),{totalCount:0,groupIndices:[]})}const C4=Et(([{totalCount:e,groupIndices:t,sizes:n},{scrollTop:s,headerHeight:r}])=>{const a=mt(),i=mt(),c=zs(fe(a,Pe(Oie)));return $e(fe(c,Pe(d=>d.totalCount)),e),$e(fe(c,Pe(d=>d.groupIndices)),t),$e(fe(En(s,n,r),Ye(([d,u])=>dm(u)),Pe(([d,u,h])=>Ro(u.groupOffsetTree,Math.max(d-h,0),"v")[0]),Yt(),Pe(d=>[d])),i),{groupCounts:a,topItemsIndexes:i}},Jt(yr,us));function Pd(e,t){return!!(e&&e[0]===t[0]&&e[1]===t[1])}function w4(e,t){return!!(e&&e.startIndex===t.startIndex&&e.endIndex===t.endIndex)}const Mp="top",Ap="bottom",p2="none";function f2(e,t,n){return typeof e=="number"?n===Td&&t===Mp||n===fd&&t===Ap?e:0:n===Td?t===Mp?e.main:e.reverse:t===Ap?e.main:e.reverse}function m2(e,t){return typeof e=="number"?e:e[t]||0}const ry=Et(([{scrollTop:e,viewportHeight:t,deviation:n,headerHeight:s,fixedHeaderHeight:r}])=>{const a=mt(),i=ke(0),c=ke(0),d=ke(0),u=as(fe(En(Qe(e),Qe(t),Qe(s),Qe(a,Pd),Qe(d),Qe(i),Qe(r),Qe(n),Qe(c)),Pe(([h,p,f,[m,g],x,C,y,v,I])=>{const k=h-v,M=C+y,_=Math.max(f-k,0);let A=p2;const D=m2(I,Mp),N=m2(I,Ap);return m-=v,m+=f+y,g+=f+y,g-=v,m>h+M-D&&(A=Td),g<h-_+p+N&&(A=fd),A!==p2?[Math.max(k-f-f2(x,Mp,A)-D,0),k-_-y+p+f2(x,Ap,A)+N]:null}),Ye(h=>h!=null),Yt(Pd)),[0,0]);return{listBoundary:a,overscan:d,topListHeight:i,increaseViewportBy:c,visibleRange:u}},Jt(us),{singleton:!0});function Nie(e,t,n){if(dm(t)){const s=y4(e,t);return[{index:Ro(t.groupOffsetTree,s)[0],size:0,offset:0},{index:s,size:0,offset:0,data:n&&n[0]}]}return[{index:e,size:0,offset:0,data:n&&n[0]}]}const lg={items:[],topItems:[],offsetTop:0,offsetBottom:0,top:0,bottom:0,topListHeight:0,totalCount:0,firstItemIndex:0};function g2(e,t,n){if(e.length===0)return[];if(!dm(t))return e.map(u=>({...u,index:u.index+n,originalIndex:u.index}));const s=e[0].index,r=e[e.length-1].index,a=[],i=cm(t.groupOffsetTree,s,r);let c,d=0;for(const u of e){(!c||c.end<u.index)&&(c=i.shift(),d=t.groupIndices.indexOf(c.start));let h;u.index===c.start?h={type:"group",index:d}:h={index:u.index-(d+1)+n,groupIndex:d},a.push({...h,size:u.size,offset:u.offset,originalIndex:u.index,data:u.data})}return a}function Bh(e,t,n,s,r,a){const{lastSize:i,lastOffset:c,lastIndex:d}=r;let u=0,h=0;if(e.length>0){u=e[0].offset;const x=e[e.length-1];h=x.offset+x.size}const p=n-d,f=c+p*i+(p-1)*s,m=u,g=f-h;return{items:g2(e,r,a),topItems:g2(t,r,a),topListHeight:t.reduce((x,C)=>C.size+x,0),offsetTop:u,offsetBottom:g,top:m,bottom:h,totalCount:n,firstItemIndex:a}}function j4(e,t,n,s,r,a){let i=0;if(n.groupIndices.length>0)for(const h of n.groupIndices){if(h-i>=e)break;i++}const c=e+i,d=oy(t,c),u=Array.from({length:c}).map((h,p)=>({index:p+d,size:0,offset:0,data:a[p+d]}));return Bh(u,[],c,r,n,s)}const Fi=Et(([{sizes:e,totalCount:t,data:n,firstItemIndex:s,gap:r},a,{visibleRange:i,listBoundary:c,topListHeight:d},{scrolledToInitialItem:u,initialTopMostItemIndex:h},{topListHeight:p},f,{didMount:m},{recalcInProgress:g}])=>{const x=ke([]),C=ke(0),y=mt();$e(a.topItemsIndexes,x);const v=as(fe(En(m,g,Qe(i,Pd),Qe(t),Qe(e),Qe(h),u,Qe(x),Qe(s),Qe(r),n),Ye(([_,A,,D,,,,,,,N])=>{const P=N&&N.length!==D;return _&&!A&&!P}),Pe(([,,[_,A],D,N,P,z,W,X,ee,G])=>{const re=N,{sizeTree:le,offsetTree:Ce}=re,be=Zn(C);if(D===0)return{...lg,totalCount:D};if(_===0&&A===0)return be===0?{...lg,totalCount:D}:j4(be,P,N,X,ee,G||[]);if($t(le))return be>0?null:Bh(Nie(oy(P,D),re,G),[],D,ee,re,X);const ye=[];if(W.length>0){const B=W[0],K=W[W.length-1];let $=0;for(const Y of cm(le,B,K)){const ae=Y.value,ue=Math.max(Y.start,B),Re=Math.min(Y.end,K);for(let we=ue;we<=Re;we++)ye.push({index:we,size:ae,offset:$,data:G&&G[we]}),$+=ae}}if(!z)return Bh([],ye,D,ee,re,X);const ne=W.length>0?W[W.length-1]+1:0,R=Sie(Ce,_,A,ne);if(R.length===0)return null;const F=D-1,Z=lm([],B=>{for(const K of R){const $=K.value;let Y=$.offset,ae=K.start;const ue=$.size;if($.offset<_){ae+=Math.floor((_-$.offset+ee)/(ue+ee));const we=ae-K.start;Y+=we*ue+we*ee}ae<ne&&(Y+=(ne-ae)*ue,ae=ne);const Re=Math.min(K.end,F);for(let we=ae;we<=Re&&!(Y>=A);we++)B.push({index:we,size:ue,offset:Y,data:G&&G[we]}),Y+=ue+ee}});return Bh(Z,ye,D,ee,re,X)}),Ye(_=>_!==null),Yt()),lg);$e(fe(n,Ye(J1),Pe(_=>_==null?void 0:_.length)),t),$e(fe(v,Pe(_=>_.topListHeight)),p),$e(p,d),$e(fe(v,Pe(_=>[_.top,_.bottom])),c),$e(fe(v,Pe(_=>_.items)),y);const I=zs(fe(v,Ye(({items:_})=>_.length>0),ct(t,n),Ye(([{items:_},A])=>_[_.length-1].originalIndex===A-1),Pe(([,_,A])=>[_-1,A]),Yt(Pd),Pe(([_])=>_))),k=zs(fe(v,ba(200),Ye(({items:_,topItems:A})=>_.length>0&&_[0].originalIndex===A.length),Pe(({items:_})=>_[0].index),Yt())),M=zs(fe(v,Ye(({items:_})=>_.length>0),Pe(({items:_})=>{let A=0,D=_.length-1;for(;_[A].type==="group"&&A<D;)A++;for(;_[D].type==="group"&&D>A;)D--;return{startIndex:_[A].index,endIndex:_[D].index}}),Yt(w4)));return{listState:v,topItemsIndexes:x,endReached:I,startReached:k,rangeChanged:M,itemsRendered:y,initialItemCount:C,...f}},Jt(yr,C4,ry,Nu,Du,Ou,Ha,ty),{singleton:!0}),Bie=Et(([{sizes:e,firstItemIndex:t,data:n,gap:s},{initialTopMostItemIndex:r},{initialItemCount:a,listState:i},{didMount:c}])=>($e(fe(c,ct(a),Ye(([,d])=>d!==0),ct(r,e,t,s,n),Pe(([[,d],u,h,p,f,m=[]])=>j4(d,u,h,p,f,m))),i),{}),Jt(yr,Nu,Fi,Ha),{singleton:!0}),S4=Et(([{scrollVelocity:e}])=>{const t=ke(!1),n=mt(),s=ke(!1);return $e(fe(e,ct(s,t,n),Ye(([r,a])=>!!a),Pe(([r,a,i,c])=>{const{exit:d,enter:u}=a;if(i){if(d(r,c))return!1}else if(u(r,c))return!0;return i}),Yt()),t),_t(fe(En(t,e,n),ct(s)),([[r,a,i],c])=>r&&c&&c.change&&c.change(a,i)),{isSeeking:t,scrollSeekConfiguration:s,scrollVelocity:e,scrollSeekRangeChanged:n}},Jt(Ou),{singleton:!0}),$ie=Et(([{topItemsIndexes:e}])=>{const t=ke(0);return $e(fe(t,Ye(n=>n>0),Pe(n=>Array.from({length:n}).map((s,r)=>r))),e),{topItemCount:t}},Jt(Fi)),k4=Et(([{footerHeight:e,headerHeight:t,fixedHeaderHeight:n,fixedFooterHeight:s},{listState:r}])=>{const a=mt(),i=as(fe(En(e,s,t,n,r),Pe(([c,d,u,h,p])=>c+d+u+h+p.offsetBottom+p.bottom)),0);return $e(Qe(i),a),{totalListHeight:i,totalListHeightChanged:a}},Jt(us,Fi),{singleton:!0});function I4(e){let t=!1,n;return()=>(t||(t=!0,n=e()),n)}const Fie=I4(()=>/iP(ad|od|hone)/i.test(navigator.userAgent)&&/WebKit/i.test(navigator.userAgent)),zie=Et(([{scrollBy:e,scrollTop:t,deviation:n,scrollingInProgress:s},{isScrolling:r,isAtBottom:a,scrollDirection:i,lastJumpDueToItemResize:c},{listState:d},{beforeUnshiftWith:u,shiftWithOffset:h,sizes:p,gap:f},{log:m},{recalcInProgress:g}])=>{const x=zs(fe(d,ct(c),nr(([,y,v,I],[{items:k,totalCount:M,bottom:_,offsetBottom:A},D])=>{const N=_+A;let P=0;return v===M&&y.length>0&&k.length>0&&(k[0].originalIndex===0&&y[0].originalIndex===0||(P=N-I,P!==0&&(P+=D))),[P,k,M,N]},[0,[],0,0]),Ye(([y])=>y!==0),ct(t,i,s,a,m,g),Ye(([,y,v,I,,,k])=>!k&&!I&&y!==0&&v===Td),Pe(([[y],,,,,v])=>(v("Upward scrolling compensation",{amount:y},Vs.DEBUG),y))));function C(y){y>0?(lt(e,{top:-y,behavior:"auto"}),lt(n,0)):(lt(n,0),lt(e,{top:-y,behavior:"auto"}))}return _t(fe(x,ct(n,r)),([y,v,I])=>{I&&Fie()?lt(n,v-y):C(-y)}),_t(fe(En(as(r,!1),n,g),Ye(([y,v,I])=>!y&&!I&&v!==0),Pe(([y,v])=>v),ba(1)),C),$e(fe(h,Pe(y=>({top:-y}))),e),_t(fe(u,ct(p,f),Pe(([y,{lastSize:v,groupIndices:I,sizeTree:k},M])=>{function _(A){return A*(v+M)}if(I.length===0)return _(y);{let A=0;const D=Ed(k,0);let N=0,P=0;for(;N<y;){N++,A+=D;let z=I.length===P+1?1/0:I[P+1]-I[P]-1;N+z>y&&(A-=D,z=y-N+1),N+=z,A+=_(z),P++}return A}})),y=>{lt(n,y),requestAnimationFrame(()=>{lt(e,{top:y}),requestAnimationFrame(()=>{lt(n,0),lt(g,!1)})})}),{deviation:n}},Jt(us,Ou,Fi,yr,Va,ty)),Vie=Et(([{didMount:e},{scrollTo:t},{listState:n}])=>{const s=ke(0);return _t(fe(e,ct(s),Ye(([,r])=>r!==0),Pe(([,r])=>({top:r}))),r=>{cr(fe(n,Jl(1),Ye(a=>a.items.length>1)),()=>{requestAnimationFrame(()=>{lt(t,r)})})}),{initialScrollTop:s}},Jt(Ha,us,Fi),{singleton:!0}),Hie=Et(([{viewportHeight:e},{totalListHeight:t}])=>{const n=ke(!1),s=as(fe(En(n,e,t),Ye(([r])=>r),Pe(([,r,a])=>Math.max(0,r-a)),ba(0),Yt()),0);return{alignToBottom:n,paddingTopAddition:s}},Jt(us,k4),{singleton:!0}),ay=Et(([{scrollTo:e,scrollContainerState:t}])=>{const n=mt(),s=mt(),r=mt(),a=ke(!1),i=ke(void 0);return $e(fe(En(n,s),Pe(([{viewportHeight:c,scrollTop:d,scrollHeight:u},{offsetTop:h}])=>({scrollTop:Math.max(0,d-h),scrollHeight:u,viewportHeight:c}))),t),$e(fe(e,ct(s),Pe(([c,{offsetTop:d}])=>({...c,top:c.top+d}))),r),{useWindowScroll:a,customScrollParent:i,windowScrollContainerState:n,windowViewportRect:s,windowScrollTo:r}},Jt(us)),Wie=({itemTop:e,itemBottom:t,viewportTop:n,viewportBottom:s,locationParams:{behavior:r,align:a,...i}})=>e<n?{...i,behavior:r,align:a??"start"}:t>s?{...i,behavior:r,align:a??"end"}:null,Gie=Et(([{sizes:e,totalCount:t,gap:n},{scrollTop:s,viewportHeight:r,headerHeight:a,fixedHeaderHeight:i,fixedFooterHeight:c,scrollingInProgress:d},{scrollToIndex:u}])=>{const h=mt();return $e(fe(h,ct(e,r,t,a,i,c,s),ct(n),Pe(([[p,f,m,g,x,C,y,v],I])=>{const{done:k,behavior:M,align:_,calculateViewLocation:A=Wie,...D}=p,N=b4(p,f,g-1),P=Ld(N,f.offsetTree,I)+x+C,z=P+Ro(f.sizeTree,N)[1],W=v+C,X=v+m-y,ee=A({itemTop:P,itemBottom:z,viewportTop:W,viewportBottom:X,locationParams:{behavior:M,align:_,...D}});return ee?k&&cr(fe(d,Ye(G=>G===!1),Jl(Zn(d)?1:2)),k):k&&k(),ee}),Ye(p=>p!==null)),u),{scrollIntoView:h}},Jt(yr,us,Du,Fi,Va),{singleton:!0}),Uie=Et(([{sizes:e,sizeRanges:t},{scrollTop:n,headerHeight:s},{initialTopMostItemIndex:r},{didMount:a},{useWindowScroll:i,windowScrollContainerState:c,windowViewportRect:d}])=>{const u=mt(),h=ke(void 0),p=ke(null),f=ke(null);return $e(c,p),$e(d,f),_t(fe(u,ct(e,n,i,p,f,s)),([m,g,x,C,y,v,I])=>{const k=_ie(g.sizeTree);C&&y!==null&&v!==null&&(x=y.scrollTop-v.offsetTop),x-=I,m({ranges:k,scrollTop:x})}),$e(fe(h,Ye(J1),Pe(Zie)),r),$e(fe(a,ct(h),Ye(([,m])=>m!==void 0),Yt(),Pe(([,m])=>m.ranges)),t),{getState:u,restoreStateFrom:h}},Jt(yr,us,Nu,Ha,ay));function Zie(e){return{offset:e.scrollTop,index:0,align:"start"}}const qie=Et(([e,t,n,s,r,a,i,c,d,u])=>({...e,...t,...n,...s,...r,...a,...i,...c,...d,...u}),Jt(ry,Bie,Ha,S4,k4,Vie,Hie,ay,Gie,Va)),Kie=Et(([{totalCount:e,sizeRanges:t,fixedItemSize:n,defaultItemSize:s,trackItemSizes:r,itemSize:a,data:i,firstItemIndex:c,groupIndices:d,statefulTotalCount:u,gap:h,sizes:p},{initialTopMostItemIndex:f,scrolledToInitialItem:m,initialItemFinalLocationReached:g},x,C,y,{listState:v,topItemsIndexes:I,...k},{scrollToIndex:M},_,{topItemCount:A},{groupCounts:D},N])=>($e(k.rangeChanged,N.scrollSeekRangeChanged),$e(fe(N.windowViewportRect,Pe(P=>P.visibleHeight)),x.viewportHeight),{totalCount:e,data:i,firstItemIndex:c,sizeRanges:t,initialTopMostItemIndex:f,scrolledToInitialItem:m,initialItemFinalLocationReached:g,topItemsIndexes:I,topItemCount:A,groupCounts:D,fixedItemHeight:n,defaultItemHeight:s,gap:h,...y,statefulTotalCount:u,listState:v,scrollToIndex:M,trackItemSizes:r,itemSize:a,groupIndices:d,...k,...N,...x,sizes:p,...C}),Jt(yr,Nu,us,Uie,Die,Fi,Du,zie,$ie,C4,qie)),cg="-webkit-sticky",x2="sticky",_4=I4(()=>{if(typeof document>"u")return x2;const e=document.createElement("div");return e.style.position=cg,e.style.position===cg?cg:x2});function M4(e,t,n){const s=te.useRef(null),r=te.useCallback(d=>{if(d===null||!d.offsetParent)return;const u=d.getBoundingClientRect(),h=u.width;let p,f;if(t){const m=t.getBoundingClientRect(),g=u.top-m.top;p=m.height-Math.max(0,g),f=g+t.scrollTop}else p=window.innerHeight-Math.max(0,u.top),f=u.top+window.pageYOffset;s.current={offsetTop:f,visibleHeight:p,visibleWidth:h},e(s.current)},[e,t]),{callbackRef:a,ref:i}=ey(r,!0,n),c=te.useCallback(()=>{r(i.current)},[r,i]);return te.useEffect(()=>{if(t){t.addEventListener("scroll",c);const d=new ResizeObserver(()=>{requestAnimationFrame(c)});return d.observe(t),()=>{t.removeEventListener("scroll",c),d.unobserve(t)}}else return window.addEventListener("scroll",c),window.addEventListener("resize",c),()=>{window.removeEventListener("scroll",c),window.removeEventListener("resize",c)}},[c,t]),a}const A4=te.createContext(void 0),E4=te.createContext(void 0);function L4(e){return e}const Qie=Et(()=>{const e=ke(d=>`Item ${d}`),t=ke(null),n=ke(d=>`Group ${d}`),s=ke({}),r=ke(L4),a=ke("div"),i=ke($c),c=(d,u=null)=>as(fe(s,Pe(h=>h[d]),Yt()),u);return{context:t,itemContent:e,groupContent:n,components:s,computeItemKey:r,HeaderFooterTag:a,scrollerRef:i,FooterComponent:c("Footer"),HeaderComponent:c("Header"),TopItemListComponent:c("TopItemList"),ListComponent:c("List","div"),ItemComponent:c("Item","div"),GroupComponent:c("Group","div"),ScrollerComponent:c("Scroller","div"),EmptyPlaceholder:c("EmptyPlaceholder"),ScrollSeekPlaceholder:c("ScrollSeekPlaceholder")}}),Yie=Et(([e,t])=>({...e,...t}),Jt(Kie,Qie)),Jie=({height:e})=>o.jsx("div",{style:{height:e}}),Xie={position:_4(),zIndex:1,overflowAnchor:"none"},T4={overflowAnchor:"none"},ele={...T4,display:"inline-block",height:"100%"},b2=te.memo(function({showTopList:t=!1}){const n=nt("listState"),s=oo("sizeRanges"),r=nt("useWindowScroll"),a=nt("customScrollParent"),i=oo("windowScrollContainerState"),c=oo("scrollContainerState"),d=a||r?i:c,u=nt("itemContent"),h=nt("context"),p=nt("groupContent"),f=nt("trackItemSizes"),m=nt("itemSize"),g=nt("log"),x=oo("gap"),C=nt("horizontalDirection"),{callbackRef:y}=mie(s,m,f,t?$c:d,g,x,a,C,nt("skipAnimationFrameInResizeObserver")),[v,I]=te.useState(0);iy("deviation",G=>{v!==G&&I(G)});const k=nt("EmptyPlaceholder"),M=nt("ScrollSeekPlaceholder")||Jie,_=nt("ListComponent"),A=nt("ItemComponent"),D=nt("GroupComponent"),N=nt("computeItemKey"),P=nt("isSeeking"),z=nt("groupIndices").length>0,W=nt("alignToBottom"),X=nt("initialItemFinalLocationReached"),ee=t?{}:{boxSizing:"border-box",...C?{whiteSpace:"nowrap",display:"inline-block",height:"100%",paddingLeft:n.offsetTop,paddingRight:n.offsetBottom,marginLeft:v!==0?v:W?"auto":0}:{marginTop:v!==0?v:W?"auto":0,paddingTop:n.offsetTop,paddingBottom:n.offsetBottom},...X?{}:{visibility:"hidden"}};return!t&&n.totalCount===0&&k?o.jsx(k,{...ns(k,h)}):o.jsx(_,{...ns(_,h),ref:y,style:ee,"data-testid":t?"virtuoso-top-item-list":"virtuoso-item-list",children:(t?n.topItems:n.items).map(G=>{const re=G.originalIndex,le=N(re+n.firstItemIndex,G.data,h);return P?l.createElement(M,{...ns(M,h),key:le,index:G.index,height:G.size,type:G.type||"item",...G.type==="group"?{}:{groupIndex:G.groupIndex}}):G.type==="group"?l.createElement(D,{...ns(D,h),key:le,"data-index":re,"data-known-size":G.size,"data-item-index":G.index,style:Xie},p(G.index,h)):l.createElement(A,{...ns(A,h),...ole(A,G.data),key:le,"data-index":re,"data-known-size":G.size,"data-item-index":G.index,"data-item-group-index":G.groupIndex,style:C?ele:T4},z?u(G.index,G.groupIndex,G.data,h):u(G.index,G.data,h))})})}),tle={height:"100%",outline:"none",overflowY:"auto",position:"relative",WebkitOverflowScrolling:"touch"},nle={outline:"none",overflowX:"auto",position:"relative"},um=e=>({width:"100%",height:"100%",position:"absolute",top:0,...e?{display:"flex",flexDirection:"column"}:{}}),sle={width:"100%",position:_4(),top:0,zIndex:1};function ns(e,t){if(typeof e!="string")return{context:t}}function ole(e,t){return{item:typeof e=="string"?void 0:t}}const rle=te.memo(function(){const t=nt("HeaderComponent"),n=oo("headerHeight"),s=nt("HeaderFooterTag"),r=$i(te.useMemo(()=>i=>n(Aa(i,"height")),[n]),!0,nt("skipAnimationFrameInResizeObserver")),a=nt("context");return t?o.jsx(s,{ref:r,children:o.jsx(t,{...ns(t,a)})}):null}),ale=te.memo(function(){const t=nt("FooterComponent"),n=oo("footerHeight"),s=nt("HeaderFooterTag"),r=$i(te.useMemo(()=>i=>n(Aa(i,"height")),[n]),!0,nt("skipAnimationFrameInResizeObserver")),a=nt("context");return t?o.jsx(s,{ref:r,children:o.jsx(t,{...ns(t,a)})}):null});function P4({usePublisher:e,useEmitter:t,useEmitterValue:n}){return te.memo(function({style:a,children:i,...c}){const d=e("scrollContainerState"),u=n("ScrollerComponent"),h=e("smoothScrollTargetReached"),p=n("scrollerRef"),f=n("context"),m=n("horizontalDirection")||!1,{scrollerRef:g,scrollByCallback:x,scrollToCallback:C}=u4(d,h,u,p,void 0,m);t("scrollTo",C),t("scrollBy",x);const y=m?nle:tle;return o.jsx(u,{ref:g,style:{...y,...a},"data-testid":"virtuoso-scroller","data-virtuoso-scroller":!0,tabIndex:0,...c,...ns(u,f),children:i})})}function R4({usePublisher:e,useEmitter:t,useEmitterValue:n}){return te.memo(function({style:a,children:i,...c}){const d=e("windowScrollContainerState"),u=n("ScrollerComponent"),h=e("smoothScrollTargetReached"),p=n("totalListHeight"),f=n("deviation"),m=n("customScrollParent"),g=n("context"),{scrollerRef:x,scrollByCallback:C,scrollToCallback:y}=u4(d,h,u,$c,m);return c4(()=>(x.current=m||window,()=>{x.current=null}),[x,m]),t("windowScrollTo",y),t("scrollBy",C),o.jsx(u,{style:{position:"relative",...a,...p!==0?{height:p+f}:{}},"data-virtuoso-scroller":!0,...c,...ns(u,g),children:i})})}const ile=({children:e})=>{const t=te.useContext(A4),n=oo("viewportHeight"),s=oo("fixedItemHeight"),r=nt("alignToBottom"),a=nt("horizontalDirection"),i=te.useMemo(()=>r4(n,d=>Aa(d,a?"width":"height")),[n,a]),c=$i(i,!0,nt("skipAnimationFrameInResizeObserver"));return te.useEffect(()=>{t&&(n(t.viewportHeight),s(t.itemHeight))},[t,n,s]),o.jsx("div",{style:um(r),ref:c,"data-viewport-type":"element",children:e})},lle=({children:e})=>{const t=te.useContext(A4),n=oo("windowViewportRect"),s=oo("fixedItemHeight"),r=nt("customScrollParent"),a=M4(n,r,nt("skipAnimationFrameInResizeObserver")),i=nt("alignToBottom");return te.useEffect(()=>{t&&(s(t.itemHeight),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:100}))},[t,n,s]),o.jsx("div",{ref:a,style:um(i),"data-viewport-type":"window",children:e})},cle=({children:e})=>{const t=nt("TopItemListComponent")||"div",n=nt("headerHeight"),s={...sle,marginTop:`${n}px`},r=nt("context");return o.jsx(t,{style:s,...ns(t,r),children:e})},dle=te.memo(function(t){const n=nt("useWindowScroll"),s=nt("topItemsIndexes").length>0,r=nt("customScrollParent"),a=r||n?ple:hle,i=r||n?lle:ile;return o.jsxs(a,{...t,children:[s&&o.jsx(cle,{children:o.jsx(b2,{showTopList:!0})}),o.jsxs(i,{children:[o.jsx(rle,{}),o.jsx(b2,{}),o.jsx(ale,{})]})]})}),{Component:ule,usePublisher:oo,useEmitterValue:nt,useEmitter:iy}=l4(Yie,{required:{},optional:{restoreStateFrom:"restoreStateFrom",context:"context",followOutput:"followOutput",itemContent:"itemContent",groupContent:"groupContent",overscan:"overscan",increaseViewportBy:"increaseViewportBy",totalCount:"totalCount",groupCounts:"groupCounts",topItemCount:"topItemCount",firstItemIndex:"firstItemIndex",initialTopMostItemIndex:"initialTopMostItemIndex",components:"components",atBottomThreshold:"atBottomThreshold",atTopThreshold:"atTopThreshold",computeItemKey:"computeItemKey",defaultItemHeight:"defaultItemHeight",fixedItemHeight:"fixedItemHeight",itemSize:"itemSize",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"HeaderFooterTag",data:"data",initialItemCount:"initialItemCount",initialScrollTop:"initialScrollTop",alignToBottom:"alignToBottom",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",horizontalDirection:"horizontalDirection",skipAnimationFrameInResizeObserver:"skipAnimationFrameInResizeObserver"},methods:{scrollToIndex:"scrollToIndex",scrollIntoView:"scrollIntoView",scrollTo:"scrollTo",scrollBy:"scrollBy",autoscrollToBottom:"autoscrollToBottom",getState:"getState"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",totalListHeightChanged:"totalListHeightChanged",itemsRendered:"itemsRendered",groupIndices:"groupIndices"}},dle),hle=P4({usePublisher:oo,useEmitterValue:nt,useEmitter:iy}),ple=R4({usePublisher:oo,useEmitterValue:nt,useEmitter:iy}),fle=ule,y2={items:[],offsetBottom:0,offsetTop:0,top:0,bottom:0,itemHeight:0,itemWidth:0},mle={items:[{index:0}],offsetBottom:0,offsetTop:0,top:0,bottom:0,itemHeight:0,itemWidth:0},{round:v2,ceil:C2,floor:Ep,min:dg,max:md}=Math;function gle(e){return{...mle,items:e}}function w2(e,t,n){return Array.from({length:t-e+1}).map((s,r)=>{const a=n===null?null:n[r+e];return{index:r+e,data:a}})}function xle(e,t){return e&&e.column===t.column&&e.row===t.row}function fh(e,t){return e&&e.width===t.width&&e.height===t.height}const ble=Et(([{overscan:e,visibleRange:t,listBoundary:n},{scrollTop:s,viewportHeight:r,scrollBy:a,scrollTo:i,smoothScrollTargetReached:c,scrollContainerState:d,footerHeight:u,headerHeight:h},p,f,{propsReady:m,didMount:g},{windowViewportRect:x,useWindowScroll:C,customScrollParent:y,windowScrollContainerState:v,windowScrollTo:I},k])=>{const M=ke(0),_=ke(0),A=ke(y2),D=ke({height:0,width:0}),N=ke({height:0,width:0}),P=mt(),z=mt(),W=ke(0),X=ke(null),ee=ke({row:0,column:0}),G=mt(),re=mt(),le=ke(!1),Ce=ke(0),be=ke(!0),ye=ke(!1),ne=ke(!1);_t(fe(g,ct(Ce),Ye(([$,Y])=>!!Y)),()=>{lt(be,!1)}),_t(fe(En(g,be,N,D,Ce,ye),Ye(([$,Y,ae,ue,,Re])=>$&&!Y&&ae.height!==0&&ue.height!==0&&!Re)),([,,,,$])=>{lt(ye,!0),sy(1,()=>{lt(P,$)}),cr(fe(s),()=>{lt(n,[0,0]),lt(be,!0)})}),$e(fe(re,Ye($=>$!=null&&$.scrollTop>0),qo(0)),_),_t(fe(g,ct(re),Ye(([,$])=>$!=null)),([,$])=>{$&&(lt(D,$.viewport),lt(N,$==null?void 0:$.item),lt(ee,$.gap),$.scrollTop>0&&(lt(le,!0),cr(fe(s,Jl(1)),Y=>{lt(le,!1)}),lt(i,{top:$.scrollTop})))}),$e(fe(D,Pe(({height:$})=>$)),r),$e(fe(En(Qe(D,fh),Qe(N,fh),Qe(ee,($,Y)=>$&&$.column===Y.column&&$.row===Y.row),Qe(s)),Pe(([$,Y,ae,ue])=>({viewport:$,item:Y,gap:ae,scrollTop:ue}))),G),$e(fe(En(Qe(M),t,Qe(ee,xle),Qe(N,fh),Qe(D,fh),Qe(X),Qe(_),Qe(le),Qe(be),Qe(Ce)),Ye(([,,,,,,,$])=>!$),Pe(([$,[Y,ae],ue,Re,we,De,Me,,ht,st])=>{const{row:We,column:T}=ue,{height:H,width:q}=Re,{width:de}=we;if(Me===0&&($===0||de===0))return y2;if(q===0){const Fn=oy(st,$),_s=Math.max(Fn+Me-1,0);return gle(w2(Fn,_s,De))}const ce=D4(de,q,T);let ie,J;ht?Y===0&&ae===0&&Me>0?(ie=0,J=Me-1):(ie=ce*Ep((Y+We)/(H+We)),J=ce*C2((ae+We)/(H+We))-1,J=dg($-1,md(J,ce-1)),ie=dg(J,md(0,ie))):(ie=0,J=-1);const ge=w2(ie,J,De),{top:Ue,bottom:Ke}=j2(we,ue,Re,ge),vt=C2($/ce),an=vt*H+(vt-1)*We-Ke;return{items:ge,offsetTop:Ue,offsetBottom:an,top:Ue,bottom:Ke,itemHeight:H,itemWidth:q}})),A),$e(fe(X,Ye($=>$!==null),Pe($=>$.length)),M),$e(fe(En(D,N,A,ee),Ye(([$,Y,{items:ae}])=>ae.length>0&&Y.height!==0&&$.height!==0),Pe(([$,Y,{items:ae},ue])=>{const{top:Re,bottom:we}=j2($,ue,Y,ae);return[Re,we]}),Yt(Pd)),n);const R=ke(!1);$e(fe(s,ct(R),Pe(([$,Y])=>Y||$!==0)),R);const F=zs(fe(Qe(A),Ye(({items:$})=>$.length>0),ct(M,R),Ye(([{items:$},Y,ae])=>ae&&$[$.length-1].index===Y-1),Pe(([,$])=>$-1),Yt())),Z=zs(fe(Qe(A),Ye(({items:$})=>$.length>0&&$[0].index===0),qo(0),Yt())),B=zs(fe(Qe(A),ct(le),Ye(([{items:$},Y])=>$.length>0&&!Y),Pe(([{items:$}])=>({startIndex:$[0].index,endIndex:$[$.length-1].index})),Yt(w4),ba(0)));$e(B,f.scrollSeekRangeChanged),$e(fe(P,ct(D,N,M,ee),Pe(([$,Y,ae,ue,Re])=>{const we=v4($),{align:De,behavior:Me,offset:ht}=we;let st=we.index;st==="LAST"&&(st=ue-1),st=md(0,st,dg(ue-1,st));let We=W0(Y,Re,ae,st);return De==="end"?We=v2(We-Y.height+ae.height):De==="center"&&(We=v2(We-Y.height/2+ae.height/2)),ht&&(We+=ht),{top:We,behavior:Me}})),i);const K=as(fe(A,Pe($=>$.offsetBottom+$.bottom)),0);return $e(fe(x,Pe($=>({width:$.visibleWidth,height:$.visibleHeight}))),D),{data:X,totalCount:M,viewportDimensions:D,itemDimensions:N,scrollTop:s,scrollHeight:z,overscan:e,scrollBy:a,scrollTo:i,scrollToIndex:P,smoothScrollTargetReached:c,windowViewportRect:x,windowScrollTo:I,useWindowScroll:C,customScrollParent:y,windowScrollContainerState:v,deviation:W,scrollContainerState:d,footerHeight:u,headerHeight:h,initialItemCount:_,gap:ee,restoreStateFrom:re,...f,initialTopMostItemIndex:Ce,horizontalDirection:ne,gridState:A,totalListHeight:K,...p,startReached:Z,endReached:F,rangeChanged:B,stateChanged:G,propsReady:m,stateRestoreInProgress:le,...k}},Jt(ry,us,Ou,S4,Ha,ay,Va));function j2(e,t,n,s){const{height:r}=n;if(r===void 0||s.length===0)return{top:0,bottom:0};const a=W0(e,t,n,s[0].index),i=W0(e,t,n,s[s.length-1].index)+r;return{top:a,bottom:i}}function W0(e,t,n,s){const r=D4(e.width,n.width,t.column),a=Ep(s/r),i=a*n.height+md(0,a-1)*t.row;return i>0?i+t.row:i}function D4(e,t,n){return md(1,Ep((e+n)/(Ep(t)+n)))}const yle=Et(()=>{const e=ke(p=>`Item ${p}`),t=ke({}),n=ke(null),s=ke("virtuoso-grid-item"),r=ke("virtuoso-grid-list"),a=ke(L4),i=ke("div"),c=ke($c),d=(p,f=null)=>as(fe(t,Pe(m=>m[p]),Yt()),f),u=ke(!1),h=ke(!1);return $e(Qe(h),u),{readyStateChanged:u,reportReadyState:h,context:n,itemContent:e,components:t,computeItemKey:a,itemClassName:s,listClassName:r,headerFooterTag:i,scrollerRef:c,FooterComponent:d("Footer"),HeaderComponent:d("Header"),ListComponent:d("List","div"),ItemComponent:d("Item","div"),ScrollerComponent:d("Scroller","div"),ScrollSeekPlaceholder:d("ScrollSeekPlaceholder","div")}}),vle=Et(([e,t])=>({...e,...t}),Jt(ble,yle)),Cle=te.memo(function(){const t=en("gridState"),n=en("listClassName"),s=en("itemClassName"),r=en("itemContent"),a=en("computeItemKey"),i=en("isSeeking"),c=ro("scrollHeight"),d=en("ItemComponent"),u=en("ListComponent"),h=en("ScrollSeekPlaceholder"),p=en("context"),f=ro("itemDimensions"),m=ro("gap"),g=en("log"),x=en("stateRestoreInProgress"),C=ro("reportReadyState"),y=$i(te.useMemo(()=>v=>{const I=v.parentElement.parentElement.scrollHeight;c(I);const k=v.firstChild;if(k){const{width:M,height:_}=k.getBoundingClientRect();f({width:M,height:_})}m({row:S2("row-gap",getComputedStyle(v).rowGap,g),column:S2("column-gap",getComputedStyle(v).columnGap,g)})},[c,f,m,g]),!0,!1);return c4(()=>{t.itemHeight>0&&t.itemWidth>0&&C(!0)},[t]),x?null:o.jsx(u,{ref:y,className:n,...ns(u,p),style:{paddingTop:t.offsetTop,paddingBottom:t.offsetBottom},"data-testid":"virtuoso-item-list",children:t.items.map(v=>{const I=a(v.index,v.data,p);return i?o.jsx(h,{...ns(h,p),index:v.index,height:t.itemHeight,width:t.itemWidth},I):l.createElement(d,{...ns(d,p),className:s,"data-index":v.index,key:I},r(v.index,v.data,p))})})}),wle=te.memo(function(){const t=en("HeaderComponent"),n=ro("headerHeight"),s=en("headerFooterTag"),r=$i(te.useMemo(()=>i=>n(Aa(i,"height")),[n]),!0,!1),a=en("context");return t?o.jsx(s,{ref:r,children:o.jsx(t,{...ns(t,a)})}):null}),jle=te.memo(function(){const t=en("FooterComponent"),n=ro("footerHeight"),s=en("headerFooterTag"),r=$i(te.useMemo(()=>i=>n(Aa(i,"height")),[n]),!0,!1),a=en("context");return t?o.jsx(s,{ref:r,children:o.jsx(t,{...ns(t,a)})}):null}),Sle=({children:e})=>{const t=te.useContext(E4),n=ro("itemDimensions"),s=ro("viewportDimensions"),r=$i(te.useMemo(()=>a=>{s(a.getBoundingClientRect())},[s]),!0,!1);return te.useEffect(()=>{t&&(s({height:t.viewportHeight,width:t.viewportWidth}),n({height:t.itemHeight,width:t.itemWidth}))},[t,s,n]),o.jsx("div",{style:um(!1),ref:r,children:e})},kle=({children:e})=>{const t=te.useContext(E4),n=ro("windowViewportRect"),s=ro("itemDimensions"),r=en("customScrollParent"),a=M4(n,r,!1);return te.useEffect(()=>{t&&(s({height:t.itemHeight,width:t.itemWidth}),n({offsetTop:0,visibleHeight:t.viewportHeight,visibleWidth:t.viewportWidth}))},[t,n,s]),o.jsx("div",{ref:a,style:um(!1),children:e})},Ile=te.memo(function({...t}){const n=en("useWindowScroll"),s=en("customScrollParent"),r=s||n?Mle:_le,a=s||n?kle:Sle;return o.jsx(r,{...t,children:o.jsxs(a,{children:[o.jsx(wle,{}),o.jsx(Cle,{}),o.jsx(jle,{})]})})}),{Component:ege,usePublisher:ro,useEmitterValue:en,useEmitter:O4}=l4(vle,{optional:{context:"context",totalCount:"totalCount",overscan:"overscan",itemContent:"itemContent",components:"components",computeItemKey:"computeItemKey",data:"data",initialItemCount:"initialItemCount",scrollSeekConfiguration:"scrollSeekConfiguration",headerFooterTag:"headerFooterTag",listClassName:"listClassName",itemClassName:"itemClassName",useWindowScroll:"useWindowScroll",customScrollParent:"customScrollParent",scrollerRef:"scrollerRef",logLevel:"logLevel",restoreStateFrom:"restoreStateFrom",initialTopMostItemIndex:"initialTopMostItemIndex"},methods:{scrollTo:"scrollTo",scrollBy:"scrollBy",scrollToIndex:"scrollToIndex"},events:{isScrolling:"isScrolling",endReached:"endReached",startReached:"startReached",rangeChanged:"rangeChanged",atBottomStateChange:"atBottomStateChange",atTopStateChange:"atTopStateChange",stateChanged:"stateChanged",readyStateChanged:"readyStateChanged"}},Ile),_le=P4({usePublisher:ro,useEmitterValue:en,useEmitter:O4}),Mle=R4({usePublisher:ro,useEmitterValue:en,useEmitter:O4});function S2(e,t,n){return t!=="normal"&&!(t!=null&&t.endsWith("px"))&&n(`${e} was not resolved to pixel value correctly`,t,Vs.WARN),t==="normal"?0:parseInt(t??"0",10)}const k2={pending:{colorScheme:"cyan",translationKey:"queue.pending"},in_progress:{colorScheme:"yellow",translationKey:"queue.in_progress"},completed:{colorScheme:"green",translationKey:"queue.completed"},failed:{colorScheme:"red",translationKey:"queue.failed"},canceled:{colorScheme:"orange",translationKey:"queue.canceled"}},Ale=({status:e})=>{const{t}=S();return o.jsx(Rn,{colorScheme:k2[e].colorScheme,children:t(k2[e].translationKey)})},Ele=l.memo(Ale),N4=e=>{const{t}=S();return t(e==="canvas"?"queue.canvas":e==="gallery"?"queue.gallery":"queue.other")},B4=e=>{const{t}=S();return t(e==="generation"?"queue.generation":e==="workflows"?"queue.workflows":e==="upscaling"?"queue.upscaling":"queue.other")},$4=e=>{const t=se(On),[n,{isLoading:s}]=jx(),{t:r}=S();return{cancelQueueItem:l.useCallback(async()=>{try{await n(e).unwrap(),he({id:"QUEUE_CANCEL_SUCCEEDED",title:r("queue.cancelSucceeded"),status:"success"})}catch{he({id:"QUEUE_CANCEL_FAILED",title:r("queue.cancelFailed"),status:"error"})}},[e,r,n]),isLoading:s,isDisabled:!t}},F4=(e,t)=>Number(((Date.parse(t)-Date.parse(e))/1e3).toFixed(2)),ys={number:"3rem",statusBadge:"5.7rem",statusDot:2,time:"4rem",origin:"5rem",destination:"6rem",batchId:"5rem",fieldValues:"auto",actions:"auto"},Lle=e=>{const t=se(On),{isCanceled:n}=kF({batch_id:e},{selectFromResult:({data:c})=>c?{isCanceled:(c==null?void 0:c.in_progress)===0&&(c==null?void 0:c.pending)===0}:{isCanceled:!0}}),[s,{isLoading:r}]=IF({fixedCacheKey:"cancelByBatchIds"}),{t:a}=S();return{cancelBatch:l.useCallback(async()=>{if(!n)try{await s({batch_ids:[e]}).unwrap(),he({id:"CANCEL_BATCH_SUCCEEDED",title:a("queue.cancelBatchSucceeded"),status:"success"})}catch{he({id:"CANCEL_BATCH_FAILED",title:a("queue.cancelBatchFailed"),status:"error"})}},[e,n,a,s]),isLoading:r,isCanceled:n,isDisabled:!t}},Tle=({queueItemDTO:e})=>{const{session_id:t,batch_id:n,item_id:s,origin:r,destination:a}=e,{t:i}=S(),{cancelBatch:c,isLoading:d,isCanceled:u}=Lle(n),{cancelQueueItem:h,isLoading:p}=$4(s),{data:f}=_F(s),m=B4(r),g=N4(a),x=l.useMemo(()=>{if(!f)return i("common.loading");if(!f.completed_at||!f.started_at)return i(`queue.${f.status}`);const C=F4(f.started_at,f.completed_at);return f.status==="completed"?`${i("queue.completedIn")} ${C}${C===1?"":"s"}`:`${C}s`},[f,i]);return o.jsxs(j,{layerStyle:"third",flexDir:"column",p:2,pt:0,borderRadius:"base",gap:2,children:[o.jsxs(j,{layerStyle:"second",p:2,gap:2,justifyContent:"space-between",alignItems:"center",borderRadius:"base",h:20,children:[o.jsx(Ji,{label:i("queue.status"),data:x}),o.jsx(Ji,{label:i("queue.origin"),data:m}),o.jsx(Ji,{label:i("queue.destination"),data:g}),o.jsx(Ji,{label:i("queue.item"),data:s}),o.jsx(Ji,{label:i("queue.batch"),data:n}),o.jsx(Ji,{label:i("queue.session"),data:t}),o.jsxs(Tn,{size:"xs",orientation:"vertical",children:[o.jsx(me,{onClick:h,isLoading:p,isDisabled:f?["canceled","completed","failed"].includes(f.status):!0,"aria-label":i("queue.cancelItem"),leftIcon:o.jsx(sn,{}),colorScheme:"error",children:i("queue.cancelItem")}),o.jsx(me,{onClick:c,isLoading:d,isDisabled:u,"aria-label":i("queue.cancelBatch"),leftIcon:o.jsx(sn,{}),colorScheme:"error",children:i("queue.cancelBatch")})]})]}),((f==null?void 0:f.error_traceback)||(f==null?void 0:f.error_message))&&o.jsxs(j,{layerStyle:"second",p:3,gap:1,justifyContent:"space-between",alignItems:"flex-start",borderRadius:"base",flexDir:"column",children:[o.jsx(Ct,{size:"sm",color:"error.400",children:i("common.error")}),o.jsx("pre",{children:(f==null?void 0:f.error_traceback)||(f==null?void 0:f.error_message)})]}),o.jsx(j,{layerStyle:"second",h:512,w:"full",borderRadius:"base",alignItems:"center",justifyContent:"center",children:f?o.jsx(Wr,{label:"Queue Item",data:f,extraCopyActions:[{label:"Graph",getData:C=>fx(C,"session.graph")}]}):o.jsx(pr,{opacity:.5})})]})},Ple=l.memo(Tle),Ji=({label:e,data:t})=>o.jsxs(j,{flexDir:"column",justifyContent:"flex-start",p:1,gap:1,overflow:"hidden",h:"full",w:"full",children:[o.jsx(Ct,{size:"md",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:e}),o.jsx(O,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",children:t})]}),I2={bg:"base.700"},Rle={_hover:I2,"&[aria-selected='true']":I2},Dle=({index:e,item:t,context:n})=>{const{t:s}=S(),r=l.useCallback(()=>{n.toggleQueueItem(t.item_id)},[n,t.item_id]),{cancelQueueItem:a,isLoading:i}=$4(t.item_id),c=l.useCallback(g=>{g.stopPropagation(),a()},[a]),d=l.useMemo(()=>n.openQueueItems.includes(t.item_id),[n.openQueueItems,t.item_id]),u=l.useMemo(()=>!t.completed_at||!t.started_at?void 0:`${F4(t.started_at,t.completed_at)}s`,[t]),h=l.useMemo(()=>["canceled","completed","failed"].includes(t.status),[t.status]),p=B4(t.origin),f=N4(t.destination),m=l.useMemo(()=>o.jsx(sn,{}),[]);return o.jsxs(j,{flexDir:"column","aria-selected":d,fontSize:"sm",borderRadius:"base",justifyContent:"center",sx:Rle,"data-testid":"queue-item",children:[o.jsxs(j,{minH:9,alignItems:"center",gap:4,p:1.5,cursor:"pointer",onClick:r,children:[o.jsx(j,{w:ys.number,justifyContent:"flex-end",alignItems:"center",flexShrink:0,children:o.jsx(O,{variant:"subtext",children:e+1})}),o.jsx(j,{w:ys.statusBadge,alignItems:"center",flexShrink:0,children:o.jsx(Ele,{status:t.status})}),o.jsx(j,{w:ys.origin,flexShrink:0,children:o.jsx(O,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:p})}),o.jsx(j,{w:ys.destination,flexShrink:0,children:o.jsx(O,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:f})}),o.jsx(j,{w:ys.time,alignItems:"center",flexShrink:0,children:u||"-"}),o.jsx(j,{w:ys.batchId,flexShrink:0,children:o.jsx(O,{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",alignItems:"center",children:t.batch_id})}),o.jsx(j,{alignItems:"center",overflow:"hidden",flexGrow:1,children:t.field_values&&o.jsx(j,{gap:2,w:"full",whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",children:t.field_values.filter(g=>g.node_path!=="metadata_accumulator").map(({node_path:g,field_name:x,value:C})=>o.jsxs(O,{as:"span",children:[o.jsxs(O,{as:"span",fontWeight:"semibold",children:[g,".",x]}),": ",C]},`${t.item_id}.${g}.${x}.${C}`))})}),o.jsx(j,{alignItems:"center",w:ys.actions,pe:3,children:o.jsx(Tn,{size:"xs",variant:"ghost",children:o.jsx(Q,{onClick:c,isDisabled:h,isLoading:i,"aria-label":s("queue.cancelItem"),icon:m})})})]}),o.jsx(Mi,{in:d,transition:Ole,unmountOnExit:!0,children:o.jsx(Ple,{queueItemDTO:t})})]})},Ole={enter:{duration:.1},exit:{duration:.1}},Nle=l.memo(Dle),z4=Gp(IS((e,t)=>o.jsx(j,{...e,ref:t,flexDirection:"column",gap:.5,children:e.children})));z4.displayName="QueueListComponent";const Ble=()=>{const{t:e}=S();return o.jsxs(j,{alignItems:"center",gap:4,p:1,pb:2,textTransform:"uppercase",fontWeight:"bold",fontSize:"sm",letterSpacing:1,children:[o.jsx(j,{w:ys.number,justifyContent:"flex-end",alignItems:"center",children:o.jsx(O,{variant:"subtext",children:"#"})}),o.jsx(j,{ps:.5,w:ys.statusBadge,alignItems:"center",children:o.jsx(O,{variant:"subtext",children:e("queue.status")})}),o.jsx(j,{ps:.5,w:ys.origin,alignItems:"center",children:o.jsx(O,{variant:"subtext",children:e("queue.origin")})}),o.jsx(j,{ps:.5,w:ys.destination,alignItems:"center",children:o.jsx(O,{variant:"subtext",children:e("queue.destination")})}),o.jsx(j,{ps:.5,w:ys.time,alignItems:"center",children:o.jsx(O,{variant:"subtext",children:e("queue.time")})}),o.jsx(j,{ps:.5,w:ys.batchId,alignItems:"center",children:o.jsx(O,{variant:"subtext",children:e("queue.batch")})}),o.jsx(j,{ps:.5,w:ys.fieldValues,alignItems:"center",children:o.jsx(O,{variant:"subtext",children:e("queue.batchFieldValues")})})]})},$le=l.memo(Ble),Fle=(e,t)=>t.item_id,zle={List:z4},Vle=(e,t,n)=>o.jsx(Nle,{index:e,item:t,context:n}),Hle=()=>{const e=w(MF),t=w(AF),n=E(),s=l.useRef(null),[r,a]=l.useState(null),[i,c]=U_(zr),{t:d}=S();l.useEffect(()=>{const{current:y}=s;return r&&y&&i({target:y,elements:{viewport:r}}),()=>{var v;return(v=c())==null?void 0:v.destroy()}},[r,i,c]);const{data:u,isLoading:h}=EF({cursor:e,priority:t}),p=l.useMemo(()=>u?LF.selectAll(u):[],[u]),f=l.useCallback(()=>{if(!(u!=null&&u.has_more))return;const y=p[p.length-1];y&&(n(Cx(y.item_id)),n(wx(y.priority)))},[n,u==null?void 0:u.has_more,p]),[m,g]=l.useState([]),x=l.useCallback(y=>{g(v=>v.includes(y)?v.filter(I=>I!==y):[...v,y])},[]),C=l.useMemo(()=>({openQueueItems:m,toggleQueueItem:x}),[m,x]);return h?o.jsx($b,{}):p.length?o.jsxs(j,{w:"full",h:"full",flexDir:"column",children:[o.jsx($le,{}),o.jsx(j,{ref:s,w:"full",h:"full",alignItems:"center",justifyContent:"center",children:o.jsx(fle,{data:p,endReached:f,scrollerRef:a,itemContent:Vle,computeItemKey:Fle,components:zle,context:C})})]}):o.jsx(j,{w:"full",h:"full",alignItems:"center",justifyContent:"center",children:o.jsx(Ct,{color:"base.500",children:d("queue.queueEmpty")})})},Wle=l.memo(Hle),Gle=()=>{const{data:e}=Oo(),{t}=S();return o.jsxs(s4,{"data-testid":"queue-status",children:[o.jsx(Zo,{label:t("queue.in_progress"),value:(e==null?void 0:e.queue.in_progress)??0}),o.jsx(Zo,{label:t("queue.pending"),value:(e==null?void 0:e.queue.pending)??0}),o.jsx(Zo,{label:t("queue.completed"),value:(e==null?void 0:e.queue.completed)??0}),o.jsx(Zo,{label:t("queue.failed"),value:(e==null?void 0:e.queue.failed)??0}),o.jsx(Zo,{label:t("queue.canceled"),value:(e==null?void 0:e.queue.canceled)??0}),o.jsx(Zo,{label:t("queue.total"),value:(e==null?void 0:e.queue.total)??0})]})},Ule=l.memo(Gle),Zle=e=>{const{t}=S(),n=pc();return o.jsx(o.Fragment,{children:o.jsx(me,{isDisabled:n.isDisabled,isLoading:n.isLoading,tooltip:t("queue.clearTooltip"),leftIcon:o.jsx(bc,{}),colorScheme:"error",onClick:n.openDialog,"data-testid":t("queue.clear"),...e,children:t("queue.clear")})})},qle=l.memo(Zle),Kle=({label:e,tooltip:t,icon:n,onClick:s,isDisabled:r,colorScheme:a,asIconButton:i,isLoading:c,loadingText:d,sx:u})=>i?o.jsx(Q,{"aria-label":e,tooltip:t,icon:n,onClick:s,isDisabled:r,colorScheme:a,isLoading:c,sx:u,"data-testid":e}):o.jsx(me,{"aria-label":e,tooltip:t,leftIcon:n,onClick:s,isDisabled:r,colorScheme:a,isLoading:c,loadingText:d??e,flexGrow:1,sx:u,"data-testid":e,children:e}),ly=l.memo(Kle),Qle=({asIconButton:e})=>{const{t}=S(),{pauseProcessor:n,isLoading:s,isDisabled:r}=HP();return o.jsx(ly,{asIconButton:e,label:t("queue.pause"),tooltip:t("queue.pauseTooltip"),isDisabled:r,isLoading:s,icon:o.jsx(XI,{}),onClick:n,colorScheme:"gold"})},Yle=l.memo(Qle),Jle=()=>{const e=E(),{t}=S(),n=se(On),[s,{isLoading:r}]=lS({fixedCacheKey:"pruneQueue"}),{finishedCount:a}=Oo(void 0,{selectFromResult:({data:d})=>d?{finishedCount:d.queue.completed+d.queue.canceled+d.queue.failed}:{finishedCount:0}}),i=l.useCallback(async()=>{if(a)try{const d=await s().unwrap();he({id:"PRUNE_SUCCEEDED",title:t("queue.pruneSucceeded",{item_count:d.deleted}),status:"success"}),e(Cx(void 0)),e(wx(void 0))}catch{he({id:"PRUNE_FAILED",title:t("queue.pruneFailed"),status:"error"})}},[a,s,e,t]),c=l.useMemo(()=>!n||!a,[a,n]);return{pruneQueue:i,isLoading:r,finishedCount:a,isDisabled:c}},Xle=({asIconButton:e})=>{const{t}=S(),{pruneQueue:n,isLoading:s,finishedCount:r,isDisabled:a}=Jle();return o.jsx(ly,{isDisabled:a,isLoading:s,asIconButton:e,label:t("queue.prune"),tooltip:t("queue.pruneTooltip",{item_count:r}),icon:o.jsx(RW,{}),onClick:n,colorScheme:"invokeBlue"})},ece=l.memo(Xle),tce=({asIconButton:e})=>{const{t}=S(),{resumeProcessor:n,isLoading:s,isDisabled:r}=WP();return o.jsx(ly,{asIconButton:e,label:t("queue.resume"),tooltip:t("queue.resumeTooltip"),isDisabled:r,isLoading:s,icon:o.jsx(e_,{}),onClick:n,colorScheme:"green"})},nce=l.memo(tce),sce=()=>{const e=dn("pauseQueue"),t=dn("resumeQueue");return o.jsxs(j,{layerStyle:"first",borderRadius:"base",p:2,gap:2,children:[e||t?o.jsxs(Tn,{w:28,orientation:"vertical",size:"sm",children:[t?o.jsx(nce,{}):o.jsx(o.Fragment,{}),e?o.jsx(Yle,{}):o.jsx(o.Fragment,{})]}):o.jsx(o.Fragment,{}),o.jsxs(Tn,{w:28,orientation:"vertical",size:"sm",children:[o.jsx(ece,{}),o.jsx(qle,{})]})]})},oce=l.memo(sce),rce=()=>{const e=dn("invocationCache"),t=w(bn);return o.jsxs(j,{display:t==="queue"?void 0:"none",hidden:t!=="queue",borderRadius:"base",w:"full",h:"full",flexDir:"column",gap:2,children:[o.jsxs(j,{gap:2,w:"full",children:[o.jsx(oce,{}),o.jsx(Ule,{}),e&&o.jsx(oie,{})]}),o.jsx(xe,{layerStyle:"first",p:2,borderRadius:"base",w:"full",h:"full",children:o.jsx(Wle,{})})]})},ace=l.memo(rce),ice=()=>o.jsx(j,{layerStyle:"body",w:"full",h:"full",children:o.jsx(ace,{})}),lce=l.memo(ice);var _2=1,cce=.9,dce=.8,uce=.17,ug=.1,hg=.999,hce=.9999,pce=.99,fce=/[\\\/_+.#"@\[\(\{&]/,mce=/[\\\/_+.#"@\[\(\{&]/g,gce=/[\s-]/,V4=/[\s-]/g;function G0(e,t,n,s,r,a,i){if(a===t.length)return r===e.length?_2:pce;var c=`${r},${a}`;if(i[c]!==void 0)return i[c];for(var d=s.charAt(a),u=n.indexOf(d,r),h=0,p,f,m,g;u>=0;)p=G0(e,t,n,s,u+1,a+1,i),p>h&&(u===r?p*=_2:fce.test(e.charAt(u-1))?(p*=dce,m=e.slice(r,u-1).match(mce),m&&r>0&&(p*=Math.pow(hg,m.length))):gce.test(e.charAt(u-1))?(p*=cce,g=e.slice(r,u-1).match(V4),g&&r>0&&(p*=Math.pow(hg,g.length))):(p*=uce,r>0&&(p*=Math.pow(hg,u-r))),e.charAt(u)!==t.charAt(a)&&(p*=hce)),(p<ug&&n.charAt(u-1)===s.charAt(a+1)||s.charAt(a+1)===s.charAt(a)&&n.charAt(u-1)!==s.charAt(a))&&(f=G0(e,t,n,s,u+1,a+2,i),f*ug>p&&(p=f*ug)),p>h&&(h=p),u=n.indexOf(d,u+1);return i[c]=h,h}function M2(e){return e.toLowerCase().replace(V4," ")}function xce(e,t,n){return e=n&&n.length>0?`${e+" "+n.join(" ")}`:e,G0(e,t,M2(e),M2(t),0,0,{})}function cs(){return cs=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var s in n)({}).hasOwnProperty.call(n,s)&&(e[s]=n[s])}return e},cs.apply(null,arguments)}function Nl(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(e==null||e(r),n===!1||!r.defaultPrevented)return t==null?void 0:t(r)}}function bce(e,t){typeof e=="function"?e(t):e!=null&&(e.current=t)}function H4(...e){return t=>e.forEach(n=>bce(n,t))}function Bu(...e){return l.useCallback(H4(...e),e)}function yce(e,t=[]){let n=[];function s(a,i){const c=l.createContext(i),d=n.length;n=[...n,i];function u(p){const{scope:f,children:m,...g}=p,x=(f==null?void 0:f[e][d])||c,C=l.useMemo(()=>g,Object.values(g));return l.createElement(x.Provider,{value:C},m)}function h(p,f){const m=(f==null?void 0:f[e][d])||c,g=l.useContext(m);if(g)return g;if(i!==void 0)return i;throw new Error(`\`${p}\` must be used within \`${a}\``)}return u.displayName=a+"Provider",[u,h]}const r=()=>{const a=n.map(i=>l.createContext(i));return function(c){const d=(c==null?void 0:c[e])||a;return l.useMemo(()=>({[`__scope${e}`]:{...c,[e]:d}}),[c,d])}};return r.scopeName=e,[s,vce(r,...t)]}function vce(...e){const t=e[0];if(e.length===1)return t;const n=()=>{const s=e.map(r=>({useScope:r(),scopeName:r.scopeName}));return function(a){const i=s.reduce((c,{useScope:d,scopeName:u})=>{const p=d(a)[`__scope${u}`];return{...c,...p}},{});return l.useMemo(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return n.scopeName=t.scopeName,n}const U0=globalThis!=null&&globalThis.document?l.useLayoutEffect:()=>{},Cce=Ux.useId||(()=>{});let wce=0;function pg(e){const[t,n]=l.useState(Cce());return U0(()=>{e||n(s=>s??String(wce++))},[e]),e||(t?`radix-${t}`:"")}function yi(e){const t=l.useRef(e);return l.useEffect(()=>{t.current=e}),l.useMemo(()=>(...n)=>{var s;return(s=t.current)===null||s===void 0?void 0:s.call(t,...n)},[])}function jce({prop:e,defaultProp:t,onChange:n=()=>{}}){const[s,r]=Sce({defaultProp:t,onChange:n}),a=e!==void 0,i=a?e:s,c=yi(n),d=l.useCallback(u=>{if(a){const p=typeof u=="function"?u(e):u;p!==e&&c(p)}else r(u)},[a,e,r,c]);return[i,d]}function Sce({defaultProp:e,onChange:t}){const n=l.useState(e),[s]=n,r=l.useRef(s),a=yi(t);return l.useEffect(()=>{r.current!==s&&(a(s),r.current=s)},[s,r,a]),n}const cy=l.forwardRef((e,t)=>{const{children:n,...s}=e,r=l.Children.toArray(n),a=r.find(Ice);if(a){const i=a.props.children,c=r.map(d=>d===a?l.Children.count(i)>1?l.Children.only(null):l.isValidElement(i)?i.props.children:null:d);return l.createElement(Z0,cs({},s,{ref:t}),l.isValidElement(i)?l.cloneElement(i,void 0,c):null)}return l.createElement(Z0,cs({},s,{ref:t}),n)});cy.displayName="Slot";const Z0=l.forwardRef((e,t)=>{const{children:n,...s}=e;return l.isValidElement(n)?l.cloneElement(n,{..._ce(s,n.props),ref:t?H4(t,n.ref):n.ref}):l.Children.count(n)>1?l.Children.only(null):null});Z0.displayName="SlotClone";const kce=({children:e})=>l.createElement(l.Fragment,null,e);function Ice(e){return l.isValidElement(e)&&e.type===kce}function _ce(e,t){const n={...t};for(const s in t){const r=e[s],a=t[s];/^on[A-Z]/.test(s)?r&&a?n[s]=(...c)=>{a(...c),r(...c)}:r&&(n[s]=r):s==="style"?n[s]={...r,...a}:s==="className"&&(n[s]=[r,a].filter(Boolean).join(" "))}return{...e,...n}}const Mce=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"],ho=Mce.reduce((e,t)=>{const n=l.forwardRef((s,r)=>{const{asChild:a,...i}=s,c=a?cy:t;return l.useEffect(()=>{window[Symbol.for("radix-ui")]=!0},[]),l.createElement(c,cs({},i,{ref:r}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function Ace(e,t){e&&Jx.flushSync(()=>e.dispatchEvent(t))}function Ece(e,t=globalThis==null?void 0:globalThis.document){const n=yi(e);l.useEffect(()=>{const s=r=>{r.key==="Escape"&&n(r)};return t.addEventListener("keydown",s),()=>t.removeEventListener("keydown",s)},[n,t])}const q0="dismissableLayer.update",Lce="dismissableLayer.pointerDownOutside",Tce="dismissableLayer.focusOutside";let A2;const Pce=l.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),Rce=l.forwardRef((e,t)=>{var n;const{disableOutsidePointerEvents:s=!1,onEscapeKeyDown:r,onPointerDownOutside:a,onFocusOutside:i,onInteractOutside:c,onDismiss:d,...u}=e,h=l.useContext(Pce),[p,f]=l.useState(null),m=(n=p==null?void 0:p.ownerDocument)!==null&&n!==void 0?n:globalThis==null?void 0:globalThis.document,[,g]=l.useState({}),x=Bu(t,D=>f(D)),C=Array.from(h.layers),[y]=[...h.layersWithOutsidePointerEventsDisabled].slice(-1),v=C.indexOf(y),I=p?C.indexOf(p):-1,k=h.layersWithOutsidePointerEventsDisabled.size>0,M=I>=v,_=Dce(D=>{const N=D.target,P=[...h.branches].some(z=>z.contains(N));!M||P||(a==null||a(D),c==null||c(D),D.defaultPrevented||d==null||d())},m),A=Oce(D=>{const N=D.target;[...h.branches].some(z=>z.contains(N))||(i==null||i(D),c==null||c(D),D.defaultPrevented||d==null||d())},m);return Ece(D=>{I===h.layers.size-1&&(r==null||r(D),!D.defaultPrevented&&d&&(D.preventDefault(),d()))},m),l.useEffect(()=>{if(p)return s&&(h.layersWithOutsidePointerEventsDisabled.size===0&&(A2=m.body.style.pointerEvents,m.body.style.pointerEvents="none"),h.layersWithOutsidePointerEventsDisabled.add(p)),h.layers.add(p),E2(),()=>{s&&h.layersWithOutsidePointerEventsDisabled.size===1&&(m.body.style.pointerEvents=A2)}},[p,m,s,h]),l.useEffect(()=>()=>{p&&(h.layers.delete(p),h.layersWithOutsidePointerEventsDisabled.delete(p),E2())},[p,h]),l.useEffect(()=>{const D=()=>g({});return document.addEventListener(q0,D),()=>document.removeEventListener(q0,D)},[]),l.createElement(ho.div,cs({},u,{ref:x,style:{pointerEvents:k?M?"auto":"none":void 0,...e.style},onFocusCapture:Nl(e.onFocusCapture,A.onFocusCapture),onBlurCapture:Nl(e.onBlurCapture,A.onBlurCapture),onPointerDownCapture:Nl(e.onPointerDownCapture,_.onPointerDownCapture)}))});function Dce(e,t=globalThis==null?void 0:globalThis.document){const n=yi(e),s=l.useRef(!1),r=l.useRef(()=>{});return l.useEffect(()=>{const a=c=>{if(c.target&&!s.current){let u=function(){W4(Lce,n,d,{discrete:!0})};const d={originalEvent:c};c.pointerType==="touch"?(t.removeEventListener("click",r.current),r.current=u,t.addEventListener("click",r.current,{once:!0})):u()}else t.removeEventListener("click",r.current);s.current=!1},i=window.setTimeout(()=>{t.addEventListener("pointerdown",a)},0);return()=>{window.clearTimeout(i),t.removeEventListener("pointerdown",a),t.removeEventListener("click",r.current)}},[t,n]),{onPointerDownCapture:()=>s.current=!0}}function Oce(e,t=globalThis==null?void 0:globalThis.document){const n=yi(e),s=l.useRef(!1);return l.useEffect(()=>{const r=a=>{a.target&&!s.current&&W4(Tce,n,{originalEvent:a},{discrete:!1})};return t.addEventListener("focusin",r),()=>t.removeEventListener("focusin",r)},[t,n]),{onFocusCapture:()=>s.current=!0,onBlurCapture:()=>s.current=!1}}function E2(){const e=new CustomEvent(q0);document.dispatchEvent(e)}function W4(e,t,n,{discrete:s}){const r=n.originalEvent.target,a=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&r.addEventListener(e,t,{once:!0}),s?Ace(r,a):r.dispatchEvent(a)}const fg="focusScope.autoFocusOnMount",mg="focusScope.autoFocusOnUnmount",L2={bubbles:!1,cancelable:!0},Nce=l.forwardRef((e,t)=>{const{loop:n=!1,trapped:s=!1,onMountAutoFocus:r,onUnmountAutoFocus:a,...i}=e,[c,d]=l.useState(null),u=yi(r),h=yi(a),p=l.useRef(null),f=Bu(t,x=>d(x)),m=l.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;l.useEffect(()=>{if(s){let x=function(I){if(m.paused||!c)return;const k=I.target;c.contains(k)?p.current=k:la(p.current,{select:!0})},C=function(I){if(m.paused||!c)return;const k=I.relatedTarget;k!==null&&(c.contains(k)||la(p.current,{select:!0}))},y=function(I){if(document.activeElement===document.body)for(const M of I)M.removedNodes.length>0&&la(c)};document.addEventListener("focusin",x),document.addEventListener("focusout",C);const v=new MutationObserver(y);return c&&v.observe(c,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",x),document.removeEventListener("focusout",C),v.disconnect()}}},[s,c,m.paused]),l.useEffect(()=>{if(c){P2.add(m);const x=document.activeElement;if(!c.contains(x)){const y=new CustomEvent(fg,L2);c.addEventListener(fg,u),c.dispatchEvent(y),y.defaultPrevented||(Bce(Hce(G4(c)),{select:!0}),document.activeElement===x&&la(c))}return()=>{c.removeEventListener(fg,u),setTimeout(()=>{const y=new CustomEvent(mg,L2);c.addEventListener(mg,h),c.dispatchEvent(y),y.defaultPrevented||la(x??document.body,{select:!0}),c.removeEventListener(mg,h),P2.remove(m)},0)}}},[c,u,h,m]);const g=l.useCallback(x=>{if(!n&&!s||m.paused)return;const C=x.key==="Tab"&&!x.altKey&&!x.ctrlKey&&!x.metaKey,y=document.activeElement;if(C&&y){const v=x.currentTarget,[I,k]=$ce(v);I&&k?!x.shiftKey&&y===k?(x.preventDefault(),n&&la(I,{select:!0})):x.shiftKey&&y===I&&(x.preventDefault(),n&&la(k,{select:!0})):y===v&&x.preventDefault()}},[n,s,m.paused]);return l.createElement(ho.div,cs({tabIndex:-1},i,{ref:f,onKeyDown:g}))});function Bce(e,{select:t=!1}={}){const n=document.activeElement;for(const s of e)if(la(s,{select:t}),document.activeElement!==n)return}function $ce(e){const t=G4(e),n=T2(t,e),s=T2(t.reverse(),e);return[n,s]}function G4(e){const t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const r=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||r?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function T2(e,t){for(const n of e)if(!Fce(n,{upTo:t}))return n}function Fce(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function zce(e){return e instanceof HTMLInputElement&&"select"in e}function la(e,{select:t=!1}={}){if(e&&e.focus){const n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&zce(e)&&t&&e.select()}}const P2=Vce();function Vce(){let e=[];return{add(t){const n=e[0];t!==n&&(n==null||n.pause()),e=R2(e,t),e.unshift(t)},remove(t){var n;e=R2(e,t),(n=e[0])===null||n===void 0||n.resume()}}}function R2(e,t){const n=[...e],s=n.indexOf(t);return s!==-1&&n.splice(s,1),n}function Hce(e){return e.filter(t=>t.tagName!=="A")}const Wce=l.forwardRef((e,t)=>{var n;const{container:s=globalThis==null||(n=globalThis.document)===null||n===void 0?void 0:n.body,...r}=e;return s?YS.createPortal(l.createElement(ho.div,cs({},r,{ref:t})),s):null});function Gce(e,t){return l.useReducer((n,s)=>{const r=t[n][s];return r??n},e)}const hm=e=>{const{present:t,children:n}=e,s=Uce(t),r=typeof n=="function"?n({present:s.isPresent}):l.Children.only(n),a=Bu(s.ref,r.ref);return typeof n=="function"||s.isPresent?l.cloneElement(r,{ref:a}):null};hm.displayName="Presence";function Uce(e){const[t,n]=l.useState(),s=l.useRef({}),r=l.useRef(e),a=l.useRef("none"),i=e?"mounted":"unmounted",[c,d]=Gce(i,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return l.useEffect(()=>{const u=mh(s.current);a.current=c==="mounted"?u:"none"},[c]),U0(()=>{const u=s.current,h=r.current;if(h!==e){const f=a.current,m=mh(u);e?d("MOUNT"):m==="none"||(u==null?void 0:u.display)==="none"?d("UNMOUNT"):d(h&&f!==m?"ANIMATION_OUT":"UNMOUNT"),r.current=e}},[e,d]),U0(()=>{if(t){const u=p=>{const m=mh(s.current).includes(p.animationName);p.target===t&&m&&Jx.flushSync(()=>d("ANIMATION_END"))},h=p=>{p.target===t&&(a.current=mh(s.current))};return t.addEventListener("animationstart",h),t.addEventListener("animationcancel",u),t.addEventListener("animationend",u),()=>{t.removeEventListener("animationstart",h),t.removeEventListener("animationcancel",u),t.removeEventListener("animationend",u)}}else d("ANIMATION_END")},[t,d]),{isPresent:["mounted","unmountSuspended"].includes(c),ref:l.useCallback(u=>{u&&(s.current=getComputedStyle(u)),n(u)},[])}}function mh(e){return(e==null?void 0:e.animationName)||"none"}let gg=0;function Zce(){l.useEffect(()=>{var e,t;const n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",(e=n[0])!==null&&e!==void 0?e:D2()),document.body.insertAdjacentElement("beforeend",(t=n[1])!==null&&t!==void 0?t:D2()),gg++,()=>{gg===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),gg--}},[])}function D2(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}var $h="right-scroll-bar-position",Fh="width-before-scroll-bar",qce="with-scroll-bars-hidden",Kce="--removed-body-scroll-bar-size";function xg(e,t){return typeof e=="function"?e(t):e&&(e.current=t),e}function Qce(e,t){var n=l.useState(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(s){var r=n.value;r!==s&&(n.value=s,n.callback(s,r))}}}})[0];return n.callback=t,n.facade}var Yce=typeof window<"u"?l.useLayoutEffect:l.useEffect,O2=new WeakMap;function Jce(e,t){var n=Qce(null,function(s){return e.forEach(function(r){return xg(r,s)})});return Yce(function(){var s=O2.get(n);if(s){var r=new Set(s),a=new Set(e),i=n.current;r.forEach(function(c){a.has(c)||xg(c,null)}),a.forEach(function(c){r.has(c)||xg(c,i)})}O2.set(n,e)},[e]),n}function Xce(e){return e}function ede(e,t){t===void 0&&(t=Xce);var n=[],s=!1,r={read:function(){if(s)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(a){var i=t(a,s);return n.push(i),function(){n=n.filter(function(c){return c!==i})}},assignSyncMedium:function(a){for(s=!0;n.length;){var i=n;n=[],i.forEach(a)}n={push:function(c){return a(c)},filter:function(){return n}}},assignMedium:function(a){s=!0;var i=[];if(n.length){var c=n;n=[],c.forEach(a),i=n}var d=function(){var h=i;i=[],h.forEach(a)},u=function(){return Promise.resolve().then(d)};u(),n={push:function(h){i.push(h),u()},filter:function(h){return i=i.filter(h),n}}}};return r}function tde(e){e===void 0&&(e={});var t=ede(null);return t.options=Qo({async:!0,ssr:!1},e),t}var U4=function(e){var t=e.sideCar,n=rI(e,["sideCar"]);if(!t)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var s=t.read();if(!s)throw new Error("Sidecar medium not found");return l.createElement(s,Qo({},n))};U4.isSideCarExport=!0;function nde(e,t){return e.useMedium(t),U4}var Z4=tde(),bg=function(){},pm=l.forwardRef(function(e,t){var n=l.useRef(null),s=l.useState({onScrollCapture:bg,onWheelCapture:bg,onTouchMoveCapture:bg}),r=s[0],a=s[1],i=e.forwardProps,c=e.children,d=e.className,u=e.removeScrollBar,h=e.enabled,p=e.shards,f=e.sideCar,m=e.noIsolation,g=e.inert,x=e.allowPinchZoom,C=e.as,y=C===void 0?"div":C,v=rI(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),I=f,k=Jce([n,t]),M=Qo(Qo({},v),r);return l.createElement(l.Fragment,null,h&&l.createElement(I,{sideCar:Z4,removeScrollBar:u,shards:p,noIsolation:m,inert:g,setCallbacks:a,allowPinchZoom:!!x,lockRef:n}),i?l.cloneElement(l.Children.only(c),Qo(Qo({},M),{ref:k})):l.createElement(y,Qo({},M,{className:d,ref:k}),c))});pm.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};pm.classNames={fullWidth:Fh,zeroRight:$h};var sde=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function ode(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=sde();return t&&e.setAttribute("nonce",t),e}function rde(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function ade(e){var t=document.head||document.getElementsByTagName("head")[0];t.appendChild(e)}var ide=function(){var e=0,t=null;return{add:function(n){e==0&&(t=ode())&&(rde(t,n),ade(t)),e++},remove:function(){e--,!e&&t&&(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},lde=function(){var e=ide();return function(t,n){l.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},q4=function(){var e=lde(),t=function(n){var s=n.styles,r=n.dynamic;return e(s,r),null};return t},cde={left:0,top:0,right:0,gap:0},yg=function(e){return parseInt(e||"",10)||0},dde=function(e){var t=window.getComputedStyle(document.body),n=t[e==="padding"?"paddingLeft":"marginLeft"],s=t[e==="padding"?"paddingTop":"marginTop"],r=t[e==="padding"?"paddingRight":"marginRight"];return[yg(n),yg(s),yg(r)]},ude=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return cde;var t=dde(e),n=document.documentElement.clientWidth,s=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,s-n+t[2]-t[0])}},hde=q4(),Bl="data-scroll-locked",pde=function(e,t,n,s){var r=e.left,a=e.top,i=e.right,c=e.gap;return n===void 0&&(n="margin"),`
  .`.concat(qce,` {
   overflow: hidden `).concat(s,`;
   padding-right: `).concat(c,"px ").concat(s,`;
  }
  body[`).concat(Bl,`] {
    overflow: hidden `).concat(s,`;
    overscroll-behavior: contain;
    `).concat([t&&"position: relative ".concat(s,";"),n==="margin"&&`
    padding-left: `.concat(r,`px;
    padding-top: `).concat(a,`px;
    padding-right: `).concat(i,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(c,"px ").concat(s,`;
    `),n==="padding"&&"padding-right: ".concat(c,"px ").concat(s,";")].filter(Boolean).join(""),`
  }
  
  .`).concat($h,` {
    right: `).concat(c,"px ").concat(s,`;
  }
  
  .`).concat(Fh,` {
    margin-right: `).concat(c,"px ").concat(s,`;
  }
  
  .`).concat($h," .").concat($h,` {
    right: 0 `).concat(s,`;
  }
  
  .`).concat(Fh," .").concat(Fh,` {
    margin-right: 0 `).concat(s,`;
  }
  
  body[`).concat(Bl,`] {
    `).concat(Kce,": ").concat(c,`px;
  }
`)},N2=function(){var e=parseInt(document.body.getAttribute(Bl)||"0",10);return isFinite(e)?e:0},fde=function(){l.useEffect(function(){return document.body.setAttribute(Bl,(N2()+1).toString()),function(){var e=N2()-1;e<=0?document.body.removeAttribute(Bl):document.body.setAttribute(Bl,e.toString())}},[])},mde=function(e){var t=e.noRelative,n=e.noImportant,s=e.gapMode,r=s===void 0?"margin":s;fde();var a=l.useMemo(function(){return ude(r)},[r]);return l.createElement(hde,{styles:pde(a,!t,r,n?"":"!important")})},K0=!1;if(typeof window<"u")try{var gh=Object.defineProperty({},"passive",{get:function(){return K0=!0,!0}});window.addEventListener("test",gh,gh),window.removeEventListener("test",gh,gh)}catch{K0=!1}var Xi=K0?{passive:!1}:!1,gde=function(e){return e.tagName==="TEXTAREA"},K4=function(e,t){var n=window.getComputedStyle(e);return n[t]!=="hidden"&&!(n.overflowY===n.overflowX&&!gde(e)&&n[t]==="visible")},xde=function(e){return K4(e,"overflowY")},bde=function(e){return K4(e,"overflowX")},B2=function(e,t){var n=t;do{typeof ShadowRoot<"u"&&n instanceof ShadowRoot&&(n=n.host);var s=Q4(e,n);if(s){var r=Y4(e,n),a=r[1],i=r[2];if(a>i)return!0}n=n.parentNode}while(n&&n!==document.body);return!1},yde=function(e){var t=e.scrollTop,n=e.scrollHeight,s=e.clientHeight;return[t,n,s]},vde=function(e){var t=e.scrollLeft,n=e.scrollWidth,s=e.clientWidth;return[t,n,s]},Q4=function(e,t){return e==="v"?xde(t):bde(t)},Y4=function(e,t){return e==="v"?yde(t):vde(t)},Cde=function(e,t){return e==="h"&&t==="rtl"?-1:1},wde=function(e,t,n,s,r){var a=Cde(e,window.getComputedStyle(t).direction),i=a*s,c=n.target,d=t.contains(c),u=!1,h=i>0,p=0,f=0;do{var m=Y4(e,c),g=m[0],x=m[1],C=m[2],y=x-C-a*g;(g||y)&&Q4(e,c)&&(p+=y,f+=g),c=c.parentNode}while(!d&&c!==document.body||d&&(t.contains(c)||t===c));return(h&&(p===0||!r)||!h&&(f===0||!r))&&(u=!0),u},xh=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},$2=function(e){return[e.deltaX,e.deltaY]},F2=function(e){return e&&"current"in e?e.current:e},jde=function(e,t){return e[0]===t[0]&&e[1]===t[1]},Sde=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},kde=0,el=[];function Ide(e){var t=l.useRef([]),n=l.useRef([0,0]),s=l.useRef(),r=l.useState(kde++)[0],a=l.useState(function(){return q4()})[0],i=l.useRef(e);l.useEffect(function(){i.current=e},[e]),l.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(r));var x=Xg([e.lockRef.current],(e.shards||[]).map(F2),!0).filter(Boolean);return x.forEach(function(C){return C.classList.add("allow-interactivity-".concat(r))}),function(){document.body.classList.remove("block-interactivity-".concat(r)),x.forEach(function(C){return C.classList.remove("allow-interactivity-".concat(r))})}}},[e.inert,e.lockRef.current,e.shards]);var c=l.useCallback(function(x,C){if("touches"in x&&x.touches.length===2)return!i.current.allowPinchZoom;var y=xh(x),v=n.current,I="deltaX"in x?x.deltaX:v[0]-y[0],k="deltaY"in x?x.deltaY:v[1]-y[1],M,_=x.target,A=Math.abs(I)>Math.abs(k)?"h":"v";if("touches"in x&&A==="h"&&_.type==="range")return!1;var D=B2(A,_);if(!D)return!0;if(D?M=A:(M=A==="v"?"h":"v",D=B2(A,_)),!D)return!1;if(!s.current&&"changedTouches"in x&&(I||k)&&(s.current=M),!M)return!0;var N=s.current||M;return wde(N,C,x,N==="h"?I:k,!0)},[]),d=l.useCallback(function(x){var C=x;if(!(!el.length||el[el.length-1]!==a)){var y="deltaY"in C?$2(C):xh(C),v=t.current.filter(function(M){return M.name===C.type&&M.target===C.target&&jde(M.delta,y)})[0];if(v&&v.should){C.cancelable&&C.preventDefault();return}if(!v){var I=(i.current.shards||[]).map(F2).filter(Boolean).filter(function(M){return M.contains(C.target)}),k=I.length>0?c(C,I[0]):!i.current.noIsolation;k&&C.cancelable&&C.preventDefault()}}},[]),u=l.useCallback(function(x,C,y,v){var I={name:x,delta:C,target:y,should:v};t.current.push(I),setTimeout(function(){t.current=t.current.filter(function(k){return k!==I})},1)},[]),h=l.useCallback(function(x){n.current=xh(x),s.current=void 0},[]),p=l.useCallback(function(x){u(x.type,$2(x),x.target,c(x,e.lockRef.current))},[]),f=l.useCallback(function(x){u(x.type,xh(x),x.target,c(x,e.lockRef.current))},[]);l.useEffect(function(){return el.push(a),e.setCallbacks({onScrollCapture:p,onWheelCapture:p,onTouchMoveCapture:f}),document.addEventListener("wheel",d,Xi),document.addEventListener("touchmove",d,Xi),document.addEventListener("touchstart",h,Xi),function(){el=el.filter(function(x){return x!==a}),document.removeEventListener("wheel",d,Xi),document.removeEventListener("touchmove",d,Xi),document.removeEventListener("touchstart",h,Xi)}},[]);var m=e.removeScrollBar,g=e.inert;return l.createElement(l.Fragment,null,g?l.createElement(a,{styles:Sde(r)}):null,m?l.createElement(mde,{gapMode:"margin"}):null)}const _de=nde(Z4,Ide);var J4=l.forwardRef(function(e,t){return l.createElement(pm,Qo({},e,{ref:t,sideCar:_de}))});J4.classNames=pm.classNames;var Mde=function(e){if(typeof document>"u")return null;var t=Array.isArray(e)?e[0]:e;return t.ownerDocument.body},tl=new WeakMap,bh=new WeakMap,yh={},vg=0,X4=function(e){return e&&(e.host||X4(e.parentNode))},Ade=function(e,t){return t.map(function(n){if(e.contains(n))return n;var s=X4(n);return s&&e.contains(s)?s:(console.error("aria-hidden",n,"in not contained inside",e,". Doing nothing"),null)}).filter(function(n){return!!n})},Ede=function(e,t,n,s){var r=Ade(t,Array.isArray(e)?e:[e]);yh[n]||(yh[n]=new WeakMap);var a=yh[n],i=[],c=new Set,d=new Set(r),u=function(p){!p||c.has(p)||(c.add(p),u(p.parentNode))};r.forEach(u);var h=function(p){!p||d.has(p)||Array.prototype.forEach.call(p.children,function(f){if(c.has(f))h(f);else try{var m=f.getAttribute(s),g=m!==null&&m!=="false",x=(tl.get(f)||0)+1,C=(a.get(f)||0)+1;tl.set(f,x),a.set(f,C),i.push(f),x===1&&g&&bh.set(f,!0),C===1&&f.setAttribute(n,"true"),g||f.setAttribute(s,"true")}catch(y){console.error("aria-hidden: cannot operate on ",f,y)}})};return h(t),c.clear(),vg++,function(){i.forEach(function(p){var f=tl.get(p)-1,m=a.get(p)-1;tl.set(p,f),a.set(p,m),f||(bh.has(p)||p.removeAttribute(s),bh.delete(p)),m||p.removeAttribute(n)}),vg--,vg||(tl=new WeakMap,tl=new WeakMap,bh=new WeakMap,yh={})}},Lde=function(e,t,n){n===void 0&&(n="data-aria-hidden");var s=Array.from(Array.isArray(e)?e:[e]),r=Mde(e);return r?(s.push.apply(s,Array.from(r.querySelectorAll("[aria-live]"))),Ede(s,r,n,"aria-hidden")):function(){return null}};const e6="Dialog",[t6,tge]=yce(e6),[Tde,zi]=t6(e6),Pde=e=>{const{__scopeDialog:t,children:n,open:s,defaultOpen:r,onOpenChange:a,modal:i=!0}=e,c=l.useRef(null),d=l.useRef(null),[u=!1,h]=jce({prop:s,defaultProp:r,onChange:a});return l.createElement(Tde,{scope:t,triggerRef:c,contentRef:d,contentId:pg(),titleId:pg(),descriptionId:pg(),open:u,onOpenChange:h,onOpenToggle:l.useCallback(()=>h(p=>!p),[h]),modal:i},n)},n6="DialogPortal",[Rde,s6]=t6(n6,{forceMount:void 0}),Dde=e=>{const{__scopeDialog:t,forceMount:n,children:s,container:r}=e,a=zi(n6,t);return l.createElement(Rde,{scope:t,forceMount:n},l.Children.map(s,i=>l.createElement(hm,{present:n||a.open},l.createElement(Wce,{asChild:!0,container:r},i))))},Q0="DialogOverlay",Ode=l.forwardRef((e,t)=>{const n=s6(Q0,e.__scopeDialog),{forceMount:s=n.forceMount,...r}=e,a=zi(Q0,e.__scopeDialog);return a.modal?l.createElement(hm,{present:s||a.open},l.createElement(Nde,cs({},r,{ref:t}))):null}),Nde=l.forwardRef((e,t)=>{const{__scopeDialog:n,...s}=e,r=zi(Q0,n);return l.createElement(J4,{as:cy,allowPinchZoom:!0,shards:[r.contentRef]},l.createElement(ho.div,cs({"data-state":r6(r.open)},s,{ref:t,style:{pointerEvents:"auto",...s.style}})))}),Rd="DialogContent",Bde=l.forwardRef((e,t)=>{const n=s6(Rd,e.__scopeDialog),{forceMount:s=n.forceMount,...r}=e,a=zi(Rd,e.__scopeDialog);return l.createElement(hm,{present:s||a.open},a.modal?l.createElement($de,cs({},r,{ref:t})):l.createElement(Fde,cs({},r,{ref:t})))}),$de=l.forwardRef((e,t)=>{const n=zi(Rd,e.__scopeDialog),s=l.useRef(null),r=Bu(t,n.contentRef,s);return l.useEffect(()=>{const a=s.current;if(a)return Lde(a)},[]),l.createElement(o6,cs({},e,{ref:r,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:Nl(e.onCloseAutoFocus,a=>{var i;a.preventDefault(),(i=n.triggerRef.current)===null||i===void 0||i.focus()}),onPointerDownOutside:Nl(e.onPointerDownOutside,a=>{const i=a.detail.originalEvent,c=i.button===0&&i.ctrlKey===!0;(i.button===2||c)&&a.preventDefault()}),onFocusOutside:Nl(e.onFocusOutside,a=>a.preventDefault())}))}),Fde=l.forwardRef((e,t)=>{const n=zi(Rd,e.__scopeDialog),s=l.useRef(!1),r=l.useRef(!1);return l.createElement(o6,cs({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{var i;if((i=e.onCloseAutoFocus)===null||i===void 0||i.call(e,a),!a.defaultPrevented){var c;s.current||(c=n.triggerRef.current)===null||c===void 0||c.focus(),a.preventDefault()}s.current=!1,r.current=!1},onInteractOutside:a=>{var i,c;(i=e.onInteractOutside)===null||i===void 0||i.call(e,a),a.defaultPrevented||(s.current=!0,a.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const d=a.target;((c=n.triggerRef.current)===null||c===void 0?void 0:c.contains(d))&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&r.current&&a.preventDefault()}}))}),o6=l.forwardRef((e,t)=>{const{__scopeDialog:n,trapFocus:s,onOpenAutoFocus:r,onCloseAutoFocus:a,...i}=e,c=zi(Rd,n),d=l.useRef(null),u=Bu(t,d);return Zce(),l.createElement(l.Fragment,null,l.createElement(Nce,{asChild:!0,loop:!0,trapped:s,onMountAutoFocus:r,onUnmountAutoFocus:a},l.createElement(Rce,cs({role:"dialog",id:c.contentId,"aria-describedby":c.descriptionId,"aria-labelledby":c.titleId,"data-state":r6(c.open)},i,{ref:u,onDismiss:()=>c.onOpenChange(!1)}))),!1)});function r6(e){return e?"open":"closed"}const zde=Pde,Vde=Dde,Hde=Ode,Wde=Bde;var Gc='[cmdk-group=""]',Cg='[cmdk-group-items=""]',Gde='[cmdk-group-heading=""]',dy='[cmdk-item=""]',z2=`${dy}:not([aria-disabled="true"])`,Y0="cmdk-item-select",Ja="data-value",Ude=(e,t,n)=>xce(e,t,n),a6=l.createContext(void 0),$u=()=>l.useContext(a6),i6=l.createContext(void 0),uy=()=>l.useContext(i6),l6=l.createContext(void 0),hy=l.forwardRef((e,t)=>{let n=al(()=>{var R,F;return{search:"",value:(F=(R=e.value)!=null?R:e.defaultValue)!=null?F:"",filtered:{count:0,items:new Map,groups:new Set}}}),s=al(()=>new Set),r=al(()=>new Map),a=al(()=>new Map),i=al(()=>new Set),c=h6(e),{label:d,children:u,value:h,onValueChange:p,filter:f,shouldFilter:m,loop:g,disablePointerSelection:x=!1,vimBindings:C=!0,...y}=e,v=l.useId(),I=l.useId(),k=l.useId(),M=l.useRef(null),_=eue();vi(()=>{if(h!==void 0){let R=h.trim();n.current.value=R,A.emit()}},[h]),vi(()=>{_(6,X)},[]);let A=l.useMemo(()=>({subscribe:R=>(i.current.add(R),()=>i.current.delete(R)),snapshot:()=>n.current,setState:(R,F,Z)=>{var B,K,$;if(!Object.is(n.current[R],F)){if(n.current[R]=F,R==="search")W(),P(),_(1,z);else if(R==="value"&&(Z||_(5,X),((B=c.current)==null?void 0:B.value)!==void 0)){let Y=F??"";($=(K=c.current).onValueChange)==null||$.call(K,Y);return}A.emit()}},emit:()=>{i.current.forEach(R=>R())}}),[]),D=l.useMemo(()=>({value:(R,F,Z)=>{var B;F!==((B=a.current.get(R))==null?void 0:B.value)&&(a.current.set(R,{value:F,keywords:Z}),n.current.filtered.items.set(R,N(F,Z)),_(2,()=>{P(),A.emit()}))},item:(R,F)=>(s.current.add(R),F&&(r.current.has(F)?r.current.get(F).add(R):r.current.set(F,new Set([R]))),_(3,()=>{W(),P(),n.current.value||z(),A.emit()}),()=>{a.current.delete(R),s.current.delete(R),n.current.filtered.items.delete(R);let Z=ee();_(4,()=>{W(),(Z==null?void 0:Z.getAttribute("id"))===R&&z(),A.emit()})}),group:R=>(r.current.has(R)||r.current.set(R,new Set),()=>{a.current.delete(R),r.current.delete(R)}),filter:()=>c.current.shouldFilter,label:d||e["aria-label"],disablePointerSelection:x,listId:v,inputId:k,labelId:I,listInnerRef:M}),[]);function N(R,F){var Z,B;let K=(B=(Z=c.current)==null?void 0:Z.filter)!=null?B:Ude;return R?K(R,n.current.search,F):0}function P(){if(!n.current.search||c.current.shouldFilter===!1)return;let R=n.current.filtered.items,F=[];n.current.filtered.groups.forEach(B=>{let K=r.current.get(B),$=0;K.forEach(Y=>{let ae=R.get(Y);$=Math.max(ae,$)}),F.push([B,$])});let Z=M.current;G().sort((B,K)=>{var $,Y;let ae=B.getAttribute("id"),ue=K.getAttribute("id");return(($=R.get(ue))!=null?$:0)-((Y=R.get(ae))!=null?Y:0)}).forEach(B=>{let K=B.closest(Cg);K?K.appendChild(B.parentElement===K?B:B.closest(`${Cg} > *`)):Z.appendChild(B.parentElement===Z?B:B.closest(`${Cg} > *`))}),F.sort((B,K)=>K[1]-B[1]).forEach(B=>{let K=M.current.querySelector(`${Gc}[${Ja}="${encodeURIComponent(B[0])}"]`);K==null||K.parentElement.appendChild(K)})}function z(){let R=G().find(Z=>Z.getAttribute("aria-disabled")!=="true"),F=R==null?void 0:R.getAttribute(Ja);A.setState("value",F||void 0)}function W(){var R,F,Z,B;if(!n.current.search||c.current.shouldFilter===!1){n.current.filtered.count=s.current.size;return}n.current.filtered.groups=new Set;let K=0;for(let $ of s.current){let Y=(F=(R=a.current.get($))==null?void 0:R.value)!=null?F:"",ae=(B=(Z=a.current.get($))==null?void 0:Z.keywords)!=null?B:[],ue=N(Y,ae);n.current.filtered.items.set($,ue),ue>0&&K++}for(let[$,Y]of r.current)for(let ae of Y)if(n.current.filtered.items.get(ae)>0){n.current.filtered.groups.add($);break}n.current.filtered.count=K}function X(){var R,F,Z;let B=ee();B&&(((R=B.parentElement)==null?void 0:R.firstChild)===B&&((Z=(F=B.closest(Gc))==null?void 0:F.querySelector(Gde))==null||Z.scrollIntoView({block:"nearest"})),B.scrollIntoView({block:"nearest"}))}function ee(){var R;return(R=M.current)==null?void 0:R.querySelector(`${dy}[aria-selected="true"]`)}function G(){var R;return Array.from((R=M.current)==null?void 0:R.querySelectorAll(z2))}function re(R){let F=G()[R];F&&A.setState("value",F.getAttribute(Ja))}function le(R){var F;let Z=ee(),B=G(),K=B.findIndex(Y=>Y===Z),$=B[K+R];(F=c.current)!=null&&F.loop&&($=K+R<0?B[B.length-1]:K+R===B.length?B[0]:B[K+R]),$&&A.setState("value",$.getAttribute(Ja))}function Ce(R){let F=ee(),Z=F==null?void 0:F.closest(Gc),B;for(;Z&&!B;)Z=R>0?Jde(Z,Gc):Xde(Z,Gc),B=Z==null?void 0:Z.querySelector(z2);B?A.setState("value",B.getAttribute(Ja)):le(R)}let be=()=>re(G().length-1),ye=R=>{R.preventDefault(),R.metaKey?be():R.altKey?Ce(1):le(1)},ne=R=>{R.preventDefault(),R.metaKey?re(0):R.altKey?Ce(-1):le(-1)};return l.createElement(ho.div,{ref:t,tabIndex:-1,...y,"cmdk-root":"",onKeyDown:R=>{var F;if((F=y.onKeyDown)==null||F.call(y,R),!R.defaultPrevented)switch(R.key){case"n":case"j":{C&&R.ctrlKey&&ye(R);break}case"ArrowDown":{ye(R);break}case"p":case"k":{C&&R.ctrlKey&&ne(R);break}case"ArrowUp":{ne(R);break}case"Home":{R.preventDefault(),re(0);break}case"End":{R.preventDefault(),be();break}case"Enter":if(!R.nativeEvent.isComposing&&R.keyCode!==229){R.preventDefault();let Z=ee();if(Z){let B=new Event(Y0);Z.dispatchEvent(B)}}}}},l.createElement("label",{"cmdk-label":"",htmlFor:D.inputId,id:D.labelId,style:nue},d),fm(e,R=>l.createElement(i6.Provider,{value:A},l.createElement(a6.Provider,{value:D},R))))}),c6=l.forwardRef((e,t)=>{var n,s;let r=l.useId(),a=l.useRef(null),i=l.useContext(l6),c=$u(),d=h6(e),u=(s=(n=d.current)==null?void 0:n.forceMount)!=null?s:i==null?void 0:i.forceMount;vi(()=>{if(!u)return c.item(r,i==null?void 0:i.id)},[u]);let h=p6(r,a,[e.value,e.children,a],e.keywords),p=uy(),f=Ci(_=>_.value&&_.value===h.current),m=Ci(_=>u||c.filter()===!1?!0:_.search?_.filtered.items.get(r)>0:!0);l.useEffect(()=>{let _=a.current;if(!(!_||e.disabled))return _.addEventListener(Y0,g),()=>_.removeEventListener(Y0,g)},[m,e.onSelect,e.disabled]);function g(){var _,A;x(),(A=(_=d.current).onSelect)==null||A.call(_,h.current)}function x(){p.setState("value",h.current,!0)}if(!m)return null;let{disabled:C,value:y,onSelect:v,forceMount:I,keywords:k,...M}=e;return l.createElement(ho.div,{ref:Dd([a,t]),...M,id:r,"cmdk-item":"",role:"option","aria-disabled":!!C,"aria-selected":!!f,"data-disabled":!!C,"data-selected":!!f,onPointerMove:C||c.disablePointerSelection?void 0:x,onClick:C?void 0:g},e.children)}),Zde=l.forwardRef((e,t)=>{let{heading:n,children:s,forceMount:r,...a}=e,i=l.useId(),c=l.useRef(null),d=l.useRef(null),u=l.useId(),h=$u(),p=Ci(m=>r||h.filter()===!1?!0:m.search?m.filtered.groups.has(i):!0);vi(()=>h.group(i),[]),p6(i,c,[e.value,e.heading,d]);let f=l.useMemo(()=>({id:i,forceMount:r}),[r]);return l.createElement(ho.div,{ref:Dd([c,t]),...a,"cmdk-group":"",role:"presentation",hidden:p?void 0:!0},n&&l.createElement("div",{ref:d,"cmdk-group-heading":"","aria-hidden":!0,id:u},n),fm(e,m=>l.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":n?u:void 0},l.createElement(l6.Provider,{value:f},m))))}),qde=l.forwardRef((e,t)=>{let{alwaysRender:n,...s}=e,r=l.useRef(null),a=Ci(i=>!i.search);return!n&&!a?null:l.createElement(ho.div,{ref:Dd([r,t]),...s,"cmdk-separator":"",role:"separator"})}),Kde=l.forwardRef((e,t)=>{let{onValueChange:n,...s}=e,r=e.value!=null,a=uy(),i=Ci(h=>h.search),c=Ci(h=>h.value),d=$u(),u=l.useMemo(()=>{var h;let p=(h=d.listInnerRef.current)==null?void 0:h.querySelector(`${dy}[${Ja}="${encodeURIComponent(c)}"]`);return p==null?void 0:p.getAttribute("id")},[]);return l.useEffect(()=>{e.value!=null&&a.setState("search",e.value)},[e.value]),l.createElement(ho.input,{ref:t,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":d.listId,"aria-labelledby":d.labelId,"aria-activedescendant":u,id:d.inputId,type:"text",value:r?e.value:i,onChange:h=>{r||a.setState("search",h.target.value),n==null||n(h.target.value)}})}),d6=l.forwardRef((e,t)=>{let{children:n,label:s="Suggestions",...r}=e,a=l.useRef(null),i=l.useRef(null),c=$u();return l.useEffect(()=>{if(i.current&&a.current){let d=i.current,u=a.current,h,p=new ResizeObserver(()=>{h=requestAnimationFrame(()=>{let f=d.offsetHeight;u.style.setProperty("--cmdk-list-height",f.toFixed(1)+"px")})});return p.observe(d),()=>{cancelAnimationFrame(h),p.unobserve(d)}}},[]),l.createElement(ho.div,{ref:Dd([a,t]),...r,"cmdk-list":"",role:"listbox","aria-label":s,id:c.listId},fm(e,d=>l.createElement("div",{ref:Dd([i,c.listInnerRef]),"cmdk-list-sizer":""},d)))}),Qde=l.forwardRef((e,t)=>{let{open:n,onOpenChange:s,overlayClassName:r,contentClassName:a,container:i,...c}=e;return l.createElement(zde,{open:n,onOpenChange:s},l.createElement(Vde,{container:i},l.createElement(Hde,{"cmdk-overlay":"",className:r}),l.createElement(Wde,{"aria-label":e.label,"cmdk-dialog":"",className:a},l.createElement(hy,{ref:t,...c}))))}),u6=l.forwardRef((e,t)=>Ci(n=>n.filtered.count===0)?l.createElement(ho.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),Yde=l.forwardRef((e,t)=>{let{progress:n,children:s,label:r="Loading...",...a}=e;return l.createElement(ho.div,{ref:t,...a,"cmdk-loading":"",role:"progressbar","aria-valuenow":n,"aria-valuemin":0,"aria-valuemax":100,"aria-label":r},fm(e,i=>l.createElement("div",{"aria-hidden":!0},i)))});Object.assign(hy,{List:d6,Item:c6,Input:Kde,Group:Zde,Separator:qde,Dialog:Qde,Empty:u6,Loading:Yde});function Jde(e,t){let n=e.nextElementSibling;for(;n;){if(n.matches(t))return n;n=n.nextElementSibling}}function Xde(e,t){let n=e.previousElementSibling;for(;n;){if(n.matches(t))return n;n=n.previousElementSibling}}function h6(e){let t=l.useRef(e);return vi(()=>{t.current=e}),t}var vi=typeof window>"u"?l.useEffect:l.useLayoutEffect;function al(e){let t=l.useRef();return t.current===void 0&&(t.current=e()),t}function Dd(e){return t=>{e.forEach(n=>{typeof n=="function"?n(t):n!=null&&(n.current=t)})}}function Ci(e){let t=uy(),n=()=>e(t.snapshot());return l.useSyncExternalStore(t.subscribe,n,n)}function p6(e,t,n,s=[]){let r=l.useRef(),a=$u();return vi(()=>{var i;let c=(()=>{var u;for(let h of n){if(typeof h=="string")return h.trim();if(typeof h=="object"&&"current"in h)return h.current?(u=h.current.textContent)==null?void 0:u.trim():r.current}})(),d=s.map(u=>u.trim());a.value(e,c,d),(i=t.current)==null||i.setAttribute(Ja,c),r.current=c}),r}var eue=()=>{let[e,t]=l.useState(),n=al(()=>new Map);return vi(()=>{n.current.forEach(s=>s()),n.current=new Map},[e]),(s,r)=>{n.current.set(s,r),t({})}};function tue(e){let t=e.type;return typeof t=="function"?t(e.props):"render"in t?t.render(e.props):e}function fm({asChild:e,children:t},n){return e&&l.isValidElement(t)?l.cloneElement(tue(t),{ref:t.ref},n(t.props.children)):n(t)}var nue={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"};const sue=e=>{const t=Gl();return{...JS,id:t,type:"current_image",position:e,data:{id:t,type:"current_image",isOpen:!0,label:"Current Image"}}},oue=e=>{const t=Gl();return{...JS,id:t,type:"notes",position:e,data:{id:t,isOpen:!0,label:"Notes",notes:"",type:"notes"}}},rue=()=>{const e=se(yn),t=XS();return l.useCallback(n=>{var d;let s=window.innerWidth/2,r=window.innerHeight/2;const a=(d=document.querySelector("#workflow-editor"))==null?void 0:d.getBoundingClientRect();a&&(s=a.width/2-qg/2+a.left,r=a.height/2-qg/2+a.top);const i=t.screenToFlowPosition({x:s,y:r});if(n==="current_image")return sue(i);if(n==="notes")return oue(i);const c=e[n];return TF(i,c)},[e,t])},f6=(e,t,n)=>{let s=t,r=n;for(;e.find(a=>a.position.x===s&&a.position.y===r);)s=Math.floor(s+50),r=Math.floor(r+50);return{x:s,y:r}},m6=(e,t)=>{const n="originalType"in e?hi(e,"originalType"):e,s="originalType"in t?hi(t,"originalType"):t,r="originalType"in e?e.originalType:null,a="originalType"in t?t.originalType:null;return!!(hl(n,s)||a&&hl(n,a)||r&&hl(r,s)||r&&a&&hl(r,a))},aue=(e,t,n,s)=>{const r=n.find(d=>d.target===s&&d.targetHandle==="item");if(!(r!=null&&r.sourceHandle))return null;const a=t.find(d=>d.id===r.source);if(!a)return null;const i=e[a.data.type];if(!i)return null;const c=i.outputs[r.sourceHandle];return c?c.type:null},iue=(e,t,n,s)=>{const r=new nv.Graph;return n.forEach(a=>{r.setNode(a.id)}),s.forEach(a=>{r.setEdge(a.source,a.target)}),r.setEdge(e,t),!nv.alg.isAcyclic(r)},g6=(e,t)=>{if(e.name==="CollectionField"&&t.name==="CollectionField")return!1;if(m6(e,t))return!0;const n=e.name==="CollectionItemField"&&!nl(t),s=pl(e)&&t.name==="CollectionItemField",r=ca(t)&&e.name===t.name,a=e.name==="CollectionField"&&!pl(t),i=t.name==="CollectionField"&&nl(e),c=pl(e),d=pl(t),u=c&&d,h=c&&ca(t),p=nl(e)&&nl(t),f=nl(e)&&ca(t),m=ca(e)&&ca(t),g=u||p||f||m||h,x=e.name==="IntegerField"&&t.name==="FloatField",C=e.name==="IntegerField"&&t.name==="StringField",y=e.name==="FloatField"&&t.name==="StringField",v=g&&(x||C||y),I=t.name==="AnyField";return n||s||r||a||i||v||I},lue=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle&&t.source===e.source&&t.sourceHandle===e.sourceHandle,cue=e=>t=>t.target===e.target&&t.targetHandle===e.targetHandle,due=()=>({isValid:!0}),Vn=e=>({isValid:!1,messageTKey:e}),Fu=(e,t,n,s,r,a=!0)=>{if(e.source===e.target)return Vn("nodes.cannotConnectToSelf");if(a){const i=n.filter(m=>m.id!==(r==null?void 0:r.id));if(i.some(lue(e)))return Vn("nodes.cannotDuplicateConnection");const c=t.find(m=>m.id===e.source);if(!c)return Vn("nodes.missingNode");const d=t.find(m=>m.id===e.target);if(!d)return Vn("nodes.missingNode");const u=s[c.data.type];if(!u)return Vn("nodes.missingInvocationTemplate");const h=s[d.data.type];if(!h)return Vn("nodes.missingInvocationTemplate");const p=u.outputs[e.sourceHandle];if(!p)return Vn("nodes.missingFieldTemplate");const f=h.inputs[e.targetHandle];if(!f)return Vn("nodes.missingFieldTemplate");if(f.input==="direct")return Vn("nodes.cannotConnectToDirectInput");if(d.data.type==="collect"&&e.targetHandle==="item"){const m=aue(s,t,n,d.id);if(m&&!m6(p.type,m))return Vn("nodes.cannotMixAndMatchCollectionItemTypes")}if(i.find(cue(e))&&f.type.name!=="CollectionItemField")return Vn("nodes.inputMayOnlyHaveOneConnection");if(!g6(p.type,f.type))return Vn("nodes.fieldTypesMustMatch")}return iue(e.source,e.target,t,n)?Vn("nodes.connectionWouldCreateCycle"):due()},x6=(e,t,n,s,r,a,i,c)=>{if(e===n)return null;if(t&&s)return{source:e,sourceHandle:t,target:n,targetHandle:s};if(t&&!s){const u=uue(e,t,n,r,a,i,c)[0];return u?{source:e,sourceHandle:t,target:n,targetHandle:u.name}:null}if(!t&&s){const u=hue(n,s,e,r,a,i,c)[0];return u?{source:e,sourceHandle:u.name,target:n,targetHandle:s}:null}return null},uue=(e,t,n,s,r,a,i)=>{const c=s.find(m=>m.id===e),d=s.find(m=>m.id===n);if(!c||!d)return[];const u=a[c.data.type],h=a[d.data.type];return!u||!h?[]:u.outputs[t]?To(h.inputs).filter(m=>{const g={source:e,sourceHandle:t,target:n,targetHandle:m.name};return Fu(g,s,r,a,i,!0).isValid}):[]},hue=(e,t,n,s,r,a,i)=>{const c=s.find(m=>m.id===e),d=s.find(m=>m.id===n);if(!d||!c)return[];const u=a[d.data.type],h=a[c.data.type];return!u||!h?[]:h.inputs[t]?To(u.outputs).filter(m=>{const g={source:n,sourceHandle:m.name,target:e,targetHandle:t};return Fu(g,s,r,a,i,!0).isValid}):[]},pue=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:r}=e;return`reactflow__edge-${t}${n||""}-${s}${r||""}`},Lp=e=>{const{source:t,sourceHandle:n,target:s,targetHandle:r}=e;return Fe(t&&n&&s&&r,"Invalid connection"),{source:t,sourceHandle:n,target:s,targetHandle:r,id:pue({source:t,sourceHandle:n,target:s,targetHandle:r})}},fue=(e,t)=>{const[n,s]=l.useState(e),r=l.useRef(Date.now());return l.useEffect(()=>{const a=setTimeout(function(){Date.now()-r.current>=t&&(s(e),r.current=Date.now())},t-(Date.now()-r.current));return()=>{clearTimeout(a)}},[e,t]),n},mue=()=>{const{t:e}=S(),t=ji(),n=rue(),s=se(yn),r=se(no);return l.useCallback(i=>{const c=n(i);if(!c){const m=e("nodes.unknownNode",{nodeType:i});he({status:"error",title:m});return}const d=bb.get(),{nodes:u,edges:h}=bt(t.getState());c.position=f6(u,(d==null?void 0:d.x)??c.position.x,(d==null?void 0:d.y)??c.position.y),c.selected=!0;const p=[{type:"add",item:c}],f=[];if(u.forEach(({id:m,selected:g})=>{g&&p.push({type:"select",id:m,selected:!1})}),h.forEach(({id:m,selected:g})=>{g&&f.push({type:"select",id:m,selected:!1})}),p.length>0&&t.dispatch(Il(p)),f.length>0&&t.dispatch(Ko(f)),r&&Br(c)){const m=ii.get(),{handleType:g}=r,x=g==="source"?r.nodeId:c.id,C=g==="source"?r.handleId:null,y=g==="target"?r.nodeId:c.id,v=g==="target"?r.handleId:null,{nodes:I,edges:k}=bt(t.getState()),M=x6(x,C,y,v,I,k,s,m);if(M){const _=Lp(M);t.dispatch(Ko([{type:"add",item:_}]))}}},[n,r,t,e,s])},gue={"[cmdk-root]":{w:"full",h:"full"},"[cmdk-list]":{w:"full",h:"full"}},b6=l.memo(()=>{const{t:e}=S(),t=xb(),n=l.useRef(null),[s,r]=l.useState(""),a=mue(),i=w(bn),c=fue(s,100);Ie({id:"addNode",category:"workflows",callback:t.setTrue,options:{enabled:i==="workflows",preventDefault:!0},dependencies:[t.setTrue,i]});const d=l.useCallback(p=>{r(p.target.value)},[]),u=l.useCallback(()=>{t.setFalse(),r(""),no.set(null)},[t]),h=l.useCallback(p=>{a(p),u()},[a,u]);return o.jsxs(fr,{isOpen:t.isTrue,onClose:u,useInert:!1,initialFocusRef:n,size:"xl",isCentered:!0,children:[o.jsx(co,{}),o.jsx(mr,{h:"512",maxH:"70%",children:o.jsx(uo,{p:2,h:"full",sx:gue,children:o.jsx(hy,{loop:!0,shouldFilter:!1,children:o.jsxs(j,{flexDir:"column",h:"full",gap:2,children:[o.jsx(Vt,{ref:n,value:s,onChange:d,placeholder:e("nodes.nodeSearch")}),o.jsx(xe,{w:"full",h:"full",children:o.jsxs(Nn,{children:[o.jsx(u6,{children:o.jsx(Mt,{position:"absolute",top:0,right:0,bottom:0,left:0,icon:null,label:"No matching items"})}),o.jsx(d6,{children:o.jsx(y6,{searchTerm:c,onSelect:h})})]})})]})})})})]})});b6.displayName="AddNodeCmdk";const xue={'&[data-selected="true"]':{bg:"base.700"}},bue=Mo(yn,e=>Object.values(e).filter(t=>t.classification!=="deprecated")),yue=ek(e=>new RegExp(e.trim().replace(/[-[\]{}()*+!<=:?./\\^$|#,]/g,"").split(" ").join(".*"),"gi")),wg=ek((e,t)=>{const n=yue(t);if(!t||e.title.includes(t)||n.test(e.title)||e.type.includes(t)||n.test(e.type)||e.description.includes(t)||n.test(e.description)||e.nodePack.includes(t)||n.test(e.nodePack)||e.classification.includes(t)||n.test(e.classification))return!0;for(const s of e.tags)if(s.includes(t)||n.test(s))return!0;return!1},(e,t)=>`${e.type}-${t}`),y6=l.memo(({searchTerm:e,onSelect:t})=>{const{t:n}=S(),s=se(bue),r=se(no),a=l.useMemo(()=>({type:"current_image",title:n("nodes.currentImage"),description:n("nodes.currentImageDescription"),tags:["progress","image","current"],classification:"stable",nodePack:"invokeai"}),[n]),i=l.useMemo(()=>({type:"notes",title:n("nodes.notes"),description:n("nodes.notesDescription"),tags:["notes"],classification:"stable",nodePack:"invokeai"}),[n]),c=l.useMemo(()=>{const d=[];if(r){for(const u of s)if(wg(u,e)){const h=r.handleType==="source"?u.inputs:u.outputs;for(const p of Object.values(h)){const f=r.handleType==="source"?p.type:r.fieldTemplate.type,m=r.handleType==="target"?p.type:r.fieldTemplate.type;if(g6(f,m)){d.push({label:u.title,value:u.type,description:u.description,classification:u.classification,nodePack:u.nodePack});break}}}}else{for(const u of s)wg(u,e)&&d.push({label:u.title,value:u.type,description:u.description,classification:u.classification,nodePack:u.nodePack});for(const u of[a,i])wg(u,e)&&d.push({label:u.title,value:u.type,description:u.description,classification:u.classification,nodePack:u.nodePack})}return d},[r,a,e,i,s]);return o.jsx(o.Fragment,{children:c.map(d=>o.jsx(c6,{value:d.value,onSelect:t,asChild:!0,children:o.jsxs(j,{role:"button",flexDir:"column",sx:xue,py:1,px:2,borderRadius:"base",children:[o.jsxs(j,{alignItems:"center",gap:2,children:[d.classification==="beta"&&o.jsx(it,{boxSize:4,color:"invokeYellow.300",as:NI}),d.classification==="prototype"&&o.jsx(it,{boxSize:4,color:"invokeRed.300",as:Rb}),d.classification==="internal"&&o.jsx(it,{boxSize:4,color:"invokePurple.300",as:TI}),o.jsx(O,{fontWeight:"semibold",children:d.label}),o.jsx(dt,{}),o.jsx(O,{variant:"subtext",fontWeight:"semibold",children:d.nodePack})]}),d.description&&o.jsx(O,{color:"base.200",children:d.description})]})},d.value))})});y6.displayName="CommandListItems";const vue=()=>{const e=xb(),{t}=S();return o.jsx(Q,{tooltip:t("nodes.addNodeToolTip"),"aria-label":t("nodes.addNode"),icon:o.jsx(Bt,{}),onClick:e.setTrue,pointerEvents:"auto"})},Cue=l.memo(vue),wue=()=>{const e=E(),{t}=S(),{isOpen:n,onOpen:s,onClose:r}=Is(),a=w(cu),i=l.useCallback(()=>{e(PS()),he({id:"WORKFLOW_CLEARED",title:t("workflows.workflowCleared"),status:"success"}),r()},[e,r,t]),c=l.useCallback(()=>{if(!a){i();return}s()},[i,a,s]);return o.jsxs(o.Fragment,{children:[o.jsx(Q,{tooltip:t("nodes.clearWorkflow"),"aria-label":t("nodes.clearWorkflow"),icon:o.jsx(bc,{}),onClick:c,pointerEvents:"auto"}),o.jsx(No,{isOpen:n,onClose:r,title:t("nodes.clearWorkflow"),acceptCallback:i,useInert:!1,children:o.jsxs(j,{flexDir:"column",gap:2,children:[o.jsx(O,{children:t("nodes.clearWorkflowDesc")}),o.jsx(O,{variant:"subtext",children:t("nodes.clearWorkflowDesc2")})]})})]})},jue=l.memo(wue),Sue=()=>{const{t:e}=S(),t=w(cu),{onOpen:n}=Dc(),{saveWorkflow:s}=H1(),r=l.useCallback(()=>{const a=Fa.get();a&&(am(a)?s():n())},[n,s]);return o.jsx(Q,{tooltip:e("workflows.saveWorkflow"),"aria-label":e("workflows.saveWorkflow"),icon:o.jsx($r,{}),isDisabled:!t,onClick:r,pointerEvents:"auto"})},kue=l.memo(Sue),v6=()=>{const e=se(yn),t=l.useMemo(()=>pe(bt,s=>s.nodes.filter(Br).some(r=>{const a=e[r.data.type];return a?CS(r.data,a):!1})),[e]);return w(t)},Iue=()=>{const e=E(),{t}=S(),n=v6(),s=l.useCallback(()=>{e(PF())},[e]);return n?o.jsx(Q,{tooltip:t("nodes.updateAllNodes"),"aria-label":t("nodes.updateAllNodes"),icon:o.jsx(lf,{}),onClick:s,pointerEvents:"auto",colorScheme:"warning"}):null},_ue=l.memo(Iue),Mue=pt(qr,e=>({name:e.name,description:e.description,notes:e.notes,author:e.author,tags:e.tags})),Aue=()=>{const{name:e,description:t,notes:n,author:s,tags:r}=w(Mue),{t:a}=S();return o.jsxs(j,{flexDir:"column",gap:"2",children:[!!e.length&&o.jsxs(xe,{children:[o.jsx(O,{fontWeight:"semibold",children:a("nodes.workflowName")}),o.jsx(O,{opacity:.7,fontStyle:"oblique 5deg",children:e})]}),!!s.length&&o.jsxs(xe,{children:[o.jsx(O,{fontWeight:"semibold",children:a("nodes.workflowAuthor")}),o.jsx(O,{opacity:.7,fontStyle:"oblique 5deg",children:s})]}),!!r.length&&o.jsxs(xe,{children:[o.jsx(O,{fontWeight:"semibold",children:a("nodes.workflowTags")}),o.jsx(O,{opacity:.7,fontStyle:"oblique 5deg",children:r})]}),!!t.length&&o.jsxs(xe,{children:[o.jsx(O,{fontWeight:"semibold",children:a("nodes.workflowDescription")}),o.jsx(O,{opacity:.7,fontStyle:"oblique 5deg",children:t})]}),!!n.length&&o.jsxs(xe,{children:[o.jsx(O,{fontWeight:"semibold",children:a("nodes.workflowNotes")}),o.jsx(O,{opacity:.7,fontStyle:"oblique 5deg",children:n})]})]})},Eue=l.memo(Aue),Lue=()=>{const{t:e}=S();return o.jsx(j,{flexDir:"column",gap:"2",children:o.jsxs(j,{flexDir:"column",gap:"2",children:[o.jsx(O,{fontWeight:"semibold",children:e("toast.loadedWithWarnings")}),o.jsxs(j,{flexDir:"column",children:[o.jsxs(O,{children:[e("common.toResolve"),":"]}),o.jsxs(O,{children:[e("nodes.editMode")," >> ",e("nodes.updateAllNodes")," >> ",e("common.save")]})]})]})})},Tue=()=>v6()?o.jsx(Ae,{label:o.jsx(Lue,{}),children:o.jsx(j,{h:"full",alignItems:"center",gap:"2",children:o.jsx(it,{color:"warning.400",as:lf})})}):o.jsx(o.Fragment,{}),Pue=()=>{const{t:e}=S(),t=w(cb),n=w(cu),s=w(lu);return o.jsxs(j,{gap:"1",alignItems:"center",children:[t.length?o.jsx(Ae,{label:o.jsx(Eue,{}),placement:"top",children:o.jsx(O,{fontSize:"lg",userSelect:"none",noOfLines:1,wordBreak:"break-all",fontWeight:"semibold",children:t})}):o.jsx(O,{fontSize:"lg",fontStyle:"italic",fontWeight:"semibold",children:e("workflows.unnamedWorkflow")}),n&&s==="edit"&&o.jsx(Ae,{label:e("nodes.newWorkflowDesc2"),children:o.jsx(j,{children:o.jsx(it,{as:CG,boxSize:"20px",sx:{color:"invokeYellow.500"}})})}),o.jsx(Tue,{})]})},Rue=()=>{const{t:e}=S(),t=BP();return o.jsx(_e,{as:"button",icon:o.jsx(mc,{}),onClick:t,children:e("workflows.downloadWorkflow")})},Due=l.memo(Rue),jg=Ge(!1),C6=()=>{const e=se(jg),t=l.useCallback(()=>{jg.set(!0)},[]),n=l.useCallback(()=>{jg.set(!1)},[]);return{isOpen:e,onOpen:t,onClose:n}},Oue=()=>{const{t:e}=S(),t=E(),{isOpen:n,onClose:s}=C6(),[r,a]=l.useState(""),[i,c]=l.useState(""),[d,u]=l.useState(!0),h=l.useCallback(x=>{a(x.target.value)},[]),p=l.useCallback(x=>{c(x.target.value)},[]),f=l.useCallback(x=>{u(x.target.checked)},[]),m=l.useCallback(()=>{const x=JSON.parse(r),C=RF(x,d);c(JSON.stringify(C,null,2))},[r,d]),g=l.useCallback(()=>{t(Dp({data:{workflow:i,graph:null},asCopy:!0})),s()},[t,s,i]);return o.jsxs(fr,{isOpen:n,onClose:s,isCentered:!0,useInert:!1,children:[o.jsx(co,{}),o.jsxs(mr,{w:"80vw",h:"80vh",maxW:"unset",maxH:"unset",children:[o.jsx(Bo,{children:e("workflows.loadFromGraph")}),o.jsx(Ea,{}),o.jsxs(uo,{as:j,flexDir:"column",gap:4,w:"full",h:"full",pb:4,children:[o.jsxs(j,{gap:4,children:[o.jsx(me,{onClick:m,size:"sm",flexShrink:0,children:e("workflows.convertGraph")}),o.jsxs(V,{children:[o.jsx(U,{children:e("workflows.autoLayout")}),o.jsx(kn,{isChecked:d,onChange:f})]}),o.jsx(dt,{}),o.jsx(me,{onClick:g,size:"sm",flexShrink:0,children:e("workflows.loadWorkflow")})]}),o.jsxs(V,{orientation:"vertical",h:"50%",children:[o.jsx(U,{children:e("nodes.graph")}),o.jsx(ls,{h:"full",value:r,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:h})]}),o.jsxs(V,{orientation:"vertical",h:"50%",children:[o.jsx(U,{children:e("nodes.workflow")}),o.jsx(ls,{h:"full",value:i,fontFamily:"monospace",whiteSpace:"pre-wrap",overflowWrap:"normal",onChange:p})]})]})]})]})},Nue=()=>{const{t:e}=S(),t=se(yn),{onOpen:n}=C6();return o.jsx(_e,{as:"button",icon:o.jsx(Rb,{}),onClick:n,isDisabled:!ec(t),children:e("workflows.loadFromGraph")})},Bue=l.memo(Nue),w6=l.memo(()=>{const{t:e}=S(),t=V1();return o.jsx(_e,{as:"button",icon:o.jsx(DI,{}),onClick:t.createWithDialog,children:e("nodes.newWorkflow")})});w6.displayName="NewWorkflowMenuItem";const $ue=()=>{const{t:e}=S(),{onOpen:t}=Dc();return o.jsx(_e,{as:"button",icon:o.jsx(gr,{}),onClick:t,children:e("workflows.saveWorkflowAs")})},Fue=l.memo($ue),zue=()=>{const{t:e}=S(),{saveWorkflow:t}=H1(),{onOpen:n}=Dc(),s=w(cu),r=l.useCallback(()=>{const a=Fa.get();a&&(am(a)?t():n())},[n,t]);return o.jsx(_e,{as:"button",isDisabled:!s,icon:o.jsx($r,{}),onClick:r,children:e("workflows.saveWorkflow")})},Vue=l.memo(zue),Hue=()=>{const{t:e}=S(),[t]=DF(),n=l.useCallback(()=>{t()},[t]);return o.jsx(me,{leftIcon:o.jsx(EW,{}),tooltip:e("nodes.reloadNodeTemplates"),"aria-label":e("nodes.reloadNodeTemplates"),onClick:n,children:e("nodes.reloadNodeTemplates")})},Wue=l.memo(Hue),Gue={flexGrow:1},[j6]=wi(!1),Uue=()=>{const e=E(),t=j6(),n=w(tk),s=w(nk),r=w(sk),a=w(ok),i=w(rk),c=w(ak),d=l.useCallback(x=>{e(OF(x.target.checked))},[e]),u=l.useCallback(x=>{e(NF(x.target.checked))},[e]),h=l.useCallback(x=>{e(BF(x.target.checked))},[e]),p=l.useCallback(x=>{e($F(x.target.checked))},[e]),f=l.useCallback(x=>{e(FF(x.target.checked))},[e]),m=l.useCallback(x=>{e(zF(x.target.checked))},[e]),{t:g}=S();return o.jsxs(fr,{isOpen:t.isTrue,onClose:t.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[o.jsx(co,{}),o.jsxs(mr,{children:[o.jsx(Bo,{children:g("nodes.workflowSettings")}),o.jsx(Ea,{}),o.jsx(uo,{children:o.jsxs(j,{flexDirection:"column",gap:4,py:4,children:[o.jsx(Ct,{size:"sm",children:g("parameters.general")}),o.jsxs(is,{orientation:"vertical",formLabelProps:Gue,children:[o.jsxs(V,{children:[o.jsxs(j,{w:"full",children:[o.jsx(U,{children:g("nodes.animatedEdges")}),o.jsx(ot,{onChange:u,isChecked:a})]}),o.jsx(ko,{children:g("nodes.animatedEdgesHelp")})]}),o.jsx(zt,{}),o.jsxs(V,{children:[o.jsxs(j,{w:"full",children:[o.jsx(U,{children:g("nodes.snapToGrid")}),o.jsx(ot,{isChecked:n,onChange:h})]}),o.jsx(ko,{children:g("nodes.snapToGridHelp")})]}),o.jsx(zt,{}),o.jsxs(V,{children:[o.jsxs(j,{w:"full",children:[o.jsx(U,{children:g("nodes.colorCodeEdges")}),o.jsx(ot,{isChecked:r,onChange:p})]}),o.jsx(ko,{children:g("nodes.colorCodeEdgesHelp")})]}),o.jsx(zt,{}),o.jsxs(V,{children:[o.jsxs(j,{w:"full",children:[o.jsx(U,{children:g("nodes.fullyContainNodes")}),o.jsx(ot,{isChecked:s===VF.Full,onChange:f})]}),o.jsx(ko,{children:g("nodes.fullyContainNodesHelp")})]}),o.jsx(zt,{}),o.jsxs(V,{children:[o.jsxs(j,{w:"full",children:[o.jsx(U,{children:g("nodes.showEdgeLabels")}),o.jsx(ot,{isChecked:i,onChange:m})]}),o.jsx(ko,{children:g("nodes.showEdgeLabelsHelp")})]}),o.jsx(zt,{}),o.jsx(Ct,{size:"sm",pt:4,children:g("common.advanced")}),o.jsxs(V,{children:[o.jsxs(j,{w:"full",children:[o.jsx(U,{children:g("nodes.validateConnections")}),o.jsx(ot,{isChecked:c,onChange:d})]}),o.jsx(ko,{children:g("nodes.validateConnectionsHelp")})]}),o.jsx(zt,{})]}),o.jsx(Wue,{})]})})]})]})},Zue=l.memo(Uue),que=()=>{const{t:e}=S(),t=j6();return o.jsx(_e,{as:"button",icon:o.jsx(xc,{}),onClick:t.setTrue,children:e("nodes.workflowSettings")})},Kue=l.memo(que),Que=()=>{const{t:e}=S(),t=l.useRef(null),n=NP({resetRef:t}),s=l.useCallback(i=>{i[0]&&n(i[0])},[n]),{getRootProps:r,getInputProps:a}=Na({accept:{"application/json":[".json"]},onDropAccepted:s,noDrag:!0,multiple:!1});return o.jsxs(_e,{as:"button",icon:o.jsx(gc,{}),...r(),children:[e("workflows.uploadWorkflow"),o.jsx("input",{...a()})]})},Yue=l.memo(Que),Jue=()=>{const{t:e}=S(),{isOpen:t,onOpen:n,onClose:s}=Is(),r=Da();return Qd(s),o.jsxs(Ta,{isOpen:t,onOpen:n,onClose:s,isLazy:!0,children:[o.jsx(Pa,{as:Q,"aria-label":e("workflows.workflowEditorMenu"),icon:o.jsx(Nb,{}),pointerEvents:"auto"}),o.jsxs(Un,{pointerEvents:"auto",children:[o.jsx(w6,{}),o.jsx(Yue,{}),o.jsx(qn,{}),o.jsx(Vue,{}),o.jsx(Fue,{}),o.jsx(Due,{}),o.jsx(qn,{}),o.jsx(Kue,{}),r&&o.jsx(qn,{}),r&&o.jsx(Bue,{})]})]})},Xue=l.memo(Jue),ehe=()=>{const e=w(cb);return o.jsxs(j,{gap:2,top:0,left:0,right:0,position:"absolute",alignItems:"flex-start",pointerEvents:"none",children:[o.jsxs(j,{gap:"2",children:[o.jsx(Cue,{}),o.jsx(_ue,{})]}),o.jsx(dt,{}),!!e.length&&o.jsx(Pue,{}),o.jsx(dt,{}),o.jsx(jue,{}),o.jsx(kue,{}),o.jsx(Xue,{})]})},the=l.memo(ehe),nhe=()=>{const{t:e}=S(),t=E(),[n,s]=Jk(),r=Vd(),a=l.useRef();return{saveWorkflowAs:l.useCallback(async({name:c,category:d,onSuccess:u,onError:h})=>{const p=Fa.get();if(p){a.current=r({title:e("workflows.savingWorkflow"),status:"loading",duration:null,isClosable:!1});try{p.id=void 0,p.name=c,p.meta.category=d;const f=await n(p).unwrap();t(RS(f.workflow.id)),t(SS(f.workflow.name)),t(HF(f.workflow.meta.category)),t(DS()),t(bse({category:d})),u&&u(),r.update(a.current,{title:e("workflows.workflowSaved"),status:"success",duration:1e3,isClosable:!0})}catch{h&&h(),r.isActive(`auth-error-toast-${pi.endpoints.createWorkflow.name}`)?r.close(a.current):r.update(a.current,{title:e("workflows.problemSavingWorkflow"),status:"error",duration:1e3,isClosable:!0})}}},[r,n,t,e]),isLoading:s.isLoading,isError:s.isError}},she=()=>{const{isOpen:e,onClose:t,workflowName:n,setWorkflowName:s,shouldSaveToProject:r,setShouldSaveToProject:a}=Dc(),i=se(TS),{saveWorkflowAs:c}=nhe(),d=l.useRef(null),u=l.useRef(null),h=l.useCallback(g=>{s(g.target.value)},[s]),p=l.useCallback(g=>{a(g.target.checked)},[a]),f=l.useCallback(()=>{t()},[t]),m=l.useCallback(async()=>{await c({name:n,category:r?"project":"user",onSuccess:f,onError:f})},[n,c,r,f]);return o.jsx(fj,{isOpen:e,onClose:t,leastDestructiveRef:d,isCentered:!0,children:o.jsx(co,{children:o.jsxs(mj,{children:[o.jsx(Bo,{fontSize:"lg",fontWeight:"bold",children:ve("workflows.saveWorkflowAs")}),o.jsx(uo,{children:o.jsxs(V,{alignItems:"flex-start",children:[o.jsx(U,{mt:"2",children:ve("workflows.workflowName")}),o.jsxs(j,{flexDir:"column",width:"full",gap:"2",children:[o.jsx(Vt,{ref:u,value:n,onChange:h,placeholder:ve("workflows.workflowName")}),i.includes("project")&&o.jsx(kn,{isChecked:r,onChange:p,children:o.jsx(U,{children:ve("workflows.saveWorkflowToProject")})})]})]})}),o.jsxs(La,{children:[o.jsx(me,{ref:d,onClick:f,children:ve("common.cancel")}),o.jsx(me,{colorScheme:"invokeBlue",onClick:m,ml:3,isDisabled:!n||!n.length,children:ve("common.saveAs")})]})]})})})},ohe=()=>{const e=ji(),t=se(yn),n=yb(),s=xb(),r=l.useCallback((d,{nodeId:u,handleId:h,handleType:p})=>{Fe(u&&h&&p,"Invalid connection start event");const m=tf(e.getState()).find(y=>y.id===u);if(!m)return;const g=t[m.data.type];if(!g)return;const C=g[p==="source"?"outputs":"inputs"][h];C&&no.set({nodeId:u,handleId:h,handleType:p,fieldTemplate:C})},[e,t]),a=l.useCallback(d=>{const{dispatch:u}=e,h=Lp(d);u(Ko([{type:"add",item:h}])),n([h.source,h.target]),no.set(null)},[e,n]),i=l.useCallback(()=>{const{dispatch:d}=e,u=no.get(),h=ii.get(),p=Oh.get();if(h&&!p){no.set(null);return}if(!u)return;const{nodes:f,edges:m}=bt(e.getState());if(p){const{handleType:g}=u,x=g==="source"?u.nodeId:p,C=g==="source"?u.handleId:null,y=g==="target"?u.nodeId:p,v=g==="target"?u.handleId:null,I=x6(x,C,y,v,f,m,t,h);if(I){const k=Lp(I),M=[{type:"add",item:k}],_=[k.source,k.target];h&&(Kc.set(!0),M.push({type:"remove",id:h.id}),_.push(h.source,h.target)),d(Ko(M)),n(_)}no.set(null)}else s.setTrue()},[s,e,t,n]);return l.useMemo(()=>({onConnectStart:r,onConnect:a,onConnectEnd:i}),[r,a,i])},rhe=Do("workflows"),ahe=()=>{const{getState:e}=gt(),{nodes:t,edges:n}=bt(e()),s=t.filter(i=>i.selected),r=n.filter(i=>i.selected),a=n.filter(i=>s.some(c=>c.id===i.target));ik.set(s),lk.set(r),ck.set(a)},S6=e=>{const{getState:t,dispatch:n}=gt(),{nodes:s,edges:r}=bt(t()),a=yn.get(),i=bb.get(),c=cn(ik.get());let d=cn(lk.get());if(e){const I=cn(ck.get());d=jk([...d,...I],hl)}const u=c.map(I=>I.position.x),h=c.map(I=>I.position.y),p=Math.min(...u),f=Math.min(...h),m=i?i.x-p:50,g=i?i.y-f:50;c.forEach(I=>{const{x:k,y:M}=f6(s,I.position.x+m,I.position.y+g);I.position.x=k,I.position.y=M,I.selected=!0;const _=Gl();for(const A of d)A.source===I.id?A.source=_:A.target===I.id&&(A.target=_);I.id=_,I.data.id=_}),d.forEach(I=>{I.id=Gl()});const x=[],C=[];s.forEach(({id:I,selected:k})=>{k&&x.push({type:"select",id:I,selected:!1})}),c.forEach(I=>{x.push({type:"add",item:I})}),r.forEach(({id:I,selected:k})=>{k&&C.push({type:"select",id:I,selected:!1})});const y=[...s,...c],v=[...r];d.forEach(I=>{const{source:k,sourceHandle:M,target:_,targetHandle:A}=I;Fe(!Ut(M)),Fe(!Ut(A));const D=Fu({source:k,sourceHandle:M,target:_,targetHandle:A},y,v,a,null,!0);if(!D.isValid){rhe.warn({edge:{source:k,sourceHandle:M,target:_,targetHandle:A}},`Invalid edge, cannot paste: ${ve(D.messageTKey)}`);return}C.push({type:"add",item:I}),v.push(I)}),x.length>0&&n(Il(x)),C.length>0&&n(Ko(C))},ihe=()=>{S6(!1)},lhe=()=>{S6(!0)},che={copySelection:ahe,pasteSelection:ihe,pasteSelectionWithEdges:lhe},dhe=()=>che,uhe=()=>{const e=ji(),t=se(yn),n=w(ak);return l.useCallback(({source:r,sourceHandle:a,target:i,targetHandle:c})=>{if(!(r&&a&&i&&c))return!1;const d=ii.get(),{nodes:u,edges:h}=bt(e.getState());return Fu({source:r,sourceHandle:a,target:i,targetHandle:c},u,h,t,d,n).isValid},[t,n,e])},py=e=>{if(!e)return Or("base.500");const t=WF[e.name];return Or(t||"base.500")},k6=(e,t,n,s)=>({strokeWidth:3,stroke:e,opacity:t?1:.5,animation:n?"dashdraw 0.5s linear infinite":void 0,strokeDasharray:t||s?5:"none"}),hhe={opacity:.8},phe=({fromX:e,fromY:t,fromPosition:n,toX:s,toY:r,toPosition:a})=>{const i=se(no),c=w(sk),d=w(ok),u=l.useMemo(()=>c&&i?py(i.fieldTemplate.type):Or("base.500"),[i,c]),h=l.useMemo(()=>d?"react-flow__custom_connection-path animated":"react-flow__custom_connection-path",[d]),p={sourceX:e,sourceY:t,sourcePosition:n,targetX:s,targetY:r,targetPosition:a},[f]=vb(p);return o.jsx("g",{children:o.jsx("path",{fill:"none",stroke:u,strokeWidth:2,className:h,d:f,style:hhe})})},fhe=l.memo(phe),I6=()=>{const[e,t,n,s,r,a,i,c,d,u,h,p,f,m,g,x,C,y,v,I,k,M,_,A,D,N,P,z,W,X,ee,G,re,le,Ce,be,ye,ne,R,F,Z,B,K,$,Y,ae,ue,Re,we,De,Me,ht,st,We,T,H,q,de,ce,ie,J,ge,Ue,Ke,vt,In,an,Fn,_s,qs,Ks,Cn,vr,po,fo,Qs]=Yp("colors",["base.50","base.100","base.150","base.200","base.250","base.300","base.350","base.400","base.450","base.500","base.550","base.600","base.650","base.700","base.750","base.800","base.850","base.900","base.950","accent.50","accent.100","accent.150","accent.200","accent.250","accent.300","accent.350","accent.400","accent.450","accent.500","accent.550","accent.600","accent.650","accent.700","accent.750","accent.800","accent.850","accent.900","accent.950","baseAlpha.50","baseAlpha.100","baseAlpha.150","baseAlpha.200","baseAlpha.250","baseAlpha.300","baseAlpha.350","baseAlpha.400","baseAlpha.450","baseAlpha.500","baseAlpha.550","baseAlpha.600","baseAlpha.650","baseAlpha.700","baseAlpha.750","baseAlpha.800","baseAlpha.850","baseAlpha.900","baseAlpha.950","accentAlpha.50","accentAlpha.100","accentAlpha.150","accentAlpha.200","accentAlpha.250","accentAlpha.300","accentAlpha.350","accentAlpha.400","accentAlpha.450","accentAlpha.500","accentAlpha.550","accentAlpha.600","accentAlpha.650","accentAlpha.700","accentAlpha.750","accentAlpha.800","accentAlpha.850","accentAlpha.900","accentAlpha.950"]);return{base50:e,base100:t,base150:n,base200:s,base250:r,base300:a,base350:i,base400:c,base450:d,base500:u,base550:h,base600:p,base650:f,base700:m,base750:g,base800:x,base850:C,base900:y,base950:v,accent50:I,accent100:k,accent150:M,accent200:_,accent250:A,accent300:D,accent350:N,accent400:P,accent450:z,accent500:W,accent550:X,accent600:ee,accent650:G,accent700:re,accent750:le,accent800:Ce,accent850:be,accent900:ye,accent950:ne,baseAlpha50:R,baseAlpha100:F,baseAlpha150:Z,baseAlpha200:B,baseAlpha250:K,baseAlpha300:$,baseAlpha350:Y,baseAlpha400:ae,baseAlpha450:ue,baseAlpha500:Re,baseAlpha550:we,baseAlpha600:De,baseAlpha650:Me,baseAlpha700:ht,baseAlpha750:st,baseAlpha800:We,baseAlpha850:T,baseAlpha900:H,baseAlpha950:q,accentAlpha50:de,accentAlpha100:ce,accentAlpha150:ie,accentAlpha200:J,accentAlpha250:ge,accentAlpha300:Ue,accentAlpha350:Ke,accentAlpha400:vt,accentAlpha450:In,accentAlpha500:an,accentAlpha550:Fn,accentAlpha600:_s,accentAlpha650:qs,accentAlpha700:Ks,accentAlpha750:Cn,accentAlpha800:vr,accentAlpha850:po,accentAlpha900:fo,accentAlpha950:Qs}},mhe={areConnectedNodesSelected:!1,shouldAnimateEdges:!1,stroke:Or("base.500"),label:""},_6=(e,t,n,s,r)=>pt(bt,tj,(a,i)=>{var y,v;const{shouldAnimateEdges:c,shouldColorEdges:d}=i,u=a.nodes.find(I=>I.id===t),h=a.nodes.find(I=>I.id===s),p=cn(mhe);p.shouldAnimateEdges=c;const f=Br(u)&&Br(h);if(p.areConnectedNodesSelected=!!(u!=null&&u.selected||h!=null&&h.selected),!u||!n||!h||!r)return p;const m=e[u.data.type],g=e[h.data.type],x=m==null?void 0:m.outputs[n],C=f?x==null?void 0:x.type:void 0;return p.stroke=C&&d?py(C):Or("base.500"),p.label=`${(m==null?void 0:m.title)||((y=u.data)==null?void 0:y.label)} -> ${(g==null?void 0:g.title)||((v=h.data)==null?void 0:v.label)}`,p}),ghe=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:r,targetPosition:a,markerEnd:i,data:c,selected:d=!1,source:u,sourceHandleId:h,target:p,targetHandleId:f})=>{const m=se(yn),g=l.useMemo(()=>_6(m,u,h,p,f),[m,u,h,p,f]),{shouldAnimateEdges:x,areConnectedNodesSelected:C}=w(g),[y,v,I]=vb({sourceX:e,sourceY:t,sourcePosition:r,targetX:n,targetY:s,targetPosition:a}),{base500:k}=I6(),M=l.useMemo(()=>k6(k,d,x,C),[C,k,d,x]);return o.jsxs(o.Fragment,{children:[o.jsx(dk,{path:y,markerEnd:i,style:M}),(c==null?void 0:c.count)&&c.count>1&&o.jsx(uk,{children:o.jsx(j,{"data-testid":"asdfasdfasdf",position:"absolute",transform:`translate(-50%, -50%) translate(${v}px,${I}px)`,className:"nodrag nopan",zIndex:1001,children:o.jsx(Rn,{variant:"solid",bg:"base.500",opacity:d?.8:.5,boxShadow:"base",children:c.count})})})]})},xhe=l.memo(ghe),bhe=({sourceX:e,sourceY:t,targetX:n,targetY:s,sourcePosition:r,targetPosition:a,markerEnd:i,selected:c=!1,source:d,target:u,sourceHandleId:h,targetHandleId:p})=>{const f=se(yn),m=l.useMemo(()=>_6(f,d,h,u,p),[f,d,h,u,p]),{shouldAnimateEdges:g,areConnectedNodesSelected:x,stroke:C,label:y}=w(m),v=w(rk),[I,k,M]=vb({sourceX:e,sourceY:t,sourcePosition:r,targetX:n,targetY:s,targetPosition:a}),_=l.useMemo(()=>k6(C,c,g,x),[x,C,c,g]);return o.jsxs(o.Fragment,{children:[o.jsx(dk,{path:I,markerEnd:i,style:_}),y&&v&&o.jsx(uk,{children:o.jsx(j,{className:"nodrag nopan",pointerEvents:"all",position:"absolute",transform:`translate(-50%, -50%) translate(${k}px,${M}px)`,bg:"base.800",borderRadius:"base",borderWidth:1,borderColor:c?"undefined":"transparent",opacity:c?1:.5,py:1,px:3,shadow:"md",children:o.jsx(O,{size:"sm",fontWeight:"semibold",color:c?"base.100":"base.300",children:y})})})]})},yhe=l.memo(bhe),vhe=e=>{const{nodeId:t,width:n,children:s,selected:r}=e,a=ji(),{isMouseOverNode:i,handleMouseOut:c,handleMouseOver:d}=DP(t),u=rb(t),h=(u==null?void 0:u.status)===vs.enum.IN_PROGRESS,[p,f,m]=Yp("shadows",["nodeInProgress","shadows.xl","shadows.base"]),g=E(),x=w(hk),{onCloseGlobal:C}=Qd(),y=l.useCallback(v=>{if(!v.ctrlKey&&!v.altKey&&!v.metaKey&&!v.shiftKey){const I=tf(a.getState()),k=[];I.forEach(({id:M,selected:_})=>{_!==(M===t)&&k.push({type:"select",id:M,selected:M===t})}),k.length>0&&g(Il(k))}C()},[C,a,g,t]);return o.jsxs(xe,{onClick:y,onMouseEnter:d,onMouseLeave:c,className:cc,h:"full",position:"relative",borderRadius:"base",w:n||qg,transitionProperty:"common",transitionDuration:"0.1s",cursor:"grab",opacity:x,children:[o.jsx(xe,{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"base",pointerEvents:"none",shadow:`${f}, ${m}, ${m}`,zIndex:-1}),o.jsx(xe,{position:"absolute",top:0,insetInlineEnd:0,bottom:0,insetInlineStart:0,borderRadius:"md",pointerEvents:"none",transitionProperty:"common",transitionDuration:"0.1s",opacity:.7,shadow:h?p:void 0,zIndex:-1}),s,o.jsx(RP,{isSelected:r,isHovered:i})]})},mm=l.memo(vhe),Che=e=>{const t=w(Fd),n=se(Tr);return n!=null&&n.image?o.jsx(Sg,{nodeProps:e,children:o.jsx(nn,{src:n==null?void 0:n.image.dataURL,w:"full",h:"full",objectFit:"contain",borderRadius:"base"})}):t?o.jsx(Sg,{nodeProps:e,children:o.jsx(Di,{imageDTO:t,isDragDisabled:!0,useThumbailFallback:!0})}):o.jsx(Sg,{nodeProps:e,children:o.jsx(Mt,{})})},whe=l.memo(Che),Sg=e=>{const[t,n]=l.useState(!1),s=l.useCallback(()=>{n(!0)},[]),r=l.useCallback(()=>{n(!1)},[]),{t:a}=S();return o.jsx(mm,{nodeId:e.nodeProps.id,selected:e.nodeProps.selected,width:384,children:o.jsxs(j,{onMouseEnter:s,onMouseLeave:r,className:cc,position:"relative",flexDirection:"column",children:[o.jsx(j,{layerStyle:"nodeHeader",borderTopRadius:"base",alignItems:"center",justifyContent:"center",h:8,children:o.jsx(O,{fontSize:"sm",fontWeight:"semibold",color:"base.200",children:a("nodes.currentImage")})}),o.jsxs(j,{layerStyle:"nodeBody",w:"full",h:"full",borderBottomRadius:"base",p:2,children:[e.children,t&&o.jsx(Nx.div,{initial:jhe,animate:She,exit:khe,style:Ihe,children:o.jsx(mL,{inset:2})},"nextPrevButtons")]})]})})},jhe={opacity:0},She={opacity:1,transition:{duration:.1}},khe={opacity:0,transition:{duration:.1}},Ihe={position:"absolute",top:40,left:-2,right:-2,bottom:0,pointerEvents:"none"},_he=e=>e.input==="connection"&&!ca(e.type)||!Yh(pk).includes(e.type.name),Mhe=e=>(["any","direct"].includes(e.input)||ca(e.type))&&Yh(pk).includes(e.type.name),Ahe=e=>{const t=ea(e),n=om(e);return l.useMemo(()=>{const r=Yh(n.inputs),a=Yh(t.inputs),i=Ck(r,a),c=pv(t.inputs,_he).map(u=>u.name),d=pv(t.inputs,Mhe).map(u=>u.name);return{missingFields:i,connectionFields:c,anyOrDirectFields:d}},[n.inputs,t.inputs])},Ehe=e=>{const t=e.filter(r=>!r.ui_hidden),n=t.filter(r=>!Ut(r.ui_order)).sort((r,a)=>(r.ui_order??0)-(a.ui_order??0)),s=t.filter(r=>Ut(r.ui_order));return n.concat(s).map(r=>r.name).filter(r=>r!=="is_intermediate")},Lhe=e=>{const t=ea(e);return l.useMemo(()=>Ehe(To(t.outputs)),[t.outputs])},fy=e=>{const t=ea(e);return l.useMemo(()=>Gn(t==null?void 0:t.outputs,s=>s.type.name==="ImageField"&&(t==null?void 0:t.type)!=="image"),[t])},The=e=>{const t=fy(e),n=dn("invocationCache");return l.useMemo(()=>t||n,[t,n])},Phe=(e,t,n,s)=>pt(bt,(r,a)=>a,(r,a,i)=>i,(r,a,i)=>{const{nodes:c,edges:d}=r;if(!a)return Vn("nodes.noConnectionInProgress");if(s===a.handleType)return Vn(s==="source"?"nodes.cannotConnectOutputToOutput":"nodes.cannotConnectInputToInput");const u=s==="source"?t:a.nodeId,h=s==="source"?n:a.handleId,p=s==="target"?t:a.nodeId,f=s==="target"?n:a.handleId;return Fu({source:u,sourceHandle:h,target:p,targetHandle:f},c,d,e,i)}),M6=({nodeId:e,fieldName:t,kind:n})=>{const s=se(no),r=se(yn),a=se(ii),i=l.useMemo(()=>pe(bt,m=>!!m.edges.filter(g=>(n==="inputs"?g.target:g.source)===e&&(n==="inputs"?g.targetHandle:g.sourceHandle)===t).length),[t,n,e]),c=l.useMemo(()=>Phe(r,e,t,n==="inputs"?"target":"source"),[r,e,t,n]),d=w(i),u=l.useMemo(()=>!!s,[s]),h=l.useMemo(()=>s?s.nodeId===e&&s.handleId===t&&s.fieldTemplate.fieldKind==={inputs:"input",outputs:"output"}[n]:!1,[t,n,e,s]),p=w(m=>c(m,s,a)),f=l.useMemo(()=>!!(u&&!p.isValid&&!h),[p,u,h]);return{isConnected:d,isConnectionInProgress:u,isConnectionStartField:h,validationResult:p,shouldDim:f}},Rhe=(e,t)=>{const n=l.useMemo(()=>pt(bt,r=>{var i;const a=au(r,e);return a?((i=a.inputs[t])==null?void 0:i.value)!==void 0:!1}),[t,e]);return w(n)},Dhe=e=>{const{fieldTemplate:t,handleType:n,isConnectionInProgress:s,isConnectionStartField:r,validationResult:a}=e,{t:i}=S(),{name:c}=t,d=t.type,u=jP(d),h=l.useMemo(()=>{const f=GF.some(x=>x===d.name),m=py(d),g={backgroundColor:pl(d)?m:Or("base.900"),position:"absolute",width:"1rem",height:"1rem",borderWidth:pl(d)?0:4,borderStyle:"solid",borderColor:m,borderRadius:f?4:"100%",zIndex:1};return n==="target"?g.insetInlineStart="-1rem":g.insetInlineEnd="-1rem",s&&!r&&!a.isValid&&(g.filter="opacity(0.4) grayscale(0.7)"),s&&!a.isValid?r?g.cursor="grab":g.cursor="not-allowed":g.cursor="crosshair",g},[n,s,r,d,a.isValid]),p=l.useMemo(()=>s&&a.messageTKey?i(a.messageTKey):u,[u,s,i,a.messageTKey]);return o.jsx(Ae,{label:p,placement:n==="target"?"start":"end",openDelay:iu,children:o.jsx(Qc,{type:n,id:c,position:n==="target"?fl.Left:fl.Right,style:h})})},J0=l.memo(Dhe),Ohe=({nodeId:e,fieldName:t})=>{const n=E(),{t:s}=S(),r=_P(e,t),a=l.useMemo(()=>pe(qr,u=>!!u.exposedFields.find(h=>h.nodeId===e&&h.fieldName===t)),[t,e]),i=w(a),c=l.useCallback(()=>{n(UF({nodeId:e,fieldName:t,value:r}))},[n,t,e,r]),d=l.useCallback(()=>{n(MS({nodeId:e,fieldName:t}))},[n,t,e]);return i?o.jsx(Q,{variant:"ghost",tooltip:s("nodes.removeLinearView"),"aria-label":s("nodes.removeLinearView"),icon:o.jsx(rG,{}),onClick:d,pointerEvents:"auto",size:"xs"}):o.jsx(Q,{variant:"ghost",tooltip:s("nodes.addLinearView"),"aria-label":s("nodes.addLinearView"),icon:o.jsx(Bt,{}),onClick:c,pointerEvents:"auto",size:"xs"})},Nhe=l.memo(Ohe),X0=l.memo(({shouldDim:e,children:t})=>o.jsx(j,{position:"relative",minH:8,py:.5,alignItems:"center",opacity:e?.5:1,transitionProperty:"opacity",transitionDuration:"0.1s",w:"full",h:"full",children:t}));X0.displayName="InputFieldWrapper";const Bhe=({nodeId:e,fieldName:t})=>{const n=SP(e,t),s=Rhe(e,t),[r,a]=l.useState(!1),{isConnected:i,isConnectionInProgress:c,isConnectionStartField:d,validationResult:u,shouldDim:h}=M6({nodeId:e,fieldName:t,kind:"inputs"}),p=l.useMemo(()=>!n||!n.required?!1:!i&&n.input==="connection"||!s&&!i&&n.input!=="connection",[n,i,s]),f=l.useCallback(()=>{a(!0)},[]),m=l.useCallback(()=>{a(!1)},[]);return n.input==="connection"||i?o.jsxs(X0,{shouldDim:h,children:[o.jsx(V,{isInvalid:p,isDisabled:i,px:2,children:o.jsx($0,{nodeId:e,fieldName:t,kind:"inputs",isMissingInput:p,withTooltip:!0,shouldDim:!0})}),o.jsx(J0,{fieldTemplate:n,handleType:"target",isConnectionInProgress:c,isConnectionStartField:d,validationResult:u})]}):o.jsxs(X0,{shouldDim:h,children:[o.jsx(V,{isInvalid:p,isDisabled:i,pointerEvents:i?"none":"auto",orientation:"vertical",px:2,children:o.jsxs(j,{flexDir:"column",w:"full",gap:1,onMouseEnter:f,onMouseLeave:m,children:[o.jsxs(j,{children:[o.jsx($0,{nodeId:e,fieldName:t,kind:"inputs",isMissingInput:p,withTooltip:!0}),r&&o.jsx(Nhe,{nodeId:e,fieldName:t})]}),o.jsx($1,{nodeId:e,fieldName:t})]})}),n.input!=="direct"&&o.jsx(J0,{fieldTemplate:n,handleType:"target",isConnectionInProgress:c,isConnectionStartField:d,validationResult:u})]})},kg=l.memo(Bhe),$he=(e,t)=>{const n=ea(e);return l.useMemo(()=>n.outputs[t]??null,[t,n.outputs])},Fhe=({nodeId:e,fieldName:t})=>{const{t:n}=S(),s=$he(e,t),{isConnected:r,isConnectionInProgress:a,isConnectionStartField:i,validationResult:c,shouldDim:d}=M6({nodeId:e,fieldName:t,kind:"outputs"});return s?o.jsxs(ex,{shouldDim:d,children:[o.jsx(Ae,{label:o.jsx(rm,{nodeId:e,fieldName:t,kind:"outputs"}),openDelay:iu,placement:"top",shouldWrapChildren:!0,children:o.jsx(V,{isDisabled:r,pe:2,children:o.jsx(U,{mb:0,children:s==null?void 0:s.title})})}),o.jsx(J0,{fieldTemplate:s,handleType:"source",isConnectionInProgress:a,isConnectionStartField:i,validationResult:c})]}):o.jsx(ex,{shouldDim:d,children:o.jsx(V,{alignItems:"stretch",justifyContent:"space-between",gap:2,h:"full",w:"full",children:o.jsx(U,{display:"flex",alignItems:"center",h:"full",color:"error.300",mb:0,px:1,gap:2,children:n("nodes.unknownOutput",{name:t})})})})},zhe=l.memo(Fhe),ex=l.memo(({shouldDim:e,children:t})=>o.jsx(j,{position:"relative",minH:8,py:.5,alignItems:"center",opacity:e?.5:1,transitionProperty:"opacity",transitionDuration:"0.1s",justifyContent:"flex-end",children:t}));ex.displayName="OutputFieldWrapper";const Vhe=e=>{const t=l.useMemo(()=>pe(bt,s=>{var r;return((r=au(s,e))==null?void 0:r.isIntermediate)??!1}),[e]);return w(t)},Hhe=({nodeId:e})=>{const{t}=S(),n=E(),s=fy(e),r=Vhe(e),a=l.useCallback(i=>{n(ZF({nodeId:e,isIntermediate:!i.target.checked}))},[n,e]);return s?o.jsxs(V,{className:"nopan",children:[o.jsxs(U,{children:[t("nodes.saveToGallery")," "]}),o.jsx(kn,{onChange:a,isChecked:!r})]}):null},Whe=l.memo(Hhe),Ghe=e=>{const t=l.useMemo(()=>pe(bt,s=>{var r;return((r=au(s,e))==null?void 0:r.useCache)??!1}),[e]);return w(t)},Uhe=({nodeId:e})=>{const t=E(),n=Ghe(e),s=l.useCallback(a=>{t(qF({nodeId:e,useCache:a.target.checked}))},[t,e]),{t:r}=S();return o.jsxs(V,{children:[o.jsx(U,{children:r("invocationCache.useCache")}),o.jsx(kn,{className:"nopan",onChange:s,isChecked:n})]})},Zhe=l.memo(Uhe),V2={w:"unset"},qhe=({nodeId:e})=>{const t=fy(e),n=dn("invocationCache");return o.jsx(j,{className:cc,layerStyle:"nodeFooter",w:"full",borderBottomRadius:"base",gap:4,px:2,py:0,h:8,justifyContent:"space-between",children:o.jsxs(is,{formControlProps:V2,formLabelProps:V2,children:[n&&o.jsx(Zhe,{nodeId:e}),t&&o.jsx(Whe,{nodeId:e})]})})},Khe=l.memo(qhe),Qhe=({nodeId:e,isOpen:t})=>{const n=E(),s=yb(),r=l.useCallback(()=>{n(KF({nodeId:e,isOpen:!t})),s(e)},[n,t,e,s]);return o.jsx(Q,{className:"nodrag",onClick:r,"aria-label":"Minimize",minW:8,w:8,h:8,variant:"link",icon:o.jsx(it,{as:LI,transform:t?"rotate(0deg)":"rotate(180deg)",transitionProperty:"common",transitionDuration:"normal"})})},my=l.memo(Qhe),Yhe=({nodeId:e,title:t})=>{const n=E(),s=bP(e),r=yP(e),{t:a}=S(),[i,c]=l.useState(""),d=l.useCallback(h=>{n(wS({nodeId:e,label:h})),c(s||t||r||a("nodes.problemSettingTitle"))},[n,e,t,r,s,a]),u=l.useCallback(h=>{c(h)},[]);return l.useEffect(()=>{c(s||t||r||a("nodes.problemSettingTitle"))},[s,r,t,a]),o.jsx(j,{overflow:"hidden",w:"full",h:"full",alignItems:"center",justifyContent:"center",cursor:"text",children:o.jsxs(nb,{as:j,value:i,onChange:u,onSubmit:d,alignItems:"center",position:"relative",w:"full",h:"full",children:[o.jsx(sb,{fontSize:"sm",p:0,w:"full",noOfLines:1}),o.jsx(ob,{className:"nodrag",fontSize:"sm",sx:Xhe}),o.jsx(Jhe,{})]})})},A6=l.memo(Yhe);function Jhe(){const{isEditing:e,getEditButtonProps:t}=_S(),n=l.useCallback(s=>{const{onClick:r}=t();r&&r(s)},[t]);return e?null:o.jsx(xe,{className:cc,onDoubleClick:n,position:"absolute",w:"full",h:"full",top:0,cursor:"grab"})}const Xhe={p:0,fontWeight:"bold",_focusVisible:{p:0}},epe=e=>{const t=ea(e);return l.useMemo(()=>t.classification,[t])},tpe=({nodeId:e})=>{const t=epe(e);return!t||t==="stable"?null:o.jsx(Ae,{label:o.jsx(E6,{classification:t}),placement:"top",shouldWrapChildren:!0,children:o.jsx(spe,{classification:t})})},npe=l.memo(tpe),E6=l.memo(({classification:e})=>{const{t}=S();return e==="beta"?t("nodes.betaDesc"):e==="prototype"||e==="internal"?t("nodes.prototypeDesc"):null});E6.displayName="ClassificationTooltipContent";const spe=({classification:e})=>e==="beta"?o.jsx(it,{as:NI,display:"block",boxSize:4,color:"invokeYellow.300"}):e==="prototype"?o.jsx(it,{as:Rb,display:"block",boxSize:4,color:"invokeRed.300"}):e==="internal"?o.jsx(it,{as:TI,display:"block",boxSize:4,color:"invokePurple.300"}):null,H2={visibility:"hidden"},ope=({nodeId:e})=>{const t=ea(e),{base600:n}=I6(),s=l.useMemo(()=>({borderWidth:0,borderRadius:"3px",width:"1rem",height:"1rem",backgroundColor:n,zIndex:-1}),[n]),r=l.useMemo(()=>({...s,left:"-0.5rem"}),[s]),a=l.useMemo(()=>({...s,right:"-0.5rem"}),[s]);return t?o.jsxs(o.Fragment,{children:[o.jsx(Qc,{type:"target",id:`${e}-collapsed-target`,isConnectable:!1,position:fl.Left,style:r}),To(t.inputs,i=>o.jsx(Qc,{type:"target",id:i.name,isConnectable:!1,position:fl.Left,style:H2},`${e}-${i.name}-collapsed-input-handle`)),o.jsx(Qc,{type:"source",id:`${e}-collapsed-source`,isConnectable:!1,position:fl.Right,style:a}),To(t.outputs,i=>o.jsx(Qc,{type:"source",id:i.name,isConnectable:!1,position:fl.Right,style:H2},`${e}-${i.name}-collapsed-output-handle`))]}):null},rpe=l.memo(ope),ape=({nodeId:e})=>{const t=xP(e);return o.jsx(Ae,{label:o.jsx(L6,{nodeId:e}),placement:"top",shouldWrapChildren:!0,children:o.jsx(it,{as:Li,display:"block",boxSize:4,w:8,color:t?"error.400":"base.400"})})},ipe=l.memo(ape),L6=l.memo(({nodeId:e})=>{const t=om(e),n=ea(e),{t:s}=S(),r=l.useMemo(()=>t!=null&&t.label&&(n!=null&&n.title)?`${t.label} (${n.title})`:t!=null&&t.label&&!n?t.label:!(t!=null&&t.label)&&n?n.title:s("nodes.unknownNode"),[t,n,s]),a=l.useMemo(()=>!Wg(t)||!n?null:t.version?n.version?sv(t.version,n.version,"<")?o.jsxs(O,{as:"span",color:"error.500",children:[s("nodes.version")," ",t.version," (",s("nodes.updateNode"),")"]}):sv(t.version,n.version,">")?o.jsxs(O,{as:"span",color:"error.500",children:[s("nodes.version")," ",t.version," (",s("nodes.updateApp"),")"]}):o.jsxs(O,{as:"span",children:[s("nodes.version")," ",t.version]}):o.jsxs(O,{as:"span",color:"error.500",children:[s("nodes.version")," ",t.version," (",s("nodes.unknownTemplate"),")"]}):o.jsx(O,{as:"span",color:"error.500",children:s("nodes.versionUnknown")}),[t,n,s]);return Wg(t)?o.jsxs(j,{flexDir:"column",children:[o.jsx(O,{as:"span",fontWeight:"semibold",children:r}),(n==null?void 0:n.nodePack)&&o.jsxs(O,{opacity:.7,children:[s("nodes.nodePack"),": ",n.nodePack]}),o.jsx(O,{opacity:.7,fontStyle:"oblique 5deg",children:n==null?void 0:n.description}),a,(t==null?void 0:t.notes)&&o.jsx(O,{children:t.notes})]}):o.jsx(O,{fontWeight:"semibold",children:s("nodes.unknownNode")})});L6.displayName="TooltipContent";const Ig=3,W2={circle:{transitionProperty:"none",transitionDuration:"0s"},".chakra-progress__track":{stroke:"transparent"}},lpe=({nodeId:e})=>{const t=rb(e);return t?o.jsx(Ae,{label:o.jsx(T6,{nodeExecutionState:t}),placement:"top",children:o.jsx(j,{className:cc,w:5,h:"full",alignItems:"center",justifyContent:"flex-end",children:o.jsx(P6,{nodeExecutionState:t})})}):null},cpe=l.memo(lpe),T6=l.memo(({nodeExecutionState:e})=>{const{status:t,progress:n,progressImage:s}=e,{t:r}=S();return t===vs.enum.PENDING?o.jsx(O,{children:r("queue.pending")}):t===vs.enum.IN_PROGRESS?s?o.jsxs(j,{pos:"relative",pt:1.5,pb:.5,children:[o.jsx(nn,{src:s.dataURL,w:32,h:32,borderRadius:"base",objectFit:"contain"}),n!==null&&o.jsxs(Rn,{variant:"solid",pos:"absolute",top:2.5,insetInlineEnd:1,children:[Math.round(n*100),"%"]})]}):n!==null?o.jsxs(O,{children:[r("nodes.executionStateInProgress")," (",Math.round(n*100),"%)"]}):o.jsx(O,{children:r("nodes.executionStateInProgress")}):t===vs.enum.COMPLETED?o.jsx(O,{children:r("nodes.executionStateCompleted")}):t===vs.enum.FAILED?o.jsx(O,{children:r("nodes.executionStateError")}):null});T6.displayName="TooltipLabel";const P6=l.memo(e=>{const{progress:t,status:n}=e.nodeExecutionState;return n===vs.enum.PENDING?o.jsx(it,{as:Nb,boxSize:Ig,color:"base.300"}):n===vs.enum.IN_PROGRESS?t===null?o.jsx(ov,{isIndeterminate:!0,size:"14px",color:"base.500",thickness:14,sx:W2}):o.jsx(ov,{value:Math.round(t*100),size:"14px",color:"base.500",thickness:14,sx:W2}):n===vs.enum.COMPLETED?o.jsx(it,{as:Ei,boxSize:Ig,color:"ok.300"}):n===vs.enum.FAILED?o.jsx(it,{as:lf,boxSize:Ig,color:"error.300"}):null});P6.displayName="StatusIcon";const dpe=({nodeId:e,isOpen:t})=>o.jsxs(j,{layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:t?0:"base",alignItems:"center",justifyContent:"space-between",h:8,textAlign:"center",color:"base.200",children:[o.jsx(my,{nodeId:e,isOpen:t}),o.jsx(npe,{nodeId:e}),o.jsx(A6,{nodeId:e}),o.jsxs(j,{alignItems:"center",children:[o.jsx(cpe,{nodeId:e}),o.jsx(ipe,{nodeId:e})]}),!t&&o.jsx(rpe,{nodeId:e})]}),upe=l.memo(dpe),hpe=({nodeId:e,isOpen:t,label:n,type:s,selected:r})=>{const a=Ahe(e),i=The(e),c=Lhe(e);return o.jsxs(mm,{nodeId:e,selected:r,children:[o.jsx(upe,{nodeId:e,isOpen:t,label:n,selected:r,type:s}),t&&o.jsxs(o.Fragment,{children:[o.jsx(j,{layerStyle:"nodeBody",flexDirection:"column",w:"full",h:"full",py:2,gap:1,borderBottomRadius:i?0:"base",children:o.jsxs(j,{flexDir:"column",px:2,w:"full",h:"full",children:[o.jsxs(va,{gridTemplateColumns:"1fr auto",gridAutoRows:"1fr",children:[a.connectionFields.map((d,u)=>o.jsx(ln,{gridColumnStart:1,gridRowStart:u+1,children:o.jsx(Dl,{nodeId:e,fieldName:d,children:o.jsx(kg,{nodeId:e,fieldName:d})})},`${e}.${d}.input-field`)),c.map((d,u)=>o.jsx(ln,{gridColumnStart:2,gridRowStart:u+1,children:o.jsx(zhe,{nodeId:e,fieldName:d})},`${e}.${d}.output-field`))]}),a.anyOrDirectFields.map(d=>o.jsx(Dl,{nodeId:e,fieldName:d,children:o.jsx(kg,{nodeId:e,fieldName:d})},`${e}.${d}.input-field`)),a.missingFields.map(d=>o.jsx(Dl,{nodeId:e,fieldName:d,children:o.jsx(kg,{nodeId:e,fieldName:d})},`${e}.${d}.input-field`))]})}),i&&o.jsx(Khe,{nodeId:e})]})]})},ppe=l.memo(hpe),fpe=e=>{const t=l.useMemo(()=>pe(bt,s=>{var r;return((r=au(s,e))==null?void 0:r.nodePack)??null}),[e]);return w(t)},mpe=({nodeId:e,isOpen:t,label:n,type:s,selected:r})=>{const{t:a}=S(),i=fpe(e);return o.jsxs(mm,{nodeId:e,selected:r,children:[o.jsxs(j,{className:cc,layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:t?0:"base",alignItems:"center",h:8,fontWeight:"semibold",fontSize:"sm",children:[o.jsx(my,{nodeId:e,isOpen:t}),o.jsx(O,{w:"full",textAlign:"center",pe:8,color:"error.300",children:n?`${n} (${s})`:s})]}),t&&o.jsx(j,{layerStyle:"nodeBody",userSelect:"auto",flexDirection:"column",w:"full",h:"full",p:4,gap:1,borderBottomRadius:"base",fontSize:"sm",children:o.jsxs(j,{gap:2,flexDir:"column",children:[o.jsxs(O,{as:"span",children:[a("nodes.unknownNodeType"),":"," ",o.jsx(O,{as:"span",fontWeight:"semibold",children:s})]}),i&&o.jsxs(O,{as:"span",children:[a("nodes.nodePack"),":"," ",o.jsx(O,{as:"span",fontWeight:"semibold",children:i})]})]})})]})},gpe=l.memo(mpe),xpe=e=>{const{data:t,selected:n}=e,{id:s,type:r,isOpen:a,label:i}=t,c=se(yn),d=l.useMemo(()=>!!c[r],[c,r]),u=l.useMemo(()=>pe(tf,p=>!!p.find(f=>f.id===s)),[s]);return w(u)?d?o.jsx(ppe,{nodeId:s,isOpen:a,label:i,type:r,selected:n}):o.jsx(gpe,{nodeId:s,isOpen:a,label:i,type:r,selected:n}):null},bpe=l.memo(xpe),ype=e=>{const{id:t,data:n,selected:s}=e,{notes:r,isOpen:a}=n,i=E(),c=l.useCallback(d=>{i(QF({nodeId:t,value:d.target.value}))},[i,t]);return o.jsxs(mm,{nodeId:t,selected:s,children:[o.jsxs(j,{layerStyle:"nodeHeader",borderTopRadius:"base",borderBottomRadius:a?0:"base",alignItems:"center",justifyContent:"space-between",h:8,children:[o.jsx(my,{nodeId:t,isOpen:a}),o.jsx(A6,{nodeId:t,title:"Notes"}),o.jsx(xe,{minW:8})]}),a&&o.jsx(o.Fragment,{children:o.jsx(j,{layerStyle:"nodeBody",className:"nopan",cursor:"auto",flexDirection:"column",borderBottomRadius:"base",w:"full",h:"full",p:2,gap:1,children:o.jsx(j,{className:"nopan",w:"full",h:"full",flexDir:"column",children:o.jsx(ls,{className:"nodrag",value:r,onChange:c,rows:8,resize:"none",fontSize:"sm"})})})})]})},vpe=l.memo(ype),Cpe={collapsed:xhe,default:yhe},wpe={invocation:bpe,current_image:whe,notes:vpe},jpe={hideAttribution:!0},Spe=[25,25],kpe=e=>e.cancelConnection,R6=l.memo(()=>{const e=E(),t=w(tf),n=w(YF),s=se(av),r=se(rv),a=w(JF),i=w(XF),c=w(tk),d=w(nk),{onConnectStart:u,onConnect:h,onConnectEnd:p}=ohe(),f=l.useRef(null),m=uhe(),g=xd(kpe),x=yb(),C=ji(),y=js("workflows");Oa("workflows",f),$ne(),e7();const[v]=Yp("radii",["base"]),I=l.useMemo(()=>({borderRadius:v}),[v]),k=l.useCallback(ye=>{e(Il(ye));const ne=wm.get();ne&&r&&(rv.set(!1),ne.fitView())},[e,r]),M=l.useCallback(ye=>{ye.length>0&&e(Ko(ye))},[e]),_=l.useCallback((ye,ne)=>{av.set(ne)},[]),{onCloseGlobal:A}=Qd(),D=l.useCallback(()=>{A()},[A]),N=l.useCallback(ye=>{wm.set(ye),ye.fitView()},[]),P=l.useCallback(ye=>{var ne,R;(ne=f.current)!=null&&ne.getBoundingClientRect()&&bb.set(((R=wm.get())==null?void 0:R.screenToFlowPosition({x:ye.clientX,y:ye.clientY}))??null)},[]),z=l.useCallback((ye,ne,R)=>{ii.set(ne),Kc.set(!1),jm.set(ye)},[]),W=l.useCallback((ye,ne)=>{Kc.set(!0);const R=Lp(ne);e(Ko([{type:"remove",id:ye.id},{type:"add",item:R}])),x([ye.source,ye.target,R.source,R.target])},[e,x]),X=l.useCallback((ye,ne,R)=>{const F=Kc.get(),Z=jm.get()??{clientX:0,clientY:0},B=!("touches"in ye)&&Math.hypot(ye.clientX-Z.clientX,ye.clientY-Z.clientY)>5;!F&&B&&e(Ko([{type:"remove",id:ne.id}])),ii.set(null),Kc.set(!1),no.set(null),jm.set(null)},[e]),{copySelection:ee,pasteSelection:G,pasteSelectionWithEdges:re}=dhe();Ie({id:"copySelection",category:"workflows",callback:ee,options:{preventDefault:!0},dependencies:[ee]});const le=l.useCallback(()=>{const{nodes:ye,edges:ne}=bt(C.getState()),R=[],F=[];ye.forEach(({id:Z,selected:B})=>{B||R.push({type:"select",id:Z,selected:!0})}),ne.forEach(({id:Z,selected:B})=>{B||F.push({type:"select",id:Z,selected:!0})}),R.length>0&&e(Il(R)),F.length>0&&e(Ko(F))},[e,C]);Ie({id:"selectAll",category:"workflows",callback:le,options:{enabled:y,preventDefault:!0},dependencies:[le,y]}),Ie({id:"pasteSelection",category:"workflows",callback:G,options:{preventDefault:!0},dependencies:[G]}),Ie({id:"pasteSelectionWithEdges",category:"workflows",callback:re,options:{preventDefault:!0},dependencies:[re]}),Ie({id:"undo",category:"workflows",callback:()=>{e(s7())},options:{enabled:a,preventDefault:!0},dependencies:[a]}),Ie({id:"redo",category:"workflows",callback:()=>{e(o7())},options:{enabled:i,preventDefault:!0},dependencies:[i]});const Ce=l.useCallback(()=>{ii.get()||(no.set(null),t7.set(!1),g())},[g]);lo("esc",Ce);const be=l.useCallback(()=>{const{nodes:ye,edges:ne}=bt(C.getState()),R=[],F=[];ye.filter(Z=>Z.selected).forEach(({id:Z})=>{R.push({type:"remove",id:Z})}),ne.filter(Z=>Z.selected).forEach(({id:Z})=>{F.push({type:"remove",id:Z})}),R.length>0&&e(Il(R)),F.length>0&&e(Ko(F))},[e,C]);return Ie({id:"deleteSelection",category:"workflows",callback:be,options:{preventDefault:!0,enabled:y},dependencies:[be,y]}),o.jsx(n7,{id:"workflow-editor",ref:f,defaultViewport:s,nodeTypes:wpe,edgeTypes:Cpe,nodes:t,edges:n,onInit:N,onMouseMove:P,onNodesChange:k,onEdgesChange:M,onEdgeUpdate:W,onEdgeUpdateStart:z,onEdgeUpdateEnd:X,onConnectStart:u,onConnect:h,onConnectEnd:p,onMoveEnd:_,connectionLineComponent:fhe,isValidConnection:m,minZoom:.1,snapToGrid:c,snapGrid:Spe,connectionRadius:30,proOptions:jpe,style:I,onPaneClick:D,deleteKeyCode:null,selectionMode:d,elevateEdgesOnSelect:!0,nodeDragThreshold:1,children:o.jsx(H9,{})})});R6.displayName="Flow";const Ipe=()=>{const e=E(),t=w(hk),{t:n}=S(),s=l.useCallback(r=>{e(r7(r))},[e]);return o.jsx(j,{alignItems:"center",children:o.jsx(qe,{"aria-label":n("nodes.nodeOpacity"),value:t,defaultValue:1,min:.5,max:1,step:.01,onChange:s,orientation:"vertical",h:"calc(100% - 0.5rem)"})})},_pe=l.memo(Ipe),Mpe=()=>{const{t:e}=S(),{zoomIn:t,zoomOut:n,fitView:s}=XS(),r=E(),a=w(fk),i=l.useCallback(()=>{t({duration:300})},[t]),c=l.useCallback(()=>{n({duration:300})},[n]),d=l.useCallback(()=>{s({duration:300})},[s]),u=l.useCallback(()=>{r(a7(!a))},[a,r]);return o.jsxs(Tn,{orientation:"vertical",children:[o.jsx(Q,{tooltip:e("nodes.zoomInNodes"),"aria-label":e("nodes.zoomInNodes"),onClick:i,icon:o.jsx(HI,{})}),o.jsx(Q,{tooltip:e("nodes.zoomOutNodes"),"aria-label":e("nodes.zoomOutNodes"),onClick:c,icon:o.jsx(VI,{})}),o.jsx(Q,{tooltip:e("nodes.fitViewportNodes"),"aria-label":e("nodes.fitViewportNodes"),onClick:d,icon:o.jsx(vu,{})}),o.jsx(Q,{tooltip:e(a?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),"aria-label":e(a?"nodes.hideMinimapnodes":"nodes.showMinimapnodes"),isChecked:a,onClick:u,icon:o.jsx(oG,{})})]})},Ape=l.memo(Mpe),Epe=()=>o.jsxs(j,{gap:2,position:"absolute",bottom:0,insetInlineStart:0,children:[o.jsx(Ape,{}),o.jsx(_pe,{})]}),Lpe=l.memo(Epe),Tpe=Kd(N9),Ppe={m:"0 !important",borderRadius:"base",backgroundColor:"base.500 !important",svg:{borderRadius:"inherit"}},Rpe=()=>{const e=w(fk);return o.jsx(j,{gap:2,position:"absolute",bottom:0,insetInlineEnd:0,children:e&&o.jsx(Tpe,{pannable:!0,zoomable:!0,nodeBorderRadius:15,sx:Ppe,nodeColor:"var(--invoke-colors-base-600)",maskColor:"var(--invoke-colors-blackAlpha-600)"})})},Dpe=l.memo(Rpe),Ope=()=>{const{data:e,isLoading:t}=Qp(),{t:n}=S(),s=l.useRef(null);return Oa("workflows",s),o.jsxs(j,{tabIndex:-1,ref:s,layerStyle:"first",position:"relative",width:"full",height:"full",borderRadius:"base",alignItems:"center",justifyContent:"center",children:[e&&o.jsxs(o.Fragment,{children:[o.jsx(R6,{}),o.jsx(b6,{}),o.jsx(the,{}),o.jsx(Lpe,{}),o.jsx(Dpe,{}),o.jsx(she,{}),o.jsx(Oue,{})]}),o.jsx(Zue,{}),t&&o.jsx(Mt,{label:n("nodes.loadingNodes"),icon:of})]})},Npe=l.memo(Ope),D6=l.memo(()=>w(lu)==="edit"?o.jsx(i7,{children:o.jsx(Npe,{})}):o.jsx(em,{}));D6.displayName="WorkflowsTabContent";const O6="data:image/svg+xml,%3csvg%20width='44'%20height='44'%20viewBox='0%200%2044%2044'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cpath%20d='M29.1951%2010.6667H42V2H2V10.6667H14.8049L29.1951%2033.3333H42V42H2V33.3333H14.8049'%20stroke='%23E6FD13'%20stroke-width='2.8'/%3e%3c/svg%3e",Bpe=()=>{const{data:e}=Cb(),t=l.useRef(null),n=se(l7),s=l.useMemo(()=>e?o.jsxs(O,{fontWeight:"semibold",children:["v",e.version]}):null,[e]);return n||o.jsx(Ae,{placement:"right",label:s,p:1,px:2,gutter:16,children:o.jsx(nn,{ref:t,src:O6,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"})})},$pe=l.memo(Bpe),tx="http://github.com/invoke-ai/InvokeAI",N6="https://discord.gg/ZmtBAhwWhy",G2="https://www.invoke.com/",Fpe="data:image/svg+xml,%3csvg%20width='231'%20height='100'%20viewBox='0%200%20231%20100'%20fill='none'%20xmlns='http://www.w3.org/2000/svg'%3e%3cg%20clip-path='url(%23clip0_659_3578)'%3e%3crect%20width='100'%20height='100'%20fill='%23E6FD13'/%3e%3cpath%20d='M57.1951%2038.6667H70V30H30V38.6667H42.8049L57.1951%2061.3333H70V70H30V61.3333H42.8049'%20stroke='%23181818'%20stroke-width='2.8'/%3e%3crect%20width='131'%20height='100'%20transform='translate(100)'%20fill='%23E6FD13'/%3e%3cpath%20d='M111.37%2043.34H107.89V39.65H111.37V43.34ZM116.38%2060.5H102.76V58.16H108.22V47.84H103.36V45.5H111.07V58.16H116.38V60.5ZM120.538%2060.5V45.5H123.388V47.6C124.288%2046.25%20125.788%2045.2%20128.188%2045.2C131.638%2045.2%20133.588%2047.3%20133.588%2050.45V60.5H130.738V51.05C130.738%2048.95%20129.838%2047.6%20127.708%2047.6H127.468C125.338%2047.6%20123.388%2049.25%20123.388%2052.1V60.5H120.538ZM141.786%2060.5L136.236%2045.5H139.176L143.526%2057.71L147.876%2045.5H150.786L145.236%2060.5H141.786ZM159.723%2060.8C155.673%2060.8%20152.523%2057.65%20152.523%2053C152.523%2048.35%20155.673%2045.2%20159.723%2045.2C163.773%2045.2%20166.923%2048.35%20166.923%2053C166.923%2057.65%20163.773%2060.8%20159.723%2060.8ZM155.373%2053C155.373%2056.45%20157.173%2058.4%20159.603%2058.4H159.843C162.273%2058.4%20164.073%2056.45%20164.073%2053C164.073%2049.55%20162.273%2047.6%20159.843%2047.6H159.603C157.173%2047.6%20155.373%2049.55%20155.373%2053ZM170.804%2060.5V39.5H173.654V51.98L180.254%2045.5H184.004L177.764%2051.47L184.304%2060.5H180.794L175.724%2053.42L173.654%2055.43V60.5H170.804ZM192.459%2060.8C188.739%2060.8%20185.379%2058.22%20185.379%2052.97C185.379%2047.78%20188.829%2045.2%20192.369%2045.2C196.269%2045.2%20198.729%2047.9%20198.729%2051.8V53.45H188.229C188.409%2056.87%20190.599%2058.4%20192.429%2058.4H192.669C194.139%2058.4%20195.549%2057.65%20195.849%2056.06H198.699C198.159%2059.09%20195.549%2060.8%20192.459%2060.8ZM188.409%2051.2H195.879C195.759%2048.59%20194.199%2047.6%20192.489%2047.6H192.249C190.689%2047.6%20188.949%2048.53%20188.409%2051.2Z'%20fill='%23181818'/%3e%3c/g%3e%3cdefs%3e%3cclipPath%20id='clip0_659_3578'%3e%3crect%20width='231'%20height='100'%20rx='5'%20fill='white'/%3e%3c/clipPath%3e%3c/defs%3e%3c/svg%3e",zpe=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=Is(),{t:r}=S(),{depsArray:a,depsObject:i}=c7(void 0,{selectFromResult:({data:u})=>({depsObject:u,depsArray:u?To(u,(h,p)=>({name:p,version:h})):[]})}),{data:c}=Cb(),d=l.useCallback(()=>{navigator.clipboard.writeText(JSON.stringify(i,null,2))},[i]);return o.jsxs(o.Fragment,{children:[l.cloneElement(e,{onClick:n}),o.jsxs(fr,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,children:[o.jsx(co,{}),o.jsxs(mr,{maxH:"80vh",h:"34rem",children:[o.jsx(Bo,{children:r("accessibility.about")}),o.jsx(Ea,{}),o.jsx(uo,{display:"flex",flexDir:"column",gap:4,children:o.jsxs(va,{templateColumns:"repeat(2, 1fr)",h:"full",children:[o.jsx(ln,{backgroundColor:"base.750",borderRadius:"base",p:"4",h:"full",children:o.jsxs(Nn,{children:[o.jsxs(j,{position:"sticky",top:"0",backgroundColor:"base.750",p:1,alignItems:"center",children:[o.jsx(Ct,{size:"md",children:r("common.localSystem")}),o.jsx(dt,{}),o.jsx(Ae,{label:r("common.copy"),children:o.jsx(Q,{onClick:d,isDisabled:!i,"aria-label":r("common.copy"),icon:o.jsx(gr,{}),variant:"ghost"})})]}),a.map(({name:u,version:h},p)=>o.jsxs(va,{py:"2",px:"1",w:"full",templateColumns:"repeat(2, 1fr)",children:[o.jsx(O,{children:u}),o.jsx(O,{children:h||r("common.notInstalled")})]},p))]})}),o.jsx(ln,{children:o.jsxs(j,{flexDir:"column",gap:3,justifyContent:"center",alignItems:"center",h:"full",children:[o.jsx(nn,{src:Fpe,alt:"invoke-logo",w:"120px"}),c&&o.jsx(O,{children:`v${c==null?void 0:c.version}`}),o.jsxs(va,{templateColumns:"repeat(2, 1fr)",gap:"3",children:[o.jsx(ln,{children:o.jsx(wa,{href:tx,label:r("common.githubLabel")})}),o.jsx(ln,{children:o.jsx(wa,{href:N6,label:r("common.discordLabel")})})]}),o.jsx(Ct,{fontSize:"large",children:r("common.aboutHeading")}),o.jsx(O,{fontSize:"sm",children:r("common.aboutDesc")}),o.jsx(wa,{href:G2,label:G2})]})})]})}),o.jsx(La,{})]})]})]})},Vpe=l.memo(zpe),Hpe=({hotkey:e})=>{const{t}=S(),{id:n,platformKeys:s,title:r,desc:a}=e;return o.jsxs(j,{flexDir:"column",gap:2,px:2,children:[o.jsxs(j,{lineHeight:1,gap:1,alignItems:"center",children:[o.jsx(O,{fontWeight:"semibold",children:r}),o.jsx(dt,{}),s.map((i,c)=>o.jsxs(l.Fragment,{children:[i.map((d,u)=>o.jsxs(l.Fragment,{children:[o.jsx(qc,{textTransform:"lowercase",children:d}),u!==i.length-1&&o.jsx(O,{as:"span",fontWeight:"semibold",children:"+"})]},`${n}-${d}-${c}-${u}`)),c!==s.length-1&&o.jsx(O,{as:"span",px:2,variant:"subtext",fontWeight:"semibold",children:t("common.or")})]},`${n}-${c}`))]}),o.jsx(O,{variant:"subtext",children:a})]})},Wpe=l.memo(Hpe),Gpe=({children:e})=>{const{isOpen:t,onOpen:n,onClose:s}=Is(),{t:r}=S(),[a,i]=l.useState(""),c=l.useRef(null),d=l.useCallback(()=>i(""),[]),u=l.useCallback(f=>i(f.target.value),[]),h=Gk(),p=l.useMemo(()=>{const f=a.trim().toLowerCase(),m=[];return Object.values(h).forEach(g=>{const x={title:g.title,hotkeys:[]};Object.values(g.hotkeys).forEach(C=>{f.length?(C.title.toLowerCase().includes(f)||C.desc.toLowerCase().includes(f)||C.category.toLowerCase().includes(f)||C.platformKeys.some(y=>y.some(v=>v.toLowerCase().includes(f))))&&x.hotkeys.push(C):x.hotkeys.push(C)}),x.hotkeys.length&&m.push(x)}),m},[h,a]);return o.jsxs(o.Fragment,{children:[l.cloneElement(e,{onClick:n}),o.jsxs(fr,{isOpen:t,onClose:s,isCentered:!0,size:"2xl",useInert:!1,initialFocusRef:c,children:[o.jsx(co,{}),o.jsxs(mr,{maxH:"80vh",h:"80vh",children:[o.jsx(Bo,{children:r("hotkeys.hotkeys")}),o.jsx(Ea,{}),o.jsxs(uo,{display:"flex",flexDir:"column",gap:4,children:[o.jsxs(Ur,{children:[o.jsx(Vt,{ref:c,placeholder:r("hotkeys.searchHotkeys"),value:a,onChange:u}),a.length&&o.jsx(ar,{h:"full",pe:2,children:o.jsx(Q,{onClick:d,size:"sm",variant:"ghost","aria-label":r("hotkeys.clearSearch"),boxSize:4,icon:o.jsx(sn,{})})})]}),o.jsx(Nn,{children:o.jsxs(j,{flexDir:"column",gap:4,children:[p.map(f=>o.jsx(_r,{title:f.title,children:f.hotkeys.map((m,g)=>o.jsxs(l.Fragment,{children:[o.jsx(Wpe,{hotkey:m}),g<f.hotkeys.length-1&&o.jsx(zt,{})]},m.id))},f.title)),!p.length&&o.jsx(Mt,{label:r("hotkeys.noHotkeysFound"),icon:null})]})})]}),o.jsx(La,{})]})]})]})},Upe=l.memo(Gpe);function Zpe(e){return oe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M19.3034 5.33716C17.9344 4.71103 16.4805 4.2547 14.9629 4C14.7719 4.32899 14.5596 4.77471 14.411 5.12492C12.7969 4.89144 11.1944 4.89144 9.60255 5.12492C9.45397 4.77471 9.2311 4.32899 9.05068 4C7.52251 4.2547 6.06861 4.71103 4.70915 5.33716C1.96053 9.39111 1.21766 13.3495 1.5891 17.2549C3.41443 18.5815 5.17612 19.388 6.90701 19.9187C7.33151 19.3456 7.71356 18.73 8.04255 18.0827C7.41641 17.8492 6.82211 17.5627 6.24904 17.2231C6.39762 17.117 6.5462 17.0003 6.68416 16.8835C10.1438 18.4648 13.8911 18.4648 17.3082 16.8835C17.4568 17.0003 17.5948 17.117 17.7434 17.2231C17.1703 17.5627 16.576 17.8492 15.9499 18.0827C16.2789 18.73 16.6609 19.3456 17.0854 19.9187C18.8152 19.388 20.5875 18.5815 22.4033 17.2549C22.8596 12.7341 21.6806 8.80747 19.3034 5.33716ZM8.5201 14.8459C7.48007 14.8459 6.63107 13.9014 6.63107 12.7447C6.63107 11.5879 7.45884 10.6434 8.5201 10.6434C9.57071 10.6434 10.4303 11.5879 10.4091 12.7447C10.4091 13.9014 9.57071 14.8459 8.5201 14.8459ZM15.4936 14.8459C14.4535 14.8459 13.6034 13.9014 13.6034 12.7447C13.6034 11.5879 14.4323 10.6434 15.4936 10.6434C16.5442 10.6434 17.4038 11.5879 17.3825 12.7447C17.3825 13.9014 16.5548 14.8459 15.4936 14.8459Z"},child:[]}]})(e)}function qpe(e){return oe({tag:"svg",attr:{viewBox:"0 0 24 24",fill:"currentColor"},child:[{tag:"path",attr:{d:"M12.001 2C6.47598 2 2.00098 6.475 2.00098 12C2.00098 16.425 4.86348 20.1625 8.83848 21.4875C9.33848 21.575 9.52598 21.275 9.52598 21.0125C9.52598 20.775 9.51348 19.9875 9.51348 19.15C7.00098 19.6125 6.35098 18.5375 6.15098 17.975C6.03848 17.6875 5.55098 16.8 5.12598 16.5625C4.77598 16.375 4.27598 15.9125 5.11348 15.9C5.90098 15.8875 6.46348 16.625 6.65098 16.925C7.55098 18.4375 8.98848 18.0125 9.56348 17.75C9.65098 17.1 9.91348 16.6625 10.201 16.4125C7.97598 16.1625 5.65098 15.3 5.65098 11.475C5.65098 10.3875 6.03848 9.4875 6.67598 8.7875C6.57598 8.5375 6.22598 7.5125 6.77598 6.1375C6.77598 6.1375 7.61348 5.875 9.52598 7.1625C10.326 6.9375 11.176 6.825 12.026 6.825C12.876 6.825 13.726 6.9375 14.526 7.1625C16.4385 5.8625 17.276 6.1375 17.276 6.1375C17.826 7.5125 17.476 8.5375 17.376 8.7875C18.0135 9.4875 18.401 10.375 18.401 11.475C18.401 15.3125 16.0635 16.1625 13.8385 16.4125C14.201 16.725 14.5135 17.325 14.5135 18.2625C14.5135 19.6 14.501 20.675 14.501 21.0125C14.501 21.275 14.6885 21.5875 15.1885 21.4875C19.259 20.1133 21.9999 16.2963 22.001 12C22.001 6.475 17.526 2 12.001 2Z"},child:[]}]})(e)}const B6=l.memo(()=>{const{t:e}=S(),t=Vx(),n=w(Xw),s=l.useCallback(r=>{t(mk(r.target.checked))},[t]);return o.jsxs(V,{children:[o.jsx(U,{children:e("system.enableLogging")}),o.jsx(ot,{isChecked:n,onChange:s})]})});B6.displayName="SettingsDeveloperLogIsEnabled";const $6=l.memo(()=>{const{t:e}=S(),t=E(),n=w(Yw),s=l.useMemo(()=>d7.options.map(i=>({label:e(`system.logLevel.${i}`),value:i})),[e]),r=l.useMemo(()=>s.find(i=>i.value===n),[n,s]),a=l.useCallback(i=>{u7(i==null?void 0:i.value)&&t(h7(i.value))},[t]);return o.jsxs(V,{children:[o.jsx(U,{children:e("system.logLevel.logLevel")}),o.jsx(Ne,{value:r,options:s,onChange:a,isSearchable:!1})]})});$6.displayName="SettingsDeveloperLogLevel";const F6=l.memo(()=>{const{t:e}=S(),t=w(Jw),n=l.useMemo(()=>Ck(p7.options,t),[t]);return o.jsxs(V,{orientation:"vertical",children:[o.jsx(U,{children:e("system.logNamespaces.logNamespaces")}),o.jsx(j,{w:"full",gap:2,flexWrap:"wrap",minH:"32px",borderRadius:"base",borderWidth:1,p:2,alignItems:"center",children:t.map(s=>o.jsx(U2,{namespace:s,isEnabled:!0},`enabled-${s}`))}),o.jsx(j,{gap:2,flexWrap:"wrap",children:n.map(s=>o.jsx(U2,{namespace:s,isEnabled:!1},`disabled-${s}`))})]})});F6.displayName="SettingsDeveloperLogNamespaces";const U2=({namespace:e,isEnabled:t})=>{const{t:n}=S(),s=Vx(),r=l.useCallback(()=>{s(f7(e))},[s,e]);return o.jsxs(eb,{h:"min-content",borderRadius:"base",onClick:r,colorScheme:t?"invokeBlue":"base",userSelect:"none",role:"button",size:"md",color:"base.900",bg:t?"invokeBlue.300":"base.300",children:[o.jsx(O,{fontSize:"sm",fontWeight:"semibold",children:n(`system.logNamespaces.${e}`)}),t&&o.jsx(tb,{})]})},Kpe=e=>{const{t}=S(),{data:n,refetch:s}=m7(void 0,{refetchOnMountOrArgChange:!0,skip:!e}),[r,{isLoading:a}]=g7(),{data:i}=Oo(),c=l.useMemo(()=>!!(i&&(i.queue.in_progress>0||i.queue.pending>0)),[i]),d=l.useCallback(()=>{c||r().unwrap().then(u=>{he({id:"INTERMEDIATES_CLEARED",title:t("settings.intermediatesCleared",{count:u}),status:"info"})}).catch(()=>{he({id:"INTERMEDIATES_CLEAR_FAILED",title:t("settings.intermediatesClearedFailed"),status:"error"})})},[t,r,c]);return{intermediatesCount:n,clearIntermediates:d,isLoading:a,hasPendingItems:c,refetchIntermediatesCount:s}},Qpe=ze.enum(["ar","az","de","en","es","fi","fr","he","hu","it","ja","ko","nl","pl","pt","pt_BR","ru","sv","tr","ua","zh_CN","zh_Hant"]),Ype=e=>Qpe.safeParse(e).success,Jpe={ar:"",az:"Azrbaycan dili",de:"Deutsch",en:"English",es:"Espaol",fi:"Suomi",fr:"Franais",he:"",hu:"Magyar Nyelv",it:"Italiano",ja:"",ko:"",nl:"Nederlands",pl:"Polski",pt:"Portugus",pt_BR:"Portugus do Brasil",ru:"",sv:"Svenska",tr:"Trke",ua:"",zh_CN:"",zh_Hant:""},Z2=To(Jpe,(e,t)=>({label:e,value:t})),z6=l.memo(()=>{const{t:e}=S(),t=E(),n=w(KM),s=dn("localization"),r=l.useMemo(()=>Z2.find(i=>i.value===n),[n]),a=l.useCallback(i=>{Ype(i==null?void 0:i.value)&&t(x7(i.value))},[t]);return o.jsxs(V,{isDisabled:!s,children:[o.jsx(U,{children:e("common.languagePickerLabel")}),o.jsx(Ne,{value:r,options:Z2,onChange:a})]})});z6.displayName="SettingsLanguageSelect";const Xpe={shouldShowDeveloperSettings:!0,shouldShowResetWebUiText:!0,shouldShowClearIntermediates:!0,shouldShowLocalizationToggle:!0},[efe]=wi(!1),tfe=({config:e=Xpe,children:t})=>{const n=E(),{t:s}=S();l.useEffect(()=>{e!=null&&e.shouldShowDeveloperSettings||n(mk(!1))},[n,e==null?void 0:e.shouldShowDeveloperSettings]);const{isNSFWCheckerAvailable:r,isWatermarkerAvailable:a}=VS(void 0,{selectFromResult:({data:G})=>({isNSFWCheckerAvailable:(G==null?void 0:G.nsfw_methods.includes("nsfw_checker"))??!1,isWatermarkerAvailable:(G==null?void 0:G.watermarking_methods.includes("invisible_watermark"))??!1})}),{clearIntermediates:i,hasPendingItems:c,intermediatesCount:d,isLoading:u,refetchIntermediatesCount:h}=Kpe(!!(e!=null&&e.shouldShowClearIntermediates)),p=efe(),f=qM(),m=w(b7),g=w(y7),x=w(Gx),C=w(v7),y=w(C7),v=w(w7),I=w(j7),k=w(Ud),M=l.useCallback(()=>{n(Ix())},[n]),_=tI();l.useEffect(()=>{p.isTrue&&(e!=null&&e.shouldShowClearIntermediates)&&h()},[e==null?void 0:e.shouldShowClearIntermediates,h,p.isTrue]);const A=l.useCallback(()=>{_(),p.setFalse(),f.setTrue()},[_,p,f]),D=l.useCallback(G=>{n(cj(G.target.checked))},[n]),N=l.useCallback(G=>{n(S7(G.target.checked))},[n]),P=l.useCallback(G=>{n(k7(G.target.checked))},[n]),z=l.useCallback(G=>{n(oS(G.target.checked))},[n]),W=l.useCallback(G=>{n(I7(G.target.checked))},[n]),X=l.useCallback(G=>{n(uj(G.target.checked))},[n]),ee=l.useCallback(G=>{n(_7(G.target.checked))},[n]);return o.jsxs(o.Fragment,{children:[l.cloneElement(t,{onClick:p.setTrue}),o.jsxs(fr,{isOpen:p.isTrue,onClose:p.setFalse,size:"2xl",isCentered:!0,useInert:!1,children:[o.jsx(co,{}),o.jsxs(mr,{maxH:"80vh",h:"68rem",children:[o.jsx(Bo,{bg:"none",children:s("common.settingsLabel")}),o.jsx(Ea,{}),o.jsx(uo,{display:"flex",flexDir:"column",gap:4,children:o.jsx(Nn,{children:o.jsx(j,{flexDir:"column",gap:4,children:o.jsxs(is,{formLabelProps:{flexGrow:1},children:[o.jsxs(_r,{title:s("settings.general"),children:[o.jsxs(V,{children:[o.jsx(U,{children:s("settings.confirmOnDelete")}),o.jsx(ot,{isChecked:g,onChange:D})]}),o.jsxs(V,{children:[o.jsx(U,{children:s("settings.confirmOnNewSession")}),o.jsx(ot,{isChecked:k,onChange:M})]})]}),o.jsxs(_r,{title:s("settings.generation"),children:[o.jsxs(V,{isDisabled:!r,children:[o.jsx(U,{children:s("settings.enableNSFWChecker")}),o.jsx(ot,{isChecked:y,onChange:N})]}),o.jsxs(V,{isDisabled:!a,children:[o.jsx(U,{children:s("settings.enableInvisibleWatermark")}),o.jsx(ot,{isChecked:v,onChange:P})]})]}),o.jsxs(_r,{title:s("settings.ui"),children:[o.jsxs(V,{children:[o.jsx(U,{children:s("settings.showProgressInViewer")}),o.jsx(ot,{isChecked:x,onChange:z})]}),o.jsxs(V,{children:[o.jsx(U,{children:s("settings.antialiasProgressImages")}),o.jsx(ot,{isChecked:C,onChange:W})]}),o.jsxs(V,{children:[o.jsx(Be,{feature:"noiseUseCPU",inPortal:!1,children:o.jsx(U,{children:s("parameters.useCpuNoise")})}),o.jsx(ot,{isChecked:m,onChange:ee})]}),!!(e!=null&&e.shouldShowLocalizationToggle)&&o.jsx(z6,{}),o.jsxs(V,{children:[o.jsx(U,{children:s("settings.enableInformationalPopovers")}),o.jsx(ot,{isChecked:I,onChange:X})]})]}),!!(e!=null&&e.shouldShowDeveloperSettings)&&o.jsxs(_r,{title:s("settings.developer"),children:[o.jsx(B6,{}),o.jsx($6,{}),o.jsx(F6,{})]}),!!(e!=null&&e.shouldShowClearIntermediates)&&o.jsxs(_r,{title:s("settings.clearIntermediates"),children:[o.jsx(me,{tooltip:c?s("settings.clearIntermediatesDisabled"):void 0,colorScheme:"warning",onClick:i,isLoading:u,isDisabled:!d||c,children:s("settings.clearIntermediatesWithCount",{count:d??0})}),o.jsx(O,{fontWeight:"bold",children:s("settings.clearIntermediatesDesc1")}),o.jsx(O,{variant:"subtext",children:s("settings.clearIntermediatesDesc2")}),o.jsx(O,{variant:"subtext",children:s("settings.clearIntermediatesDesc3")})]}),o.jsxs(_r,{title:s("settings.resetWebUI"),children:[o.jsx(me,{colorScheme:"error",onClick:A,children:s("settings.resetWebUI")}),!!(e!=null&&e.shouldShowResetWebUiText)&&o.jsxs(o.Fragment,{children:[o.jsx(O,{variant:"subtext",children:s("settings.resetWebUIDesc1")}),o.jsx(O,{variant:"subtext",children:s("settings.resetWebUIDesc2")})]})]})]})})})}),o.jsx(La,{})]})]})]})},nfe=l.memo(tfe),q2=({menuText:e,menuIcon:t})=>{const{t:n}=S();return o.jsx(Ae,{label:n("upsell.professionalUpsell"),placement:"right",gutter:16,children:o.jsx(_e,{as:"a",href:"http://invoke.com/pricing",target:"_blank",icon:t({}),children:o.jsxs(j,{gap:"1",alignItems:"center",justifyContent:"space-between",children:[o.jsx(O,{children:e}),o.jsx(it,{as:AI,color:"invokeYellow.500"})]})})})},sfe=()=>{const{t:e}=S(),{isOpen:t,onOpen:n,onClose:s}=Is();Qd(s);const r=dn("bugLink"),a=dn("discordLink"),i=dn("githubLink");return o.jsxs(Ta,{isOpen:t,onOpen:n,onClose:s,autoSelect:!1,children:[o.jsx(Pa,{as:Q,variant:"link","aria-label":e("accessibility.menu"),icon:o.jsx(xc,{fontSize:20}),boxSize:8}),o.jsx(Zd,{children:o.jsxs(Un,{children:[o.jsxs(os,{title:e("upsell.professional"),children:[o.jsx(q2,{menuText:e("upsell.inviteTeammates"),menuIcon:xG}),o.jsx(q2,{menuText:e("upsell.shareAccess"),menuIcon:SG})]}),o.jsxs(os,{title:e("common.communityLabel"),children:[i&&o.jsx(_e,{as:"a",href:tx,target:"_blank",icon:o.jsx(qpe,{}),children:e("common.githubLabel")}),r&&o.jsx(_e,{as:"a",href:`${tx}/issues`,target:"_blank",icon:o.jsx(DW,{}),children:e("common.reportBugLabel")}),a&&o.jsx(_e,{as:"a",href:N6,target:"_blank",icon:o.jsx(Zpe,{}),children:e("common.discordLabel")})]}),o.jsxs(os,{title:e("common.settingsLabel"),children:[o.jsx(Upe,{children:o.jsx(_e,{as:"button",icon:o.jsx(XW,{}),children:e("common.hotkeysLabel")})}),o.jsx(nfe,{children:o.jsx(_e,{as:"button",icon:o.jsx(kG,{}),children:e("common.settingsLabel")})})]}),o.jsx(os,{title:e("accessibility.about"),children:o.jsx(Vpe,{children:o.jsx(_e,{as:"button",icon:o.jsx(Li,{}),children:e("accessibility.about")})})})]})})]})},ofe=l.memo(sfe),rfe=()=>{const e=se(On),{t}=S();return e?null:o.jsx(Ae,{label:t("common.statusDisconnected"),placement:"end",shouldWrapChildren:!0,gutter:10,children:o.jsx(it,{as:lf,color:"error.300"})})},afe=l.memo(rfe),il=l.memo(({tab:e,children:t})=>{const n=l.useMemo(()=>pe(Gs,r=>!r.disabledTabs.includes(e)),[e]);return w(n)?t:null});il.displayName="TabMountGate";const ife="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAACXBIWXMAACxLAAAsSwGlPZapAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAANISURBVHgB7ZvBSxRRHMe/763rmolu1CEjcaWjB4WgyEuuEHRTQroGgtcyvLdud1O7Ch46RoHegqDyIhQE+w+EE0J2KBhNMl13Xu83pc6sovMcZ97gmw8s7Lx97PL77e/7e7/3ezMMdayKS/3CwSAghuRlAWcAwVgFQlQ4z5bb2XfL+xnbfbMsCvkc1ktw2BjOMpxNb6Gl3MUsmy5dB5DxjWLjPROiFwZAEbHNWorkBE4D9M+bYjxBtuawUXLfr4rLBeFUl2EgzGFFDqdagqHUuBjiAsyY0K9H6n+QfatdFDAYDsNJHQDDMd4BDVDkSuYnkoxM6krzUwnAcNIcgJCoau60CZuTUgnAcEJLYGlxJ9C8tjaG7t4MgrJiOVj56iBqQjtgeGAt0LzWPMPbz3l0FIIF3csXW5gs/0bUxCaBdVvg8cgGkkasOWBpsYo3C9tIEsoS6OvPKs13tWzV9q7HZBR8+nLBlcRRXO3kyr91EiJviJAD7lxfkxLYT2ijD5tQnjqPJBC5BCjpjT7K+cZmn/8JvHpETWwtsZvXbJ8UyDG0KhwnhaiJLQlOzflDnqRBkaCb2BzQdzsrpdDkG6N1nhyhk1iXwfEnzTL0/dWg7togVgeQ3svPmn1jVBvMzuiTgpZzgeGBddfwXVTL5NNEy25waq5FGr3/0zrLZC0OoH96vHTON6arTNZ6NFYvBR21gdaGCEnBCy2JcWyBvWh1wGFSiLtM1n46TAmQNkv1ZfJHuWOMA+09QdL7YWXy5NNNxEEimqKHlcmzM5uxlMnKEqDMrcr9Bzn3dRQkhRtyx+jtG5AUOjqDN1KJV+9aleYrd4S8y1ZQbgXo7JAUpqUURu792hv7102KNgoSdS5wd7DRlUOcJO5gpL5MjprQ5wJBNKeiY9L9a/mda3aw0D9JTvIS2gFRhGx3DzlMLfmdlPRwFIYTWgJJv2foOFIJwHDSHABFdN8TdNqkEoDhpA6A4ZADLJgKYxUu91wLMBRBT5NmHDYPQ+G8Vubt2R8fHAczMAyyuZ3ZlpsEqw21CTBRgSHQo7Ouzfi/CnQx295iTtGESCAbt9lOkWym6wOnkKsiXxC1zAQ468HZeZ7YkoYvZMDmSfLeD/4CAK41g1vx5woAAAAASUVORK5CYII=",lfe=pe(Gs,e=>e.isLocal),cfe=()=>{const{t:e}=S(),t=w(lfe);return o.jsxs(j,{gap:4,flexDir:"column",children:[o.jsxs(Si,{fontSize:"sm",children:[o.jsx(Qt,{children:e("whatsNew.canvasV2Announcement.newCanvas")}),o.jsx(Qt,{children:e("whatsNew.canvasV2Announcement.newLayerTypes")}),o.jsx(Qt,{children:e("whatsNew.canvasV2Announcement.fluxSupport")})]}),o.jsxs(j,{flexDir:"column",gap:1,children:[o.jsx(wa,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.canvasV2Announcement.readReleaseNotes"),href:t?"https://github.com/invoke-ai/InvokeAI/releases/tag/v5.0.0":"https://support.invoke.ai/support/solutions/articles/151000178246"}),o.jsx(wa,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.canvasV2Announcement.watchReleaseVideo"),href:"https://www.youtube.com/watch?v=y80W3PjR0Gc"}),o.jsx(wa,{fontSize:"sm",fontWeight:"semibold",label:e("whatsNew.canvasV2Announcement.watchUiUpdatesOverview"),href:"https://www.youtube.com/watch?v=Tl-69JvwJ2s"})]})]})},dfe=pe(Gs,e=>e.isLocal),ufe=()=>{const{t:e}=S(),t=E(),n=w(i=>i.ui.shouldShowNotification),s=l.useCallback(()=>{t(M7(!1))},[t]),{data:r}=Cb(),a=w(dfe);return r?o.jsxs(Qn,{onClose:s,placement:"top-start",autoFocus:!1,defaultIsOpen:n,children:[o.jsx(ds,{children:o.jsx(j,{pos:"relative",children:o.jsx(Q,{"aria-label":"Notifications",variant:"link",icon:o.jsx(eG,{fontSize:20}),boxSize:8})})}),o.jsxs(Yn,{p:2,children:[o.jsx(Zr,{}),o.jsx(hj,{}),o.jsx(A7,{fontSize:"md",fontWeight:"semibold",pt:5,children:o.jsxs(j,{alignItems:"center",gap:3,children:[o.jsx(nn,{src:ife,boxSize:6}),e("whatsNew.whatsNewInInvoke"),a&&o.jsx(O,{variant:"subtext",children:`v${r.version}`})]})}),o.jsx(Jn,{p:2,children:o.jsx(cfe,{})})]})]}):null},ll=l.memo(l.forwardRef(({tab:e,icon:t,label:n},s)=>{const r=E(),a=w(bn),i=l.useCallback(()=>{r(Tt(e))},[r,e]);return o.jsx(Ae,{label:n,placement:"end",children:o.jsx(Q,{ref:s,p:0,onClick:i,icon:t,size:"md",fontSize:"24px",variant:"appTab","data-selected":a===e,"aria-label":n,"data-testid":n})})}));ll.displayName="TabButton";const V6=l.memo(()=>{const{t:e}=S(),t=se(E7);return o.jsxs(j,{flexDir:"column",alignItems:"center",py:2,gap:4,minW:0,children:[o.jsx($pe,{}),o.jsxs(j,{gap:4,pt:6,h:"full",flexDir:"column",children:[o.jsx(il,{tab:"canvas",children:o.jsx(ll,{tab:"canvas",icon:o.jsx(fc,{}),label:e("ui.tabs.canvas")})}),o.jsx(il,{tab:"upscaling",children:o.jsx(ll,{tab:"upscaling",icon:o.jsx(vu,{}),label:e("ui.tabs.upscaling")})}),o.jsx(il,{tab:"workflows",children:o.jsx(ll,{tab:"workflows",icon:o.jsx(of,{}),label:e("ui.tabs.workflows")})}),o.jsx(il,{tab:"models",children:o.jsx(ll,{tab:"models",icon:o.jsx($W,{}),label:e("ui.tabs.models")})}),o.jsx(il,{tab:"queue",children:o.jsx(ll,{tab:"queue",icon:o.jsx(GI,{}),label:e("ui.tabs.queue")})})]}),o.jsx(dt,{}),o.jsx(afe,{}),o.jsx(ufe,{}),t||o.jsx(ofe,{})]})});V6.displayName="VerticalNavBar";const K2=0,H6=-10,W6=10,hfe=-10,pfe=10,Q2=1,Y2=1,ffe=[H6,0,W6],mfe=()=>{const e=w(L7),t=E(),{t:n}=S(),s=l.useCallback(r=>{t(T7(r))},[t]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"creativity",children:o.jsx(U,{children:n("upscaling.creativity")})}),o.jsx(qe,{value:e,defaultValue:K2,min:H6,max:W6,step:Q2,fineStep:Y2,onChange:s,marks:ffe}),o.jsx(Ve,{value:e,defaultValue:K2,min:hfe,max:pfe,step:Q2,fineStep:Y2,onChange:s})]})},gfe=l.memo(mfe),xfe=()=>{const{t:e}=S(),[t,{isLoading:n}]=_u(),s=w(gk),r=E(),a=l.useMemo(()=>{var f;if(!(!t.length||!s))return(f=t.find(m=>m.key===(s==null?void 0:s.key)))==null?void 0:f.description},[t,s]),i=l.useCallback(f=>{r(P7(f))},[r]),{options:c,value:d,onChange:u,placeholder:h,noOptionsMessage:p}=jc({modelConfigs:t,onChange:i,selectedModel:s,isLoading:n});return o.jsxs(V,{orientation:"vertical",children:[o.jsx(Be,{feature:"upscaleModel",children:o.jsx(U,{children:e("upscaling.upscaleModel")})}),o.jsx(Ae,{label:a,children:o.jsx(xe,{w:"full",children:o.jsx(Ne,{value:d,placeholder:h,options:c,onChange:u,noOptionsMessage:p,isDisabled:c.length===0})})})]})},bfe=l.memo(xfe),J2=0,G6=-10,U6=10,yfe=-10,vfe=10,X2=1,ew=1,Cfe=[G6,0,U6],wfe=()=>{const e=w(R7),t=E(),{t:n}=S(),s=l.useCallback(r=>{t(D7(r))},[t]);return o.jsxs(V,{children:[o.jsx(Be,{feature:"structure",children:o.jsx(U,{children:n("upscaling.structure")})}),o.jsx(qe,{value:e,defaultValue:J2,min:G6,max:U6,step:X2,fineStep:ew,onChange:s,marks:Cfe}),o.jsx(Ve,{value:e,defaultValue:J2,min:yfe,max:vfe,step:X2,fineStep:ew,onChange:s})]})},jfe=l.memo(wfe),Sfe=[2,4,8],tw=e=>`${e}x`,Z6=l.memo(()=>{const e=E(),{t}=S(),n=w(O7),s=l.useCallback(r=>{e(N7(r))},[e]);return o.jsxs(V,{orientation:"vertical",gap:0,children:[o.jsx(Be,{feature:"scale",children:o.jsx(U,{m:0,children:t("upscaling.scale")})}),o.jsxs(j,{w:"full",gap:4,children:[o.jsx(qe,{min:2,max:8,value:n,onChange:s,marks:Sfe,formatValue:tw,defaultValue:4}),o.jsx(Ve,{maxW:20,value:n,onChange:s,defaultValue:4,min:2,max:16,format:tw})]})]})});Z6.displayName="UpscaleScaleSlider";const kfe=()=>{const e=E(),t=w(xk),n=l.useMemo(()=>({actionType:"SET_UPSCALE_INITIAL_IMAGE",id:"upscale-intial-image"}),[]),s=l.useMemo(()=>({type:"SET_UPSCALE_INITIAL_IMAGE"}),[]),r=l.useCallback(()=>{e(xj(null))},[e]);return o.jsx(j,{justifyContent:"flex-start",children:o.jsxs(j,{position:"relative",w:36,h:36,alignItems:"center",justifyContent:"center",children:[o.jsx(Di,{droppableData:n,imageDTO:t||void 0,postUploadAction:s}),t&&o.jsxs(o.Fragment,{children:[o.jsx(j,{position:"absolute",flexDir:"column",top:1,insetInlineEnd:1,gap:1,children:o.jsx(Ic,{onClick:r,icon:o.jsx(Kr,{size:16}),tooltip:ve("common.reset")})}),o.jsx(O,{position:"absolute",background:"base.900",color:"base.50",fontSize:"sm",fontWeight:"semibold",bottom:0,left:0,opacity:.7,px:2,lineHeight:1.25,borderTopEndRadius:"base",borderBottomStartRadius:"base",pointerEvents:"none",children:`${t.width}x${t.height}`})]})]})})},Ife=e=>pt(Gd,Gs,(t,n)=>{const{upscaleModel:s,scale:r}=t,{maxUpscaleDimension:a}=n;if(!a||!s||!e)return!1;const{width:i,height:c}=e,d=a**2;return i*r*c*r>d}),_fe=e=>{const t=l.useMemo(()=>Ife(e),[e]);return w(t)},Mfe=()=>{const{t:e}=S(),t=w(Zp),n=w(gk),s=w(B7),r=w(xk),a=E(),[i,{isLoading:c}]=a1(),d=w(ib),u=w($7),h=_fe(r);l.useEffect(()=>{const g=i.find(x=>x.base===(t==null?void 0:t.base)&&x.name.toLowerCase().includes("tile"));a(F7(g||null))},[t==null?void 0:t.base,i,a]);const p=l.useMemo(()=>{const g=[];return t||g.push(e("upscaling.mainModelDesc")),s||g.push(e("upscaling.tileControlNetModelDesc")),n||g.push(e("upscaling.upscaleModelDesc")),g},[t,s,n,e]),f=l.useMemo(()=>{const g=[];return h&&u&&g.push(e("upscaling.exceedsMaxSizeDetails",{maxUpscaleDimension:u.toLocaleString()})),g},[h,e,u]),m=l.useCallback(()=>{a(Tt("models")),mi.set(3)},[a]);return p.length&&d||!p.length&&!f.length||c?null:o.jsxs(j,{bg:"error.500",borderRadius:"base",padding:4,direction:"column",fontSize:"sm",gap:2,children:[!!p.length&&o.jsx(O,{children:o.jsx(Cs,{i18nKey:"upscaling.missingModelsWarning",components:{LinkComponent:o.jsx(me,{size:"sm",flexGrow:0,variant:"link",color:"base.50",onClick:m})}})}),o.jsx(Si,{children:[...p,...f].map(g=>o.jsx(Qt,{children:g},g))})]})},Afe=pt([Gd],e=>{const{upscaleModel:t,upscaleInitialImage:n,scale:s}=e,r=[];if(t&&r.push(t.name),n){const a=t?iv(t.base):iv(null),i=Zh(n.width*s,a),c=Zh(n.height*s,a);r.push(`${i}${c}`)}return{badges:r}}),q6=l.memo(()=>{const{t:e}=S(),{badges:t}=w(Afe),{isOpen:n,onToggle:s}=Oc({id:"upscale-settings",defaultIsOpen:!0}),{isOpen:r,onToggle:a}=K1({id:"upscale-settings-advanced",defaultIsOpen:!1});return o.jsx(lc,{label:e("upscaling.upscale"),badges:t,isOpen:n,onToggle:s,children:o.jsxs(j,{pt:4,px:4,w:"full",h:"full",flexDir:"column","data-testid":"upscale-settings-accordion",children:[o.jsxs(j,{flexDir:"column",gap:4,children:[o.jsxs(j,{gap:4,children:[o.jsx(kfe,{}),o.jsxs(j,{direction:"column",w:"full",alignItems:"center",gap:2,minW:0,children:[o.jsx(bfe,{}),o.jsx(Z6,{})]})]}),o.jsx(Mfe,{})]}),o.jsx(mb,{label:e("accordions.advanced.options"),isOpen:r,onToggle:a,children:o.jsxs(j,{gap:4,pb:4,flexDir:"column",children:[o.jsx(gfe,{}),o.jsx(jfe,{})]})})]})})});q6.displayName="UpscaleSettingsAccordion";const nw={height:"100%",width:"100%"},Efe=()=>{const e=se(Wl);return o.jsxs(j,{w:"full",h:"full",flexDir:"column",gap:2,children:[o.jsx(TR,{}),o.jsx(j,{w:"full",h:"full",position:"relative",children:o.jsxs(xe,{position:"absolute",top:0,left:0,right:0,bottom:0,children:[e&&o.jsx(Vr,{defer:!0,style:nw,options:zr.options,children:o.jsx(j,{gap:2,flexDirection:"column",h:"full",w:"full",children:o.jsx(LR,{})})}),o.jsx(Vr,{defer:!0,style:nw,options:zr.options,children:o.jsxs(j,{gap:2,flexDirection:"column",h:"full",w:"full",children:[o.jsx(W1,{}),o.jsx(q6,{}),o.jsx(Q1,{}),o.jsx(q1,{})]})})]})})]})},Lfe=l.memo(Efe),vh={position:"relative",height:"100%",width:"100%",minWidth:0},Tfe=e=>Gg.set(!e),Pfe=e=>H7.set(!e),K6=l.memo(()=>{const e=l.useRef(null),t=w(z7),n=l.useMemo(()=>({id:"left-panel",minSizePx:lv,defaultSizePx:lv,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:Tfe}),[]),s=B0(n);Ie({id:"toggleLeftPanel",category:"app",callback:s.toggle,options:{enabled:t},dependencies:[s.toggle,t]});const r=w(V7),a=l.useMemo(()=>({id:"right-panel",minSizePx:cv,defaultSizePx:cv,imperativePanelGroupRef:e,panelGroupDirection:"horizontal",onCollapse:Pfe}),[]),i=B0(a);return Ie({id:"toggleRightPanel",category:"app",callback:i.toggle,options:{enabled:r},dependencies:[i.toggle,r]}),Ie({id:"resetPanelLayout",category:"app",callback:()=>{s.reset(),i.reset()},dependencies:[s.reset,i.reset]}),Ie({id:"togglePanels",category:"app",callback:()=>{s.isCollapsed||i.isCollapsed?(s.expand(),i.expand()):(s.collapse(),i.collapse())},dependencies:[s.isCollapsed,i.isCollapsed,s.expand,i.expand,s.collapse,i.collapse]}),o.jsxs(j,{id:"invoke-app-tabs",w:"full",h:"full",gap:4,p:4,children:[o.jsx(V6,{}),o.jsxs(Lu,{ref:e,id:"app-panel-group",autoSaveId:"app-panel-group",direction:"horizontal",style:vh,children:[t&&o.jsxs(o.Fragment,{children:[o.jsx(or,{order:0,collapsible:!0,style:vh,...s.panelProps,children:o.jsxs(j,{flexDir:"column",w:"full",h:"full",gap:2,children:[o.jsx(aoe,{}),o.jsx(xe,{position:"relative",w:"full",h:"full",children:o.jsx(Y6,{})})]})}),o.jsx(Md,{id:"left-main-handle",...s.resizeHandleProps})]}),o.jsxs(or,{id:"main-panel",order:1,minSize:20,style:vh,children:[o.jsx(J6,{}),t&&o.jsx(uoe,{panelApi:s}),r&&o.jsx(loe,{panelApi:i})]}),r&&o.jsxs(o.Fragment,{children:[o.jsx(Md,{id:"main-right-handle",...i.resizeHandleProps}),o.jsx(or,{order:2,style:vh,collapsible:!0,...i.panelProps,children:o.jsx(Q6,{})})]})]})]})});K6.displayName="AppContent";const Q6=l.memo(()=>{const e=w(bn);return e==="canvas"?o.jsx(mP,{}):e==="upscaling"||e==="workflows"?o.jsx(fP,{}):null});Q6.displayName="RightPanelContent";const Y6=l.memo(()=>{const e=w(bn);return e==="canvas"?o.jsx(vae,{}):e==="upscaling"?o.jsx(Lfe,{}):e==="workflows"?o.jsx(Xse,{}):null});Y6.displayName="LeftPanelContent";const J6=l.memo(()=>{const e=w(bn);return e==="canvas"?o.jsx(oT,{}):e==="upscaling"?o.jsx(em,{}):e==="workflows"?o.jsx(D6,{}):e==="models"?o.jsx(Uae,{}):e==="queue"?o.jsx(lce,{}):null});J6.displayName="MainPanelContent";const Rfe=l.createContext(null),_g={didCatch:!1,error:null};class Dfe extends l.Component{constructor(t){super(t),this.resetErrorBoundary=this.resetErrorBoundary.bind(this),this.state=_g}static getDerivedStateFromError(t){return{didCatch:!0,error:t}}resetErrorBoundary(){const{error:t}=this.state;if(t!==null){for(var n,s,r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];(n=(s=this.props).onReset)===null||n===void 0||n.call(s,{args:a,reason:"imperative-api"}),this.setState(_g)}}componentDidCatch(t,n){var s,r;(s=(r=this.props).onError)===null||s===void 0||s.call(r,t,n)}componentDidUpdate(t,n){const{didCatch:s}=this.state,{resetKeys:r}=this.props;if(s&&n.error!==null&&Ofe(t.resetKeys,r)){var a,i;(a=(i=this.props).onReset)===null||a===void 0||a.call(i,{next:r,prev:t.resetKeys,reason:"keys"}),this.setState(_g)}}render(){const{children:t,fallbackRender:n,FallbackComponent:s,fallback:r}=this.props,{didCatch:a,error:i}=this.state;let c=t;if(a){const d={error:i,resetErrorBoundary:this.resetErrorBoundary};if(typeof n=="function")c=n(d);else if(s)c=l.createElement(s,d);else if(r===null||l.isValidElement(r))c=r;else throw i}return l.createElement(Rfe.Provider,{value:{didCatch:a,error:i,resetErrorBoundary:this.resetErrorBoundary}},c)}}function Ofe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[];return e.length!==t.length||e.some((n,s)=>!Object.is(n,t[s]))}const Nfe="default",Bfe=Ge(Nfe);function $fe(e){navigator.clipboard.writeText(e)}const Ffe={OutOfMemoryError:"toast.outOfMemoryError"},zfe={OutOfMemoryError:"toast.outOfMemoryErrorDesc"},Vfe=e=>ve(Ffe[e]??"toast.serverError");function Hfe({errorType:e,errorMessage:t,sessionId:n,isLocal:s}){const{t:r}=S(),a=l.useMemo(()=>{const i=s?null:zfe[e];if(i)return r(i);if(t)return`${e}: ${t}`},[t,e,s,r]);return o.jsxs(j,{flexDir:"column",children:[a&&o.jsx(O,{noOfLines:4,fontSize:"md",children:a}),!s&&o.jsxs(j,{gap:"2",alignItems:"center",children:[o.jsx(O,{fontSize:"sm",fontStyle:"italic",children:r("toast.sessionRef",{sessionId:n})}),o.jsx(Q,{size:"sm","aria-label":"Copy",icon:o.jsx(gr,{}),onClick:$fe.bind(null,n),variant:"ghost",sx:Wfe})]})]})}const Wfe={svg:{fill:"base.50"}},sw=Do("events"),Gfe=e=>e.invocation_source_id.split(":")[0]==="canvas_output",Ufe=["load_image","image"],Zfe=(e,t)=>{const n=(c,d)=>{if(Ufe.includes(c.invocation.type)){sw.trace("Skipping node type denylisted");return}if(d.is_intermediate)return;t(G7.util.updateQueryData("getBoardImagesTotal",d.board_id??"none",m=>{m.total+=1})),t(U7.util.invalidateTags([{type:"Board",id:d.board_id??"none"},{type:"ImageList",id:Z7({board_id:d.board_id??"none",categories:q7(d)})}]));const{shouldAutoSwitch:u,selectedBoardId:h,galleryView:p,offset:f}=e().gallery;u&&(d.board_id&&d.board_id!==h?t(vd({boardId:d.board_id,selectedImageName:d.image_name})):!d.board_id&&h!=="none"?t(vd({boardId:"none",selectedImageName:d.image_name})):(t(yx(d)),p!=="images"?t(Hg("images")):f>0&&t(tS({offset:0}))))},s=c=>{const{result:d}=c;return d.type==="image_output"?Hl(d.image.image_name):null},r=async c=>{const{result:d,invocation_source_id:u}=c,h=cn(sl.get()[u]);h&&(h.status=vs.enum.COMPLETED,h.progress!==null&&(h.progress=1),h.outputs.push(d),kh(h.nodeId,h));const p=await s(c);p&&!p.is_intermediate&&n(c,p)},a=async c=>{const d=await s(c);d&&(c.destination==="canvas"?Gfe(c)&&(c.result.type==="image_output"&&t(W7({stagingAreaImage:{imageDTO:d,offsetX:0,offsetY:0}})),n(c,d)):d.is_intermediate||n(c,d))},i=async c=>{const d=await s(c);d&&!d.is_intermediate&&n(c,d)};return async c=>{sw.debug({data:c},`Invocation complete (${c.invocation.type}, ${c.invocation_source_id})`),c.origin==="workflows"?await r(c):c.origin==="canvas"?await a(c):await i(c),Tr.set(null)}},Ft=Do("events"),Ua=sa.endpoints.listModelInstalls.select(),qfe=({socket:e,store:t,setIsConnected:n})=>{const{dispatch:s,getState:r}=t;e.on("connect",()=>{Ft.debug("Connected"),n(!0),s(K7());const i=Q7.get();if(e.emit("subscribe_queue",{queue_id:i}),!bk.get()){const c=Bfe.get();e.emit("subscribe_bulk_download",{bulk_download_id:c})}Tr.set(null)}),e.on("connect_error",i=>{Ft.debug("Connect error"),n(!1),Tr.set(null),i&&i.message&&i.data==="ERR_UNAUTHENTICATED"&&he({id:`connect-error-${i.message}`,title:i.message,status:"error",duration:1e4})}),e.on("disconnect",()=>{Ft.debug("Disconnected"),Tr.set(null),n(!1)}),e.on("invocation_started",i=>{const{invocation_source_id:c,invocation:d}=i;Ft.debug({data:i},`Invocation started (${d.type}, ${c})`);const u=cn(sl.get()[c]);u&&(u.status=vs.enum.IN_PROGRESS,kh(u.nodeId,u))}),e.on("invocation_progress",i=>{const{invocation_source_id:c,invocation:d,image:u,origin:h,percentage:p,message:f}=i;let m="Invocation progress";if(f&&(m+=`: ${f}`),Ut(p)||(m+=` ${wb(p*100,2)}%`),m+=` (${d.type}, ${c})`,Ft.trace({data:i},m),Tr.set(i),h==="workflows"){const g=cn(sl.get()[c]);g&&(g.status=vs.enum.IN_PROGRESS,g.progress=p,g.progressImage=u??null,kh(g.nodeId,g))}}),e.on("invocation_error",i=>{const{invocation_source_id:c,invocation:d,error_type:u,error_message:h,error_traceback:p}=i;Ft.error({data:i},`Invocation error (${d.type}, ${c})`);const f=cn(sl.get()[c]);f&&(f.status=vs.enum.FAILED,f.progress=null,f.progressImage=null,f.error={error_type:u,error_message:h,error_traceback:p},kh(f.nodeId,f))});const a=Zfe(r,s);e.on("invocation_complete",a),e.on("model_load_started",i=>{const{config:c,submodel_type:d}=i,{name:u,base:h,type:p}=c,f=[h,p];d&&f.push(d);const m=`Model load started: ${u} (${f.join(", ")})`;Ft.debug({data:i},m)}),e.on("model_load_complete",i=>{const{config:c,submodel_type:d}=i,{name:u,base:h,type:p}=c,f=[h,p];d&&f.push(d);const m=`Model load complete: ${u} (${f.join(", ")})`;Ft.debug({data:i},m)}),e.on("download_started",i=>{Ft.debug({data:i},"Download started")}),e.on("download_progress",i=>{Ft.trace({data:i},"Download progress")}),e.on("download_complete",i=>{Ft.debug({data:i},"Download complete")}),e.on("download_cancelled",i=>{Ft.warn({data:i},"Download cancelled")}),e.on("download_error",i=>{Ft.error({data:i},"Download error")}),e.on("model_install_started",i=>{Ft.debug({data:i},"Model install started");const{id:c}=i,d=Ua(r()).data;d!=null&&d.find(u=>u.id===c)?s(sa.util.updateQueryData("listModelInstalls",void 0,u=>{const h=u.find(p=>p.id===c);return h&&(h.status="running"),u})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_started",i=>{Ft.debug({data:i},"Model install download started");const{id:c}=i,d=Ua(r()).data;d!=null&&d.find(u=>u.id===c)?s(sa.util.updateQueryData("listModelInstalls",void 0,u=>{const h=u.find(p=>p.id===c);return h&&(h.status="downloading"),u})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_download_progress",i=>{Ft.trace({data:i},"Model install download progress");const{bytes:c,total_bytes:d,id:u}=i,h=Ua(r()).data;h!=null&&h.find(p=>p.id===u)?s(sa.util.updateQueryData("listModelInstalls",void 0,p=>{const f=p.find(m=>m.id===u);return f&&(f.bytes=c,f.total_bytes=d,f.status="downloading"),p})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_downloads_complete",i=>{Ft.debug({data:i},"Model install downloads complete");const{id:c}=i,d=Ua(r()).data;d!=null&&d.find(u=>u.id===c)?s(sa.util.updateQueryData("listModelInstalls",void 0,u=>{const h=u.find(p=>p.id===c);return h&&(h.status="downloads_done"),u})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_complete",i=>{Ft.debug({data:i},"Model install complete");const{id:c}=i,d=Ua(r()).data;d!=null&&d.find(u=>u.id===c)?s(sa.util.updateQueryData("listModelInstalls",void 0,u=>{const h=u.find(p=>p.id===c);return h&&(h.status="completed"),u})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}])),s(Ho.util.invalidateTags([{type:"ModelConfig",id:Go}])),s(Ho.util.invalidateTags([{type:"ModelScanFolderResults",id:Go}]))}),e.on("model_install_error",i=>{Ft.error({data:i},"Model install error");const{id:c,error:d,error_type:u}=i,h=Ua(r()).data;h!=null&&h.find(p=>p.id===c)?s(sa.util.updateQueryData("listModelInstalls",void 0,p=>{const f=p.find(m=>m.id===c);return f&&(f.status="error",f.error_reason=u,f.error=d),p})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("model_install_cancelled",i=>{Ft.warn({data:i},"Model install cancelled");const{id:c}=i,d=Ua(r()).data;d!=null&&d.find(u=>u.id===c)?s(sa.util.updateQueryData("listModelInstalls",void 0,u=>{const h=u.find(p=>p.id===c);return h&&(h.status="cancelled"),u})):s(Ho.util.invalidateTags([{type:"ModelInstalls"}]))}),e.on("queue_item_status_changed",i=>{const{item_id:c,session_id:d,status:u,started_at:h,updated_at:p,completed_at:f,batch_status:m,queue_status:g,error_type:x,error_message:C,error_traceback:y,destination:v}=i;Ft.debug({data:i},`Queue item ${c} status updated: ${u}`),s(ul.util.updateQueryData("listQueueItems",void 0,k=>{Y7.updateOne(k,{id:String(c),changes:{status:u,started_at:h,updated_at:p??void 0,completed_at:f??void 0,error_type:x,error_message:C,error_traceback:y}})})),s(ul.util.updateQueryData("getQueueStatus",void 0,k=>{k&&Object.assign(k.queue,g)})),s(ul.util.updateQueryData("getBatchStatus",{batch_id:m.batch_id},()=>m));const I=["CurrentSessionQueueItem","NextSessionQueueItem","InvocationCacheStatus",{type:"SessionQueueItem",id:c}];if(v&&I.push({type:"QueueCountsByDestination",id:v}),s(ul.util.invalidateTags(I)),u==="in_progress")sj(sl.get(),k=>{if(!k)return;const M=cn(k);M.status=vs.enum.PENDING,M.error=null,M.progress=null,M.progressImage=null,M.outputs=[],sl.setKey(M.nodeId,M)});else if(u==="failed"&&x){const k=r().config.isLocal??!0,M=d;he({id:`INVOCATION_ERROR_${x}`,title:Vfe(x),status:"error",duration:null,updateDescription:k,description:o.jsx(Hfe,{errorType:x,errorMessage:C,sessionId:M,isLocal:k})})}else(u==="completed"||u==="failed"||u==="canceled")&&Tr.set(null)}),e.on("queue_cleared",i=>{Ft.debug({data:i},"Queue cleared")}),e.on("batch_enqueued",i=>{Ft.debug({data:i},"Batch enqueued")}),e.on("bulk_download_started",i=>{Ft.debug({data:i},"Bulk gallery download preparation started")}),e.on("bulk_download_complete",i=>{Ft.debug({data:i},"Bulk gallery download ready");const{bulk_download_item_name:c}=i,d=`/api/v1/images/download/${c}`;he({id:c,title:ve("gallery.bulkDownloadReady","Download ready"),status:"success",description:o.jsx(wa,{label:ve("gallery.clickToDownload","Click here to download"),href:d,download:c}),duration:null})}),e.on("bulk_download_error",i=>{Ft.error({data:i},"Bulk gallery download error");const{bulk_download_item_name:c,error:d}=i;he({id:c,title:ve("gallery.bulkDownloadFailed"),status:"error",description:d,duration:null})})},dr=Object.create(null);dr.open="0";dr.close="1";dr.ping="2";dr.pong="3";dr.message="4";dr.upgrade="5";dr.noop="6";const zh=Object.create(null);Object.keys(dr).forEach(e=>{zh[dr[e]]=e});const nx={type:"error",data:"parser error"},X6=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",eD=typeof ArrayBuffer=="function",tD=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e&&e.buffer instanceof ArrayBuffer,gy=({type:e,data:t},n,s)=>X6&&t instanceof Blob?n?s(t):ow(t,s):eD&&(t instanceof ArrayBuffer||tD(t))?n?s(t):ow(new Blob([t]),s):s(dr[e]+(t||"")),ow=(e,t)=>{const n=new FileReader;return n.onload=function(){const s=n.result.split(",")[1];t("b"+(s||""))},n.readAsDataURL(e)};function rw(e){return e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer,e.byteOffset,e.byteLength)}let Mg;function Kfe(e,t){if(X6&&e.data instanceof Blob)return e.data.arrayBuffer().then(rw).then(t);if(eD&&(e.data instanceof ArrayBuffer||tD(e.data)))return t(rw(e.data));gy(e,!1,n=>{Mg||(Mg=new TextEncoder),t(Mg.encode(n))})}const aw="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",rd=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let e=0;e<aw.length;e++)rd[aw.charCodeAt(e)]=e;const Qfe=e=>{let t=e.length*.75,n=e.length,s,r=0,a,i,c,d;e[e.length-1]==="="&&(t--,e[e.length-2]==="="&&t--);const u=new ArrayBuffer(t),h=new Uint8Array(u);for(s=0;s<n;s+=4)a=rd[e.charCodeAt(s)],i=rd[e.charCodeAt(s+1)],c=rd[e.charCodeAt(s+2)],d=rd[e.charCodeAt(s+3)],h[r++]=a<<2|i>>4,h[r++]=(i&15)<<4|c>>2,h[r++]=(c&3)<<6|d&63;return u},Yfe=typeof ArrayBuffer=="function",xy=(e,t)=>{if(typeof e!="string")return{type:"message",data:nD(e,t)};const n=e.charAt(0);return n==="b"?{type:"message",data:Jfe(e.substring(1),t)}:zh[n]?e.length>1?{type:zh[n],data:e.substring(1)}:{type:zh[n]}:nx},Jfe=(e,t)=>{if(Yfe){const n=Qfe(e);return nD(n,t)}else return{base64:!0,data:e}},nD=(e,t)=>{switch(t){case"blob":return e instanceof Blob?e:new Blob([e]);case"arraybuffer":default:return e instanceof ArrayBuffer?e:e.buffer}},sD="",Xfe=(e,t)=>{const n=e.length,s=new Array(n);let r=0;e.forEach((a,i)=>{gy(a,!1,c=>{s[i]=c,++r===n&&t(s.join(sD))})})},eme=(e,t)=>{const n=e.split(sD),s=[];for(let r=0;r<n.length;r++){const a=xy(n[r],t);if(s.push(a),a.type==="error")break}return s};function tme(){return new TransformStream({transform(e,t){Kfe(e,n=>{const s=n.length;let r;if(s<126)r=new Uint8Array(1),new DataView(r.buffer).setUint8(0,s);else if(s<65536){r=new Uint8Array(3);const a=new DataView(r.buffer);a.setUint8(0,126),a.setUint16(1,s)}else{r=new Uint8Array(9);const a=new DataView(r.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(s))}e.data&&typeof e.data!="string"&&(r[0]|=128),t.enqueue(r),t.enqueue(n)})}})}let Ag;function Ch(e){return e.reduce((t,n)=>t+n.length,0)}function wh(e,t){if(e[0].length===t)return e.shift();const n=new Uint8Array(t);let s=0;for(let r=0;r<t;r++)n[r]=e[0][s++],s===e[0].length&&(e.shift(),s=0);return e.length&&s<e[0].length&&(e[0]=e[0].slice(s)),n}function nme(e,t){Ag||(Ag=new TextDecoder);const n=[];let s=0,r=-1,a=!1;return new TransformStream({transform(i,c){for(n.push(i);;){if(s===0){if(Ch(n)<1)break;const d=wh(n,1);a=(d[0]&128)===128,r=d[0]&127,r<126?s=3:r===126?s=1:s=2}else if(s===1){if(Ch(n)<2)break;const d=wh(n,2);r=new DataView(d.buffer,d.byteOffset,d.length).getUint16(0),s=3}else if(s===2){if(Ch(n)<8)break;const d=wh(n,8),u=new DataView(d.buffer,d.byteOffset,d.length),h=u.getUint32(0);if(h>Math.pow(2,21)-1){c.enqueue(nx);break}r=h*Math.pow(2,32)+u.getUint32(4),s=3}else{if(Ch(n)<r)break;const d=wh(n,r);c.enqueue(xy(a?d:Ag.decode(d),t)),s=0}if(r===0||r>e){c.enqueue(nx);break}}}})}const oD=4;function gn(e){if(e)return sme(e)}function sme(e){for(var t in gn.prototype)e[t]=gn.prototype[t];return e}gn.prototype.on=gn.prototype.addEventListener=function(e,t){return this._callbacks=this._callbacks||{},(this._callbacks["$"+e]=this._callbacks["$"+e]||[]).push(t),this};gn.prototype.once=function(e,t){function n(){this.off(e,n),t.apply(this,arguments)}return n.fn=t,this.on(e,n),this};gn.prototype.off=gn.prototype.removeListener=gn.prototype.removeAllListeners=gn.prototype.removeEventListener=function(e,t){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var n=this._callbacks["$"+e];if(!n)return this;if(arguments.length==1)return delete this._callbacks["$"+e],this;for(var s,r=0;r<n.length;r++)if(s=n[r],s===t||s.fn===t){n.splice(r,1);break}return n.length===0&&delete this._callbacks["$"+e],this};gn.prototype.emit=function(e){this._callbacks=this._callbacks||{};for(var t=new Array(arguments.length-1),n=this._callbacks["$"+e],s=1;s<arguments.length;s++)t[s-1]=arguments[s];if(n){n=n.slice(0);for(var s=0,r=n.length;s<r;++s)n[s].apply(this,t)}return this};gn.prototype.emitReserved=gn.prototype.emit;gn.prototype.listeners=function(e){return this._callbacks=this._callbacks||{},this._callbacks["$"+e]||[]};gn.prototype.hasListeners=function(e){return!!this.listeners(e).length};const gm=typeof Promise=="function"&&typeof Promise.resolve=="function"?t=>Promise.resolve().then(t):(t,n)=>n(t,0),to=typeof self<"u"?self:typeof window<"u"?window:Function("return this")(),ome="arraybuffer";function rD(e,...t){return t.reduce((n,s)=>(e.hasOwnProperty(s)&&(n[s]=e[s]),n),{})}const rme=to.setTimeout,ame=to.clearTimeout;function xm(e,t){t.useNativeTimers?(e.setTimeoutFn=rme.bind(to),e.clearTimeoutFn=ame.bind(to)):(e.setTimeoutFn=to.setTimeout.bind(to),e.clearTimeoutFn=to.clearTimeout.bind(to))}const ime=1.33;function lme(e){return typeof e=="string"?cme(e):Math.ceil((e.byteLength||e.size)*ime)}function cme(e){let t=0,n=0;for(let s=0,r=e.length;s<r;s++)t=e.charCodeAt(s),t<128?n+=1:t<2048?n+=2:t<55296||t>=57344?n+=3:(s++,n+=4);return n}function aD(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function dme(e){let t="";for(let n in e)e.hasOwnProperty(n)&&(t.length&&(t+="&"),t+=encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return t}function ume(e){let t={},n=e.split("&");for(let s=0,r=n.length;s<r;s++){let a=n[s].split("=");t[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return t}class hme extends Error{constructor(t,n,s){super(t),this.description=n,this.context=s,this.type="TransportError"}}class by extends gn{constructor(t){super(),this.writable=!1,xm(this,t),this.opts=t,this.query=t.query,this.socket=t.socket,this.supportsBinary=!t.forceBase64}onError(t,n,s){return super.emitReserved("error",new hme(t,n,s)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(t){this.readyState==="open"&&this.write(t)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(t){const n=xy(t,this.socket.binaryType);this.onPacket(n)}onPacket(t){super.emitReserved("packet",t)}onClose(t){this.readyState="closed",super.emitReserved("close",t)}pause(t){}createUri(t,n={}){return t+"://"+this._hostname()+this._port()+this.opts.path+this._query(n)}_hostname(){const t=this.opts.hostname;return t.indexOf(":")===-1?t:"["+t+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(t){const n=dme(t);return n.length?"?"+n:""}}class pme extends by{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(t){this.readyState="pausing";const n=()=>{this.readyState="paused",t()};if(this._polling||!this.writable){let s=0;this._polling&&(s++,this.once("pollComplete",function(){--s||n()})),this.writable||(s++,this.once("drain",function(){--s||n()}))}else n()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(t){const n=s=>{if(this.readyState==="opening"&&s.type==="open"&&this.onOpen(),s.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(s)};eme(t,this.socket.binaryType).forEach(n),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const t=()=>{this.write([{type:"close"}])};this.readyState==="open"?t():this.once("open",t)}write(t){this.writable=!1,Xfe(t,n=>{this.doWrite(n,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const t=this.opts.secure?"https":"http",n=this.query||{};return this.opts.timestampRequests!==!1&&(n[this.opts.timestampParam]=aD()),!this.supportsBinary&&!n.sid&&(n.b64=1),this.createUri(t,n)}}let iD=!1;try{iD=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const fme=iD;function mme(){}class gme extends pme{constructor(t){if(super(t),typeof location<"u"){const n=location.protocol==="https:";let s=location.port;s||(s=n?"443":"80"),this.xd=typeof location<"u"&&t.hostname!==location.hostname||s!==t.port}}doWrite(t,n){const s=this.request({method:"POST",data:t});s.on("success",n),s.on("error",(r,a)=>{this.onError("xhr post error",r,a)})}doPoll(){const t=this.request();t.on("data",this.onData.bind(this)),t.on("error",(n,s)=>{this.onError("xhr poll error",n,s)}),this.pollXhr=t}}class rr extends gn{constructor(t,n,s){super(),this.createRequest=t,xm(this,s),this._opts=s,this._method=s.method||"GET",this._uri=n,this._data=s.data!==void 0?s.data:null,this._create()}_create(){var t;const n=rD(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");n.xdomain=!!this._opts.xd;const s=this._xhr=this.createRequest(n);try{s.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){s.setDisableHeaderCheck&&s.setDisableHeaderCheck(!0);for(let r in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(r)&&s.setRequestHeader(r,this._opts.extraHeaders[r])}}catch{}if(this._method==="POST")try{s.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{s.setRequestHeader("Accept","*/*")}catch{}(t=this._opts.cookieJar)===null||t===void 0||t.addCookies(s),"withCredentials"in s&&(s.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(s.timeout=this._opts.requestTimeout),s.onreadystatechange=()=>{var r;s.readyState===3&&((r=this._opts.cookieJar)===null||r===void 0||r.parseCookies(s.getResponseHeader("set-cookie"))),s.readyState===4&&(s.status===200||s.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof s.status=="number"?s.status:0)},0))},s.send(this._data)}catch(r){this.setTimeoutFn(()=>{this._onError(r)},0);return}typeof document<"u"&&(this._index=rr.requestsCount++,rr.requests[this._index]=this)}_onError(t){this.emitReserved("error",t,this._xhr),this._cleanup(!0)}_cleanup(t){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=mme,t)try{this._xhr.abort()}catch{}typeof document<"u"&&delete rr.requests[this._index],this._xhr=null}}_onLoad(){const t=this._xhr.responseText;t!==null&&(this.emitReserved("data",t),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}}rr.requestsCount=0;rr.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",iw);else if(typeof addEventListener=="function"){const e="onpagehide"in to?"pagehide":"unload";addEventListener(e,iw,!1)}}function iw(){for(let e in rr.requests)rr.requests.hasOwnProperty(e)&&rr.requests[e].abort()}const xme=function(){const e=lD({xdomain:!1});return e&&e.responseType!==null}();class bme extends gme{constructor(t){super(t);const n=t&&t.forceBase64;this.supportsBinary=xme&&!n}request(t={}){return Object.assign(t,{xd:this.xd},this.opts),new rr(lD,this.uri(),t)}}function lD(e){const t=e.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!t||fme))return new XMLHttpRequest}catch{}if(!t)try{return new to[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const cD=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class yme extends by{get name(){return"websocket"}doOpen(){const t=this.uri(),n=this.opts.protocols,s=cD?{}:rD(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(s.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(t,n,s)}catch(r){return this.emitReserved("error",r)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=t=>this.onClose({description:"websocket connection closed",context:t}),this.ws.onmessage=t=>this.onData(t.data),this.ws.onerror=t=>this.onError("websocket error",t)}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],r=n===t.length-1;gy(s,this.supportsBinary,a=>{try{this.doWrite(s,a)}catch{}r&&gm(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.close(),this.ws=null)}uri(){const t=this.opts.secure?"wss":"ws",n=this.query||{};return this.opts.timestampRequests&&(n[this.opts.timestampParam]=aD()),this.supportsBinary||(n.b64=1),this.createUri(t,n)}}const Eg=to.WebSocket||to.MozWebSocket;class vme extends yme{createSocket(t,n,s){return cD?new Eg(t,n,s):n?new Eg(t,n):new Eg(t)}doWrite(t,n){this.ws.send(n)}}class Cme extends by{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(t){return this.emitReserved("error",t)}this._transport.closed.then(()=>{this.onClose()}).catch(t=>{this.onError("webtransport error",t)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(t=>{const n=nme(Number.MAX_SAFE_INTEGER,this.socket.binaryType),s=t.readable.pipeThrough(n).getReader(),r=tme();r.readable.pipeTo(t.writable),this._writer=r.writable.getWriter();const a=()=>{s.read().then(({done:c,value:d})=>{c||(this.onPacket(d),a())}).catch(c=>{})};a();const i={type:"open"};this.query.sid&&(i.data=`{"sid":"${this.query.sid}"}`),this._writer.write(i).then(()=>this.onOpen())})})}write(t){this.writable=!1;for(let n=0;n<t.length;n++){const s=t[n],r=n===t.length-1;this._writer.write(s).then(()=>{r&&gm(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var t;(t=this._transport)===null||t===void 0||t.close()}}const wme={websocket:vme,webtransport:Cme,polling:bme},jme=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Sme=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function sx(e){if(e.length>8e3)throw"URI too long";const t=e,n=e.indexOf("["),s=e.indexOf("]");n!=-1&&s!=-1&&(e=e.substring(0,n)+e.substring(n,s).replace(/:/g,";")+e.substring(s,e.length));let r=jme.exec(e||""),a={},i=14;for(;i--;)a[Sme[i]]=r[i]||"";return n!=-1&&s!=-1&&(a.source=t,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=kme(a,a.path),a.queryKey=Ime(a,a.query),a}function kme(e,t){const n=/\/{2,9}/g,s=t.replace(n,"/").split("/");return(t.slice(0,1)=="/"||t.length===0)&&s.splice(0,1),t.slice(-1)=="/"&&s.splice(s.length-1,1),s}function Ime(e,t){const n={};return t.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(s,r,a){r&&(n[r]=a)}),n}const ox=typeof addEventListener=="function"&&typeof removeEventListener=="function",Vh=[];ox&&addEventListener("offline",()=>{Vh.forEach(e=>e())},!1);class ka extends gn{constructor(t,n){if(super(),this.binaryType=ome,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,t&&typeof t=="object"&&(n=t,t=null),t){const s=sx(t);n.hostname=s.host,n.secure=s.protocol==="https"||s.protocol==="wss",n.port=s.port,s.query&&(n.query=s.query)}else n.host&&(n.hostname=sx(n.host).host);xm(this,n),this.secure=n.secure!=null?n.secure:typeof location<"u"&&location.protocol==="https:",n.hostname&&!n.port&&(n.port=this.secure?"443":"80"),this.hostname=n.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=n.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},n.transports.forEach(s=>{const r=s.prototype.name;this.transports.push(r),this._transportsByName[r]=s}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},n),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=ume(this.opts.query)),ox&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Vh.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(t){const n=Object.assign({},this.opts.query);n.EIO=oD,n.transport=t,this.id&&(n.sid=this.id);const s=Object.assign({},this.opts,{query:n,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[t]);return new this._transportsByName[t](s)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const t=this.opts.rememberUpgrade&&ka.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const n=this.createTransport(t);n.open(),this.setTransport(n)}setTransport(t){this.transport&&this.transport.removeAllListeners(),this.transport=t,t.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",n=>this._onClose("transport close",n))}onOpen(){this.readyState="open",ka.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",t),this.emitReserved("heartbeat"),t.type){case"open":this.onHandshake(JSON.parse(t.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const n=new Error("server error");n.code=t.data,this._onError(n);break;case"message":this.emitReserved("data",t.data),this.emitReserved("message",t.data);break}}onHandshake(t){this.emitReserved("handshake",t),this.id=t.sid,this.transport.query.sid=t.sid,this._pingInterval=t.pingInterval,this._pingTimeout=t.pingTimeout,this._maxPayload=t.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const t=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+t,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},t),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const t=this._getWritablePackets();this.transport.send(t),this._prevBufferLen=t.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let n=1;for(let s=0;s<this.writeBuffer.length;s++){const r=this.writeBuffer[s].data;if(r&&(n+=lme(r)),s>0&&n>this._maxPayload)return this.writeBuffer.slice(0,s);n+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const t=Date.now()>this._pingTimeoutTime;return t&&(this._pingTimeoutTime=0,gm(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),t}write(t,n,s){return this._sendPacket("message",t,n,s),this}send(t,n,s){return this._sendPacket("message",t,n,s),this}_sendPacket(t,n,s,r){if(typeof n=="function"&&(r=n,n=void 0),typeof s=="function"&&(r=s,s=null),this.readyState==="closing"||this.readyState==="closed")return;s=s||{},s.compress=s.compress!==!1;const a={type:t,data:n,options:s};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),r&&this.once("flush",r),this.flush()}close(){const t=()=>{this._onClose("forced close"),this.transport.close()},n=()=>{this.off("upgrade",n),this.off("upgradeError",n),t()},s=()=>{this.once("upgrade",n),this.once("upgradeError",n)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?s():t()}):this.upgrading?s():t()),this}_onError(t){if(ka.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",t),this._onClose("transport error",t)}_onClose(t,n){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),ox&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const s=Vh.indexOf(this._offlineEventListener);s!==-1&&Vh.splice(s,1)}this.readyState="closed",this.id=null,this.emitReserved("close",t,n),this.writeBuffer=[],this._prevBufferLen=0}}}ka.protocol=oD;class _me extends ka{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let t=0;t<this._upgrades.length;t++)this._probe(this._upgrades[t])}_probe(t){let n=this.createTransport(t),s=!1;ka.priorWebsocketSuccess=!1;const r=()=>{s||(n.send([{type:"ping",data:"probe"}]),n.once("packet",p=>{if(!s)if(p.type==="pong"&&p.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",n),!n)return;ka.priorWebsocketSuccess=n.name==="websocket",this.transport.pause(()=>{s||this.readyState!=="closed"&&(h(),this.setTransport(n),n.send([{type:"upgrade"}]),this.emitReserved("upgrade",n),n=null,this.upgrading=!1,this.flush())})}else{const f=new Error("probe error");f.transport=n.name,this.emitReserved("upgradeError",f)}}))};function a(){s||(s=!0,h(),n.close(),n=null)}const i=p=>{const f=new Error("probe error: "+p);f.transport=n.name,a(),this.emitReserved("upgradeError",f)};function c(){i("transport closed")}function d(){i("socket closed")}function u(p){n&&p.name!==n.name&&a()}const h=()=>{n.removeListener("open",r),n.removeListener("error",i),n.removeListener("close",c),this.off("close",d),this.off("upgrading",u)};n.once("open",r),n.once("error",i),n.once("close",c),this.once("close",d),this.once("upgrading",u),this._upgrades.indexOf("webtransport")!==-1&&t!=="webtransport"?this.setTimeoutFn(()=>{s||n.open()},200):n.open()}onHandshake(t){this._upgrades=this._filterUpgrades(t.upgrades),super.onHandshake(t)}_filterUpgrades(t){const n=[];for(let s=0;s<t.length;s++)~this.transports.indexOf(t[s])&&n.push(t[s]);return n}}let Mme=class extends _me{constructor(t,n={}){const s=typeof t=="object"?t:n;(!s.transports||s.transports&&typeof s.transports[0]=="string")&&(s.transports=(s.transports||["polling","websocket","webtransport"]).map(r=>wme[r]).filter(r=>!!r)),super(t,s)}};function Ame(e,t="",n){let s=e;n=n||typeof location<"u"&&location,e==null&&(e=n.protocol+"//"+n.host),typeof e=="string"&&(e.charAt(0)==="/"&&(e.charAt(1)==="/"?e=n.protocol+e:e=n.host+e),/^(https?|wss?):\/\//.test(e)||(typeof n<"u"?e=n.protocol+"//"+e:e="https://"+e),s=sx(e)),s.port||(/^(http|ws)$/.test(s.protocol)?s.port="80":/^(http|ws)s$/.test(s.protocol)&&(s.port="443")),s.path=s.path||"/";const a=s.host.indexOf(":")!==-1?"["+s.host+"]":s.host;return s.id=s.protocol+"://"+a+":"+s.port+t,s.href=s.protocol+"://"+a+(n&&n.port===s.port?"":":"+s.port),s}const Eme=typeof ArrayBuffer=="function",Lme=e=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(e):e.buffer instanceof ArrayBuffer,dD=Object.prototype.toString,Tme=typeof Blob=="function"||typeof Blob<"u"&&dD.call(Blob)==="[object BlobConstructor]",Pme=typeof File=="function"||typeof File<"u"&&dD.call(File)==="[object FileConstructor]";function yy(e){return Eme&&(e instanceof ArrayBuffer||Lme(e))||Tme&&e instanceof Blob||Pme&&e instanceof File}function Hh(e,t){if(!e||typeof e!="object")return!1;if(Array.isArray(e)){for(let n=0,s=e.length;n<s;n++)if(Hh(e[n]))return!0;return!1}if(yy(e))return!0;if(e.toJSON&&typeof e.toJSON=="function"&&arguments.length===1)return Hh(e.toJSON(),!0);for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)&&Hh(e[n]))return!0;return!1}function Rme(e){const t=[],n=e.data,s=e;return s.data=rx(n,t),s.attachments=t.length,{packet:s,buffers:t}}function rx(e,t){if(!e)return e;if(yy(e)){const n={_placeholder:!0,num:t.length};return t.push(e),n}else if(Array.isArray(e)){const n=new Array(e.length);for(let s=0;s<e.length;s++)n[s]=rx(e[s],t);return n}else if(typeof e=="object"&&!(e instanceof Date)){const n={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=rx(e[s],t));return n}return e}function Dme(e,t){return e.data=ax(e.data,t),delete e.attachments,e}function ax(e,t){if(!e)return e;if(e&&e._placeholder===!0){if(typeof e.num=="number"&&e.num>=0&&e.num<t.length)return t[e.num];throw new Error("illegal attachments")}else if(Array.isArray(e))for(let n=0;n<e.length;n++)e[n]=ax(e[n],t);else if(typeof e=="object")for(const n in e)Object.prototype.hasOwnProperty.call(e,n)&&(e[n]=ax(e[n],t));return e}const Ome=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Nme=5;var ft;(function(e){e[e.CONNECT=0]="CONNECT",e[e.DISCONNECT=1]="DISCONNECT",e[e.EVENT=2]="EVENT",e[e.ACK=3]="ACK",e[e.CONNECT_ERROR=4]="CONNECT_ERROR",e[e.BINARY_EVENT=5]="BINARY_EVENT",e[e.BINARY_ACK=6]="BINARY_ACK"})(ft||(ft={}));class Bme{constructor(t){this.replacer=t}encode(t){return(t.type===ft.EVENT||t.type===ft.ACK)&&Hh(t)?this.encodeAsBinary({type:t.type===ft.EVENT?ft.BINARY_EVENT:ft.BINARY_ACK,nsp:t.nsp,data:t.data,id:t.id}):[this.encodeAsString(t)]}encodeAsString(t){let n=""+t.type;return(t.type===ft.BINARY_EVENT||t.type===ft.BINARY_ACK)&&(n+=t.attachments+"-"),t.nsp&&t.nsp!=="/"&&(n+=t.nsp+","),t.id!=null&&(n+=t.id),t.data!=null&&(n+=JSON.stringify(t.data,this.replacer)),n}encodeAsBinary(t){const n=Rme(t),s=this.encodeAsString(n.packet),r=n.buffers;return r.unshift(s),r}}function lw(e){return Object.prototype.toString.call(e)==="[object Object]"}class vy extends gn{constructor(t){super(),this.reviver=t}add(t){let n;if(typeof t=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");n=this.decodeString(t);const s=n.type===ft.BINARY_EVENT;s||n.type===ft.BINARY_ACK?(n.type=s?ft.EVENT:ft.ACK,this.reconstructor=new $me(n),n.attachments===0&&super.emitReserved("decoded",n)):super.emitReserved("decoded",n)}else if(yy(t)||t.base64)if(this.reconstructor)n=this.reconstructor.takeBinaryData(t),n&&(this.reconstructor=null,super.emitReserved("decoded",n));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+t)}decodeString(t){let n=0;const s={type:Number(t.charAt(0))};if(ft[s.type]===void 0)throw new Error("unknown packet type "+s.type);if(s.type===ft.BINARY_EVENT||s.type===ft.BINARY_ACK){const a=n+1;for(;t.charAt(++n)!=="-"&&n!=t.length;);const i=t.substring(a,n);if(i!=Number(i)||t.charAt(n)!=="-")throw new Error("Illegal attachments");s.attachments=Number(i)}if(t.charAt(n+1)==="/"){const a=n+1;for(;++n&&!(t.charAt(n)===","||n===t.length););s.nsp=t.substring(a,n)}else s.nsp="/";const r=t.charAt(n+1);if(r!==""&&Number(r)==r){const a=n+1;for(;++n;){const i=t.charAt(n);if(i==null||Number(i)!=i){--n;break}if(n===t.length)break}s.id=Number(t.substring(a,n+1))}if(t.charAt(++n)){const a=this.tryParse(t.substr(n));if(vy.isPayloadValid(s.type,a))s.data=a;else throw new Error("invalid payload")}return s}tryParse(t){try{return JSON.parse(t,this.reviver)}catch{return!1}}static isPayloadValid(t,n){switch(t){case ft.CONNECT:return lw(n);case ft.DISCONNECT:return n===void 0;case ft.CONNECT_ERROR:return typeof n=="string"||lw(n);case ft.EVENT:case ft.BINARY_EVENT:return Array.isArray(n)&&(typeof n[0]=="number"||typeof n[0]=="string"&&Ome.indexOf(n[0])===-1);case ft.ACK:case ft.BINARY_ACK:return Array.isArray(n)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class $me{constructor(t){this.packet=t,this.buffers=[],this.reconPack=t}takeBinaryData(t){if(this.buffers.push(t),this.buffers.length===this.reconPack.attachments){const n=Dme(this.reconPack,this.buffers);return this.finishedReconstruction(),n}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Fme=Object.freeze(Object.defineProperty({__proto__:null,Decoder:vy,Encoder:Bme,get PacketType(){return ft},protocol:Nme},Symbol.toStringTag,{value:"Module"}));function So(e,t,n){return e.on(t,n),function(){e.off(t,n)}}const zme=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class uD extends gn{constructor(t,n,s){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=t,this.nsp=n,s&&s.auth&&(this.auth=s.auth),this._opts=Object.assign({},s),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const t=this.io;this.subs=[So(t,"open",this.onopen.bind(this)),So(t,"packet",this.onpacket.bind(this)),So(t,"error",this.onerror.bind(this)),So(t,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...t){return t.unshift("message"),this.emit.apply(this,t),this}emit(t,...n){var s,r,a;if(zme.hasOwnProperty(t))throw new Error('"'+t.toString()+'" is a reserved event name');if(n.unshift(t),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(n),this;const i={type:ft.EVENT,data:n};if(i.options={},i.options.compress=this.flags.compress!==!1,typeof n[n.length-1]=="function"){const h=this.ids++,p=n.pop();this._registerAckCallback(h,p),i.id=h}const c=(r=(s=this.io.engine)===null||s===void 0?void 0:s.transport)===null||r===void 0?void 0:r.writable,d=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!c||(d?(this.notifyOutgoingListeners(i),this.packet(i)):this.sendBuffer.push(i)),this.flags={},this}_registerAckCallback(t,n){var s;const r=(s=this.flags.timeout)!==null&&s!==void 0?s:this._opts.ackTimeout;if(r===void 0){this.acks[t]=n;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[t];for(let c=0;c<this.sendBuffer.length;c++)this.sendBuffer[c].id===t&&this.sendBuffer.splice(c,1);n.call(this,new Error("operation has timed out"))},r),i=(...c)=>{this.io.clearTimeoutFn(a),n.apply(this,c)};i.withError=!0,this.acks[t]=i}emitWithAck(t,...n){return new Promise((s,r)=>{const a=(i,c)=>i?r(i):s(c);a.withError=!0,n.push(a),this.emit(t,...n)})}_addToQueue(t){let n;typeof t[t.length-1]=="function"&&(n=t.pop());const s={id:this._queueSeq++,tryCount:0,pending:!1,args:t,flags:Object.assign({fromQueue:!0},this.flags)};t.push((r,...a)=>s!==this._queue[0]?void 0:(r!==null?s.tryCount>this._opts.retries&&(this._queue.shift(),n&&n(r)):(this._queue.shift(),n&&n(null,...a)),s.pending=!1,this._drainQueue())),this._queue.push(s),this._drainQueue()}_drainQueue(t=!1){if(!this.connected||this._queue.length===0)return;const n=this._queue[0];n.pending&&!t||(n.pending=!0,n.tryCount++,this.flags=n.flags,this.emit.apply(this,n.args))}packet(t){t.nsp=this.nsp,this.io._packet(t)}onopen(){typeof this.auth=="function"?this.auth(t=>{this._sendConnectPacket(t)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(t){this.packet({type:ft.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},t):t})}onerror(t){this.connected||this.emitReserved("connect_error",t)}onclose(t,n){this.connected=!1,delete this.id,this.emitReserved("disconnect",t,n),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(t=>{if(!this.sendBuffer.some(s=>String(s.id)===t)){const s=this.acks[t];delete this.acks[t],s.withError&&s.call(this,new Error("socket has been disconnected"))}})}onpacket(t){if(t.nsp===this.nsp)switch(t.type){case ft.CONNECT:t.data&&t.data.sid?this.onconnect(t.data.sid,t.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case ft.EVENT:case ft.BINARY_EVENT:this.onevent(t);break;case ft.ACK:case ft.BINARY_ACK:this.onack(t);break;case ft.DISCONNECT:this.ondisconnect();break;case ft.CONNECT_ERROR:this.destroy();const s=new Error(t.data.message);s.data=t.data.data,this.emitReserved("connect_error",s);break}}onevent(t){const n=t.data||[];t.id!=null&&n.push(this.ack(t.id)),this.connected?this.emitEvent(n):this.receiveBuffer.push(Object.freeze(n))}emitEvent(t){if(this._anyListeners&&this._anyListeners.length){const n=this._anyListeners.slice();for(const s of n)s.apply(this,t)}super.emit.apply(this,t),this._pid&&t.length&&typeof t[t.length-1]=="string"&&(this._lastOffset=t[t.length-1])}ack(t){const n=this;let s=!1;return function(...r){s||(s=!0,n.packet({type:ft.ACK,id:t,data:r}))}}onack(t){const n=this.acks[t.id];typeof n=="function"&&(delete this.acks[t.id],n.withError&&t.data.unshift(null),n.apply(this,t.data))}onconnect(t,n){this.id=t,this.recovered=n&&this._pid===n,this._pid=n,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(t=>this.emitEvent(t)),this.receiveBuffer=[],this.sendBuffer.forEach(t=>{this.notifyOutgoingListeners(t),this.packet(t)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(t=>t()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:ft.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(t){return this.flags.compress=t,this}get volatile(){return this.flags.volatile=!0,this}timeout(t){return this.flags.timeout=t,this}onAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(t),this}prependAny(t){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(t),this}offAny(t){if(!this._anyListeners)return this;if(t){const n=this._anyListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(t),this}prependAnyOutgoing(t){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(t),this}offAnyOutgoing(t){if(!this._anyOutgoingListeners)return this;if(t){const n=this._anyOutgoingListeners;for(let s=0;s<n.length;s++)if(t===n[s])return n.splice(s,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(t){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const n=this._anyOutgoingListeners.slice();for(const s of n)s.apply(this,t.data)}}}function Fc(e){e=e||{},this.ms=e.min||100,this.max=e.max||1e4,this.factor=e.factor||2,this.jitter=e.jitter>0&&e.jitter<=1?e.jitter:0,this.attempts=0}Fc.prototype.duration=function(){var e=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var t=Math.random(),n=Math.floor(t*this.jitter*e);e=Math.floor(t*10)&1?e+n:e-n}return Math.min(e,this.max)|0};Fc.prototype.reset=function(){this.attempts=0};Fc.prototype.setMin=function(e){this.ms=e};Fc.prototype.setMax=function(e){this.max=e};Fc.prototype.setJitter=function(e){this.jitter=e};class ix extends gn{constructor(t,n){var s;super(),this.nsps={},this.subs=[],t&&typeof t=="object"&&(n=t,t=void 0),n=n||{},n.path=n.path||"/socket.io",this.opts=n,xm(this,n),this.reconnection(n.reconnection!==!1),this.reconnectionAttempts(n.reconnectionAttempts||1/0),this.reconnectionDelay(n.reconnectionDelay||1e3),this.reconnectionDelayMax(n.reconnectionDelayMax||5e3),this.randomizationFactor((s=n.randomizationFactor)!==null&&s!==void 0?s:.5),this.backoff=new Fc({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(n.timeout==null?2e4:n.timeout),this._readyState="closed",this.uri=t;const r=n.parser||Fme;this.encoder=new r.Encoder,this.decoder=new r.Decoder,this._autoConnect=n.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(t){return arguments.length?(this._reconnection=!!t,t||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(t){return t===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=t,this)}reconnectionDelay(t){var n;return t===void 0?this._reconnectionDelay:(this._reconnectionDelay=t,(n=this.backoff)===null||n===void 0||n.setMin(t),this)}randomizationFactor(t){var n;return t===void 0?this._randomizationFactor:(this._randomizationFactor=t,(n=this.backoff)===null||n===void 0||n.setJitter(t),this)}reconnectionDelayMax(t){var n;return t===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=t,(n=this.backoff)===null||n===void 0||n.setMax(t),this)}timeout(t){return arguments.length?(this._timeout=t,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(t){if(~this._readyState.indexOf("open"))return this;this.engine=new Mme(this.uri,this.opts);const n=this.engine,s=this;this._readyState="opening",this.skipReconnect=!1;const r=So(n,"open",function(){s.onopen(),t&&t()}),a=c=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",c),t?t(c):this.maybeReconnectOnOpen()},i=So(n,"error",a);if(this._timeout!==!1){const c=this._timeout,d=this.setTimeoutFn(()=>{r(),a(new Error("timeout")),n.close()},c);this.opts.autoUnref&&d.unref(),this.subs.push(()=>{this.clearTimeoutFn(d)})}return this.subs.push(r),this.subs.push(i),this}connect(t){return this.open(t)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const t=this.engine;this.subs.push(So(t,"ping",this.onping.bind(this)),So(t,"data",this.ondata.bind(this)),So(t,"error",this.onerror.bind(this)),So(t,"close",this.onclose.bind(this)),So(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(t){try{this.decoder.add(t)}catch(n){this.onclose("parse error",n)}}ondecoded(t){gm(()=>{this.emitReserved("packet",t)},this.setTimeoutFn)}onerror(t){this.emitReserved("error",t)}socket(t,n){let s=this.nsps[t];return s?this._autoConnect&&!s.active&&s.connect():(s=new uD(this,t,n),this.nsps[t]=s),s}_destroy(t){const n=Object.keys(this.nsps);for(const s of n)if(this.nsps[s].active)return;this._close()}_packet(t){const n=this.encoder.encode(t);for(let s=0;s<n.length;s++)this.engine.write(n[s],t.options)}cleanup(){this.subs.forEach(t=>t()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(t,n){var s;this.cleanup(),(s=this.engine)===null||s===void 0||s.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",t,n),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const t=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const n=this.backoff.duration();this._reconnecting=!0;const s=this.setTimeoutFn(()=>{t.skipReconnect||(this.emitReserved("reconnect_attempt",t.backoff.attempts),!t.skipReconnect&&t.open(r=>{r?(t._reconnecting=!1,t.reconnect(),this.emitReserved("reconnect_error",r)):t.onreconnect()}))},n);this.opts.autoUnref&&s.unref(),this.subs.push(()=>{this.clearTimeoutFn(s)})}}onreconnect(){const t=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",t)}}const Uc={};function Wh(e,t){typeof e=="object"&&(t=e,e=void 0),t=t||{};const n=Ame(e,t.path||"/socket.io"),s=n.source,r=n.id,a=n.path,i=Uc[r]&&a in Uc[r].nsps,c=t.forceNew||t["force new connection"]||t.multiplex===!1||i;let d;return c?d=new ix(s,t):(Uc[r]||(Uc[r]=new ix(s,t)),d=Uc[r]),n.query&&!t.query&&(t.query=n.queryKey),d.socket(n.path,t)}Object.assign(Wh,{Manager:ix,Socket:uD,io:Wh,connect:Wh});const Vme=()=>{wt("useSocketIO");const e=Hj(),t=se(bk),n=se(qd),s=se(dv),r=l.useMemo(()=>{const i=window.location.protocol==="https:"?"wss":"ws";return t?t.replace(/^https?:\/\//i,""):`${i}://${window.location.host}`},[t]),a=l.useMemo(()=>{const i={timeout:6e4,path:t?"/ws/socket.io":`${window.location.pathname}ws/socket.io`,autoConnect:!1,forceNew:!0};return n&&(i.auth={token:n},i.transports=["websocket","polling"]),{...i,...s}},[n,s,t]);l.useEffect(()=>{const i=Wh(r,a);Wj.set(i),qfe({socket:i,store:e,setIsConnected:On.set}),i.connect(),uv.get()&&(window.$socketOptions=dv,console.log("Socket initialized",i));const c=e.subscribe(()=>{const d=J7(e.getState()).data;(!d||d.queue.in_progress===0)&&Tr.set(null)});return()=>{uv.get()&&(window.$socketOptions=void 0,console.log("Socket teardown",i)),c(),i.disconnect()}},[a,r,e])};function Hme(e={}){let t;if(e.repoUrl)t=e.repoUrl;else if(e.user&&e.repo)t=`https://github.com/${e.user}/${e.repo}`;else throw new Error("You need to specify either the `repoUrl` option or both the `user` and `repo` options");const n=new URL(`${t}/issues/new`),s=["body","title","labels","template","milestone","assignee","projects"];for(const r of s){let a=e[r];if(a!==void 0){if(r==="labels"||r==="projects"){if(!Array.isArray(a))throw new TypeError(`The \`${r}\` option should be an array`);a=a.join(",")}n.searchParams.set(r,a)}}return n.toString()}const Wme=pe(Gs,e=>e.isLocal),Gme=({error:e,resetErrorBoundary:t})=>{const{t:n}=S(),s=w(Wme),r=l.useCallback(()=>{const i=JSON.stringify(ya(e),null,2);navigator.clipboard.writeText(`\`\`\`
${i}
\`\`\``),he({id:"ERROR_COPIED",title:n("toast.errorCopied")})},[e,n]),a=l.useMemo(()=>s?Hme({user:"invoke-ai",repo:"InvokeAI",template:"BUG_REPORT.yml",title:`[bug]: ${e.name}: ${e.message}`}):"https://support.invoke.ai/support/tickets/new",[e.message,e.name,s]);return o.jsx(j,{layerStyle:"body",w:"100dvw",h:"100dvh",alignItems:"center",justifyContent:"center",p:4,children:o.jsxs(j,{layerStyle:"first",flexDir:"column",borderRadius:"base",justifyContent:"center",gap:8,p:16,children:[o.jsxs(j,{alignItems:"center",gap:"2",children:[o.jsx(nn,{src:O6,alt:"invoke-logo",w:"24px",h:"24px",minW:"24px",minH:"24px",userSelect:"none"}),o.jsx(Ct,{fontSize:"2xl",children:n("common.somethingWentWrong")})]}),o.jsx(j,{layerStyle:"second",px:8,py:4,gap:4,borderRadius:"base",justifyContent:"space-between",alignItems:"center",children:o.jsxs(O,{fontWeight:"semibold",color:"error.400",children:[e.name,": ",e.message]})}),o.jsxs(j,{gap:4,children:[o.jsx(me,{leftIcon:o.jsx(Kr,{}),onClick:t,children:n("accessibility.resetUI")}),o.jsx(me,{leftIcon:o.jsx(gr,{}),onClick:r,children:n("common.copyError")}),o.jsx(Xx,{href:a,isExternal:!0,children:o.jsx(me,{leftIcon:o.jsx(Lb,{}),children:n(s?"accessibility.createIssue":"accessibility.submitSupportTicket")})})]})]})})},Ume=l.memo(Gme),Zme={},qme=({config:e=Zme,studioInitAction:t})=>{const n=w(KM),s=eI("system"),r=E(),a=tI();Vme(),X7(),rW(),Qp();const{dropzone:i,isHandlingUpload:c,setIsHandlingUpload:d}=nW(),u=l.useCallback(()=>(a(),location.reload(),!1),[a]);return l.useEffect(()=>{Xe.changeLanguage(n)},[n]),l.useEffect(()=>{ec(e)&&(s.info({config:e},"Received config"),r(e9(e)))},[r,e,s]),l.useEffect(()=>{r(t9())},[r]),qV(t),OZ(),YV(),G9(),o.jsxs(Dfe,{onReset:u,FallbackComponent:Ume,children:[o.jsxs(xe,{id:"invoke-app-wrapper",w:"100dvw",h:"100dvh",position:"relative",overflow:"hidden",...i.getRootProps(),children:[o.jsx("input",{...i.getInputProps()}),o.jsx(K6,{}),i.isDragActive&&c&&o.jsx(XV,{dropzone:i,setIsHandlingUpload:d})]}),o.jsx(mW,{}),o.jsx(cW,{}),o.jsx(Z_,{}),o.jsx(UZ,{}),o.jsx(gI,{}),o.jsx(FP,{}),o.jsx(ZM,{}),o.jsx(Pse,{}),o.jsx($Z,{}),o.jsx(qZ,{}),o.jsx(ZU,{}),o.jsx(Uk,{}),o.jsx(wI,{}),o.jsx(jI,{}),o.jsx(uM,{})]})},sge=l.memo(qme);export{sge as default};
